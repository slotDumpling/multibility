(this.webpackJsonpmultibility=this.webpackJsonpmultibility||[]).push([[0],{16:function(t,e,n){},17:function(t,e,n){},21:function(t,e,n){"use strict";n.r(e);var r=n(1),i=n.n(r),c=n(11),u=n.n(c),a=(n(16),n(3)),o=(n(17),n(8),n(4)),s=n(5),h=function(){function t(e){Object(o.a)(this,t),this.context=e,this.points=[]}return Object(s.a)(t,[{key:"drawBegin",value:function(t){this.points.push(t),this.context.lineWidth=t.lineWidth,this.context.beginPath(),this.context.moveTo(t.x,t.y),this.context.stroke()}},{key:"drawCurve",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"black",n=this.points.slice(-1)[0];if(this.points.push(t),!(this.points.length<3)){var r=(t.x+n.x)/2,i=(t.y+n.y)/2;this.context.strokeStyle=e,this.context.lineCap="round",this.context.lineJoin="round",this.context.lineWidth=n.lineWidth,this.context.quadraticCurveTo(n.x,n.y,r,i),this.context.stroke(),this.context.beginPath(),this.context.moveTo(r,i)}}},{key:"computeLineWidth",value:function(t){var e;return 5*Math.log(t+1)+.8*((null===(e=this.points.slice(-1)[0])||void 0===e?void 0:e.lineWidth)||0)}}]),t}();var d=n(0);function l(t){var e=t.drawState,n=t.width,i=t.height,c=Object(r.useRef)(null),u=Object(r.useRef)();return Object(r.useEffect)((function(){if(c.current){c.current.addEventListener("touchstart",(function(t){t.preventDefault()}),{passive:!1});var t=c.current.getContext("2d");t&&(u.current=t)}}),[]),Object(r.useEffect)((function(){var t;null===(t=u.current)||void 0===t||t.clearRect(0,0,n,i),e.getValidStrokes().forEach((function(t){u.current&&function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"black",r=new h(t),i=e.slice(),c=i.shift();c&&(r.drawBegin(c),i.forEach((function(t){r.drawCurve(t,n)})))}(u.current,t.points)})),console.timeEnd("stroke")})),Object(d.jsx)("canvas",{width:n,height:i,ref:c})}function f(t){var e=t.setDrawState,n=t.method,i=t.finger,c=t.even,u=t.lineWidth,o=t.width,s=t.height,l=Object(r.useRef)(null),f=Object(r.useRef)(),v=Object(r.useRef)(o),g=Object(r.useRef)(s),b=o,j=s,k=0,m=0,p=Object(r.useState)(!1),O=Object(a.a)(p,2),S=O[0],x=O[1],w=Object(r.useRef)();function y(t){var e=t.clientX/v.current*o,n=t.clientY/g.current*s,r=[Math.floor(Math.max(Math.min(b,e-u),0)),Math.floor(Math.max(Math.min(j,n-u),0)),Math.ceil(Math.min(Math.max(k,e+u),o)),Math.ceil(Math.min(Math.max(m,n+u),s))];return b=r[0],j=r[1],k=r[2],m=r[3],[e,n]}function M(){l.current&&(v.current=l.current.clientWidth,g.current=l.current.clientHeight)}function C(){var t=f.current;if(S&&w.current&&t){var r=w.current.points;console.time("stroke");var i=function(){var i=t.getImageData(b,j,k-b,m-j);e((function(t){return n(t,{imageData:i,minX:b,minY:j,maxX:k,maxY:m},r)})),x(!1)};requestAnimationFrame((function(){requestAnimationFrame(i)}))}}return Object(r.useEffect)((function(){if(l.current){l.current.addEventListener("touchstart",(function(t){t.preventDefault()}),{passive:!1});var t=l.current.getContext("2d");t&&(f.current=t,M())}}),[]),Object(r.useEffect)((function(){var t;!1===S&&(null===(t=f.current)||void 0===t||t.clearRect(0,0,o,s))}),[S,o,s]),Object(d.jsx)("canvas",{width:o,height:s,ref:l,onTouchStart:function(t){if(f.current){x(!0),M(),w.current=new h(f.current);var e=t.touches[0];if(i||"direct"!==e.touchType){var n=(e.force||0)*u,r=y(e),o=Object(a.a)(r,2),s={x:o[0],y:o[1],lineWidth:c?u:w.current.computeLineWidth(n)};w.current.drawBegin(s)}}},onMouseDown:function(t){if(f.current){x(!0),M();var e=y(t),n=Object(a.a)(e,2),r=n[0],i=n[1];w.current=new h(f.current);var c={x:r,y:i,lineWidth:u};w.current.drawBegin(c)}},onTouchMove:function(t){if(S&&w.current){var e=t.touches[0];if(i||"direct"!==e.touchType){var n=(e.force||0)*u,r=y(e),o=Object(a.a)(r,2),s={x:o[0],y:o[1],lineWidth:c?u:w.current.computeLineWidth(n)};w.current.drawCurve(s)}}},onMouseMove:function(t){if(S&&w.current){var e=y(t),n=Object(a.a)(e,2),r={x:n[0],y:n[1],lineWidth:u};w.current.drawCurve(r)}},onTouchEnd:C,onMouseUp:C,onMouseLeave:C})}var v=n(2),g=n(7),b={state:"drawing",strokes:Object(v.a)(),uidStack:Object(v.a)(),undoStack:Object(v.b)(),eraseStack:Object(v.a)(),deleted:Object(v.d)(),position:Object(v.a)()},j=Object(v.c)(b),k=function(){function t(e,n,r){Object(o.a)(this,t),this.immutable=e,this.width=n,this.height=r}return Object(s.a)(t,[{key:"getImmutable",value:function(){return this.immutable}},{key:"getUidStack",value:function(){return this.getImmutable().get("uidStack")}},{key:"getUndoStack",value:function(){return this.getImmutable().get("undoStack")}},{key:"getEraseStack",value:function(){return this.getImmutable().get("eraseStack")}},{key:"getValidEraseStack",value:function(){var t=this.getDeleted(),e=this.getUndoStack();return this.getEraseStack().filter((function(n){var r=n.uid;return!t.has(r)&&!e.has(r)}))}},{key:"getStrokes",value:function(){return this.getImmutable().get("strokes")}},{key:"getValidStrokes",value:function(){var t=this.getDeleted(),e=this.getUndoStack(),n=this.getValidEraseStack();return this.getStrokes().filter((function(r){var i=r.uid;return!t.has(i)&&!e.has(i)&&!n.some((function(t){return t.erased.has(i)}))}))}},{key:"getDeleted",value:function(){return this.getImmutable().get("deleted")}},{key:"getState",value:function(){return this.getImmutable().get("state")}},{key:"getPosition",value:function(){return this.getImmutable().get("position")}}],[{key:"createEmpty",value:function(e,n){return new t(j(),e,n)}},{key:"undo",value:function(e){var n=e.getUidStack().last();return n?new t(e.getImmutable().set("state","revoking").update("undoStack",(function(t){return t.add(n)})).update("uidStack",(function(t){return t.pop()})),e.width,e.height):e}},{key:"redo",value:function(e){var n=e.getUndoStack().last();return n?new t(e.getImmutable().update("undoStack",(function(t){return t.butLast()})).update("uidStack",(function(t){return t.push(n)})),e.width,e.height):e}},{key:"pushStroke",value:function(e,n,r){var i=Object(g.v4)(),c=e.getUndoStack(),u=m(e.getImmutable().set("state","drawing").update("deleted",(function(t){return t.concat(c)})).set("undoStack",Object(v.b)()).update("strokes",(function(t){return t.push({uid:i,points:r})})).update("uidStack",(function(t){return t.push(i)}))),a=e.getPosition();return a=function(t,e,n,r){for(var i=e.imageData,c=i.data,u=i.width,a=i.height,o=e.minX,s=e.minY,h=new Array(u*a),d=0;d<c.length;d+=4)h[d/4]=Boolean(c[d]+c[d+1]+c[d+2]+c[d+3]);for(var l=0;l<a;l++)for(var f=0;f<u;f++){var g=(l+s)*r+f+o;h[l*u+f]&&(t=t.update(g,Object(v.d)(),(function(t){return(t||Object(v.d)()).add(n)})))}return t}(a,n,i,e.width),new t(u.set("position",a),e.width,e.height)}},{key:"eraseStrokes",value:function(e,n){var r=e.getPosition();if(!r)return e;var i=Object(g.v4)(),c=function(t,e,n){for(var r=e.imageData,i=r.data,c=r.width,u=r.height,a=e.minX,o=e.minY,s=Object(v.d)(),h=new Array(c*u),d=0;d<i.length;d+=4)h[d/4]=Boolean(i[d]+i[d+1]+i[d+2]+i[d+3]);for(var l=0;l<u;l++)for(var f=0;f<c;f++){var g=(l+o)*n+f+a;h[l*c+f]&&(s=s.concat(t.get(g)||Object(v.d)()))}return s}(r,n,e.width);return new t(m(e.getImmutable().update("eraseStack",(function(t){return t.push({uid:i,erased:c})})).update("uidStack",(function(t){return t.push(i)}))),e.width,e.height)}}]),t}();function m(t){var e=t.get("undoStack");return t.update("deleted",(function(t){return t.concat(e)})).set("undoStack",Object(v.b)()).update("uidStack",(function(t){return t.filter((function(t){return!e.has(t)}))}))}function p(t){var e=t.drawState,n=t.onChange,r=t.erasing,i=void 0!==r&&r,c=t.finger,u=void 0!==c&&c,a=t.even,o=void 0===a||a,s=t.lineWidth,h=void 0===s?10:s,v=t.width,g=void 0===v?100:v,b=t.height,j=void 0===b?100:b,m=i?k.eraseStrokes:k.pushStroke;return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(l,{width:g,height:j,drawState:e}),Object(d.jsx)(f,{method:m,width:g,height:j,finger:u,even:o,lineWidth:h,setDrawState:n})]})}var O=function(){var t=Object(r.useState)((function(){return k.createEmpty(2e3,2e3)})),e=Object(a.a)(t,2),n=e[0],i=e[1],c=Object(r.useState)(!1),u=Object(a.a)(c,2),o=u[0],s=u[1],h=Object(r.useState)(!0),l=Object(a.a)(h,2),f=l[0],v=l[1],g=Object(r.useState)(20),b=Object(a.a)(g,2),j=b[0],m=b[1];return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(p,{width:2e3,height:2e3,drawState:n,onChange:i,erasing:o,even:f,lineWidth:j}),Object(d.jsxs)("div",{style:{position:"absolute",top:0,left:0},children:[Object(d.jsx)("button",{onClick:function(){i(k.undo(n))},children:"undo"}),Object(d.jsx)("button",{onClick:function(){i(k.redo(n))},children:"redo"}),Object(d.jsxs)("span",{children:[Object(d.jsx)("input",{type:"checkbox",checked:o,onChange:function(t){s(t.target.checked)}}),Object(d.jsx)("label",{children:"eraser"})]}),Object(d.jsxs)("span",{children:[Object(d.jsx)("input",{type:"checkbox",checked:f,onChange:function(t){v(t.target.checked)}}),Object(d.jsx)("label",{children:"even"})]}),Object(d.jsx)("input",{type:"number",value:j,onChange:function(t){m(parseInt(t.target.value,10)||0)}})]})]})},S=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,22)).then((function(e){var n=e.getCLS,r=e.getFID,i=e.getFCP,c=e.getLCP,u=e.getTTFB;n(t),r(t),i(t),c(t),u(t)}))};u.a.render(Object(d.jsx)(i.a.StrictMode,{children:Object(d.jsx)(O,{})}),document.getElementById("root")),S()},8:function(t,e,n){}},[[21,1,2]]]);
//# sourceMappingURL=main.43278592.chunk.js.map