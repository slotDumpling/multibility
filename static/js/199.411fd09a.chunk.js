"use strict";(self.webpackChunkmultibility=self.webpackChunkmultibility||[]).push([[199],{27199:function(e,t,n){n.r(t),n.d(t,{default:function(){return V}});var r=n(74165),i=n(15861),o=n(29439),a=n(72791),l=n(70587),c=n(34322),s=n(91715),u=n(1413),d=n(61507),f=n(23414),v=n(82622),p=n(97804),m=n(94396),h=n(69228),x=n(87309),g=n(70776),w=n(2721),Z=n(74115),j=n(22568),C=n(80184),y={type:"text",shape:"round",size:"small"},b=function(e,t){return{"--pos-x":e+"px","--pos-y":t+"px"}},N=function(e,t){var n={};return Object.entries(e).forEach((function(e){var r=(0,o.Z)(e,2),i=r[0],a=r[1];t&&(a+=t),n["--"+i]=a})),n},S=function(e){var t=e.drawRef,n=e.visible,r=e.clickPoint,i=(0,a.useState)({}),l=(0,o.Z)(i,2),c=l[0],s=l[1];if(!r)return null;var p=r.x,m=r.y;return(0,C.jsxs)("div",{className:"select-tool tool-options","data-visible":n,style:b(p,m),children:[(0,C.jsx)(h.Z,{trigger:"click",placement:"bottom",overlayClassName:"style-pop",getPopupContainer:function(e){return e.parentElement},destroyTooltipOnHide:!0,content:(0,C.jsx)(w.Uk,{updateDrawCtrl:function(e){var n;s((function(t){return(0,u.Z)((0,u.Z)({},t),e)})),null===(n=t.current)||void 0===n||n.mutateStyle(e)},drawCtrl:c}),children:(0,C.jsx)(x.Z,(0,u.Z)({icon:(0,C.jsx)(d.Z,{})},y))}),(0,C.jsx)(x.Z,(0,u.Z)({icon:(0,C.jsx)(f.Z,{}),onClick:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.duplicateSelected()}},y)),(0,C.jsx)(x.Z,(0,u.Z)({danger:!0,icon:(0,C.jsx)(v.Z,{}),onClick:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.deleteSelected()}},y))]})},k=function(e){var t,n,r,i=e.pointText,o=e.drawRef,l=e.renderSlow,c=i.view,s=i.position,d=i.leading,f=i.content,v=i.rotation,S=i.fontFamily,k=i.fontWeight,L=i.fontSize,I=c.projectToView(s),R=I.x,W=I.y,_=i.bounds,B=_.topLeft,O=_.bottomLeft,z=c.projectToView(B),F=z.x,A=z.y,M=c.projectToView(O),Y=M.x,V=M.y,H=A<90,Q=i.viewMatrix.scaling.x,X=i.internalBounds,U=X.width,G=X.height,K=null!==(t=+d/+L)&&void 0!==t?t:1.2,q=null!==(n=null===(r=i.fillColor)||void 0===r?void 0:r.toCSS(!0))&&void 0!==n?n:Z.Qk[0],J=(0,C.jsx)(h.Z,{content:(0,C.jsx)(w.Q5,{color:q,setColor:function(e){var t;return null===(t=o.current)||void 0===t?void 0:t.mutatePointText((function(t){t.fillColor=e}))}}),trigger:"click",overlayStyle:{width:200},placement:"bottom",getPopupContainer:function(e){return e.parentElement},children:(0,C.jsx)(x.Z,(0,u.Z)((0,u.Z)({},y),{},{icon:(0,C.jsx)(j.Z,{type:"icon-circle",className:"text-color-icon",style:{color:q}})}))}),$=P(k),ee=$.isItalic,te=$.isBold,ne={fontWeight:te?"bold":"normal",fontStyle:ee?"italic":"normal"},re=(0,C.jsx)(g.Z,{className:"font-select",popupClassName:"font-drop",value:S,onChange:function(e){var t;null===(t=o.current)||void 0===t||t.mutatePointText((function(t){t.fontFamily=e}))},size:"small",bordered:!1,virtual:!1,getPopupContainer:function(e){return e.parentElement.parentElement},dropdownMatchSelectWidth:100,options:[{value:"Arial, sans-serif",name:"Arial"},{value:"'Times New Roman', serif",name:"Times"},{value:"Georgia, serif",name:"Georgia"},{value:"'Courier New', monospace",name:"Courier"}].map((function(e){var t=e.value,n=e.name;return{value:t,label:(0,C.jsx)("span",{style:{fontFamily:t,fontWeight:"normal"},children:n})}}))}),ie=(0,a.useMemo)((function(){return.75-E(S,K)}),[S,K]);return(0,C.jsxs)("div",{className:"text-tool",style:(0,u.Z)((0,u.Z)((0,u.Z)((0,u.Z)((0,u.Z)({},N({scale:Q,color:q})),N({rotation:v},"deg")),N({width:U,height:G},"px")),N({offset:ie},"em")),b(R,W)),children:[(0,C.jsx)("div",{className:"textarea-wrapper","data-empty":!f,style:(0,u.Z)({fontSize:L,fontFamily:S,lineHeight:K},ne),children:(0,C.jsx)("textarea",{autoFocus:!f,placeholder:"Text",value:f,onChange:function(e){var t;null===(t=o.current)||void 0===t||t.mutatePointText((function(t){t.content=e.target.value}))},"data-slow":l})}),(0,C.jsxs)("div",{className:"tool-options text-options","data-bottom":H,style:(0,u.Z)({},H?b(Y,V):b(F,A)),children:[(0,C.jsxs)("div",{className:"row",children:[re,J]}),(0,C.jsxs)("div",{className:"row",children:[(0,C.jsx)(x.Z,(0,u.Z)((0,u.Z)({onClick:function(){var e;null===(e=o.current)||void 0===e||e.mutatePointText((function(e){e.fontWeight=D(e.fontWeight)}))}},y),{},{type:te?"link":"text",icon:(0,C.jsx)(p.Z,{})})),(0,C.jsx)(x.Z,(0,u.Z)((0,u.Z)({onClick:function(){var e;null===(e=o.current)||void 0===e||e.mutatePointText((function(e){e.fontWeight=T(e.fontWeight)}))}},y),{},{type:ee?"link":"text",icon:(0,C.jsx)(m.Z,{})})),(0,C.jsx)(x.Z,(0,u.Z)((0,u.Z)({},y),{},{icon:(0,C.jsx)(j.Z,{type:"icon-font_size_down"}),onClick:function(){var e;null===(e=o.current)||void 0===e||e.mutatePointText((function(e){var t=e.bounds.topLeft;e.scale(.9,t)}))}})),(0,C.jsx)(x.Z,(0,u.Z)((0,u.Z)({},y),{},{icon:(0,C.jsx)(j.Z,{type:"icon-font_size_up"}),onClick:function(){var e;null===(e=o.current)||void 0===e||e.mutatePointText((function(e){var t=e.bounds.topLeft;e.scale(1.1,t)}))}}))]})]})]})},P=function(e){return{isItalic:/italic/g.test(e+=""),isBold:/bold/g.test(e)}},T=function(e){var t=P(e);return(t.isItalic?"":"italic ")+(t.isBold?"bold":"normal")},D=function(e){var t=P(e);return(t.isItalic?"italic ":"")+(t.isBold?"normal":"bold")},E=function(e,t){var n=document.createElement("div");n.innerText="p",Object.assign(n.style,{fontSize:"100px",fontFamily:e,lineHeight:t}),document.body.appendChild(n);var r=document.createElement("span");r.style.display="inline-block",n.appendChild(r);var i=n.getBoundingClientRect(),o=(r.getBoundingClientRect().y-i.y)/i.height;return document.body.removeChild(n),Math.max(-1,Math.min(o,1))},L=n(763),I=n(19348),R=n(24124),W=n(15671),_=n(43144),B=n(60136),O=n(27277),z=n(77063),F=function(e){(0,B.Z)(n,e);var t=(0,O.Z)(n);function n(){var e;(0,W.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).state={hasError:!1},e}return(0,_.Z)(n,[{key:"componentDidCatch",value:function(e,t){console.error("Uncaught error:",e,t)}},{key:"render",value:function(){return this.state.hasError?(0,C.jsx)(z.ZP,{status:"error",title:"Something went wrong."}):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{hasError:!0}}}]),n}(a.Component),A=n(52365),M=function(e){var t=e.thumbnail,l=e.drawState,c=e.teamStateMap,s=e.updateState,u=e.pdfIndex,d=e.noteID,f=void 0===d?"":d,v=e.preview,p=void 0!==v&&v,m=e.onViewChange,h=e.preload,x=void 0!==h&&h,g=e.ignores,w=void 0===g?(0,R.Set)():g,Z=e.skipInView,j=void 0!==Z&&Z,y=m&&(0,L.range)(0,1.2,.2),b=(0,I.YD)({threshold:y,skip:j}),N=(0,o.Z)(b,3),S=N[0],k=N[1],P=N[2];(0,a.useEffect)((function(){if(m)return P&&k?void m(P.intersectionRatio):m(0)}),[k,P,m]);var T=(0,a.useState)(),D=(0,o.Z)(T,2),E=D[0],W=D[1],_=(0,a.useCallback)((0,L.once)((0,i.Z)((0,r.Z)().mark((function e(){var t,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u&&f){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,Promise.all([n.e(643),n.e(867)]).then(n.bind(n,98338));case 4:return t=e.sent,i=t.getNotePageImage,e.t0=W,e.next=9,i(f,u);case 9:e.t1=e.sent,(0,e.t0)(e.t1);case 11:case"end":return e.stop()}}),e)})))),[u,f]),B=k||x;(0,a.useEffect)((function(){!p&&B&&_()}),[B,p,_]);var O=(0,a.useMemo)((function(){return null===c||void 0===c?void 0:c.deleteAll(w).toList().toArray()}),[c,w]),z=Boolean(E||!u),A=B&&z,M=l.height/l.width;return(0,C.jsx)(F,{children:(0,C.jsxs)("div",{ref:S,className:"page-wrapper","data-preview":p,children:[(0,C.jsx)("svg",{className:"size-holder",viewBox:"0 0 100 ".concat(100*M)}),A&&(0,C.jsx)(Y,{drawState:l,otherStates:O,updateState:s,imgSrc:E||t,preview:p})]})})};M.displayName="PageWrapper";var Y=function(e){var t=e.drawState,n=e.updateState,r=e.otherStates,i=e.preview,u=void 0!==i&&i,d=e.imgSrc,f=(0,l.gX)(),v=(0,a.useRef)(null),p=(0,a.useState)(!1),m=(0,o.Z)(p,2),h=m[0],x=m[1],g=(0,a.useState)(),w=(0,o.Z)(g,2),Z=w[0],j=w[1],y=(0,a.useState)(),b=(0,o.Z)(y,2),N=b[0],P=b[1],T=(0,a.useState)(!1),D=(0,o.Z)(T,2),E=D[0],L=D[1],I=(0,A.zX)((function(e){if(n){var r=e instanceof s.DrawState?e:e(t);r!==t&&n(r)}}));return u?(0,C.jsx)(c.Draw,{drawState:t,otherStates:r,imgSrc:d,readonly:!0}):(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(c.Draw,{drawState:t,otherStates:r,onChange:I,imgSrc:d,drawCtrl:f,ref:v,toggleTextTool:function(e,t){P(e),L(t)},toggleSelectTool:function(e,t){t&&j(t),x(e)}}),(0,C.jsx)(S,{drawRef:v,visible:h,clickPoint:Z}),N&&(0,C.jsx)(k,{drawRef:v,pointText:N,renderSlow:E})]})},V=a.memo(M)},70587:function(e,t,n){n.d(t,{w3:function(){return w},gX:function(){return x},F7:function(){return g}});var r=n(74165),i=n(1413),o=n(29439),a=n(15861),l=n(72791),c=n(13085),s=n(61842),u=n.n(s),d=n(763),f=n(91715),v=n(80184);function p(){return(p=(0,a.Z)((0,r.Z)().mark((function e(){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u().getItem("DRAW_CTRL");case 2:if(t=e.sent){e.next=7;break}return t=f.defaultDrawCtrl,e.next=7,u().setItem("DRAW_CTRL",t);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(){return(m=(0,a.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u().setItem("DRAW_CTRL",t);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var h=l.createContext({drawCtrl:f.defaultDrawCtrl,updateDrawCtrl:function(){}});function x(){var e=(0,l.useContext)(h).drawCtrl;return(0,l.useDebugValue)(e),e}function g(){return(0,l.useContext)(h).updateDrawCtrl}var w=function(e){var t=e.children,n=(0,l.useState)(f.defaultDrawCtrl),r=(0,o.Z)(n,2),a=r[0],c=r[1];(0,l.useEffect)((function(){(function(){return p.apply(this,arguments)})().then(c)}),[]);var s=function(e){c((function(t){var n=(0,i.Z)((0,i.Z)({},t),e);return function(e){m.apply(this,arguments)}(n),n}))},u=a.finger;return(0,l.useEffect)((function(){var e=(0,d.debounce)((function(e){e.isPrimary&&"pen"===e.pointerType&&u&&Z((function(){return s({finger:!1})}))}),1e3);return document.addEventListener("pointerup",e),function(){return document.removeEventListener("pointerup",e)}}),[u]),(0,v.jsx)(h.Provider,{value:{drawCtrl:a,updateDrawCtrl:s},children:t})},Z=(0,d.once)(function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=function(){c.Z.close("PENCIL_ONLY"),u().setItem("SKIP_PENCIL_ONLY_NOTY",!0)},e.next=3,u().getItem("SKIP_PENCIL_ONLY_NOTY");case 3:if(!e.sent){e.next=5;break}return e.abrupt("return");case 5:c.Z.info({message:"Your device supports Pencil Only",description:(0,v.jsxs)("div",{className:"pencil-noty-content",children:[(0,v.jsxs)("div",{className:"enable demo-card",onClick:function(){t(),n()},children:[(0,v.jsx)("div",{className:"title",children:"Draw with pencil only"}),(0,v.jsx)("div",{className:"stroke"}),(0,v.jsx)("div",{className:"pencil-1 emoji",children:"\u270d\ufe0f"}),(0,v.jsx)("div",{className:"finger-1 emoji",children:"\ud83e\udef5"})]}),(0,v.jsxs)("div",{className:"disable demo-card",onClick:n,children:[(0,v.jsx)("div",{className:"title",children:"Draw with fingers"}),(0,v.jsx)("div",{className:"stroke"}),(0,v.jsx)("div",{className:"finger-1 emoji",children:"\ud83e\udef5"}),(0,v.jsx)("div",{className:"finger-2 emoji",children:"\ud83e\udef5"})]})]}),icon:(0,v.jsx)(v.Fragment,{}),duration:60,className:"pencil-noty",key:"PENCIL_ONLY"});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},2721:function(e,t,n){n.d(t,{Q5:function(){return C},Uk:function(){return w},Db:function(){return Z}});var r=n(4942),i=n(93433),o=n(29439),a=n(72791),l=n(91715),c=n(35873),s=n(69228),u=n(96272),d=n(53163),f=n(35945),v=n(74115),p=n(52365),m=n(22568),h=n(24124),x=n(74689),g=n(80184),w=function(e){var t=e.updateDrawCtrl,n=e.drawCtrl,r=n.highlight,i=n.color,l=n.mode,c=(0,a.useState)(!1),s=(0,o.Z)(c,2),u=s[0],d=s[1];return(0,g.jsxs)("div",{className:"pen-panel","data-blur":u,"data-hi":r,"data-mode":l,children:[(0,g.jsxs)("div",{className:"pen-status",children:[(0,g.jsx)(Z,{updateDrawCtrl:t,drawCtrl:n,setPanelBlur:d}),(0,g.jsx)(j,{checked:r,updateDrawCtrl:t})]}),(0,g.jsx)(C,{color:i||"",setColor:function(e){return t({color:e})}})]})},Z=function(e){var t,n,f=e.updateDrawCtrl,v=e.drawCtrl,m=e.setPanelBlur,w=void 0===m?function(){}:m,Z=e.field,j=void 0===Z?"lineWidth":Z,C=v[j],y=null!==(t=v.widthList)&&void 0!==t?t:l.defaultWidthList,b="lineWidth"===j&&null!==(n=v.color)&&void 0!==n?n:"#aaa",N=(0,a.useMemo)((function(){return y.indexOf(null!==C&&void 0!==C?C:-1)}),[C,y]),S=(0,a.useState)((0,h.List)([!1,!1,!1,!1])),k=(0,o.Z)(S,2),P=k[0],T=k[1];w=(0,p.zX)(w),(0,a.useEffect)((function(){P.includes(!0)?w(!0):w(!1)}),[P,w]);var D=(0,a.useState)((function(){var e,t=document.querySelector("section.note-page");return(null!==(e=null===t||void 0===t?void 0:t.getBoundingClientRect().width)&&void 0!==e?e:0)/document.body.getBoundingClientRect().width})),E=(0,o.Z)(D,1)[0],L=function(e){return{"--real-size":"calc(".concat(100/x.m,"vw * ").concat(e," * ").concat(E,")")}},I=[{value:-1,label:null}].concat((0,i.Z)(y.map((function(e,t){return{value:t,label:(0,g.jsx)(s.Z,{open:P.get(t),onOpenChange:function(e){return T((function(n){return n.set(t,e)}))},trigger:N===t?["click"]:[],placement:"bottom",destroyTooltipOnHide:!0,content:(0,g.jsx)(u.Z,{min:5,max:100,className:"ctrl-slider",defaultValue:e,onAfterChange:function(e){if(y.includes(e))return T((function(e){return e.set(t,!1)})),f((0,r.Z)({},j,e));var n=y.slice();n[t]=e,f((0,r.Z)({widthList:n},j,e))}}),children:(0,g.jsx)("div",{className:"circle-wrapper","data-chosen":N===t,style:L(e),children:(0,g.jsx)(c.W,{className:"width-circle "+j,color:b})})})}}))));return(0,g.jsx)(d.Z,{className:"width-seg",value:N,options:I,onChange:function(e){var t;return f((0,r.Z)({},j,null!==(t=y[+e])&&void 0!==t?t:10))}})},j=function(e){var t=e.checked,n=void 0!==t&&t,r=e.updateDrawCtrl;return(0,g.jsxs)("label",{className:"hi-wrapper",children:[(0,g.jsx)("input",{type:"checkbox",name:"highlight",checked:n,onChange:function(e){return r({highlight:e.target.checked})}}),(0,g.jsx)(f.Z,{title:"Highlighter",placement:"bottom",children:(0,g.jsx)("div",{className:"hi-switch",children:(0,g.jsx)(m.Z,{type:"icon-Highlight"})})})]})},C=function(e){var t=e.setColor,n=e.color;return(0,g.jsx)("div",{className:"color-select",children:v.Qk.map((function(e){return(0,g.jsx)("div",{"data-color":e,"data-selected":n===e,className:"circle",style:{backgroundColor:e,borderColor:e},onClick:function(){return t(e)}},e)}))})}}}]);
//# sourceMappingURL=199.411fd09a.chunk.js.map