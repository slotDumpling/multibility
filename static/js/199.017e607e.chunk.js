"use strict";(self.webpackChunkmultibility=self.webpackChunkmultibility||[]).push([[199],{22568:function(e,t,n){var r=n(92721);t.Z=(0,r.Z)({scriptUrl:"//at.alicdn.com/t/c/font_3181679_61bmx4utsp.js"})},27199:function(e,t,n){n.r(t),n.d(t,{default:function(){return O}});var r=n(74165),o=n(15861),i=n(29439),a=n(72791),c=n(70587),l=n(98211),u=n(34322),s=n(91715),d=n(1413),f=n(61507),p=n(23414),v=n(82622),h=n(97804),m=n(94396),x=n(69228),g=n(87309),Z=n(70776),w=n(2721),C=n(74115),j=n(22568),y=n(80184),S={type:"text",shape:"round",size:"small"},b=function(e,t){return{"--pos-x":e+"px","--pos-y":t+"px"}},k=function(e,t){var n={};return Object.entries(e).forEach((function(e){var r=(0,i.Z)(e,2),o=r[0],a=r[1];t&&(a+=t),n["--"+o]=a})),n},N=function(e){var t=e.drawRef,n=e.visible,r=e.clickPoint,o=(0,a.useState)({}),c=(0,i.Z)(o,2),l=c[0],u=c[1];if(!r)return null;var s=r.x,h=r.y;return(0,y.jsxs)("div",{className:"select-tool tool-options","data-visible":n,style:b(s,h),children:[(0,y.jsx)(x.Z,{trigger:"click",placement:"bottom",overlayClassName:"style-pop",getPopupContainer:function(e){return e.parentElement},destroyTooltipOnHide:!0,content:(0,y.jsx)(w.Uk,{updateDrawCtrl:function(e){var n;u((function(t){return(0,d.Z)((0,d.Z)({},t),e)})),null===(n=t.current)||void 0===n||n.mutateStyle(e)},drawCtrl:l}),children:(0,y.jsx)(g.Z,(0,d.Z)({icon:(0,y.jsx)(f.Z,{})},S))}),(0,y.jsx)(g.Z,(0,d.Z)({icon:(0,y.jsx)(p.Z,{}),onClick:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.duplicateSelected()}},S)),(0,y.jsx)(g.Z,(0,d.Z)({danger:!0,icon:(0,y.jsx)(v.Z,{}),onClick:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.deleteSelected()}},S))]})},T=function(e){var t,n,r,o=e.pointText,i=e.drawRef,c=e.renderSlow,l=o.view,u=o.position,s=o.leading,f=o.content,p=o.rotation,v=o.fontFamily,N=o.fontWeight,T=o.fontSize,L=l.projectToView(u),R=L.x,W=L.y,_=o.bounds,B=_.topLeft,z=_.bottomLeft,M=l.projectToView(B),A=M.x,F=M.y,V=l.projectToView(z),O=V.x,H=V.y,G=F<90,Q=o.viewMatrix.scaling.x,U=o.internalBounds,K=U.width,X=U.height,Y=null!==(t=+s/+T)&&void 0!==t?t:1.2,q=null!==(n=null===(r=o.fillColor)||void 0===r?void 0:r.toCSS(!0))&&void 0!==n?n:C.Qk[0],J=(0,y.jsx)(x.Z,{content:(0,y.jsx)(w.Q5,{color:q,setColor:function(e){var t;return null===(t=i.current)||void 0===t?void 0:t.mutatePointText((function(t){t.fillColor=e}))}}),trigger:"click",overlayStyle:{width:200},placement:"bottom",getPopupContainer:function(e){return e.parentElement},children:(0,y.jsx)(g.Z,(0,d.Z)((0,d.Z)({},S),{},{icon:(0,y.jsx)(j.Z,{type:"icon-circle",className:"text-color-icon",style:{color:q}})}))}),$=P(N),ee=$.isItalic,te=$.isBold,ne={fontWeight:te?"bold":"normal",fontStyle:ee?"italic":"normal"},re=(0,y.jsx)(Z.Z,{className:"font-select",popupClassName:"font-drop",value:v,onChange:function(e){var t;null===(t=i.current)||void 0===t||t.mutatePointText((function(t){t.fontFamily=e}))},size:"small",bordered:!1,virtual:!1,getPopupContainer:function(e){return e.parentElement.parentElement},dropdownMatchSelectWidth:100,options:[{value:"Arial, sans-serif",name:"Arial"},{value:"'Times New Roman', serif",name:"Times"},{value:"Georgia, serif",name:"Georgia"},{value:"'Courier New', monospace",name:"Courier"}].map((function(e){var t=e.value,n=e.name;return{value:t,label:(0,y.jsx)("span",{style:{fontFamily:t,fontWeight:"normal"},children:n})}}))}),oe=(0,a.useMemo)((function(){return.75-I(v,Y)}),[v,Y]);return(0,y.jsxs)("div",{className:"text-tool",style:(0,d.Z)((0,d.Z)((0,d.Z)((0,d.Z)((0,d.Z)({},k({scale:Q,color:q})),k({rotation:p},"deg")),k({width:K,height:X},"px")),k({offset:oe},"em")),b(R,W)),children:[(0,y.jsx)("div",{className:"textarea-wrapper","data-empty":!f,style:(0,d.Z)({fontSize:T,fontFamily:v,lineHeight:Y},ne),children:(0,y.jsx)("textarea",{autoFocus:!f,placeholder:"Text",value:f,onChange:function(e){var t;null===(t=i.current)||void 0===t||t.mutatePointText((function(t){t.content=e.target.value}))},"data-slow":c})}),(0,y.jsxs)("div",{className:"tool-options text-options","data-bottom":G,style:(0,d.Z)({},G?b(O,H):b(A,F)),children:[(0,y.jsxs)("div",{className:"row",children:[re,J]}),(0,y.jsxs)("div",{className:"row",children:[(0,y.jsx)(g.Z,(0,d.Z)((0,d.Z)({onClick:function(){var e;null===(e=i.current)||void 0===e||e.mutatePointText((function(e){e.fontWeight=D(e.fontWeight)}))}},S),{},{type:te?"link":"text",icon:(0,y.jsx)(h.Z,{})})),(0,y.jsx)(g.Z,(0,d.Z)((0,d.Z)({onClick:function(){var e;null===(e=i.current)||void 0===e||e.mutatePointText((function(e){e.fontWeight=E(e.fontWeight)}))}},S),{},{type:ee?"link":"text",icon:(0,y.jsx)(m.Z,{})})),(0,y.jsx)(g.Z,(0,d.Z)((0,d.Z)({},S),{},{icon:(0,y.jsx)(j.Z,{type:"icon-font_size_down"}),onClick:function(){var e;null===(e=i.current)||void 0===e||e.mutatePointText((function(e){var t=e.bounds.topLeft;e.scale(.9,t)}))}})),(0,y.jsx)(g.Z,(0,d.Z)((0,d.Z)({},S),{},{icon:(0,y.jsx)(j.Z,{type:"icon-font_size_up"}),onClick:function(){var e;null===(e=i.current)||void 0===e||e.mutatePointText((function(e){var t=e.bounds.topLeft;e.scale(1.1,t)}))}}))]})]})]})},P=function(e){return{isItalic:/italic/g.test(e+=""),isBold:/bold/g.test(e)}},E=function(e){var t=P(e);return(t.isItalic?"":"italic ")+(t.isBold?"bold":"normal")},D=function(e){var t=P(e);return(t.isItalic?"italic ":"")+(t.isBold?"normal":"bold")},I=function(e,t){var n=document.createElement("div");n.innerText="p",Object.assign(n.style,{fontSize:"100px",fontFamily:e,lineHeight:t}),document.body.appendChild(n);var r=document.createElement("span");r.style.display="inline-block",n.appendChild(r);var o=n.getBoundingClientRect(),i=(r.getBoundingClientRect().y-o.y)/o.height;return document.body.removeChild(n),Math.max(-1,Math.min(i,1))},L=n(763),R=n(19348),W=n(24124),_=n(15671),B=n(43144),z=n(60136),M=n(27277),A=function(e){(0,z.Z)(n,e);var t=(0,M.Z)(n);function n(){var e;(0,_.Z)(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).state={hasError:!1},e}return(0,B.Z)(n,[{key:"componentDidCatch",value:function(e,t){console.error("Uncaught error:",e,t)}},{key:"render",value:function(){return this.state.hasError?(0,y.jsx)("p",{children:"Error"}):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{hasError:!0}}}]),n}(a.Component),F=function(e){var t=e.thumbnail,c=e.drawState,l=e.teamStateMap,u=e.updateState,s=e.pdfIndex,d=e.noteID,f=void 0===d?"":d,p=e.preview,v=void 0!==p&&p,h=e.onViewChange,m=e.preload,x=void 0!==m&&m,g=e.ignores,Z=void 0===g?(0,W.Set)():g,w=e.skipInView,C=void 0!==w&&w,j=h&&(0,L.range)(0,1.2,.2),S=(0,R.YD)({threshold:j,skip:C}),b=(0,i.Z)(S,3),k=b[0],N=b[1],T=b[2];(0,a.useEffect)((function(){if(h)return T&&N?void h(T.intersectionRatio):h(0)}),[N,T,h]);var P=(0,a.useState)(),E=(0,i.Z)(P,2),D=E[0],I=E[1],_=(0,a.useCallback)((0,L.once)((0,o.Z)((0,r.Z)().mark((function e(){var t,o;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s&&f){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,Promise.all([n.e(643),n.e(867)]).then(n.bind(n,98338));case 4:return t=e.sent,o=t.getNotePageImage,e.t0=I,e.next=9,o(f,s);case 9:e.t1=e.sent,(0,e.t0)(e.t1);case 11:case"end":return e.stop()}}),e)})))),[s,f]),B=N||x;(0,a.useEffect)((function(){!v&&B&&_()}),[B,v,_]);var z=(0,a.useMemo)((function(){return null===l||void 0===l?void 0:l.deleteAll(Z).toList().toArray()}),[l,Z]),M=Boolean(D||!s),A=B&&M,F=c.height/c.width;return(0,y.jsxs)("div",{ref:k,className:"page-wrapper","data-preview":v,children:[(0,y.jsx)("svg",{className:"size-holder",viewBox:"0 0 100 ".concat(100*F)}),A&&(0,y.jsx)(V,{drawState:c,otherStates:z,updateState:u,imgSrc:D||t,preview:v})]})};F.displayName="PageWrapper";var V=function(e){var t=e.drawState,n=e.updateState,r=e.otherStates,o=e.preview,d=void 0!==o&&o,f=e.imgSrc,p=(0,c.gX)(),v=(0,a.useRef)(null),h=(0,a.useState)(!1),m=(0,i.Z)(h,2),x=m[0],g=m[1],Z=(0,a.useState)(),w=(0,i.Z)(Z,2),C=w[0],j=w[1],S=(0,a.useState)(),b=(0,i.Z)(S,2),k=b[0],P=b[1],E=(0,a.useState)(!1),D=(0,i.Z)(E,2),I=D[0],L=D[1],R=(0,l.Z)((function(e){if(n){var r=e instanceof s.DrawState?e:e(t);r!==t&&n(r)}}));return d?(0,y.jsx)(u.Draw,{drawState:t,otherStates:r,imgSrc:f,readonly:!0}):(0,y.jsxs)(A,{children:[(0,y.jsx)(u.Draw,{drawState:t,otherStates:r,onChange:R,imgSrc:f,drawCtrl:p,ref:v,toggleTextTool:function(e,t){P(e),L(t)},toggleSelectTool:function(e,t){t&&j(t),g(e)}}),(0,y.jsx)(N,{drawRef:v,visible:x,clickPoint:C}),k&&(0,y.jsx)(T,{drawRef:v,pointText:k,renderSlow:I})]})},O=a.memo(F)},70587:function(e,t,n){n.d(t,{w3:function(){return j},gX:function(){return w},F7:function(){return C}});var r=n(74165),o=n(1413),i=n(29439),a=n(15861),c=n(72791),l=n(50419),u=n(87309),s=n(31752),d=n(60732),f=n(61842),p=n.n(f),v=n(763),h=n(91715),m=n(80184);function x(){return(x=(0,a.Z)((0,r.Z)().mark((function e(){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p().getItem("DRAW_CTRL");case 2:if(t=e.sent){e.next=7;break}return t=h.defaultDrawCtrl,e.next=7,p().setItem("DRAW_CTRL",t);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(){return(g=(0,a.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p().setItem("DRAW_CTRL",t);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Z=c.createContext({drawCtrl:h.defaultDrawCtrl,updateDrawCtrl:function(){}});function w(){var e=(0,c.useContext)(Z).drawCtrl;return(0,c.useDebugValue)(e),e}function C(){return(0,c.useContext)(Z).updateDrawCtrl}var j=function(e){var t=e.children,n=(0,c.useState)(h.defaultDrawCtrl),r=(0,i.Z)(n,2),a=r[0],l=r[1];(0,c.useEffect)((function(){(function(){return x.apply(this,arguments)})().then(l)}),[]);var u=function(e){l((function(t){var n=(0,o.Z)((0,o.Z)({},t),e);return function(e){g.apply(this,arguments)}(n),n}))},s=a.finger;return(0,c.useEffect)((function(){var e=function(e){e.isPrimary&&"pen"===e.pointerType&&s&&y((function(){return u({finger:!1})}))};return document.addEventListener("pointerup",e),function(){return document.removeEventListener("pointerup",e)}}),[s]),(0,m.jsx)(Z.Provider,{value:{drawCtrl:a,updateDrawCtrl:u},children:t})},y=(0,v.once)(function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=function(){l.ZP.destroy("DETECT_PENCIL"),p().setItem("SKIP_PENCIL_MSG",!0)},e.next=3,p().getItem("SKIP_PENCIL_MSG");case 3:if(!e.sent){e.next=5;break}return e.abrupt("return");case 5:l.ZP.info({content:(0,m.jsxs)(m.Fragment,{children:["Your device supports",(0,m.jsx)(u.Z,{shape:"round",size:"small",icon:(0,m.jsx)(s.Z,{}),onClick:function(){t(),n()},children:"Pencil only"}),(0,m.jsx)(u.Z,{size:"small",type:"text",shape:"circle",icon:(0,m.jsx)(d.Z,{style:{color:"#999"}}),onClick:n})]}),key:"DETECT_PENCIL",className:"pencil-msg",duration:0});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},2721:function(e,t,n){n.d(t,{Q5:function(){return w},Uk:function(){return x},Db:function(){return g}});var r=n(4942),o=n(93433),i=n(29439),a=n(72791),c=n(91715),l=n(35873),u=n(69228),s=n(96272),d=n(53163),f=n(74115),p=n(22568),v=n(24124),h=n(74689),m=n(80184),x=function(e){var t=e.updateDrawCtrl,n=e.drawCtrl,r=n.highlight,o=n.color,c=(0,a.useState)(!1),l=(0,i.Z)(c,2),u=l[0],s=l[1];return(0,m.jsxs)("div",{className:"pen-panel","data-blur":u,"data-hi":r,children:[(0,m.jsxs)("div",{className:"pen-status",children:[(0,m.jsx)(g,{updateDrawCtrl:t,drawCtrl:n,setPanelBlur:s}),(0,m.jsx)(Z,{checked:r,updateDrawCtrl:t})]}),(0,m.jsx)(w,{color:o||"",setColor:function(e){return t({color:e})}})]})},g=function(e){var t,n,f=e.updateDrawCtrl,p=e.drawCtrl,x=e.setPanelBlur,g=void 0===x?function(){}:x,Z=e.field,w=void 0===Z?"lineWidth":Z,C=p[w],j=null!==(t=p.widthList)&&void 0!==t?t:c.defaultWidthList,y="lineWidth"===w&&null!==(n=p.color)&&void 0!==n?n:"#aaa",S=(0,a.useMemo)((function(){return j.indexOf(null!==C&&void 0!==C?C:-1)}),[C,j]),b=(0,a.useState)((0,v.List)([!1,!1,!1,!1])),k=(0,i.Z)(b,2),N=k[0],T=k[1];(0,a.useEffect)((function(){N.includes(!0)?g(!0):g(!1)}),[N,g]);var P=(0,a.useState)((function(){var e,t=document.querySelector("section.note-page");return(null!==(e=null===t||void 0===t?void 0:t.getBoundingClientRect().width)&&void 0!==e?e:0)/document.body.getBoundingClientRect().width})),E=(0,i.Z)(P,1)[0],D=function(e){return{"--real-size":"calc(".concat(100/h.m,"vw * ").concat(e," * ").concat(E,")")}},I=[{value:-1,label:null}].concat((0,o.Z)(j.map((function(e,t){return{value:t,label:(0,m.jsx)(u.Z,{open:N.get(t),onOpenChange:function(e){return T((function(n){return n.set(t,e)}))},trigger:S===t?["click"]:[],placement:"bottom",destroyTooltipOnHide:!0,content:(0,m.jsx)(s.Z,{min:5,max:100,className:"ctrl-slider",defaultValue:e,onAfterChange:function(e){if(j.includes(e))return T((function(e){return e.set(t,!1)})),f((0,r.Z)({},w,e));var n=j.slice();n[t]=e,f((0,r.Z)({widthList:n},w,e))}}),children:(0,m.jsx)("div",{className:"circle-wrapper",style:D(e),children:(0,m.jsx)(l.W,{className:"width-circle "+w,color:y})})})}}))));return(0,m.jsx)(d.Z,{className:"width-seg",value:S,options:I,onChange:function(e){var t;return f((0,r.Z)({},w,null!==(t=j[+e])&&void 0!==t?t:10))}})},Z=function(e){var t=e.checked,n=void 0!==t&&t,r=e.updateDrawCtrl;return(0,m.jsxs)("label",{className:"hi-wrapper",children:[(0,m.jsx)("input",{type:"checkbox",name:"highlight",checked:n,onChange:function(e){return r({highlight:e.target.checked})}}),(0,m.jsx)("div",{className:"hi-switch",children:(0,m.jsx)(p.Z,{type:"icon-Highlight"})})]})},w=function(e){var t=e.setColor,n=e.color;return(0,m.jsx)("div",{className:"color-select",children:f.Qk.map((function(e){return(0,m.jsxs)("label",{children:[(0,m.jsx)("input",{checked:n===e,type:"radio",name:"color",onChange:function(n){return n.target.checked&&t(e)}}),(0,m.jsx)("div",{"data-color":e,className:"circle",style:{backgroundColor:e,borderColor:e}})]},e)}))})}}}]);
//# sourceMappingURL=199.017e607e.chunk.js.map