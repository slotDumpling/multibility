{"version":3,"file":"static/js/715.53bbd9bb.chunk.js","mappings":"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","sources":["lib/draw/StateSet.ts","pages/reader/lib/scroll.ts","pages/reader/lib/array.ts","component/UserAvatar.tsx","pages/reader/tools/AddButton.tsx","pages/reader/Options/index.tsx","pages/reader/PageNav/PageNav.tsx","pages/reader/Header/Left.tsx","pages/reader/Header/Middle.tsx","pages/reader/Header/Right.tsx","pages/reader/Header/index.tsx","pages/reader/Info/InfoNav.tsx","lib/keyboard.ts","pages/reader/Reader.tsx","pages/reader/Team.tsx","lib/network/io.ts","pages/reader/tools/Messages.tsx"],"sourcesContent":["import { DrawState, Operation } from \"draft-pad/dist/lib\";\nimport { List, Map, Record } from \"immutable\";\nimport { NotePage } from \"lib/note/note\";\nimport { WIDTH } from \"./DrawConst\";\n\ninterface StateSetRecordType {\n  states: Map<string, DrawState>;\n  editStack: List<string>;\n  undoStack: List<string>;\n}\n\nconst defaultRecord: Readonly<StateSetRecordType> = {\n  states: Map(),\n  editStack: List(),\n  undoStack: List(),\n};\n\ntype StateSetRecord = Record<StateSetRecordType>;\nconst defaultFactory = Record(defaultRecord);\n\nexport type SetOperation = Operation & { pageID: string };\n\nexport class StateSet {\n  constructor(\n    private immutable: StateSetRecord,\n    public lastOp?: SetOperation\n  ) {}\n\n  static createFromPages(pageRec: globalThis.Record<string, NotePage>) {\n    return new StateSet(\n      defaultFactory().set(\n        \"states\",\n        Map(pageRec).map(({ state, ratio }) =>\n          DrawState.loadFromFlat(state, ratio, WIDTH)\n        )\n      )\n    );\n  }\n\n  getImmutable() {\n    return this.immutable;\n  }\n\n  getStates() {\n    return this.getImmutable().get(\"states\");\n  }\n\n  getOneState(pageID: string) {\n    return this.getStates().get(pageID);\n  }\n\n  getEditStack() {\n    return this.getImmutable().get(\"editStack\");\n  }\n\n  getUndoStack() {\n    return this.getImmutable().get(\"undoStack\");\n  }\n\n  setState(pageID: string, drawState: DrawState) {\n    const prevDS = this.getOneState(pageID);\n    if (!prevDS || prevDS === drawState) return this;\n    let currRecord = this.getImmutable()\n      .update(\"states\", (s) => s.set(pageID, drawState))\n      .update(\"editStack\", (l) => l.push(pageID))\n      .delete(\"undoStack\");\n\n    const { lastOp } = drawState;\n    const lastSetOp = lastOp && { ...lastOp, pageID };\n\n    return new StateSet(currRecord, lastSetOp);\n  }\n\n  // sync with mutation.\n  syncStrokeTime(pageID: string, uid: string, timestamp: number) {\n    const prevDS = this.getOneState(pageID);\n    prevDS && DrawState.syncStrokeTime(prevDS, uid, timestamp);\n    return this;\n  }\n\n  addState(pageID: string, notePage: NotePage) {\n    const { state, ratio } = notePage;\n    const newDS = DrawState.loadFromFlat(state, ratio, WIDTH);\n    const currRecord = this.getImmutable().update(\"states\", (s) =>\n      s.set(pageID, newDS)\n    );\n    return new StateSet(currRecord);\n  }\n\n  deleteState(pageID: string) {\n    return new StateSet(\n      this.getImmutable().update(\"states\", (s) => s.delete(pageID))\n    );\n  }\n\n  isUndoable() {\n    return this.getEditStack().size > 0;\n  }\n\n  isRedoable() {\n    return this.getUndoStack().size > 0;\n  }\n\n  undo() {\n    if (!this.isUndoable()) return this;\n    const lastUid = this.getEditStack().last();\n    const prevDS = lastUid && this.getOneState(lastUid);\n    if (!prevDS) return this;\n\n    const newDS = DrawState.undo(prevDS);\n    const { lastOp } = newDS;\n    const lastSetOp = lastOp && { pageID: lastUid, ...lastOp };\n\n    return new StateSet(\n      this.getImmutable()\n        .update(\"editStack\", (s) => s.pop())\n        .update(\"undoStack\", (s) => s.push(lastUid))\n        .update(\"states\", (s) => s.set(lastUid, newDS)),\n      lastSetOp\n    );\n  }\n\n  redo() {\n    if (!this.isRedoable()) return this;\n    const lastUid = this.getUndoStack().last();\n    const prevDS = lastUid && this.getOneState(lastUid);\n    if (!prevDS) return this;\n\n    const newDS = DrawState.redo(prevDS);\n    const { lastOp } = newDS;\n    const lastSetOp = lastOp && { pageID: lastUid, ...lastOp };\n\n    return new StateSet(\n      this.getImmutable()\n        .update(\"undoStack\", (s) => s.pop())\n        .update(\"editStack\", (s) => s.push(lastUid))\n        .update(\"states\", (s) => s.set(lastUid, newDS)),\n      lastSetOp\n    );\n  }\n}\n","import {\n  useRef,\n  useMemo,\n  useState,\n  useEffect,\n  useDebugValue,\n  useLayoutEffect,\n  useDeferredValue,\n} from \"react\";\nimport localforage from \"localforage\";\nimport { Map } from \"immutable\";\nimport { debounce } from \"lodash\";\nimport { useEvent } from \"lib/hooks\";\n\nconst scrollForage = localforage.createInstance({ name: \"scroll\" });\nconst persistScroll = debounce((noteID: string, currPageID: string) => {\n  scrollForage.setItem(noteID, currPageID);\n}, 2000);\n\nexport function useScrollPage(\n  noteID: string,\n  pageOrder = [] as string[],\n  deps = [] as any[]\n) {\n  const [refMap, setRefMap] = useState(Map<string, HTMLElement>());\n  const scrolled = useRef(false);\n  const [prevPageID, setPrevPageID] = useState(\"\");\n  useEffect(() => {\n    (async () => {\n      const stored = await scrollForage.getItem<string>(noteID);\n      if (!stored) return (scrolled.current = true);\n      setPrevPageID(stored);\n    })();\n  }, [noteID]);\n\n  useLayoutEffect(() => {\n    const section = refMap.get(prevPageID);\n    if (scrolled.current || !section) return;\n    section.scrollIntoView();\n    scrolled.current = true;\n  }, [prevPageID, refMap]);\n\n  const [inviewRatios, setInviewRatios] = useState(Map<string, number>());\n  const deferredRatios = useDeferredValue(inviewRatios);\n  const deferredOrder = useDeferredValue(pageOrder);\n  const currPageID = useMemo(\n    () => largestKey(deferredRatios, deferredOrder),\n    [deferredRatios, deferredOrder]\n  );\n\n  useEffect(() => {\n    if (scrolled.current) persistScroll(noteID, currPageID);\n  }, [noteID, currPageID]);\n\n  const calcScrollY = useEvent(() => {\n    const section = refMap.get(currPageID);\n    const header = section?.parentElement?.parentElement?.firstElementChild;\n    if (!header) return 0;\n    const { top } = section.getBoundingClientRect();\n    const { height } = header.getBoundingClientRect();\n    return -top + height;\n  });\n  const scrollY = useMemo(calcScrollY, [pageOrder, calcScrollY, ...deps]);\n\n  const scrollToCurr = useEvent(() => {\n    const section = refMap.get(currPageID);\n    if (!section) return;\n    section.scrollIntoView();\n    window.scrollBy(0, scrollY);\n  });\n  useLayoutEffect(scrollToCurr, [pageOrder, scrollToCurr, ...deps]);\n\n  const sectionRef = useEvent((pageID: string) => (el: HTMLElement | null) => {\n    if (!el) return;\n    setRefMap((prev) => prev.set(pageID, el));\n  });\n\n  const taskID = useRef(0);\n  const [scrolling, setScrolling] = useState(false);\n  const scrollPage = (pageID: string) => {\n    const section = refMap.get(pageID);\n    if (!section) return;\n    const handleScroll = () => {\n      window.clearTimeout(taskID.current);\n      taskID.current = window.setTimeout(() => {\n        setScrolling(false);\n        document.removeEventListener(\"scroll\", handleScroll);\n      }, 50);\n    };\n    document.addEventListener(\"scroll\", handleScroll);\n    section.scrollIntoView({ behavior: \"smooth\" });\n    setScrolling(true);\n  };\n\n  useDebugValue(currPageID);\n  return { scrollPage, setInviewRatios, sectionRef, currPageID, scrolling };\n}\n\nconst largestKey = (map: Map<string, number>, order: string[]) => {\n  let result = \"\";\n  let maxRatio = 0;\n  for (let key of order) {\n    const ratio = map.get(key);\n    if (!ratio) continue;\n    if (ratio === 1) return key;\n    if (ratio > maxRatio) {\n      result = key;\n      maxRatio = ratio;\n    }\n  }\n  return result;\n};\n","export function exchange<T>(list: T[], fromIndex: number, toIndex: number) {\n  const result = list.slice();\n  const [removed] = result.splice(fromIndex, 1);\n  if (!removed) return list;\n  result.splice(toIndex, 0, removed);\n  return result;\n}\n\nexport function insertAfter<T>(list: T[], prevItem: T, newItem: T) {\n  const prevIndex = list.indexOf(prevItem);\n  const curr = list.slice();\n  if (prevIndex === -1) return curr;\n  curr.splice(prevIndex + 1, 0, newItem);\n  return curr;\n}\n","import { Avatar } from \"antd\";\nimport { AvatarSize } from \"antd/lib/avatar/SizeContext\";\nimport { FC, useMemo } from \"react\";\nimport { getHashedColor } from \"lib/color\";\nimport { UserInfo } from \"lib/user\";\n\nexport const UserAvatar: FC<{\n  userInfo: UserInfo;\n  size?: AvatarSize;\n  onClick?: () => void;\n  chosen?: boolean;\n  className?: string;\n}> = ({\n  userInfo,\n  size = \"default\",\n  onClick = () => {},\n  chosen = false,\n  className,\n}) => {\n  const color = useMemo(() => getHashedColor(userInfo.userID), [userInfo]);\n  if (!userInfo) return null;\n  const { userName } = userInfo;\n\n  return (\n    <Avatar\n      className={className}\n      data-chosen={chosen}\n      size={size}\n      style={{ backgroundColor: color }}\n    >\n      <div className=\"avatar-wrapper\" onClick={onClick}>\n        {userName?.slice(0, 3)}\n      </div>\n    </Avatar>\n  );\n};\n","import { FC } from \"react\";\nimport { Button } from \"antd\";\nimport { PlusOutlined } from \"@ant-design/icons\";\n\nexport const AddPageButton: FC<{ addFinalPage: () => void }> = ({\n  addFinalPage,\n}) => {\n  return (\n    <Button type=\"dashed\" icon={<PlusOutlined />} block onClick={addFinalPage}>\n      New page\n    </Button>\n  );\n};\n","import { FC } from \"react\";\nimport { Button, Popover, Switch } from \"antd\";\nimport { TooltipPlacement } from \"antd/lib/tooltip\";\nimport { useForceLight } from \"lib/Dark\";\nimport { useDrawCtrl, useUpdateDrawCtrl } from \"lib/draw/DrawCtrl\";\nimport { useMediaQuery } from \"react-responsive\";\nimport { MoreOutlined } from \"@ant-design/icons\";\nimport \"./options.sass\";\n\nexport const OptionButton: FC<{\n  placement?: TooltipPlacement;\n}> = ({ placement }) => {\n  const { finger } = useDrawCtrl();\n  const updateDrawCtrl = useUpdateDrawCtrl();\n  const [forceLight, setForceLight] = useForceLight();\n  const isLight = useMediaQuery({ query: \"(prefers-color-scheme: light)\" });\n\n  const options = (\n    <div className=\"reader-options\">\n      <div className=\"other-option\">\n        <span>Pencil only</span>\n        <Switch\n          size=\"small\"\n          checked={!finger}\n          onChange={(v) => updateDrawCtrl({ finger: !v })}\n        />\n      </div>\n      <div className=\"other-option\">\n        <span>Light mode</span>\n        <Switch\n          size=\"small\"\n          checked={forceLight || isLight}\n          disabled={isLight}\n          onChange={setForceLight}\n        />\n      </div>\n    </div>\n  );\n\n  return (\n    <Popover\n      getPopupContainer={(e) => e.parentElement!}\n      trigger=\"click\"\n      content={options}\n      placement={placement}\n    >\n      <Button\n        type=\"text\"\n        icon={<MoreOutlined />}\n        className=\"reader-option-btn\"\n      />\n    </Popover>\n  );\n};\n","import React, {\n  FC,\n  useRef,\n  useMemo,\n  useState,\n  useContext,\n  useLayoutEffect,\n} from \"react\";\nimport {\n  MoreOutlined,\n  PlusOutlined,\n  CopyOutlined,\n  DeleteOutlined,\n} from \"@ant-design/icons\";\nimport {\n  Draggable,\n  Droppable,\n  DropResult,\n  DragDropContext,\n} from \"react-beautiful-dnd\";\nimport { Avatar, Button, Menu, Pagination, Popover, Select, Tabs } from \"antd\";\nimport {\n  Setter,\n  useActiveKey,\n  useAsideOpen,\n  ActiveKeyProvider,\n  useEvent,\n} from \"lib/hooks\";\nimport { ReaderMethods, ReaderStates } from \"../Reader\";\nimport PageWrapper from \"component/PageWrapper\";\nimport { UserAvatar } from \"component/UserAvatar\";\nimport { exchange } from \"../lib/array\";\nimport IconFont from \"component/IconFont\";\nimport classNames from \"classnames\";\nimport { TeamCtx } from \"../Team\";\nimport { useSwipeable } from \"react-swipeable\";\nimport { NotePage } from \"lib/note/note\";\nimport { TeamState } from \"lib/draw/TeamState\";\nimport { AddPageButton } from \"../tools/AddButton\";\nimport { CSSTransition } from \"react-transition-group\";\nimport { OptionButton } from \"../Options\";\n\ntype PreviewProps = ReaderMethods & ReaderStates;\nexport const PageNav: FC<PreviewProps> = (props) => {\n  const [left, setLeft] = useState(false);\n  const [asideOpen] = useAsideOpen();\n\n  const opposite = (\n    <Draggable draggableId=\"OPPOSITE\" index={left ? 1 : 0} isDragDisabled>\n      {({ innerRef }) => <div className=\"opposite\" ref={innerRef} />}\n    </Draggable>\n  );\n\n  return (\n    <CSSTransition in={asideOpen} timeout={300} unmountOnExit>\n      <ActiveKeyProvider initKey=\"ALL\">\n        <DragDropContext\n          onDragEnd={({ destination }) => {\n            if (destination?.index === 0) setLeft(true);\n            if (destination?.index === 1) setLeft(false);\n          }}\n        >\n          <Droppable droppableId=\"preview-drop\" direction=\"horizontal\">\n            {(\n              { droppableProps, innerRef, placeholder },\n              { isDraggingOver }\n            ) => (\n              <aside\n                className=\"preview-drop\"\n                data-left={left}\n                ref={innerRef}\n                data-dragged={isDraggingOver}\n                {...droppableProps}\n              >\n                {opposite}\n                <PreviewCard left={left} {...props} />\n                {placeholder}\n              </aside>\n            )}\n          </Droppable>\n        </DragDropContext>\n      </ActiveKeyProvider>\n    </CSSTransition>\n  );\n};\n\nconst PreviewCard: FC<{ left: boolean } & PreviewProps> = ({\n  left,\n  ...props\n}) => {\n  const [activeKey] = useActiveKey();\n  const [, setAsideOpen] = useAsideOpen();\n\n  const title = {\n    ALL: \"All Pages\",\n    MARKED: \"Bookmarks\",\n    WRITTEN: \"Notes\",\n  }[activeKey];\n\n  const { ref: swipeRef, ...swipeHandler } = useSwipeable({\n    onSwipedLeft() {\n      if (left) setAsideOpen(false);\n    },\n    onSwipedRight() {\n      if (!left) setAsideOpen(false);\n    },\n    swipeDuration: 200,\n  });\n\n  return (\n    <Draggable draggableId={\"CARD\"} index={left ? 0 : 1}>\n      {(\n        { innerRef, draggableProps, dragHandleProps },\n        { isDragging, isDropAnimating }\n      ) => (\n        <div\n          className=\"preview-card\"\n          ref={(e) => {\n            innerRef(e);\n            swipeRef(e);\n          }}\n          data-animating={isDropAnimating}\n          {...draggableProps}\n          {...swipeHandler}\n        >\n          <div className=\"drag-handle\" {...dragHandleProps} />\n          <h3>{title}</h3>\n          <PreviewTabs />\n          <PageList cardDragged={isDragging} {...props} />\n          <PreviewFooter {...props} />\n        </div>\n      )}\n    </Draggable>\n  );\n};\n\nconst PageList: FC<PreviewProps & { cardDragged: boolean }> = React.memo(\n  ({ cardDragged, ...props }) => {\n    const refRec = useRef<Record<string, HTMLElement>>({});\n    const [activeKey] = useActiveKey();\n    const [asideOpen] = useAsideOpen();\n    const { pageOrder, currPageID } = props;\n    const { saveReorder, addFinalPage } = props;\n\n    const onDragEnd = ({ source, destination }: DropResult) => {\n      if (!destination || !pageOrder) return;\n      const { index: fromIndex } = source;\n      const { index: toIndex } = destination;\n      const pageID = pageOrder[fromIndex];\n      if (fromIndex === toIndex || !pageID) return;\n      const newOrder = exchange(pageOrder, fromIndex, toIndex);\n      saveReorder(newOrder, true);\n    };\n\n    const initScroll = useEvent(() => {\n      refRec.current[currPageID]?.scrollIntoView();\n    });\n    useLayoutEffect(() => {\n      if (asideOpen) initScroll();\n    }, [asideOpen, activeKey, initScroll]);\n\n    return (\n      <DragDropContext onDragEnd={onDragEnd}>\n        <Droppable droppableId=\"preview-list\" isDropDisabled={cardDragged}>\n          {({ droppableProps, innerRef, placeholder }) => (\n            <div className=\"page-list\" ref={innerRef} {...droppableProps}>\n              {pageOrder.map((uid, index) => (\n                <PagePreview\n                  key={uid}\n                  uid={uid}\n                  pageIndex={index}\n                  refRec={refRec.current}\n                  cardDragged={cardDragged}\n                  {...props}\n                />\n              ))}\n              {placeholder}\n              {activeKey === \"ALL\" && (\n                <AddPageButton addFinalPage={addFinalPage} />\n              )}\n            </div>\n          )}\n        </Droppable>\n      </DragDropContext>\n    );\n  }\n);\nPageList.displayName = \"PageList\";\n\nconst PagePreview: FC<\n  {\n    uid: string;\n    pageIndex: number;\n    refRec: Record<string, HTMLElement>;\n    cardDragged: boolean;\n  } & PreviewProps\n> = ({ uid, pageIndex, refRec, cardDragged, ...props }) => {\n  const { stateSet, pageRec, currPageID, scrollPage } = props;\n  const { teamState, ignores } = useContext(TeamCtx);\n  const [activeKey] = useActiveKey();\n  const [chosen, setChosen] = useState(\"\");\n\n  const page = pageRec.get(uid);\n  const drawState = stateSet.getOneState(uid);\n  const teamStateMap = teamState?.getOnePageStateMap(uid);\n\n  const marked = useRef(false);\n  if (activeKey === \"MARKED\") {\n    marked.current = page?.marked || marked.current;\n  } else {\n    marked.current = false;\n  }\n\n  const userIDs = useMemo(\n    () => TeamState.getValidUsers(teamStateMap, ignores),\n    [teamStateMap, ignores]\n  );\n\n  if (!page || !drawState) return null;\n\n  if (\n    activeKey === \"WRITTEN\" &&\n    drawState.isEmpty() &&\n    TeamState.isEmpty(teamStateMap)\n  ) {\n    return null;\n  }\n  if (activeKey === \"MARKED\" && !marked.current) return null;\n  const curr = currPageID === uid;\n\n  return (\n    <Draggable\n      draggableId={uid}\n      index={pageIndex}\n      isDragDisabled={activeKey !== \"ALL\" || cardDragged}\n    >\n      {(\n        { innerRef, draggableProps, dragHandleProps },\n        { isDragging, isDropAnimating }\n      ) => (\n        <div\n          ref={(e) => {\n            innerRef(e);\n            if (e) refRec[uid] = e;\n          }}\n          className=\"page\"\n          data-curr={curr}\n          data-dragged={isDragging}\n          data-animating={isDropAnimating}\n          onClick={() => scrollPage(uid)}\n          {...draggableProps}\n          {...dragHandleProps}\n        >\n          <PageWrapper\n            drawState={teamStateMap?.get(chosen) || drawState}\n            teamStateMap={chosen ? undefined : teamStateMap}\n            thumbnail={page.image}\n            ignores={ignores}\n            preview\n            skipInView={isDragging || cardDragged}\n          />\n          <PreviewTools\n            uid={uid}\n            index={pageIndex}\n            chosen={chosen}\n            setChosen={setChosen}\n            page={page}\n            userIDs={userIDs}\n            {...props}\n          />\n        </div>\n      )}\n    </Draggable>\n  );\n};\n\nconst PreviewTools: FC<\n  {\n    uid: string;\n    index: number;\n    chosen: string;\n    setChosen: Setter<string>;\n    page: NotePage;\n    userIDs: string[];\n  } & ReaderMethods\n> = React.memo(({ uid, index, chosen, setChosen, page, userIDs, ...props }) => {\n  const { switchPageMarked } = props;\n  return (\n    <div className=\"tools\" onClick={(e) => e.stopPropagation()}>\n      <div\n        className=\"bookmark\"\n        data-marked={page.marked}\n        onClick={() => switchPageMarked(uid)}\n      />\n      <div className=\"index\">{index + 1}</div>\n      <PreviewOption uid={uid} {...props} />\n      <TeamAvatars userIDs={userIDs} chosen={chosen} setChosen={setChosen} />\n    </div>\n  );\n});\nPreviewTools.displayName = \"PreviewTools\";\n\nconst TeamAvatars: FC<{\n  userIDs: string[];\n  chosen: string;\n  setChosen: Setter<string>;\n}> = ({ userIDs, chosen, setChosen }) => {\n  const { userRec } = useContext(TeamCtx);\n  return (\n    <Avatar.Group\n      maxCount={2}\n      size=\"default\"\n      className={classNames(\"team-group\", { chosen })}\n      maxPopoverPlacement=\"bottom\"\n    >\n      {userIDs.map((userID) => {\n        const userInfo = userRec[userID];\n        if (!userInfo) return null;\n        return (\n          <UserAvatar\n            key={userID}\n            size=\"default\"\n            userInfo={userInfo}\n            className=\"preview-avatar\"\n            chosen={chosen === userID}\n            onClick={() => setChosen((prev) => (prev === userID ? \"\" : userID))}\n          />\n        );\n      })}\n    </Avatar.Group>\n  );\n};\n\nconst PreviewOption: FC<{ uid: string } & ReaderMethods> = ({\n  uid,\n  addPage,\n  deletePage,\n}) => {\n  const menu = (\n    <Menu\n      items={[\n        {\n          key: \"ADD\",\n          icon: <PlusOutlined />,\n          label: \"Add page\",\n          onClick: () => addPage(uid),\n        },\n        {\n          key: \"COPY\",\n          icon: <CopyOutlined />,\n          label: \"Duplicate\",\n          onClick: () => addPage(uid, true),\n        },\n        {\n          key: \"DELETE\",\n          icon: <DeleteOutlined />,\n          label: \"Delete\",\n          danger: true,\n          onClick: () => deletePage(uid),\n        },\n      ]}\n    />\n  );\n  return (\n    <Popover\n      content={menu}\n      trigger=\"click\"\n      placement=\"left\"\n      destroyTooltipOnHide\n      getPopupContainer={(e) => e.parentElement?.parentElement?.parentElement!}\n    >\n      <div className=\"option\">\n        <MoreOutlined />\n      </div>\n    </Popover>\n  );\n};\n\nconst PreviewTabs: FC = React.memo(() => {\n  const [activeKey, setActiveKey] = useActiveKey();\n  return (\n    <Tabs\n      className=\"tabs\"\n      activeKey={activeKey}\n      onChange={setActiveKey}\n      tabBarGutter={0}\n      size=\"small\"\n      centered\n      items={[\n        { key: \"ALL\", label: <IconFont type=\"icon-uf_paper\" /> },\n        { key: \"MARKED\", label: <IconFont type=\"icon-bookmark2\" /> },\n        { key: \"WRITTEN\", label: <IconFont type=\"icon-write\" /> },\n      ]}\n    ></Tabs>\n  );\n});\nPreviewTabs.displayName = \"PreviewTabs\";\n\nconst PreviewFooter: FC<PreviewProps> = ({\n  currPageID,\n  pageOrder,\n  scrollPage,\n  size,\n  setSize,\n}) => {\n  const pageIndex = useMemo(\n    () => (pageOrder.indexOf(currPageID) ?? 0) + 1,\n    [currPageID, pageOrder]\n  );\n\n  const jumpMenu = pageOrder && (\n    <Pagination\n      pageSize={1}\n      total={pageOrder.length}\n      simple\n      current={pageIndex}\n      onChange={(index) => {\n        const pageID = pageOrder[index - 1];\n        pageID && scrollPage(pageID);\n      }}\n    />\n  );\n\n  return (\n    <footer>\n      <Popover\n        content={jumpMenu}\n        trigger=\"click\"\n        getPopupContainer={(e) => e.parentElement!}\n        destroyTooltipOnHide\n      >\n        <Button type=\"text\" size=\"small\">\n          {pageIndex} / {pageOrder.length}\n        </Button>\n      </Popover>\n      <Select\n        className=\"size-select\"\n        popupClassName=\"size-drop\"\n        size=\"small\"\n        bordered={false}\n        showArrow={false}\n        dropdownMatchSelectWidth={80}\n        options={[40, 60, 80, 100].map((value) => ({\n          value,\n          label: value + \"%\",\n        }))}\n        value={size}\n        onChange={setSize}\n        placement=\"topRight\"\n        getPopupContainer={(e) => e.parentElement!}\n      />\n      <OptionButton placement=\"topRight\" />\n    </footer>\n  );\n};\n","import { FC } from \"react\";\nimport { Button } from \"antd\";\nimport { useNavigate } from \"react-router-dom\";\nimport { HomeFilled, SaveOutlined } from \"@ant-design/icons\";\n\nexport const HeaderLeft: FC<{\n  saved: boolean;\n  instantSave: () => Promise<void> | undefined;\n}> = ({ saved, instantSave }) => {\n  const nav = useNavigate();\n  return (\n    <div className=\"left\">\n      <Button\n        type=\"text\"\n        onClick={async () => {\n          await instantSave();\n          nav(\"/\");\n        }}\n        icon={<HomeFilled style={{ opacity: 0.8 }} />}\n      />\n      <Button\n        type=\"text\"\n        className=\"save\"\n        onClick={instantSave}\n        disabled={saved}\n        icon={<SaveOutlined />}\n      />\n    </div>\n  );\n};\n","import React, { FC, ReactNode, useState } from \"react\";\nimport { Button, ButtonProps, Input, Popover, Segmented, Tooltip } from \"antd\";\nimport {\n  UndoOutlined,\n  RedoOutlined,\n  LinkOutlined,\n  BorderOutlined,\n  GatewayOutlined,\n  PictureOutlined,\n  HighlightTwoTone,\n  HighlightOutlined,\n  PlusCircleOutlined,\n} from \"@ant-design/icons\";\nimport IconFont from \"component/IconFont\";\nimport { PenPanel, WidthSelect } from \"../tools/PenPanel\";\nimport { DrawCtrl } from \"draft-pad/dist/lib\";\nimport { useDrawCtrl, useUpdateDrawCtrl } from \"lib/draw/DrawCtrl\";\n\nconst btnProps: ButtonProps = { type: \"text\" };\nconst addTip = (icon: React.ReactNode, title = \"\"): React.ReactNode => (\n  <Tooltip placement=\"bottom\" title={title}>\n    {icon}\n  </Tooltip>\n);\n\nexport const HeaderMiddle: FC<{\n  handleUndo: () => void;\n  handleRedo: () => void;\n  undoable: boolean;\n  redoable: boolean;\n}> = ({ handleUndo, handleRedo, undoable, redoable }) => (\n  <div className=\"middle\">\n    <Button\n      {...btnProps}\n      icon={addTip(<UndoOutlined />, \"Undo\")}\n      onClick={handleUndo}\n      disabled={!undoable}\n    />\n    <Button\n      className=\"redo-btn\"\n      {...btnProps}\n      icon={addTip(<RedoOutlined />, \"Redo\")}\n      onClick={handleRedo}\n      disabled={!redoable}\n    />\n    <PenButton />\n    <EraserButton />\n    <AddMoreButtons />\n    <SelectButton />\n  </div>\n);\n\nconst PenButton = () => {\n  const drawCtrl = useDrawCtrl();\n  const { mode, color } = drawCtrl;\n  const updateDrawCtrl = useUpdateDrawCtrl();\n\n  return mode === \"draw\" ? (\n    <Popover\n      content={<PenPanel updateDrawCtrl={updateDrawCtrl} drawCtrl={drawCtrl} />}\n      trigger=\"click\"\n      placement=\"bottom\"\n      getPopupContainer={(e) => e.parentElement!}\n      destroyTooltipOnHide\n    >\n      <Button\n        type=\"link\"\n        icon={addTip(\n          <HighlightTwoTone twoToneColor={color} className=\"pen-icon\" />,\n          \"Draw\"\n        )}\n        data-active={mode === \"draw\"}\n      />\n    </Popover>\n  ) : (\n    <Button\n      {...btnProps}\n      onClick={() => updateDrawCtrl({ mode: \"draw\" })}\n      icon={addTip(<HighlightOutlined />, \"Draw\")}\n    />\n  );\n};\n\nconst EraserButton = () => {\n  const drawCtrl = useDrawCtrl();\n  const { mode, pixelEraser } = drawCtrl;\n  const updateDrawCtrl = useUpdateDrawCtrl();\n\n  const pixelSeg = (\n    <Segmented\n      block\n      size=\"small\"\n      className=\"pixel-seg\"\n      options={[\"Pixel\", \"Object\"]}\n      value={pixelEraser ? \"Pixel\" : \"Object\"}\n      onChange={(value) => {\n        if (value === \"Pixel\") updateDrawCtrl({ pixelEraser: true });\n        else updateDrawCtrl({ pixelEraser: false });\n      }}\n    />\n  );\n\n  return mode === \"erase\" ? (\n    <Popover\n      content={\n        <div className=\"erase-panel\">\n          {pixelSeg}\n          <WidthSelect\n            drawCtrl={drawCtrl}\n            updateDrawCtrl={updateDrawCtrl}\n            field=\"eraserWidth\"\n          />\n        </div>\n      }\n      trigger=\"click\"\n      placement=\"bottom\"\n      getPopupContainer={(e) => e.parentElement!}\n      destroyTooltipOnHide\n    >\n      <Button\n        type=\"link\"\n        icon={addTip(<IconFont type=\"icon-eraser\" />, \"Eraser\")}\n        data-active={mode === \"erase\"}\n      />\n    </Popover>\n  ) : (\n    <Button\n      {...btnProps}\n      onClick={() => updateDrawCtrl({ mode: \"erase\" })}\n      icon={addTip(<IconFont type=\"icon-eraser\" />, \"Eraser\")}\n    />\n  );\n};\n\nconst SelectButton = () => {\n  const { lasso, mode } = useDrawCtrl();\n  const updateDrawCtrl = useUpdateDrawCtrl();\n\n  const icon = addTip(\n    lasso ? <IconFont type=\"icon-lasso1\" /> : <GatewayOutlined />,\n    \"Lasso\"\n  );\n\n  return mode === \"select\" ? (\n    <Button\n      type=\"link\"\n      icon={icon}\n      onClick={() => updateDrawCtrl({ lasso: !lasso })}\n      data-active={mode === \"select\"}\n    />\n  ) : (\n    <Button\n      {...btnProps}\n      icon={icon}\n      onClick={() => updateDrawCtrl({ mode: \"select\" })}\n    />\n  );\n};\n\nconst AddMoreButtons: FC = () => {\n  const drawCtrl = useDrawCtrl();\n  const updateDrawCtrl = useUpdateDrawCtrl();\n  const { mode, imageSrc } = drawCtrl;\n\n  const getButton = (\n    modeName: DrawCtrl[\"mode\"],\n    icon: ReactNode,\n    className?: string\n  ) => (\n    <Button\n      key={modeName}\n      className={className}\n      type={mode === modeName ? \"link\" : \"text\"}\n      onClick={() => updateDrawCtrl({ mode: modeName })}\n      icon={icon}\n      data-active={mode === modeName}\n    />\n  );\n\n  const buttons: Record<string, ReactNode> = {\n    text: getButton(\"text\", addTip(<IconFont type=\"icon-text1\" />, \"Add text\")),\n    picture: getButton(\"picture\", addTip(<PictureOutlined />, \"Add image\")),\n    rect: getButton(\"rect\", addTip(<BorderOutlined />, \"Add rectangle\")),\n  };\n\n  const [showImage, setShowImage] = useState(false);\n\n  const optionPanels: Record<string, ReactNode> = {\n    text: <div className=\"text-option\">Tap anywhere to insert text.</div>,\n    picture: (\n      <div className=\"picture-option\">\n        <Input\n          value={imageSrc}\n          onChange={(e) => updateDrawCtrl({ imageSrc: e.target.value })}\n          prefix={<LinkOutlined />}\n          placeholder=\"Image URL\"\n          allowClear\n        />\n        {\n          <img\n            src={imageSrc}\n            alt=\"inserted\"\n            data-show={showImage}\n            onLoad={() => setShowImage(true)}\n            onError={() => setShowImage(false)}\n          />\n        }\n      </div>\n    ),\n    rect: <PenPanel {...{ drawCtrl, updateDrawCtrl }} />,\n  };\n\n  const content = (\n    <div className=\"add-pop\">\n      <div className=\"button-row\">{Object.values(buttons)}</div>\n      {/^(text|picture|rect)$/.test(mode) && (\n        <div className=\"option-panel\" data-mode={mode}>\n          {optionPanels[mode]}\n        </div>\n      )}\n    </div>\n  );\n  return (\n    <>\n      {Object.entries(buttons).map(([key, btn]) => (\n        <Popover\n          key={\"pop-\" + key}\n          className=\"btn-for-desktop\"\n          content={optionPanels[key]}\n          trigger=\"click\"\n          placement=\"bottomRight\"\n          getPopupContainer={(e) => e.parentElement!}\n        >\n          {btn}\n        </Popover>\n      ))}\n      <Popover\n        className=\"btn-for-phone\"\n        content={content}\n        trigger=\"click\"\n        placement=\"bottomRight\"\n        getPopupContainer={(e) => e.parentElement!}\n      >\n        {buttons[mode] ?? (\n          <Button\n            type=\"text\"\n            icon={addTip(<PlusCircleOutlined />, \"Add more\")}\n          />\n        )}\n      </Popover>\n    </>\n  );\n};\n","import {\n  FC,\n  useMemo,\n  useState,\n  useEffect,\n  useContext,\n  PropsWithChildren,\n  ReactNode,\n} from \"react\";\nimport {\n  Badge,\n  Alert,\n  Modal,\n  Button,\n  Divider,\n  message,\n  Popover,\n  Tooltip,\n  Switch,\n  Select,\n} from \"antd\";\nimport Search from \"antd/lib/input/Search\";\nimport { useNavigate, useParams } from \"react-router-dom\";\nimport { PasscodeInput } from \"antd-mobile\";\nimport { TeamCtx } from \"../Team\";\nimport { getUserID, getUserName, saveUserName, UserInfo } from \"lib/user\";\nimport {\n  EyeOutlined,\n  FormOutlined,\n  TeamOutlined,\n  LinkOutlined,\n  UserOutlined,\n  CheckOutlined,\n  ReloadOutlined,\n  GlobalOutlined,\n  ShareAltOutlined,\n  BranchesOutlined,\n  CheckCircleFilled,\n  DisconnectOutlined,\n  EyeInvisibleOutlined,\n  UsergroupAddOutlined,\n  QuestionCircleOutlined,\n} from \"@ant-design/icons\";\nimport { editNoteData } from \"lib/note/archive\";\nimport { UserAvatar } from \"component/UserAvatar\";\nimport { putNote } from \"lib/network/http\";\nimport copy from \"clipboard-copy\";\nimport { useAsideOpen } from \"lib/hooks\";\nimport { sortBy } from \"lodash\";\nimport IconFont from \"component/IconFont\";\nimport { useDrawCtrl, useUpdateDrawCtrl } from \"lib/draw/DrawCtrl\";\nimport { OptionButton } from \"../Options\";\n\nexport const HeaderRight: FC<{\n  instantSave: () => Promise<void> | undefined;\n}> = ({ instantSave }) => {\n  const { teamOn } = useContext(TeamCtx);\n  return (\n    <div className=\"right\">\n      {teamOn ? <RoomInfo /> : <JoinRoom instantSave={instantSave} />}\n      <PageNavButton />\n      <OptionButton placement=\"bottomRight\" />\n    </div>\n  );\n};\n\nconst PageNavButton = () => {\n  const [asideOpen, setAsideOpen] = useAsideOpen();\n  return (\n    <Button\n      type={asideOpen ? \"link\" : \"text\"}\n      icon={<IconFont type=\"icon-cards\" />}\n      onClick={() => setAsideOpen((prev) => !prev)}\n    />\n  );\n};\n\nconst UserCard: FC<{ userInfo: UserInfo }> = ({ userInfo }) => {\n  const [renaming, setRenaming] = useState(false);\n  const { ignores, setIgnores, resetIO } = useContext(TeamCtx);\n  useEffect(() => setRenaming(false), [userInfo]);\n  if (!userInfo) return null;\n\n  const { userName, online, userID } = userInfo;\n  const self = userID === getUserID();\n  const ignored = ignores.has(userID) && !self;\n\n  const switchIgnore = () => {\n    setIgnores((prev) => {\n      if (prev.has(userID)) return prev.delete(userID);\n      return prev.add(userID);\n    });\n  };\n\n  const submitRename = (value: string) => {\n    const name = value.trim();\n    if (!name || name === userName) return setRenaming(false);\n    saveUserName(name);\n    resetIO();\n  };\n\n  return (\n    <div className=\"user-item\" data-online={online}>\n      <UserAvatar userInfo={userInfo} size=\"small\" className=\"room-avatar\" />\n      {renaming || <span className=\"user-name\">{userName}</span>}\n      {renaming && (\n        <Search\n          autoFocus\n          className=\"rename-input\"\n          defaultValue={userName}\n          onSearch={submitRename}\n          enterButton={<Button icon={<CheckOutlined />} />}\n        />\n      )}\n      {self ? (\n        renaming || (\n          <Button\n            type=\"text\"\n            icon={<FormOutlined />}\n            onClick={() => setRenaming(true)}\n          />\n        )\n      ) : (\n        <Button\n          type=\"text\"\n          icon={ignored ? <EyeInvisibleOutlined /> : <EyeOutlined />}\n          onClick={switchIgnore}\n        />\n      )}\n    </div>\n  );\n};\n\nconst ShareButton: FC = () => {\n  const [copied, setCopied] = useState(false);\n  const link = window.location.href;\n  const share = async () => {\n    try {\n      await copy(`${document.title}\\n${link}`);\n      setCopied(true);\n    } catch (e) {\n      console.log(e);\n    }\n  };\n  return (\n    <Button\n      icon={copied ? <CheckCircleFilled /> : <LinkOutlined />}\n      type={copied ? \"primary\" : \"default\"}\n      className=\"share-btn\"\n      onClick={share}\n      block\n    >\n      {copied ? \"Copied\" : \"Copy link\"}\n    </Button>\n  );\n};\n\nconst TeamInfoMenu: FC<\n  PropsWithChildren<{ title: string; icon: ReactNode }>\n> = ({ children, title, icon }) => {\n  return (\n    <div className=\"team-info-menu\">\n      <div className=\"team-info-title\">\n        {icon}\n        <span>{title}</span>\n      </div>\n      {children}\n      <Divider />\n    </div>\n  );\n};\n\nconst ShareMenu: FC = () => {\n  const { code } = useContext(TeamCtx);\n  return (\n    <TeamInfoMenu icon={<ShareAltOutlined />} title=\"Share\">\n      <PasscodeInput\n        className=\"code-display\"\n        value={String(code)}\n        length={4}\n        plain\n      />\n      <ShareButton />\n    </TeamInfoMenu>\n  );\n};\n\nconst CollaborateMenu: FC = () => {\n  const drawCtrl = useDrawCtrl();\n  const { globalEraser } = drawCtrl;\n  const updateDrawCtrl = useUpdateDrawCtrl();\n\n  return (\n    <TeamInfoMenu icon={<BranchesOutlined />} title=\"Collaborate\">\n      <div className=\"global-switch\">\n        <span>\n          Global\n          <Tooltip className=\"hint\" title=\"Turn on to edit others' strokes.\">\n            <QuestionCircleOutlined />\n          </Tooltip>\n        </span>\n        <Switch\n          size=\"small\"\n          checked={globalEraser}\n          onChange={(v) => updateDrawCtrl({ globalEraser: v })}\n        />\n      </div>\n    </TeamInfoMenu>\n  );\n};\n\nconst RoomInfo: FC = () => {\n  const { userRec, connected, loadInfo, loadState, resetIO } =\n    useContext(TeamCtx);\n\n  const userList = useMemo(() => {\n    const selfID = getUserID();\n    const { [selfID]: selfInfo, ...otherUsers } = userRec;\n    if (!selfInfo) return [];\n    const values = Object.values(otherUsers);\n    return [selfInfo, ...sortBy(values, \"online\").reverse()];\n  }, [userRec]);\n\n  const onlineNum = useMemo(\n    () => userList.filter(({ online }) => online).length,\n    [userList]\n  );\n\n  const teamPop = (\n    <div className=\"team-popover\">\n      {connected || (\n        <Alert\n          className=\"disconn-alert\"\n          message=\"Network failed.\"\n          icon={<DisconnectOutlined />}\n          type=\"error\"\n          showIcon\n          banner\n        />\n      )}\n      <ShareMenu />\n      <CollaborateMenu />\n      <TeamInfoMenu icon={<TeamOutlined />} title=\"Members\">\n        <div className=\"user-list\">\n          {userList.map((u) => (\n            <UserCard key={u.userID} userInfo={u} />\n          ))}\n        </div>\n      </TeamInfoMenu>\n    </div>\n  );\n\n  const [reloading, setReloading] = useState(false);\n  const title = (\n    <div className=\"team-title\">\n      <span>Team info</span>\n      <Button\n        shape=\"circle\"\n        type=\"text\"\n        size=\"small\"\n        loading={reloading}\n        icon={<ReloadOutlined />}\n        onClick={async () => {\n          setReloading(true);\n          await loadInfo();\n          await loadState();\n          setReloading(false);\n          resetIO();\n        }}\n      />\n    </div>\n  );\n\n  return (\n    <Popover\n      content={teamPop}\n      trigger=\"click\"\n      placement=\"bottomRight\"\n      title={title}\n      getPopupContainer={(e) => e.parentElement!}\n      destroyTooltipOnHide\n    >\n      <Button\n        type=\"text\"\n        icon={\n          <Badge\n            status={connected ? \"success\" : \"error\"}\n            count={connected ? onlineNum : \"!\"}\n            size=\"small\"\n          >\n            <TeamOutlined />\n          </Badge>\n        }\n      />\n    </Popover>\n  );\n};\n\nconst JoinRoom: FC<{\n  instantSave: () => Promise<void> | undefined;\n}> = ({ instantSave }) => {\n  const noteID = useParams().noteID ?? \"\";\n  const nav = useNavigate();\n\n  const createRoom = async () => {\n    await instantSave();\n    const res = await putNote(noteID);\n    if (!res) return message.error(\"Can't create room.\");\n    await editNoteData(noteID, { team: true });\n    nav(\"/team/\" + noteID);\n  };\n\n  const content = (\n    <div className=\"share-modal-content\">\n      <Alert\n        className=\"share-alert\"\n        type=\"warning\"\n        message=\"This will make your note public.\"\n      />\n      <p className=\"share-list-item\">\n        <span className=\"user-info\">\n          <GlobalOutlined />\n          Anyone with the link\n        </span>\n        <Select\n          defaultValue=\"EDIT\"\n          options={[{ value: \"EDIT\", label: \"Edit\" }]}\n        />\n      </p>\n      <p className=\"share-list-item\">\n        <span className=\"user-info\">\n          <UserOutlined />\n          {getUserName()} (You)\n        </span>\n        <span>Owner</span>\n      </p>\n    </div>\n  );\n\n  const showModal = () => {\n    Modal.confirm({\n      title: \"Enable team editing\",\n      content,\n      icon: <TeamOutlined style={{ color: \"#555\" }} />,\n      onOk: createRoom,\n    });\n  };\n\n  return (\n    <Button type=\"text\" icon={<UsergroupAddOutlined />} onClick={showModal} />\n  );\n};\n","import { FC } from \"react\";\nimport { HeaderLeft } from \"./Left\";\nimport { HeaderMiddle } from \"./Middle\";\nimport { HeaderRight } from \"./Right\";\nimport \"./header.sass\";\n\nexport const Header: FC<{\n  saved: boolean;\n  handleUndo: () => void;\n  handleRedo: () => void;\n  undoable: boolean;\n  redoable: boolean;\n  instantSave: () => Promise<void> | undefined;\n}> = ({ saved, instantSave, ...undoProps }) => (\n  <header>\n    <HeaderLeft saved={saved} instantSave={instantSave} />\n    <HeaderMiddle {...undoProps} />\n    <HeaderRight instantSave={instantSave} />\n  </header>\n);\n","import { FC, useMemo, useState } from \"react\";\nimport { Input } from \"antd\";\nimport { NoteInfo } from \"lib/note/note\";\nimport dayjs from \"dayjs\";\nimport calender from \"dayjs/plugin/calendar\";\ndayjs.extend(calender);\n\nexport const InfoNav: FC<{\n  noteInfo: NoteInfo;\n  renameNote: (name: string) => void;\n}> = ({ noteInfo, renameNote }) => {\n  const [inputShow, setInputShow] = useState(false);\n  const [name, setName] = useState(noteInfo.name);\n\n  const [createDateShow, setCreateDateShow] = useState(false);\n  const { lastTime: lt, createTime: ct } = noteInfo;\n  const lastDate = useMemo(() => dayjs(lt).calendar(), [lt]);\n  const createDate = useMemo(() => dayjs(ct).calendar(), [ct]);\n\n  return (\n    <nav>\n      <div className=\"info\">\n        {inputShow ? (\n          <Input\n            className=\"title\"\n            size=\"large\"\n            bordered={false}\n            value={name}\n            onChange={(e) => setName(e.target.value)}\n            autoFocus\n            onBlur={() => {\n              renameNote(name);\n              setInputShow(false);\n            }}\n          />\n        ) : (\n          <p className=\"title\" onClick={() => setInputShow(true)}>\n            {name}\n          </p>\n        )}\n        <span className=\"time\" onClick={() => setCreateDateShow((p) => !p)}>\n          {createDateShow ? createDate : lastDate}\n          <span className=\"label\">\n            {createDateShow ? \"Created\" : \"Last Edited\"}\n          </span>\n        </span>\n      </div>\n    </nav>\n  );\n};\n","import { useHotkeys } from \"react-hotkeys-hook\";\n\nconst isMac = /Mac/i.test(navigator.userAgent);\n\nexport function useRedoUndo(onUndo: () => void, onRedo: () => void) {\n  const undoKey = isMac ? \"meta+z\" : \"ctrl+z\";\n  const redoKey = isMac ? \"meta+shift+z\" : \"ctrl+shift+z\";\n\n  useHotkeys(undoKey, (e) => {\n    e.preventDefault();\n    onUndo();\n  });\n\n  useHotkeys(redoKey, (e) => {\n    e.preventDefault();\n    onRedo();\n  });\n}\n","import {\n  FC,\n  useMemo,\n  useState,\n  useEffect,\n  useContext,\n  useCallback,\n} from \"react\";\nimport { NoteInfo, NotePage, createPage, defaultNotePage } from \"lib/note/note\";\nimport { DrawCtrlProvider, useDrawCtrl } from \"lib/draw/DrawCtrl\";\nimport { NewPageInfo, pushAck, ReorderInfo } from \"lib/network/io\";\nimport { DarkModeProvider } from \"lib/Dark\";\nimport { SetOperation, StateSet } from \"lib/draw/StateSet\";\nimport { loadNote, editNoteData } from \"lib/note/archive\";\nimport { showPageDelMsg, showReopenMsg } from \"./tools/Messages\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport PageWrapper from \"component/PageWrapper\";\nimport { DrawState } from \"draft-pad/dist/lib\";\nimport { useScrollPage } from \"./lib/scroll\";\nimport { debounce, last } from \"lodash\";\nimport { insertAfter } from \"./lib/array\";\nimport { PageNav } from \"./PageNav\";\nimport { AsideOpenProvider, Setter, useEvent } from \"lib/hooks\";\nimport { AddPageButton } from \"./tools/AddButton\";\nimport { Header } from \"./Header\";\nimport { TeamCtx } from \"./Team\";\nimport { Map } from \"immutable\";\nimport { message } from \"antd\";\nimport { InfoNav } from \"./Info\";\nimport { useRedoUndo } from \"lib/keyboard\";\nimport \"./reader.sass\";\n\nexport interface ReaderStates {\n  noteID: string;\n  currPageID: string;\n  stateSet: StateSet;\n  pageRec: Map<string, NotePage>;\n  pageOrder: string[];\n  size: number;\n}\n\nexport interface ReaderMethods {\n  scrollPage: (pageID: string) => void;\n  switchPageMarked: (pageID: string) => void;\n  addPage: (prevPageID: string, copy?: boolean) => void;\n  addFinalPage: () => void;\n  deletePage: (pageID: string) => void;\n  saveReorder: (order: string[], push: boolean) => Promise<void>;\n  setSize: Setter<number>;\n}\n\nexport default function Reader() {\n  return (\n    <AsideOpenProvider>\n      <DarkModeProvider>\n        <DrawCtrlProvider>\n          <ReaderContent />\n        </DrawCtrlProvider>\n      </DarkModeProvider>\n    </AsideOpenProvider>\n  );\n}\n\nconst ReaderContent: FC = () => {\n  const noteID = useParams().noteID ?? \"\";\n  const nav = useNavigate();\n\n  const [pageRec, setPageRec] = useState<Map<string, NotePage>>();\n  const [noteInfo, setNoteInfo] = useState<NoteInfo>();\n  const [stateSet, setStateSet] = useState<StateSet>();\n  const [pageOrder, setPageOrder] = useState<string[]>();\n  const [saved, setSaved] = useState(true);\n\n  const { io, addTeamStatePage, checkOpID } = useContext(TeamCtx);\n\n  useEffect(() => {\n    (async () => {\n      const storedNote = await loadNote(noteID);\n      if (!storedNote) {\n        message.error(\"Note not found\");\n        return nav(\"/\");\n      }\n      const { pageRec, pdf, pageOrder, ...noteInfo } = storedNote;\n      setPageRec(Map(pageRec));\n      setPageOrder(pageOrder);\n      setNoteInfo(noteInfo);\n      setStateSet(StateSet.createFromPages(pageRec));\n    })();\n  }, [nav, noteID]);\n\n  useEffect(() => {\n    if (!noteInfo) return;\n    document.title = noteInfo.name + \" - Multibility\";\n  }, [noteInfo]);\n\n  useEffect(() => {\n    document.body.classList.add(\"reader\");\n    return () => document.body.classList.remove(\"reader\");\n  }, []);\n\n  const saver = useEvent(async (withState = false) => {\n    let currPageRec = pageRec;\n    if (withState) {\n      stateSet?.getStates().forEach((ds, pageID) => {\n        currPageRec = currPageRec?.update(pageID, defaultNotePage, (page) => ({\n          ...page,\n          state: DrawState.flaten(ds),\n        }));\n      });\n      setPageRec(currPageRec);\n    }\n    const pr = currPageRec?.toObject();\n    await editNoteData(noteID, { pageRec: pr });\n    setSaved(true);\n  });\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const debouncedSave = useCallback(debounce(saver, 5000), [saver]);\n  const instantSave = debouncedSave.flush;\n\n  const savePageRec = (pageID: string, cb: (prev: NotePage) => NotePage) => {\n    setPageRec((prev) => prev?.update(pageID, defaultNotePage, cb));\n    setSaved(false);\n    debouncedSave();\n  };\n\n  const saveReorder = async (pageOrder: string[], push = false) => {\n    setPageOrder(pageOrder);\n    await editNoteData(noteID, { pageOrder });\n    await instantSave();\n    push && pushReorder(pageOrder);\n  };\n\n  const pushReorder = (pageOrder: string[]) =>\n    io?.emit(\"reorder\", { pageOrder });\n\n  const handleReorder = useEvent(\n    ({ deleted, pageOrder, prevOrder }: ReorderInfo) => {\n      saveReorder(pageOrder);\n      if (!deleted) return;\n      showPageDelMsg(() => saveReorder(prevOrder, true));\n    }\n  );\n\n  const handleNewPage = useEvent(\n    ({ pageOrder, pageID, newPage }: NewPageInfo) => {\n      saveReorder(pageOrder);\n      savePageRec(pageID, () => newPage);\n      setStateSet((prev) => prev?.addState(pageID, newPage));\n    }\n  );\n\n  useEffect(() => {\n    io?.on(\"reorder\", handleReorder);\n    io?.on(\"newPage\", handleNewPage);\n    return () => void io?.removeAllListeners();\n  }, [io, handleReorder, handleNewPage]);\n\n  const pushOperation = (operation: SetOperation) => {\n    const handleSync = (t: number) => {\n      if (operation.type !== \"add\") return;\n      const { pageID, stroke } = operation;\n      const { uid } = stroke;\n      setStateSet((prev) => prev?.syncStrokeTime(pageID, uid, t));\n    };\n\n    io?.emit(\n      \"push\",\n      { operation },\n      ({ timestamp, prevID, currID }: pushAck) => {\n        handleSync(timestamp);\n        checkOpID(prevID, currID);\n      }\n    );\n  };\n\n  const pushNewPage = (\n    pageOrder: string[],\n    pageID: string,\n    newPage: NotePage\n  ) => {\n    const { image, marked, ...newTeamPage } = newPage;\n    io?.emit(\"newPage\", { pageOrder, pageID, newPage: newTeamPage });\n    addTeamStatePage(pageID, newPage);\n  };\n\n  const updateStateSet = (cb: (prevSS: StateSet) => StateSet) => {\n    if (!stateSet) return;\n    const newSS = cb(stateSet);\n    if (newSS === stateSet) return;\n    setStateSet(newSS);\n    setSaved(false);\n    debouncedSave(true);\n    const lastOp = newSS.lastOp;\n    lastOp && pushOperation(lastOp);\n  };\n\n  const switchPageMarked = (pageID: string) =>\n    savePageRec(pageID, (prev) => ({ ...prev, marked: !prev.marked }));\n\n  const addPage = (prevPageID: string, copy = false) => {\n    if (!pageOrder) return;\n    const prevPage = copy ? pageRec?.get(prevPageID) : undefined;\n    const [pageID, newPage] = createPage(prevPage);\n    const newOrder = insertAfter(pageOrder, prevPageID, pageID);\n    pushNewPage(newOrder, pageID, newPage);\n    saveReorder(newOrder);\n    savePageRec(pageID, () => newPage);\n    setStateSet((prev) => prev?.addState(pageID, newPage));\n  };\n\n  const addFinalPage = () => {\n    const lastPageID = last(pageOrder);\n    lastPageID && addPage(lastPageID);\n  };\n\n  const deletePage = (pageID: string) => {\n    const newOrder = pageOrder?.filter((id) => id !== pageID);\n    newOrder?.length && saveReorder(newOrder, true);\n  };\n\n  const [size, setSize] = useState(100);\n  const isFull = size === 100;\n  const pd = (100 - size) / 2 + \"%\";\n  const mainStyle = { paddingLeft: pd, paddingRight: pd };\n\n  const { setInviewRatios, scrollPage, sectionRef, currPageID, scrolling } =\n    useScrollPage(noteID, pageOrder, [size]);\n\n  const { finger } = useDrawCtrl();\n\n  useEffect(() => {\n    if (!window.BroadcastChannel) return;\n    const bc = new BroadcastChannel(\"open note\");\n    bc.postMessage(noteID);\n    bc.onmessage = (e) => {\n      if (e.data !== noteID) return;\n      debouncedSave.cancel();\n      showReopenMsg(() => nav(\"/\"));\n    };\n    return () => bc.close();\n  }, [nav, noteID, debouncedSave]);\n\n  useEffect(() => {\n    const handleUnload = (e: BeforeUnloadEvent) => {\n      if (saved) return;\n      e.preventDefault();\n      return (e.returnValue = \"\");\n    };\n    window.addEventListener(\"beforeunload\", handleUnload);\n    return () => window.removeEventListener(\"beforeunload\", handleUnload);\n  }, [saved]);\n\n  const renameNote = async (name: string) => {\n    if (name === noteInfo?.name) return;\n    await editNoteData(noteID, { name });\n    const storedNote = await loadNote(noteID);\n    if (!storedNote) return;\n    const { pageRec, pdf, pageOrder, ...info } = storedNote;\n    setNoteInfo(info);\n  };\n\n  const handleUndo = () => updateStateSet((prev) => prev.undo());\n  const handleRedo = () => updateStateSet((prev) => prev.redo());\n  useRedoUndo(handleUndo, handleRedo);\n\n  if (!stateSet || !pageOrder || !pageRec || !noteInfo) return null;\n  const readerStates: ReaderStates = {\n    noteID,\n    pageRec,\n    pageOrder,\n    stateSet,\n    currPageID,\n    size,\n  };\n  const readerMethods: ReaderMethods = {\n    scrollPage,\n    switchPageMarked,\n    addFinalPage,\n    addPage,\n    deletePage,\n    saveReorder,\n    setSize,\n  };\n\n  return (\n    <div className=\"reader container\">\n      <Header\n        saved={saved}\n        instantSave={instantSave}\n        handleUndo={handleUndo}\n        handleRedo={handleRedo}\n        undoable={stateSet.isUndoable()}\n        redoable={stateSet.isRedoable()}\n      />\n      <InfoNav noteInfo={noteInfo} renameNote={renameNote} />\n      <main data-finger={finger} data-full={isFull} style={mainStyle}>\n        {pageOrder.map((uid) => (\n          <section key={uid} className=\"note-page\" ref={sectionRef(uid)}>\n            <PageContainer\n              uid={uid}\n              updateStateSet={updateStateSet}\n              setInviewRatios={setInviewRatios}\n              scrolling={scrolling}\n              {...readerStates}\n            />\n          </section>\n        ))}\n        <footer>\n          <AddPageButton addFinalPage={addFinalPage} />\n        </footer>\n      </main>\n      <PageNav {...readerStates} {...readerMethods} />\n    </div>\n  );\n};\n\nconst PageContainer: FC<\n  {\n    uid: string;\n    updateStateSet: (cb: (prevSS: StateSet) => StateSet) => void;\n    setInviewRatios: Setter<Map<string, number>>;\n    scrolling: boolean;\n  } & ReaderStates\n> = ({\n  uid,\n  updateStateSet,\n  setInviewRatios,\n  scrolling,\n  pageRec,\n  stateSet,\n  currPageID,\n  pageOrder,\n  noteID,\n}) => {\n  const { teamState, ignores } = useContext(TeamCtx);\n\n  const page = pageRec.get(uid);\n  const drawState = stateSet.getOneState(uid);\n  const teamStateMap = teamState?.getOnePageStateMap(uid);\n  const updateState = useEvent((ds: DrawState) => {\n    updateStateSet((prev) => prev.setState(uid, ds));\n  });\n\n  const onViewChange = useEvent((ratio: number) => {\n    if (!ratio) return setInviewRatios((prev) => prev.delete(uid));\n    setInviewRatios((prev) => prev.set(uid, ratio));\n  });\n\n  const preload = useMemo(() => {\n    if (!pageOrder) return false;\n    const currIndex = pageOrder.indexOf(currPageID);\n    const selfIndex = pageOrder.indexOf(uid);\n    return Math.abs(selfIndex - currIndex) <= 1;\n  }, [currPageID, uid, pageOrder]);\n\n  if (!page || !drawState) return null;\n  return (\n    <PageWrapper\n      drawState={drawState}\n      teamStateMap={teamStateMap}\n      updateState={updateState}\n      pdfIndex={page.pdfIndex}\n      noteID={noteID}\n      ignores={ignores}\n      onViewChange={onViewChange}\n      preload={preload}\n      skipInView={scrolling}\n    />\n  );\n};\n","import React, { useState, useEffect, useCallback, useRef } from \"react\";\nimport {\n  getTeamNoteState,\n  loadTeamNoteInfo,\n  updatePages,\n} from \"lib/network/http\";\nimport { IoFactory, NewPageInfo } from \"lib/network/io\";\nimport { useNavigate, useParams } from \"react-router-dom\";\nimport { showJoinMsg, showLeaveMsg } from \"./tools/Messages\";\nimport { TeamState } from \"lib/draw/TeamState\";\nimport { getUserID, UserInfo } from \"lib/user\";\nimport { NotePage } from \"lib/note/note\";\nimport { Socket } from \"socket.io-client\";\nimport { Setter, useEvent } from \"lib/hooks\";\nimport { Loading } from \"component/Loading\";\nimport { message } from \"antd\";\nimport { Set } from \"immutable\";\nimport Reader from \"./Reader\";\nimport { DebouncedFunc, throttle } from \"lodash\";\nimport bytes from \"bytes\";\n\nexport const TeamCtx = React.createContext({\n  io: undefined as Socket | undefined,\n  code: 0,\n  teamOn: false,\n  connected: false,\n  ignores: Set<string>(),\n  userRec: {} as Record<string, UserInfo>,\n  teamState: undefined as TeamState | undefined,\n  resetIO: () => {},\n  loadInfo: async () => false,\n  loadState: (() => {}) as DebouncedFunc<() => Promise<boolean>>,\n  setIgnores: (() => {}) as Setter<Set<string>>,\n  addTeamStatePage: (pageID: string, newPage: NotePage) => {},\n  checkOpID: (prevID: string, currID: string) => {},\n});\n\nexport default function Team() {\n  const noteID = useParams().noteID ?? \"\";\n  const [teamState, setTeamState] = useState<TeamState>();\n  const [code, setCode] = useState(-2);\n  const [userRec, setUserRec] = useState<Record<string, UserInfo>>({});\n  const [ignores, setIgnores] = useState(Set<string>());\n  const [io, setIO] = useState<Socket>();\n  const [loaded, setLoaded] = useState(false);\n  const [connected, setConnected] = useState(false);\n  const nav = useNavigate();\n  const [loadingText, setLoadingText] = useState(\"\");\n\n  const loadInfo = useEvent(async () => {\n    setLoadingText(\"Loading note info...\");\n    const info = await loadTeamNoteInfo(noteID, (len) => {\n      setLoadingText(\"Downloading PDF: \" + bytes(len));\n    });\n    if (!info) {\n      message.error(\"Failed loading the team note info\");\n      return false;\n    }\n    setCode(info.code);\n    return true;\n  });\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const loadState = useCallback(\n    throttle(async (cb?: (len: number) => void) => {\n      setLoadingText(\"Loading team note...\");\n      const teamNote = await getTeamNoteState(noteID, (len) => {\n        if (len < 1024) return;\n        setLoadingText(\"Loading team note: \" + bytes(len));\n        cb?.(len);\n      });\n      if (!teamNote) {\n        message.error(\"Failed loading the team note state\");\n        return false;\n      }\n      setTeamState(TeamState.createFromTeamPages(teamNote));\n      return true;\n    }, 10_000),\n    [noteID]\n  );\n  const reloadState = () => {\n    const key = \"SYNC\";\n    const hide = message.loading({ content: \"Syncing...\", key });\n    loadState((len) => {\n      const content = \"Syncing: \" + bytes(len);\n      message.loading({ content, key, duration: 0 });\n    })?.then(hide);\n  };\n\n  const resetIO = useEvent(() => setIO(IoFactory(noteID)));\n  const updateSelfState = useEvent(() => void updatePages(noteID));\n\n  const opID = useRef(\"\");\n  const checkOpID = useEvent((prevID: string, currID: string) => {\n    const lost = prevID && opID.current && prevID !== opID.current;\n    opID.current = currID;\n    if (lost) reloadState();\n  });\n  const resetOpID = useEvent((currID: string) => {\n    const lost = opID.current && opID.current !== currID;\n    opID.current = currID;\n    if (lost) reloadState();\n  });\n\n  useEffect(() => {\n    const roomInit = async () => {\n      const infoLoaded = await loadInfo();\n      const stateLoaded = await loadState();\n      if (!infoLoaded || !stateLoaded) return nav(\"/\");\n      setLoaded(true);\n      resetIO();\n      updateSelfState();\n    };\n    roomInit();\n    return updateSelfState;\n  }, [loadInfo, loadState, nav, resetIO, updateSelfState]);\n\n  useEffect(() => {\n    if (!io) return;\n    io.on(\"push\", ({ operation, userID, prevID, currID }) => {\n      setTeamState((prev) => prev?.pushOperation(operation, userID));\n      checkOpID(prevID, currID);\n    });\n\n    io.on(\"join\", ({ joined, members }) => {\n      const { userID, userName } = joined;\n      setUserRec(members);\n      if (userID === getUserID()) return;\n      showJoinMsg(userID, userName);\n    });\n\n    io.on(\"leave\", ({ leaved, members }) => {\n      const { userID, userName } = leaved;\n      setUserRec(members);\n      if (userID === getUserID()) return io.emit(\"join\");\n      showLeaveMsg(userID, userName);\n    });\n\n    io.on(\"newPage\", (info: NewPageInfo) => {\n      const { pageID, newPage } = info;\n      setTeamState((prev) => prev?.addPage(pageID, newPage));\n    });\n\n    io.on(\"reset\", ({ userID, pageRec }) => {\n      if (userID === getUserID()) return;\n      setTeamState((prev) => prev?.resetUser(userID, pageRec));\n    });\n\n    io.on(\"connect_error\", console.error);\n    io.on(\"disconnect\", () => setConnected(false));\n    io.on(\"connect\", () => setConnected(true));\n    io.on(\"connected\", ({ currID }) => resetOpID(currID));\n\n    return () => {\n      io.removeAllListeners();\n      io.close();\n    };\n  }, [io, checkOpID, resetOpID]);\n\n  const addTeamStatePage = (pageID: string, newPage: NotePage) => {\n    setTeamState((prev) => prev?.addPage(pageID, newPage));\n  };\n\n  return (\n    <Loading loading={!loaded} text={loadingText}>\n      <TeamCtx.Provider\n        value={{\n          io,\n          code,\n          teamOn: true,\n          ignores,\n          userRec,\n          connected,\n          teamState,\n          resetIO,\n          loadInfo,\n          loadState,\n          setIgnores,\n          addTeamStatePage,\n          checkOpID,\n        }}\n      >\n        <Reader />\n      </TeamCtx.Provider>\n    </Loading>\n  );\n}\n","import { io } from \"socket.io-client\";\nimport { NotePage } from \"lib/note/note\";\nimport { getUserID, getUserName } from \"lib/user\";\nimport { BASE_URL } from \"./http\";\n\nexport const IoFactory = (noteID: string) =>\n  io(BASE_URL, {\n    query: {\n      userID: getUserID(),\n      userName: getUserName(),\n      noteID,\n    },\n  });\n\nexport interface ReorderInfo {\n  pageOrder: string[];\n  prevOrder: string[];\n  deleted: boolean;\n}\n\nexport interface NewPageInfo {\n  pageOrder: string[];\n  pageID: string;\n  newPage: NotePage;\n}\n\nexport interface pushAck {\n  timestamp: number;\n  prevID: string;\n  currID: string;\n}\n","import { Button, message, Modal } from \"antd\";\nimport { LoginOutlined, LogoutOutlined, HomeFilled } from \"@ant-design/icons\";\n\nexport const showPageDelMsg = (onUndo: () => void) => {\n  message.warning({\n    content: (\n      <>\n        One page was deleted.\n        <Button\n          size=\"small\"\n          type=\"link\"\n          onClick={() => {\n            message.destroy(\"DELETE\");\n            onUndo();\n          }}\n        >\n          Undo\n        </Button>\n      </>\n    ),\n    key: \"DELETE\",\n    duration: 10,\n  });\n};\n\nexport const showJoinMsg = (userID: string, userName: string) => {\n  message.success({\n    content: `${userName} joined the room`,\n    icon: <LoginOutlined />,\n    key: userID,\n  });\n};\n\nexport const showLeaveMsg = (userID: string, userName: string) => {\n  message.warning({\n    content: `${userName} left the room`,\n    icon: <LogoutOutlined />,\n    key: userID,\n  });\n};\n\nexport const showReopenMsg = (onOk: () => void) => {\n  Modal.error({\n    title: \"This note is opened in another tab.\",\n    okText: \"Back\",\n    okButtonProps: { icon: <HomeFilled /> },\n    onOk,\n  });\n};\n"],"names":["defaultRecord","states","Map","editStack","List","undoStack","defaultFactory","Record","StateSet","immutable","lastOp","this","getImmutable","get","pageID","getStates","drawState","prevDS","getOneState","currRecord","update","s","set","l","push","delete","uid","timestamp","DrawState","notePage","state","ratio","newDS","WIDTH","getEditStack","size","getUndoStack","isUndoable","lastUid","last","lastSetOp","pop","isRedoable","pageRec","map","scrollForage","localforage","name","persistScroll","debounce","noteID","currPageID","setItem","largestKey","order","result","maxRatio","key","insertAfter","list","prevItem","newItem","prevIndex","indexOf","curr","slice","splice","UserAvatar","userInfo","onClick","chosen","className","color","useMemo","getHashedColor","userID","userName","style","backgroundColor","AddPageButton","addFinalPage","type","icon","PlusOutlined","block","OptionButton","placement","finger","useDrawCtrl","updateDrawCtrl","useUpdateDrawCtrl","useForceLight","forceLight","setForceLight","isLight","useMediaQuery","query","options","checked","onChange","v","disabled","getPopupContainer","e","parentElement","trigger","content","MoreOutlined","PageNav","props","useState","left","setLeft","useAsideOpen","asideOpen","opposite","draggableId","index","isDragDisabled","innerRef","ref","CSSTransition","in","timeout","unmountOnExit","initKey","onDragEnd","destination","droppableId","direction","droppableProps","placeholder","isDraggingOver","PreviewCard","useActiveKey","activeKey","setAsideOpen","title","ALL","MARKED","WRITTEN","useSwipeable","onSwipedLeft","onSwipedRight","swipeDuration","swipeRef","swipeHandler","draggableProps","dragHandleProps","isDragging","isDropAnimating","PreviewTabs","PageList","cardDragged","PreviewFooter","React","refRec","useRef","pageOrder","saveReorder","initScroll","useEvent","current","scrollIntoView","useLayoutEffect","source","fromIndex","toIndex","newOrder","removed","exchange","isDropDisabled","PagePreview","pageIndex","displayName","stateSet","scrollPage","useContext","TeamCtx","teamState","ignores","setChosen","page","teamStateMap","getOnePageStateMap","marked","userIDs","TeamState","isEmpty","PageWrapper","undefined","thumbnail","image","preview","skipInView","PreviewTools","switchPageMarked","stopPropagation","PreviewOption","TeamAvatars","userRec","maxCount","classNames","maxPopoverPlacement","prev","addPage","deletePage","menu","items","label","CopyOutlined","DeleteOutlined","danger","destroyTooltipOnHide","setActiveKey","tabBarGutter","centered","IconFont","setSize","jumpMenu","pageSize","total","length","simple","popupClassName","bordered","showArrow","dropdownMatchSelectWidth","value","HeaderLeft","saved","instantSave","nav","useNavigate","HomeFilled","opacity","SaveOutlined","btnProps","addTip","HeaderMiddle","handleUndo","handleRedo","undoable","redoable","UndoOutlined","RedoOutlined","PenButton","EraserButton","AddMoreButtons","SelectButton","drawCtrl","mode","PenPanel","HighlightTwoTone","twoToneColor","HighlightOutlined","pixelEraser","pixelSeg","field","lasso","GatewayOutlined","imageSrc","getButton","modeName","buttons","text","picture","PictureOutlined","rect","BorderOutlined","showImage","setShowImage","optionPanels","target","prefix","LinkOutlined","allowClear","src","alt","onLoad","onError","Object","values","test","entries","btn","PlusCircleOutlined","HeaderRight","teamOn","RoomInfo","JoinRoom","PageNavButton","UserCard","renaming","setRenaming","setIgnores","resetIO","useEffect","online","self","getUserID","ignored","has","Search","autoFocus","defaultValue","onSearch","trim","saveUserName","enterButton","CheckOutlined","FormOutlined","EyeInvisibleOutlined","EyeOutlined","add","ShareButton","copied","setCopied","link","window","location","href","share","copy","document","console","log","CheckCircleFilled","TeamInfoMenu","children","ShareMenu","code","ShareAltOutlined","String","plain","CollaborateMenu","globalEraser","BranchesOutlined","QuestionCircleOutlined","connected","loadInfo","loadState","userList","selfID","selfInfo","otherUsers","sortBy","reverse","onlineNum","filter","teamPop","message","DisconnectOutlined","showIcon","banner","TeamOutlined","u","reloading","setReloading","shape","loading","ReloadOutlined","status","count","useParams","createRoom","putNote","editNoteData","team","GlobalOutlined","UserOutlined","getUserName","UsergroupAddOutlined","Modal","onOk","Header","undoProps","dayjs","calender","InfoNav","noteInfo","renameNote","inputShow","setInputShow","setName","createDateShow","setCreateDateShow","lt","lastTime","ct","createTime","lastDate","calendar","createDate","onBlur","p","isMac","navigator","userAgent","Reader","Dark","DrawCtrl","ReaderContent","setPageRec","setNoteInfo","setStateSet","setPageOrder","setSaved","io","addTeamStatePage","checkOpID","loadNote","storedNote","pdf","createFromPages","body","classList","remove","saver","withState","currPageRec","forEach","ds","defaultNotePage","pr","toObject","debouncedSave","useCallback","flush","savePageRec","cb","pushReorder","emit","handleReorder","deleted","prevOrder","showPageDelMsg","handleNewPage","newPage","addState","on","removeAllListeners","pushOperation","operation","prevID","currID","t","stroke","syncStrokeTime","handleSync","pushNewPage","newTeamPage","updateStateSet","newSS","prevPageID","prevPage","createPage","lastPageID","isFull","pd","mainStyle","paddingLeft","paddingRight","deps","refMap","setRefMap","scrolled","setPrevPageID","getItem","stored","section","inviewRatios","setInviewRatios","deferredRatios","useDeferredValue","deferredOrder","calcScrollY","header","firstElementChild","getBoundingClientRect","top","height","scrollY","scrollToCurr","scrollBy","sectionRef","el","taskID","scrolling","setScrolling","addEventListener","handleScroll","clearTimeout","setTimeout","removeEventListener","behavior","useDebugValue","useScrollPage","BroadcastChannel","bc","postMessage","onmessage","data","cancel","showReopenMsg","close","handleUnload","preventDefault","returnValue","info","undo","redo","onUndo","onRedo","undoKey","redoKey","useHotkeys","useRedoUndo","readerStates","readerMethods","id","PageContainer","updateState","setState","onViewChange","preload","currIndex","selfIndex","Math","abs","pdfIndex","Set","Team","setTeamState","setCode","setUserRec","setIO","loaded","setLoaded","setConnected","loadingText","setLoadingText","loadTeamNoteInfo","len","bytes","throttle","getTeamNoteState","teamNote","reloadState","hide","duration","then","BASE_URL","IoFactory","updateSelfState","updatePages","opID","lost","resetOpID","roomInit","infoLoaded","stateLoaded","joined","members","showJoinMsg","leaved","showLeaveMsg","resetUser","error","Loading","Provider","okText","okButtonProps"],"sourceRoot":""}