{"version":3,"file":"static/js/199.d952b2b6.chunk.js","mappings":"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","sources":["pages/reader/tools/DrawTools.tsx","lib/ErrorBoundary.tsx","component/PageWrapper/PageWrapper.tsx","component/PageWrapper/index.tsx","lib/draw/DrawCtrl.tsx","pages/reader/tools/PenPanel.tsx"],"sourcesContent":["/// <reference types=\"paper\" />\nimport {\n  CSSProperties,\n  FC,\n  RefObject,\n  useEffect,\n  useMemo,\n  useState,\n} from \"react\";\nimport {\n  CopyOutlined,\n  BoldOutlined,\n  DeleteOutlined,\n  BgColorsOutlined,\n  ItalicOutlined,\n} from \"@ant-design/icons\";\nimport { Button, ButtonProps, Popover, Select } from \"antd\";\nimport { DrawRefType } from \"draft-pad\";\nimport { DrawCtrl } from \"draft-pad/dist/lib\";\nimport { ColorSelect, PenPanel } from \"./PenPanel\";\nimport { allColors } from \"lib/color\";\nimport IconFont from \"component/IconFont\";\nimport \"./draw-tools.sass\";\n\nconst btnProps: ButtonProps = {\n  type: \"text\",\n  shape: \"round\",\n  size: \"small\",\n};\n\nconst getPosVars = (x: number, y: number) => {\n  return { \"--pos-x\": x + \"px\", \"--pos-y\": y + \"px\" } as CSSProperties;\n};\nconst getObjVars = (obj: Record<string, string | number>, unit?: string) => {\n  const result: Record<string, string | number> = {};\n  Object.entries(obj).forEach(([key, value]) => {\n    if (unit) value += unit;\n    result[\"--\" + key] = value;\n  });\n  return result as CSSProperties;\n};\n\nexport const SelectTool: FC<{\n  drawRef: RefObject<DrawRefType>;\n  visible: boolean;\n  clickPoint?: paper.Point;\n}> = ({ drawRef, visible, clickPoint }) => {\n  const [currDrawCtrl, setCurrDrawCtrl] = useState<Partial<DrawCtrl>>({});\n  useEffect(() => setCurrDrawCtrl({}), [visible]);\n  if (!clickPoint) return null;\n  const { x, y } = clickPoint;\n  return (\n    <div\n      className=\"select-tool tool-options\"\n      data-visible={visible}\n      style={getPosVars(x, y)}\n    >\n      {visible && (\n        <Popover\n          trigger=\"click\"\n          placement=\"bottom\"\n          overlayClassName=\"style-pop\"\n          getPopupContainer={(e) => e.parentElement!}\n          destroyTooltipOnHide\n          content={\n            <PenPanel\n              updateDrawCtrl={(updated) => {\n                setCurrDrawCtrl((prev) => ({ ...prev, ...updated }));\n                drawRef.current?.mutateStyle(updated);\n              }}\n              drawCtrl={currDrawCtrl}\n            />\n          }\n        >\n          <Button icon={<BgColorsOutlined />} {...btnProps} />\n        </Popover>\n      )}\n      <Button\n        icon={<CopyOutlined />}\n        onClick={() => drawRef.current?.duplicateSelected()}\n        {...btnProps}\n      />\n      <Button\n        danger\n        icon={<DeleteOutlined />}\n        onClick={() => drawRef.current?.deleteSelected()}\n        {...btnProps}\n      />\n    </div>\n  );\n};\n\nexport const TextTool: FC<{\n  pointText: paper.PointText;\n  drawRef: RefObject<DrawRefType>;\n  renderSlow: boolean;\n}> = ({ pointText, drawRef, renderSlow }) => {\n  const { view, position, leading, content, rotation } = pointText;\n  const { fontFamily, fontWeight, fontSize } = pointText;\n\n  const { x, y } = view.projectToView(position);\n  const { topLeft, bottomLeft } = pointText.bounds;\n  const { x: bx, y: by } = view.projectToView(topLeft);\n  const { x: bbx, y: bby } = view.projectToView(bottomLeft);\n  const optionAtBottom = by < 90;\n\n  const scale = pointText.viewMatrix.scaling.x;\n  const { width, height } = pointText.internalBounds;\n\n  const lineHeight = +leading / +fontSize ?? 1.2;\n\n  const color = pointText.fillColor?.toCSS(true) ?? allColors[0]!;\n  const fontColorBtn = (\n    <Popover\n      content={\n        <ColorSelect\n          color={color}\n          setColor={(c) =>\n            drawRef.current?.mutatePointText((prev) => {\n              prev.fillColor = c as unknown as paper.Color;\n            })\n          }\n        />\n      }\n      trigger=\"click\"\n      overlayStyle={{ width: 200 }}\n      placement=\"bottom\"\n      getPopupContainer={(e) => e.parentElement!}\n    >\n      <Button\n        {...btnProps}\n        icon={\n          <IconFont\n            type=\"icon-circle\"\n            className=\"text-color-icon\"\n            style={{ color }}\n          />\n        }\n      />\n    </Popover>\n  );\n\n  const { isItalic, isBold } = parseFontStyle(fontWeight);\n  const fontStyleCSS = {\n    fontWeight: isBold ? \"bold\" : \"normal\",\n    fontStyle: isItalic ? \"italic\" : \"normal\",\n  };\n\n  const fontFamilySelect = (\n    <Select\n      className=\"font-select\"\n      popupClassName=\"font-drop\"\n      value={fontFamily}\n      onChange={(v) => {\n        drawRef.current?.mutatePointText((prev) => {\n          prev.fontFamily = v;\n        });\n      }}\n      size=\"small\"\n      bordered={false}\n      virtual={false}\n      getPopupContainer={(e) => e.parentElement.parentElement!}\n      dropdownMatchSelectWidth={100}\n      options={[\n        { value: \"Arial, sans-serif\", name: \"Arial\" },\n        { value: \"'Times New Roman', serif\", name: \"Times\" },\n        { value: \"Georgia, serif\", name: \"Georgia\" },\n        { value: \"'Courier New', monospace\", name: \"Courier\" },\n      ].map(({ value, name }) => ({\n        value,\n        label: (\n          <span style={{ fontFamily: value, fontWeight: \"normal\" }}>\n            {name}\n          </span>\n        ),\n      }))}\n    />\n  );\n\n  const offset = useMemo(\n    // paperjs sets all baseline ratio to 0.75.\n    () => 0.75 - getBaselineRatio(fontFamily, lineHeight),\n    [fontFamily, lineHeight]\n  );\n\n  return (\n    <div\n      className=\"text-tool\"\n      style={{\n        ...getObjVars({ scale, color }),\n        ...getObjVars({ rotation }, \"deg\"),\n        ...getObjVars({ width, height }, \"px\"),\n        ...getObjVars({ offset }, \"em\"),\n        ...getPosVars(x, y),\n      }}\n    >\n      <div\n        className=\"textarea-wrapper\"\n        data-empty={!content}\n        style={{ fontSize, fontFamily, lineHeight, ...fontStyleCSS }}\n      >\n        <textarea\n          autoFocus={!content}\n          placeholder=\"Text\"\n          value={content}\n          onChange={(e) => {\n            drawRef.current?.mutatePointText((prev) => {\n              prev.content = e.target.value;\n            });\n          }}\n          data-slow={renderSlow}\n        />\n      </div>\n      <div\n        className=\"tool-options text-options\"\n        data-bottom={optionAtBottom}\n        style={{\n          ...(optionAtBottom ? getPosVars(bbx, bby) : getPosVars(bx, by)),\n        }}\n      >\n        <div className=\"row\">\n          {fontFamilySelect}\n          {fontColorBtn}\n        </div>\n        <div className=\"row\">\n          <Button\n            onClick={() => {\n              drawRef.current?.mutatePointText((prev) => {\n                prev.fontWeight = toggleBold(prev.fontWeight);\n              });\n            }}\n            {...btnProps}\n            type={isBold ? \"link\" : \"text\"}\n            icon={<BoldOutlined />}\n          />\n          <Button\n            onClick={() => {\n              drawRef.current?.mutatePointText((prev) => {\n                prev.fontWeight = toggleItalic(prev.fontWeight);\n              });\n            }}\n            {...btnProps}\n            type={isItalic ? \"link\" : \"text\"}\n            icon={<ItalicOutlined />}\n          />\n          <Button\n            {...btnProps}\n            icon={<IconFont type=\"icon-font_size_down\" />}\n            onClick={() => {\n              drawRef.current?.mutatePointText((prev) => {\n                const { topLeft } = prev.bounds;\n                prev.scale(0.9, topLeft);\n              });\n            }}\n          />\n          <Button\n            {...btnProps}\n            icon={<IconFont type=\"icon-font_size_up\" />}\n            onClick={() => {\n              drawRef.current?.mutatePointText((prev) => {\n                const { topLeft } = prev.bounds;\n                prev.scale(1.1, topLeft);\n              });\n            }}\n          />\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst parseFontStyle = (fontStyle: string | number) => {\n  fontStyle = fontStyle + \"\";\n  const isItalic = /italic/g.test(fontStyle);\n  const isBold = /bold/g.test(fontStyle);\n  return { isItalic, isBold };\n};\n\nconst toggleItalic = (fontStyle: string | number) => {\n  const { isItalic, isBold } = parseFontStyle(fontStyle);\n  const boldText = isBold ? \"bold\" : \"normal\";\n  return (isItalic ? \"\" : \"italic \") + boldText;\n};\n\nconst toggleBold = (fontStyle: string | number) => {\n  const { isItalic, isBold } = parseFontStyle(fontStyle);\n  const italicText = isItalic ? \"italic \" : \"\";\n  return italicText + (isBold ? \"normal\" : \"bold\");\n};\n\nconst getBaselineRatio = (fontFamily: string, lineHeight: number) => {\n  const div = document.createElement(\"div\");\n  div.innerText = \"p\";\n  Object.assign(div.style, { fontSize: \"100px\", fontFamily, lineHeight });\n  document.body.appendChild(div);\n\n  const span = document.createElement(\"span\");\n  span.style.display = \"inline-block\";\n  div.appendChild(span);\n\n  const r0 = div.getBoundingClientRect();\n  const r1 = span.getBoundingClientRect();\n  const ratio = (r1.y - r0.y) / r0.height;\n  document.body.removeChild(div);\n  return Math.max(-1, Math.min(ratio, 1));\n};\n","import { Result } from \"antd\";\nimport { Component, ErrorInfo, ReactNode } from \"react\";\n\ninterface Props {\n  children?: ReactNode;\n}\n\ninterface State {\n  hasError: boolean;\n}\n\nexport class ErrorBoundary extends Component<Props, State> {\n  public state: State = {\n    hasError: false,\n  };\n\n  public static getDerivedStateFromError(_: Error): State {\n    return { hasError: true };\n  }\n\n  public componentDidCatch(error: Error, errorInfo: ErrorInfo) {\n    console.error(\"Uncaught error:\", error, errorInfo);\n  }\n\n  public render() {\n    if (this.state.hasError) {\n      return <Result status=\"error\" title=\"Something went wrong.\" />;\n    }\n\n    return this.props.children;\n  }\n}\n","/// <reference types=\"paper\" />\nimport React, {\n  FC,\n  useRef,\n  useMemo,\n  useState,\n  useEffect,\n  useCallback,\n} from \"react\";\nimport { useDrawCtrl } from \"lib/draw/DrawCtrl\";\nimport { Draw, DrawRefType } from \"draft-pad\";\nimport { DrawState } from \"draft-pad/dist/lib\";\nimport { SelectTool, TextTool } from \"pages/reader/tools/DrawTools\";\nimport { once, range } from \"lodash\";\nimport { useInView } from \"react-intersection-observer\";\nimport { Map, Set } from \"immutable\";\nimport { ErrorBoundary } from \"lib/ErrorBoundary\";\nimport { useEvent } from \"lib/hooks\";\n\nconst PageWrapperRaw: FC<{\n  drawState: DrawState;\n  teamStateMap?: Map<string, DrawState>;\n  thumbnail?: string;\n  pdfIndex?: number;\n  noteID?: string;\n  updateState?: (ds: DrawState) => void;\n  onViewChange?: (ratio: number) => void;\n  preview?: boolean;\n  preload?: boolean;\n  ignores?: Set<string>;\n  skipInView?: boolean;\n}> = ({\n  thumbnail,\n  drawState,\n  teamStateMap,\n  updateState,\n  pdfIndex,\n  noteID = \"\",\n  preview = false,\n  onViewChange,\n  preload = false,\n  ignores = Set<string>(),\n  skipInView = false,\n}) => {\n  const threshold = onViewChange && range(0, 1.2, 0.2);\n  const [ref, visible, entry] = useInView({ threshold, skip: skipInView });\n  useEffect(() => {\n    if (!onViewChange) return;\n    if (!entry || !visible) return onViewChange(0);\n    onViewChange(entry.intersectionRatio);\n  }, [visible, entry, onViewChange]);\n\n  const [fullImg, setFullImg] = useState<string>();\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const loadImage = useCallback(\n    once(async () => {\n      if (!pdfIndex || !noteID) return;\n      const { getNotePageImage } = await import(\"lib/note/pdfImage\");\n      setFullImg(await getNotePageImage(noteID, pdfIndex));\n    }),\n    [pdfIndex, noteID]\n  );\n\n  const show = visible || preload;\n  useEffect(() => {\n    if (!preview && show) loadImage();\n  }, [show, preview, loadImage]);\n\n  const otherStates = useMemo(\n    () => teamStateMap?.deleteAll(ignores).toList().toArray(),\n    [teamStateMap, ignores]\n  );\n\n  const imageLoaded = Boolean(fullImg || !pdfIndex);\n  const drawShow = show && imageLoaded;\n\n  const { height, width } = drawState;\n  const ratio = height / width;\n\n  return (\n    <ErrorBoundary>\n      <div ref={ref} className=\"page-wrapper\" data-preview={preview}>\n        <svg className=\"size-holder\" viewBox={`0 0 100 ${ratio * 100}`} />\n        {drawShow && (\n          <DrawWrapper\n            drawState={drawState}\n            otherStates={otherStates}\n            updateState={updateState}\n            imgSrc={fullImg || thumbnail}\n            preview={preview}\n          />\n        )}\n      </div>\n    </ErrorBoundary>\n  );\n};\nPageWrapperRaw.displayName = \"PageWrapper\";\nexport const PageWrapper = React.memo(PageWrapperRaw);\n\nconst DrawWrapper: FC<{\n  drawState: DrawState;\n  otherStates?: DrawState[];\n  updateState?: (ds: DrawState) => void;\n  preview?: boolean;\n  imgSrc?: string;\n}> = ({ drawState, updateState, otherStates, preview = false, imgSrc }) => {\n  const drawCtrl = useDrawCtrl();\n  const drawRef = useRef<DrawRefType>(null);\n  const [selectShow, setSelectShow] = useState(false);\n  const [clickPoint, setClickPoint] = useState<paper.Point>();\n  const [pointText, setPointText] = useState<paper.PointText>();\n  const [renderSlow, setRenderSlow] = useState(false);\n\n  const handleChange = useEvent(\n    (arg: ((s: DrawState) => DrawState) | DrawState) => {\n      if (!updateState) return;\n      const newDS = arg instanceof DrawState ? arg : arg(drawState);\n      if (newDS === drawState) return;\n      updateState(newDS);\n    }\n  );\n\n  const toggleSelectTool = (active: boolean, clickPoint?: paper.Point) => {\n    if (clickPoint) setClickPoint(clickPoint);\n    setSelectShow(active);\n  };\n\n  const toggleTextTool = (\n    pointText: paper.PointText | undefined,\n    slow: boolean\n  ) => {\n    setPointText(pointText);\n    setRenderSlow(slow);\n  };\n\n  return preview ? (\n    <Draw\n      drawState={drawState}\n      otherStates={otherStates}\n      imgSrc={imgSrc}\n      readonly\n    />\n  ) : (\n    <>\n      <Draw\n        drawState={drawState}\n        otherStates={otherStates}\n        onChange={handleChange}\n        imgSrc={imgSrc}\n        drawCtrl={drawCtrl}\n        ref={drawRef}\n        toggleTextTool={toggleTextTool}\n        toggleSelectTool={toggleSelectTool}\n      />\n      <SelectTool\n        drawRef={drawRef}\n        visible={selectShow}\n        clickPoint={clickPoint}\n      />\n      {pointText && (\n        <TextTool\n          drawRef={drawRef}\n          pointText={pointText}\n          renderSlow={renderSlow}\n        />\n      )}\n    </>\n  );\n};\n","import { PageWrapper } from \"./PageWrapper\";\nimport \"./page-wrapper.sass\";\nexport default PageWrapper;\n","import React, {\n  FC,\n  PropsWithChildren,\n  useContext,\n  useDebugValue,\n  useEffect,\n  useState,\n} from \"react\";\nimport { notification } from \"antd\";\nimport localforage from \"localforage\";\nimport { debounce, once } from \"lodash\";\nimport { defaultDrawCtrl, DrawCtrl } from \"draft-pad/dist/lib\";\nimport \"./draw-ctrl.sass\";\n\nasync function getDrawCtrl() {\n  let drawCtrl = await localforage.getItem<DrawCtrl>(\"DRAW_CTRL\");\n  if (!drawCtrl) {\n    drawCtrl = defaultDrawCtrl;\n    await localforage.setItem(\"DRAW_CTRL\", drawCtrl);\n  }\n  return drawCtrl;\n}\n\nasync function saveDrawCtrl(drawCtrl: DrawCtrl) {\n  await localforage.setItem(\"DRAW_CTRL\", drawCtrl);\n}\n\nconst DrawCtrlContext = React.createContext({\n  drawCtrl: defaultDrawCtrl,\n  updateDrawCtrl: (() => {}) as (updated: Partial<DrawCtrl>) => void,\n});\n\nexport function useDrawCtrl() {\n  const { drawCtrl } = useContext(DrawCtrlContext);\n  useDebugValue(drawCtrl);\n  return drawCtrl;\n}\n\nexport function useUpdateDrawCtrl() {\n  const { updateDrawCtrl } = useContext(DrawCtrlContext);\n  return updateDrawCtrl;\n}\n\nexport const DrawCtrlProvider: FC<PropsWithChildren> = ({ children }) => {\n  const [drawCtrl, setDrawCtrl] = useState(defaultDrawCtrl);\n  useEffect(() => {\n    getDrawCtrl().then(setDrawCtrl);\n  }, []);\n\n  const updateDrawCtrl = (updated: Partial<DrawCtrl>) => {\n    setDrawCtrl((prev) => {\n      const newCtrl = { ...prev, ...updated };\n      saveDrawCtrl(newCtrl);\n      return newCtrl;\n    });\n  };\n\n  const { finger } = drawCtrl;\n  useEffect(() => {\n    const detectPen = debounce((e: PointerEvent) => {\n      const isPen = e.isPrimary && e.pointerType === \"pen\";\n      if (!isPen || !finger) return;\n      showPencilMsg(() => updateDrawCtrl({ finger: false }));\n    }, 1000);\n    document.addEventListener(\"pointerup\", detectPen);\n    return () => document.removeEventListener(\"pointerup\", detectPen);\n  }, [finger]);\n\n  return (\n    <DrawCtrlContext.Provider value={{ drawCtrl, updateDrawCtrl }}>\n      {children}\n    </DrawCtrlContext.Provider>\n  );\n};\n\nconst showPencilMsg = once(async (cb: () => void) => {\n  const hide = () => {\n    notification.close(\"PENCIL_ONLY\");\n    localforage.setItem(\"SKIP_PENCIL_ONLY_NOTY\", true);\n  };\n\n  if (await localforage.getItem(\"SKIP_PENCIL_ONLY_NOTY\")) return;\n\n  notification.info({\n    message: \"Your device supports Pencil Only\",\n    description: (\n      <div className=\"pencil-noty-content\">\n        <div\n          className=\"enable demo-card\"\n          onClick={() => {\n            cb();\n            hide();\n          }}\n        >\n          <div className=\"title\">Draw with pencil only</div>\n          <div className=\"stroke\"></div>\n          <div className=\"pencil-1 emoji\">✍️</div>\n          <div className=\"finger-1 emoji\">🫵</div>\n        </div>\n        <div className=\"disable demo-card\" onClick={hide}>\n          <div className=\"title\">Draw with fingers</div>\n          <div className=\"stroke\"></div>\n          <div className=\"finger-1 emoji\">🫵</div>\n          <div className=\"finger-2 emoji\">🫵</div>\n        </div>\n      </div>\n    ),\n    icon: <></>,\n    duration: 60,\n    className: \"pencil-noty\",\n    key: \"PENCIL_ONLY\",\n  });\n});\n","import { CSSProperties, FC, useEffect, useMemo, useState } from \"react\";\nimport { defaultWidthList, DrawCtrl } from \"draft-pad/dist/lib\";\nimport { ColorCirle } from \"component/ColorCircle\";\nimport { Popover, Segmented, Slider, Tooltip } from \"antd\";\nimport { allColors } from \"lib/color\";\nimport { Setter, useEvent } from \"lib/hooks\";\nimport IconFont from \"component/IconFont\";\nimport { List } from \"immutable\";\nimport { WIDTH } from \"lib/draw/DrawConst\";\nimport \"./pen-panel.sass\";\n\nexport const PenPanel: FC<{\n  updateDrawCtrl: (updated: Partial<DrawCtrl>) => void;\n  drawCtrl: Partial<DrawCtrl>;\n}> = ({ updateDrawCtrl, drawCtrl }) => {\n  const { highlight, color, mode } = drawCtrl;\n  const [panelBlur, setPanelBlur] = useState(false);\n\n  return (\n    <div\n      className=\"pen-panel\"\n      data-blur={panelBlur}\n      data-hi={highlight}\n      data-mode={mode}\n    >\n      <div className=\"pen-status\">\n        <WidthSelect\n          updateDrawCtrl={updateDrawCtrl}\n          drawCtrl={drawCtrl}\n          setPanelBlur={setPanelBlur}\n        />\n        <HighlightSwitch checked={highlight} updateDrawCtrl={updateDrawCtrl} />\n      </div>\n      <ColorSelect\n        color={color || \"\"}\n        setColor={(c) => updateDrawCtrl({ color: c })}\n      />\n    </div>\n  );\n};\n\nexport const WidthSelect: FC<{\n  updateDrawCtrl: (updated: Partial<DrawCtrl>) => void;\n  drawCtrl: Partial<DrawCtrl>;\n  setPanelBlur?: Setter<boolean>;\n  field?: \"lineWidth\" | \"eraserWidth\";\n}> = ({\n  updateDrawCtrl,\n  drawCtrl,\n  setPanelBlur = () => {},\n  field = \"lineWidth\",\n}) => {\n  const currWidth = drawCtrl[field];\n  const widthList = drawCtrl.widthList ?? defaultWidthList;\n  const color = field === \"lineWidth\" ? drawCtrl.color ?? \"#aaa\" : \"#aaa\";\n\n  const chosenIndex = useMemo(\n    () => widthList.indexOf(currWidth ?? -1),\n    [currWidth, widthList]\n  );\n\n  const [popShow, setPopShow] = useState(List([false, false, false, false]));\n  setPanelBlur = useEvent(setPanelBlur);\n  useEffect(() => {\n    if (popShow.includes(true)) setPanelBlur(true);\n    else setPanelBlur(false);\n  }, [popShow, setPanelBlur]);\n\n  // temp: ugly Implementation\n  const [widthRatio] = useState(() => {\n    const section = document.querySelector(\"section.note-page\");\n    const sw = section?.getBoundingClientRect().width ?? 0;\n    const bw = document.body.getBoundingClientRect().width;\n    return sw / bw;\n  });\n\n  const realSizeStyle = (width: number) =>\n    ({\n      \"--real-size\": `calc(${100 / WIDTH}vw * ${width} * ${widthRatio})`,\n    } as CSSProperties);\n\n  const options = [\n    { value: -1, label: null },\n    ...widthList.map((width, index) => ({\n      value: index,\n      label: (\n        <Popover\n          open={popShow.get(index)}\n          onOpenChange={(v) => setPopShow((prev) => prev.set(index, v))}\n          trigger={chosenIndex === index ? [\"click\"] : []}\n          placement=\"bottom\"\n          destroyTooltipOnHide\n          content={\n            <Slider\n              min={5}\n              max={100}\n              className=\"ctrl-slider\"\n              defaultValue={width}\n              onAfterChange={(w) => {\n                if (widthList.includes(w)) {\n                  setPopShow((prev) => prev.set(index, false));\n                  return updateDrawCtrl({ [field]: w });\n                }\n                const newWL = widthList.slice();\n                newWL[index] = w;\n                updateDrawCtrl({ widthList: newWL, [field]: w });\n              }}\n            />\n          }\n        >\n          <div\n            className=\"circle-wrapper\"\n            data-chosen={chosenIndex === index}\n            style={realSizeStyle(width)}\n          >\n            <ColorCirle className={\"width-circle \" + field} color={color} />\n          </div>\n        </Popover>\n      ),\n    })),\n  ];\n\n  return (\n    <Segmented\n      className=\"width-seg\"\n      value={chosenIndex}\n      options={options}\n      onChange={(i) => updateDrawCtrl({ [field]: widthList[+i] ?? 10 })}\n    />\n  );\n};\n\nconst HighlightSwitch: FC<{\n  checked?: boolean;\n  updateDrawCtrl: (updated: Partial<DrawCtrl>) => void;\n}> = ({ checked = false, updateDrawCtrl }) => {\n  return (\n    <label className=\"hi-wrapper\">\n      <input\n        type=\"checkbox\"\n        name=\"highlight\"\n        checked={checked}\n        onChange={(e) => updateDrawCtrl({ highlight: e.target.checked })}\n      />\n      <Tooltip title=\"Highlighter\" placement=\"bottom\">\n        <div className=\"hi-switch\">\n          <IconFont type=\"icon-Highlight\" />\n        </div>\n      </Tooltip>\n    </label>\n  );\n};\n\nexport const ColorSelect: FC<{\n  color: string;\n  setColor: (color: string) => void;\n}> = ({ setColor, color }) => (\n  <div className=\"color-select\">\n    {allColors.map((c) => (\n      <div\n        key={c}\n        data-color={c}\n        data-selected={color === c}\n        className=\"circle\"\n        style={{ backgroundColor: c, borderColor: c }}\n        onClick={() => setColor(c)}\n      />\n    ))}\n  </div>\n);\n"],"names":["btnProps","type","shape","size","getPosVars","x","y","getObjVars","obj","unit","result","Object","entries","forEach","key","value","SelectTool","drawRef","visible","clickPoint","useState","currDrawCtrl","setCurrDrawCtrl","useEffect","className","style","trigger","placement","overlayClassName","getPopupContainer","e","parentElement","destroyTooltipOnHide","content","PenPanel","updateDrawCtrl","updated","prev","current","mutateStyle","drawCtrl","icon","BgColorsOutlined","CopyOutlined","onClick","duplicateSelected","danger","DeleteOutlined","deleteSelected","TextTool","pointText","renderSlow","view","position","leading","rotation","fontFamily","fontWeight","fontSize","projectToView","bounds","topLeft","bottomLeft","bx","by","bbx","bby","optionAtBottom","scale","viewMatrix","scaling","internalBounds","width","height","lineHeight","color","fillColor","toCSS","allColors","fontColorBtn","setColor","c","mutatePointText","overlayStyle","IconFont","parseFontStyle","isItalic","isBold","fontStyleCSS","fontStyle","fontFamilySelect","popupClassName","onChange","v","bordered","virtual","dropdownMatchSelectWidth","options","name","map","label","offset","useMemo","getBaselineRatio","autoFocus","placeholder","target","toggleBold","BoldOutlined","toggleItalic","ItalicOutlined","test","div","document","createElement","innerText","assign","body","appendChild","span","display","r0","getBoundingClientRect","ratio","removeChild","Math","max","min","ErrorBoundary","state","hasError","error","errorInfo","console","this","status","title","props","children","_","Component","PageWrapperRaw","thumbnail","drawState","teamStateMap","updateState","pdfIndex","noteID","preview","onViewChange","preload","ignores","Set","skipInView","threshold","range","useInView","skip","ref","entry","intersectionRatio","fullImg","setFullImg","loadImage","useCallback","once","getNotePageImage","show","otherStates","deleteAll","toList","toArray","imageLoaded","Boolean","drawShow","viewBox","DrawWrapper","imgSrc","displayName","useDrawCtrl","useRef","selectShow","setSelectShow","setClickPoint","setPointText","setRenderSlow","handleChange","useEvent","arg","newDS","DrawState","Draw","readonly","toggleTextTool","slow","toggleSelectTool","active","React","getDrawCtrl","localforage","defaultDrawCtrl","saveDrawCtrl","DrawCtrlContext","useContext","useDebugValue","useUpdateDrawCtrl","DrawCtrlProvider","setDrawCtrl","then","newCtrl","finger","detectPen","debounce","isPrimary","pointerType","showPencilMsg","addEventListener","removeEventListener","Provider","cb","hide","notification","message","description","duration","highlight","mode","panelBlur","setPanelBlur","WidthSelect","HighlightSwitch","checked","ColorSelect","field","currWidth","widthList","defaultWidthList","chosenIndex","indexOf","List","popShow","setPopShow","includes","section","querySelector","widthRatio","realSizeStyle","WIDTH","index","open","get","onOpenChange","set","defaultValue","onAfterChange","w","newWL","slice","i","backgroundColor","borderColor"],"sourceRoot":""}