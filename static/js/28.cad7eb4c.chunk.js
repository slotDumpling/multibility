(self.webpackChunkmultibility=self.webpackChunkmultibility||[]).push([[28],{22568:function(e,t,n){"use strict";var r=n(92721);t.Z=(0,r.Z)({scriptUrl:"//at.alicdn.com/t/c/font_3181679_61bmx4utsp.js"})},241:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return we}});var r=n(74165),i=n(15861),o=n(29439),a=n(72791),u=n(70587),c=n(98211),l=n(1413),s=n(93433),d=n(46668),f=n.n(d),v=n(63078),p=n(1488),m=n(82670),h=n(96153),w=function(e,t){var n=new Map,r=t/2,i=(0,h.v)(t,t),o=i.canvas,a=i.context,u=new Image;return u.src=e,function(e){e=10*Math.round(e/10);var i=n.get(e);if(i)return i;a.translate(r,r),a.rotate(e*Math.PI/180),a.drawImage(u,-r,-r);var c=o.toDataURL();return a.clearRect(-r,-r,t,t),a.resetTransform(),n.set(e,c),c}},g=w("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAF0WlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNy4yLWMwMDAgNzkuMWI2NWE3OWI0LCAyMDIyLzA2LzEzLTIyOjAxOjAxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgMjMuNSAoTWFjaW50b3NoKSIgeG1wOkNyZWF0ZURhdGU9IjIwMjItMTAtMDVUMTY6Mzc6MzYrMDg6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDIyLTEwLTA2VDA5OjQ5OjQ2KzA4OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIyLTEwLTA2VDA5OjQ5OjQ2KzA4OjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozZWI2OWRkMS1lYjBhLTRlMmMtODhmOC03NTVkMDllNjhkMTgiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDoyZTdiNDZhMS05ZmE4LTVjNGMtYmM0Yi04ZDA3MzMyY2VjYjYiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDoyNDEwMDgwYi04OGRkLTRmYzktYWEwMi04NDJjM2M5MTgzM2QiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjI0MTAwODBiLTg4ZGQtNGZjOS1hYTAyLTg0MmMzYzkxODMzZCIgc3RFdnQ6d2hlbj0iMjAyMi0xMC0wNVQxNjozNzozNiswODowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIzLjUgKE1hY2ludG9zaCkiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjNlYjY5ZGQxLWViMGEtNGUyYy04OGY4LTc1NWQwOWU2OGQxOCIgc3RFdnQ6d2hlbj0iMjAyMi0xMC0wNlQwOTo0OTo0NiswODowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIzLjUgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+W4lGwQAAAuRJREFUWMPtV09ImmEY91NzavNvWjMyYaZrFJJN6NAGgbCYhw67CB1Gp0ivk0gm6zajWxDJqkMtRNq6FZ3WpUPs5kWiqWz+Wa0SiczU6dqz54lvEDvt8n679MCP7+V5Xnh/7/O+z+95PxEAiP4nRLcEbgn880TelEolZzAYlCaT6Q6htbVV2dzczIluGDMCuLgsn89vV6vV3PHx8eejo6Pk6elpPpPJbCMJGXMCer3+Ho6L09PT0N3dDX19feDz+YB8RqOxjTmBlpaW++Vy+cvQ0BA5wGazlVOp1FWpVMo0NTWZhSBgKxaLmcHBQfB4PDW8C42DgwPKwHcMW5gT0Ol0NhxX6AgqlQpEIhEK1C8vL6/C4bCPOQGpVNqxu7u7eXh4mMSdJ9Df6O3tbbjdbspCVqPR6FkSoFLTIawKheIJfl1zc3PvKBO0Zq1Wg6mpqRdMM4BGpXaXCgLRJpFIHmMs73K5YGZmBvb399dYE7hpcoRkfX19LRaLQU9PD9Tr9U+oB0qhCFwb7vz13t7etSagKBVQGW2CEgiFQuPJZJI0AVAlobOz85GgBGZnZ18mEgmwWq2QzWZL7e3tDkEJLCwsvNnZ2QGz2QwnJydplGthjwB3vzk2Ngajo6NQKBQ+okslGAGn0/mQFIjjOIjH47CxsfGWaRliw5EGAoFhlODnwWBwGBXxw+LiIuC5E48fDofjKU4TMyOg1Wo1OC6cnZ3BH0N3lcoQ8Z6eDCRWLLuhGRfPDQwMwPLy8hV9vV7vL4yXLRbLM0oSSTbLB0nX+fn515GREZDL5T/tdnuFsoDd8BuG7ZR+pncA+78dF8v19/dfNyCZTFafnJyEi4uLPB7PA+btWK1WW2nD6XQatra2IBqNAokQHYFKpbKyJsCJxWKT3+9/hVWwird/ZWlpaWV+fn51YmIiRDG+ZTN9D6hJaBAdiC4eHbxPzZqAiL9kCn5BDQ8V7xMzvwM3jPsLIuY/JqzwGwfc8bK3fn7PAAAAAElFTkSuQmCC",32),A=w("data:image/png;base64,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",64),x=function(e){var t=g(e),n=A(e);return"-webkit-image-set(url(".concat(t,")1x, url(").concat(n,")2x) 16 16, auto")};function Z(e){var t=(0,a.useRef)(!1),n=function(e){return e.isPrimary&&(t.current="touch"===e.pointerType)},r=function(n){return function(n){return!t.current||function(e){var t=e.touches[0];return"stylus"===(null===t||void 0===t?void 0:t.touchType)}(n)||e&&1===n.touches.length}(n)||n.stopPropagation()};return{onPointerDownCapture:n,onPointerMoveCapture:n,onTouchStartCapture:r,onTouchMoveCapture:r}}var y=function(e){var t=e.topLeft,n=e.bottomRight;return[Math.floor(t.x/100),Math.ceil(n.x/100),Math.floor(t.y/100),Math.ceil(n.y/100)]},b=function(e,t,n){for(var r=(null!==n&&void 0!==n?n:t).strokeBounds,i=y(r),a=(0,o.Z)(i,4),u=a[0],c=a[1],l=a[2],s=a[3],d=u;d<=c;d+=1)for(var f=l;f<=s;f+=1){var v,p,m,h;n&&(null===(v=e[d])||void 0===v||null===(p=v[f])||void 0===p||p.delete(n)),null===(m=e[d])||void 0===m||null===(h=m[f])||void 0===h||h.add(t)}},C=function(e,t){for(var n=new Set,r=y(t),i=(0,o.Z)(r,4),a=i[0],u=i[1],c=i[2],l=i[3],s=a;s<=u;s+=1)for(var d=c;d<=l;d+=1){var f,v;null===(f=e[s])||void 0===f||null===(v=f[d])||void 0===v||v.forEach((function(e){return n.add(e)}))}return Array.from(n)},j=n(80184),P=new d.Point(0,0),S=a.forwardRef((function(e,t){var n=e.drawState,r=e.otherStates,i=e.onChange,w=void 0===i?function(){}:i,g=e.drawCtrl,A=void 0===g?u.Hq:g,y=e.readonly,S=void 0!==y&&y,M=e.imgSrc,Q=e.toggleSelectTool,O=void 0===Q?function(){}:Q,V=e.toggleTextTool,Y=void 0===V?function(){}:V,U=n.width,J=n.height,X=(0,a.useMemo)((function(){return new d.Size(U,J)}),[U,J]),H=A.mode,q=A.finger,K=A.lasso,_=A.eraserWidth,$=(0,a.useRef)(null),ee=(0,a.useRef)(new(f().PaperScope)),te=(0,a.useState)([]),ne=(0,o.Z)(te,2),re=ne[0],ie=ne[1],oe=(0,a.useState)([]),ae=(0,o.Z)(oe,2),ue=ae[0],ce=ae[1],le=R(),se=(0,o.Z)(le,2),de=se[0],fe=se[1],ve=R(),pe=(0,o.Z)(ve,2),me=pe[0],he=pe[1];O=(0,c.Z)(O),Y=(0,c.Z)(Y);var we=function(){if(de){var e=de.bounds.bottomCenter,t=ee.current.view;O(!0,t.projectToView(e))}};(0,a.useLayoutEffect)((function(){var e,t=$.current,n=ee.current;if(t)return n.setup(t),n.settings.handleSize=10,n.settings.hitTolerance=20,[0,1,2].forEach((function(){return(new d.Layer).visible=!1})),null===(e=n.project.layers[2])||void 0===e||e.activate(),new n.Tool,function(){var e;null===(e=n.view)||void 0===e||e.remove(),(0,h.j)(t)}}),[]),(0,a.useEffect)((function(){ee.current.activate();var e=ee.current.project.layers,t=D(e,X);return function(){return t.forEach((function(e){return e.remove()}))}}),[X]);var ge=(0,p.Z)($),Ae=(0,o.Z)(ge,1)[0],xe=Ae/U;(0,a.useEffect)((function(){if(xe){var e=ee.current;return e.view.viewSize=X.multiply(xe),e.view.scale(xe,P),e.project.layers.forEach((function(e){return e.visible=!0})),e.view.update(),function(){var t;return null===(t=e.view)||void 0===t?void 0:t.scale(1/xe,P)}}}),[xe,X]);var Ze=R(),ye=(0,o.Z)(Ze,2),be=ye[0],Ce=ye[1];(0,a.useEffect)((function(){var e;if(M){ee.current.activate();var t=new d.Raster(M);null===(e=t.project.layers[0])||void 0===e||e.addChild(t),t.sendToBack(),t.onLoad=function(){t.view.update(),t.fitBounds(new d.Rectangle(X)),t.bringToFront()},Ce(t)}}),[M,X,Ce]);var je=(0,a.useMemo)((function(){return r?m.Dw.mergeStates.apply(m.Dw,[n].concat((0,s.Z)(r))):n.getStrokeMap()}),[n,r]),Pe=(0,a.useRef)(!1),Se=(0,a.useRef)(0),Me=(0,a.useRef)(!1),Re=function(){return Me.current=Pe.current};S&&Re(),(0,a.useEffect)((function(){var e=(0,o.Z)(ee.current.project.layers,2)[1];if(e){var t=function(){ee.current.activate();var t=[],r=[];e.removeChildren(1),je.forEach((function(i){var o=n.hasStroke(i.uid),a=k(i,e);o&&a&&t.push(a),a&&r.push(a)})),ie(t),ce(r),Je(),Me.current=!1,ct.current.forEach((function(e){return e.remove()})),ct.current=[];var i=performance.now();ee.current.view.requestUpdate(),requestAnimationFrame((function(){var e=performance.now()-i;Pe.current=e>20}))};if(Me.current)return Se.current=window.setTimeout(t,1e3),function(){return window.clearTimeout(Se.current)};t()}}),[je,n]);var ke=(0,a.useRef)(),De=(0,a.useState)(!1),We=(0,o.Z)(De,2),Ee=We[0],Ne=We[1],Te="select"===H&&Ee?"selected":H,Ie=(0,a.useState)([]),Be=(0,o.Z)(Ie,2),Le=Be[0],Ge=Be[1],ze=(0,a.useMemo)((function(){var e=new Set(Le);return re.filter((function(t){return e.has(t.name)}))}),[re,Le]),Fe=(0,c.Z)((function(){Ne(!1),fe(void 0),he(void 0),Ge([]),O(!1)}));(0,a.useEffect)((function(){if("select"===H)return Fe}),[H,Fe]),(0,a.useEffect)((function(){return Fe}),[K,Fe]),(0,a.useEffect)((function(){var e,t,r=null!==(e=null===(t=n.lastOp)||void 0===t?void 0:t.type)&&void 0!==e?e:"";/^redo|undo$/.test(r)&&Fe()}),[n,Fe]),(0,a.useEffect)((function(){if(O(!1),jt.current){var e=new Proxy(jt.current,{});Y(e,Pe.current)}}),[Ae,O,Y]);var Qe=(0,a.useRef)(),Oe=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Pe.current||t){var n=(0,o.Z)(ee.current.project.layers,2),r=n[0],i=n[1];if(r&&i){i.visible=!0,e.clipMask=!0;var a=i.firstChild;a.replaceWith(e),null===be||void 0===be||be.insertAbove(e);var u=72*devicePixelRatio,c=Ae/e.bounds.width*u,l=Qe.current;(l=Qe.current=i.rasterize({raster:l,resolution:c})).visible=!0,i.visible=!1,e.replaceWith(a),null===be||void 0===be||be.addTo(r)}}},Ve=function(){ee.current.activate();var e=(0,o.Z)(ee.current.project.layers,2)[1],t=Qe.current;e&&t&&(e.visible=!0,t.visible=!1)},Ye=(0,a.useRef)();(0,a.useEffect)((function(){return function(){var e;null===(e=Ye.current)||void 0===e||e.remove(),Ye.current=void 0}}),[Ae]);var Ue=function(){var e,t;if(Pe.current&&!0!==(null===(e=Ye.current)||void 0===e?void 0:e.visible)){ee.current.activate();var n=ee.current.view,r=null!==(t=Ye.current)&&void 0!==t?t:Ye.current=new d.Raster(n.viewSize.multiply(devicePixelRatio));r.drawImage(n.element,P),r.fitBounds(n.bounds),r.visible=!0,r.opacity=1;var i=(0,o.Z)(ee.current.project.layers,2)[1];i&&(i.visible=!1)}},Je=function(){ee.current.activate();var e=(0,o.Z)(ee.current.project.layers,2)[1],t=Ye.current,n=Qe.current;e&&t&&(t.visible=!1,!0!==(null===n||void 0===n?void 0:n.visible)&&(e.visible=!0))},Xe=function(e){Ue(),fe(E(A,e.point,Pe.current))},He=function(e){fe(E(A,e.point)),requestAnimationFrame(Ue)},qe=function(e){fe(W(e.point)),requestAnimationFrame(Ue)},Ke=(0,a.useRef)(!1),_e={draw:function(e){Re(),Xe(e)},erase:Xe,select:K?He:qe,selected:function(e){if(Ke.current=!1,de){if(!K){var t,n=null!==(t=de.hitTest(e.point,{segments:!0}))&&void 0!==t?t:null===me||void 0===me?void 0:me.hitTest(e.point,{segments:!0,selected:!0});if(ke.current=n,n)return}de.contains(e.point)||(Fe(),he(void 0),K?He(e):qe(e))}},text:null}[Te],$e=function(e){window.clearTimeout(Se.current),null===de||void 0===de||de.add(e.point),null===de||void 0===de||de.smooth()},et=function(e){ze.forEach((function(t){return t.translate(e)})),null===de||void 0===de||de.translate(e),null===me||void 0===me||me.translate(e)},tt={draw:$e,erase:$e,select:K?$e:function(e){if(de){var t=e.point,n=t.x,r=t.y,i=(0,o.Z)(de.segments,4),a=i[1],u=i[2],c=i[3];a&&u&&c&&(a.point.x=n,u.point=e.point,c.point.y=r,de.selected=!0)}},selected:function(e){var t=ke.current;if(de)if(O(!1),Ke.current=!0,null!==t&&void 0!==t&&t.segment){var n=t.segment;if(n.selected){var r=de.bounds.center,i=n.point.subtract(r),o=e.point.subtract(r);vt(x(o.angle));var a=o.angle-i.angle;de.rotate(a,r),null===me||void 0===me||me.rotate(a,r),ze.forEach((function(e){return null===e||void 0===e?void 0:e.rotate(a,r)}))}else{var u,c=n.point,l=n.next.next.point,s=c.subtract(l),d=e.point.subtract(l).project(s).x/s.x;if(d<0)return;if(de.scale(d,l),ze.forEach((function(e){e.scale(d,l),e.strokeWidth*=d})),!me)return;me.scale(d,l);var f=null===(u=me.segments[0])||void 0===u?void 0:u.point;if(!f)return;me.scale(100/me.length,f)}}else et(e.delta)},text:null}[Te];(0,a.useEffect)((function(){ee.current.tool.maxDistance=_}),[_]);var nt=(0,a.useRef)(new Set),rt=(0,a.useRef)(new Map),it=A.globalEraser,ot=A.pixelEraser,at=(0,a.useMemo)((function(){return/^(erase|select)$/.test(H)?function(e,t,n){var r=Math.ceil(t/100),i=Math.ceil(n/100),o=Array.from({length:r},(function(){return Array.from({length:i},(function(){return new Set}))}));return e.forEach((function(e){return b(o,e)})),o}(it&&"erase"===H&&!ot?ue:re,U,J):[]}),[re,U,J,H,ue,it,ot]),ut=function(e){var t=ee.current.project.layers[1];if("erase"===Te&&t){var n=_,r={class:f().Path,stroke:!0,tolerance:n/2},i=new d.Rectangle(e.point.subtract(n),new d.Size(n,n));C(at,i).forEach((function(i){var o;nt.current.has(i.name)||i.parent&&(null===(o=i.hitTestAll(e.point,r))||void 0===o||o.forEach((function(r){var i=r.item;if(i instanceof f().Path){for(var o=i;o.parent!==t&&o.parent instanceof f().PathItem;)o=o.parent;var a=o.name;if(ot){var u=(n+i.strokeWidth)/2,c=new d.Path.Circle({center:e.point,radius:u,insert:!1}),l=i.subtract(c,{trace:!1});i.replaceWith(l),o===i&&(b(at,l,i),o=l),rt.current.set(a,o)}else o.opacity=.5,o.guide=!0,nt.current.add(a)}})))}))}},ct=(0,a.useRef)([]),lt={draw:function(){if(!de||de.segments.length<=1)ct.current.length||Je();else{de.simplify(),Pe.current&&ct.current.push(de.clone());var e=de.exportJSON();w((function(t){return m.Dw.addStroke(t,e)})),fe(void 0)}},erase:function(){if(Je(),fe(void 0),A.pixelEraser){var e=Array.from(rt.current);rt.current.clear();var t=e.map((function(e){var t=(0,o.Z)(e,2),n=t[0],r=t[1],i=F(r);return i.forEach((function(e){return e.name=""})),[n,i.map((function(e){return e.exportJSON()}))]}));if(!t.length)return;w((function(e){return m.Dw.splitStrokes(e,t)}))}else{var n=Array.from(nt.current);if(nt.current.clear(),!n.length)return;w((function(e){return m.Dw.eraseStrokes(e,n)}))}},select:function(){if(Je(),de){if(Math.abs(de.area)<1e3)return fe(void 0);var e;if(K){de.closePath(),de.simplify(),Pe.current||N(de);var t=C(at,de.bounds);e=B(t,de)}else{var n=C(at,de.bounds);e=B(n,de);var r=new d.Path,i=de.bounds.topCenter;r.add(i,i.subtract(new d.Point(0,100))),r.lastSegment.selected=!0,he(r)}Ne(!0),Ge(e),we()}},selected:function(e){pt(e),de&&Ke.current&&(we(),xt())},text:function(e){if(jt.current)return Mt(),ht(e);var t=(0,o.Z)(ee.current.project.layers,2)[1];if(t){var n=G(t,e.point),r=n&&mt(n)?n:z(e.point);r.justification="left",jt.current=r,Pt.current=r.exportJSON(),Pe.current&&(r.visible=!1),requestAnimationFrame((function(){Ue(),r.visible=!0})),Y(r,Pe.current)}}}[Te],st=(0,a.useState)("auto"),dt=(0,o.Z)(st,2),ft=dt[0],vt=dt[1];(0,a.useEffect)((function(){"text"===Te||"select"===Te?vt("crosshair"):"selected"===Te?vt(K?"crosshair":"nwse-resize"):"draw"!==Te&&"erase"!==Te||vt(function(e,t){var n=e.lineWidth,r=e.eraserWidth,i=t*("erase"===e.mode?r:n);if(i<5)return"crosshair";var o=i/2,a=2*i,u=function(e){return'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" fill="%23DDD7" width="'.concat(e,'" height="').concat(e,'" viewBox="0 0 10 10"><circle cx="5" cy="5" r="5"/></svg>')},c=u(i),l=u(a);return"-webkit-image-set(url('".concat(c,"')1x, url('").concat(l,"')2x) ").concat(o," ").concat(o,", crosshair")}(A,xe))}),[Te,K,A,xe]);var pt=function(e){var t;if(de){var n=null!==(t=de.hitTest(e.point,{segments:!0}))&&void 0!==t?t:null===me||void 0===me?void 0:me.hitTest(e.point,{segments:!0,selected:!0});if(null!==n&&void 0!==n&&n.segment){if(n.segment.selected){var r=de.bounds.center;if(!r)return;var i=n.segment.point.subtract(r);return vt(x(i.angle))}var o=n.segment.point,a=n.segment.next.next.point,u=o.subtract(a),c=u.x,l=u.y;return vt(c*l<0?"nesw-resize":"nwse-resize")}if(de.contains(e.point))return vt("move");vt("crosshair")}},mt=function(e){return n.getStrokeMap().has(e.name)},ht=function(e){if(jt.current)return vt("auto");var t=ee.current.project.layers[1];if(t){var n=G(t,e.point);n&&mt(n)?vt("text"):vt("crosshair")}},wt=(0,l.Z)({selected:pt,text:ht},{select:null,draw:null,erase:null})[Te],gt=function(e){if("selected"===Te){var t={up:new d.Point(0,-10),down:new d.Point(0,10),left:new d.Point(-10,0),right:new d.Point(10,0)}[e.key];t&&(e.preventDefault(),t&&et(t),O(!1))}},At=(0,l.Z)({selected:function(e){/^(delete|backspace)$/.test(e.key)&&Zt(),/^(up|down|left|right)$/.test(e.key)&&xt(),/escape/.test(e.key)&&Fe()},text:function(e){/escape/.test(e.key)&&Mt()}},{select:null,draw:null,erase:null})[Te];(0,a.useEffect)((function(){if(!S){var e=function(e){return function(t){if(ee.current.activate(),e)return e(t)}},t=ee.current,n=t.view,r=t.tool;n.onMouseDown=e(_e),n.onMouseDrag=e(tt),n.onMouseUp=e(lt),n.onMouseMove=e(wt),r.onMouseDrag=e(ut),r.onKeyDown=e(gt),r.onKeyUp=e(At)}}));var xt=function(){if(null!==ze&&void 0!==ze&&ze.length){var e=ze.map((function(e){var t=e.name;return e.name="",[t,e.exportJSON()]}));w((function(t){return m.Dw.mutateStrokes(t,e)}))}},Zt=function(){Fe(),Le.length&&w((function(e){return m.Dw.eraseStrokes(e,Le)}))},yt=function(e){ee.current.activate(),L(ze,e),xt()},bt=function(){if(ee.current.activate(),de&&ze.length){var e=de.bounds.size,t=e.width,n=e.height,r=new d.Point(t,n).divide(10),i=ze.map((function(e){return e.clone()}));i.forEach((function(e){return e.translate(r)})),de.translate(r),null===me||void 0===me||me.translate(r),i.forEach((function(e){return e.name=""}));var o=i.map((function(e){return e.exportJSON()})),a=[];w((function(e){return m.Dw.addStrokes(e,o,a)})),Ge(a),we()}},Ct=function(){var e,t;ee.current.activate();var n=null===de||void 0===de?void 0:de.clone();return n&&Oe(n,!0),Ve(),null!==(e=null===(t=Qe.current)||void 0===t?void 0:t.toDataURL())&&void 0!==e?e:""},jt=(0,a.useRef)(),Pt=(0,a.useRef)(""),St=(0,c.Z)((function(){var e,t;(Je(),null!==(e=jt.current)&&void 0!==e&&e.name)||(null===(t=jt.current)||void 0===t||t.remove());jt.current=void 0,Y(void 0,Pe.current)})),Mt=(0,c.Z)((function(){var e=jt.current;if(e&&(St(),e.exportJSON()!==Pt.current)){var t=e.content,n=e.name;if(e.name="",t){var r=e.exportJSON();w(n?function(e){return m.Dw.mutateStrokes(e,[[n,r]])}:function(e){return m.Dw.addStroke(e,r)})}else n&&w((function(e){return m.Dw.eraseStrokes(e,[n])}))}})),Rt=function(e){var t=jt.current;t&&(ee.current.activate(),e(t),Y(new Proxy(t,{}),Pe.current))};(0,a.useEffect)((function(){if("text"===H)return Mt}),[H,Mt]),(0,a.useImperativeHandle)(t,(function(){return{deleteSelected:Zt,duplicateSelected:bt,rasterizeSelected:Ct,mutateStyle:yt,mutatePointText:Rt}}));var kt=(0,a.useRef)(1);(0,a.useEffect)((function(){var e=function(e){return e.preventDefault()};return document.addEventListener("gesturestart",e),document.addEventListener("gesturechange",e),document.addEventListener("gestureend",e),function(){document.removeEventListener("gesturestart",e),document.removeEventListener("gesturechange",e),document.removeEventListener("gestureend",e)}}),[]),(0,v.usePinch)((function(e){var t=e.memo,n=(0,o.Z)(e.offset,1)[0],r=e.first,i=e.last,a=e.origin;ee.current.activate();var u,c,l=ee.current.view,s=new(f().Point)(a);if(r||!t){var v=l.element.getBoundingClientRect(),p=v.x,m=v.y;c=new d.Point(p,m),u=s.subtract(c),O(!1),St(),Oe(new d.Path.Rectangle(P,X)),Je()}else{var h=(0,o.Z)(t,2);u=h[0],c=h[1]}var w=s.subtract(c),g=l.viewToProject(w),A=w.subtract(u).divide(l.zoom);l.translate(A);var x=n/kt.current;if(kt.current=n,ee.current.settings.hitTolerance/=x,l.scale(x,g),!i)return[w,c];Promise.all([I(l,X),T(l,g,x)]).then(Ve),l.scale(1/x,g)}),{scaleBounds:{max:5,min:1},rubberband:.5,target:$}),(0,v.useWheel)((function(e){var t=e.event,n=e.delta,r=e.ctrlKey,i=e.last;if(1!==kt.current&&!r){var o=ee.current.view;t.preventDefault();var a=P.subtract(new(f().Point)(n).divide(o.zoom));o.translate(a),i&&I(o,X)}}),{target:$,eventOptions:{passive:!1}});var Dt=Z(q);return(0,j.jsx)("div",(0,l.Z)((0,l.Z)({className:"draw-wrapper",style:{cursor:ft},"data-readonly":S},Dt),{},{children:(0,j.jsx)("canvas",{ref:$,className:"draw-canvas"})}))}));S.displayName="Draw";var M=a.memo(S);function R(){var e=(0,a.useState)(),t=(0,o.Z)(e,1)[0];return(0,a.useDebugValue)(t),(0,a.useEffect)((function(){return function(){null===t||void 0===t||t.remove()}}),[t]),e}var k=function(){var e=new WeakMap;return function(t,n){var r,i,o=t.pathData,a=t.uid,u=null!==(r=e.get(n))&&void 0!==r?r:new Map;e.set(n,u);var c=u.get(a);if((null===c||void 0===c?void 0:c.stroke)===t)n.addChild(c.item),i=c.item;else{var l;try{i=n.importJSON(o)}catch(s){console.error(s)}null!==(l=i)&&void 0!==l||(i=new(f().Item)),i.name=a,u.set(a,{item:i,stroke:t})}return i.opacity=1,i.guide=!1,i}}(),D=function(e,t){var n=(0,o.Z)(e,3),r=n[0],i=n[1],a=n[2];if(!r||!i||!a)return[];var u=new d.Path.Rectangle(P,t),c=u.clone(),l=u.clone();return u.fillColor=new d.Color("#fff"),r.addChild(u),i.addChild(c),a.addChild(l),i.clipped=!0,a.clipped=!0,[u,c,l]},W=function(e){var t=new d.Path.Rectangle(e,new d.Size(0,0));return t.onFrame=function(){},t},E=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.mode,i=e.lineWidth,o=e.eraserWidth,a=e.color,u=e.highlight,c=new d.Path;c.add(t),"erase"===r&&(a="#ccc",i=o),"select"===r&&(a="#009dec",i=5);var l=new d.Color(a);return("draw"===r&&u||"erase"===r&&!n)&&(l.alpha=.5,c.blendMode="multiply"),c.strokeColor=l,c.strokeWidth=i,c.strokeJoin="round",c.strokeCap="round",c.guide=!0,c},N=function(e){e.dashOffset=0,e.dashArray=[30,20],e.onFrame=function(){return e.dashOffset+=3}},T=function(e,t,n){return new Promise((function(r){if(Math.abs(n-1)<.05)return e.scale(n,t),r();var i=10;n=Math.pow(n,1/i);!function o(){e.scale(n,t),--i>0?requestAnimationFrame(o):requestAnimationFrame((function(){return r()}))}()}))},I=function(e,t){return new Promise((function(n){var r=function(e,t){var n=e.center,r=n.x,i=n.y,o=d.Size.min(e.size,t).divide(2),a=o.width,u=o.height,c=t.subtract(o),l=c.width,s=c.height,f=r<a?a:r>l?l:r,v=i<u?u:i>s?s:i;return new d.Point(f,v)}(e,t);if(e.center.equals(r))return n();var i=10;requestAnimationFrame((function t(){var o=e.center.subtract(r);e.translate(o.divide(i)),--i>0?requestAnimationFrame(t):requestAnimationFrame((function(){return n()}))}))}))},B=function(e,t){var n=function(e){return!(4!==t.segments.length||!e.isInside(t.bounds))||!e.subtract(t,{insert:!1,trace:!1}).compare(e)};return e.filter((function(e){if(!e.name)return!1;if(!e.bounds.intersects(t.bounds))return!1;if(e instanceof f().Path)return n(e);var r=new d.Path.Rectangle(e.bounds);return r.remove(),n(r)||t.isInside(e.bounds)})).map((function(e){return e.name}))},L=function(e,t){var n=t.lineWidth,r=t.color,i=t.highlight;e.forEach((function(e){if(e instanceof f().PointText&&r){var t=new d.Color(r);e.fillColor=t}if(e instanceof f().Path){if(r){var o=new d.Color(r);"multiply"===e.blendMode&&(o.alpha=.5),e.strokeColor=o}n&&(e.strokeWidth=n),e.strokeColor&&void 0!==i&&(e.strokeColor.alpha=i?.5:1,e.blendMode=i?"multiply":"normal")}}))},G=function(e,t){var n=e.hitTest(t,{class:f().PointText,fill:!0});if((null===n||void 0===n?void 0:n.item)instanceof f().PointText)return null===n||void 0===n?void 0:n.item},z=function(e){return new(f().PointText)({point:e.add(new d.Point(0,50)),content:"",fontSize:50,fontFamily:"Arial, sans-serif"})},F=function e(t){return t instanceof f().Path?t.isEmpty()?[]:[t]:t instanceof f().CompoundPath?t.children.map(e).flat():[]},Q=n(36485),O=n(61507),V=n(23414),Y=n(64239),U=n(82622),J=n(97804),X=n(94396),H=n(50759),q=n(69228),K=n(87309),_=n(70776),$=n(2721),ee=n(74115),te=n(64802),ne=n(22568),re={type:"text",shape:"round",size:"small"},ie=function(e,t){return{"--pos-x":e+"px","--pos-y":t+"px"}},oe=function(e,t){var n={};return Object.entries(e).forEach((function(e){var r=(0,o.Z)(e,2),i=r[0],a=r[1];t&&(a+=t),n["--"+i]=a})),n},ae=function(e){var t=e.drawRef,n=e.visible,r=e.clickPoint,i=(0,a.useState)({}),u=(0,o.Z)(i,2),c=u[0],s=u[1],d=r.x,f=r.y;return(0,j.jsxs)("div",{className:"select-tool tool-options","data-visible":n,style:ie(d,f),children:[(0,j.jsx)(q.Z,{trigger:"click",placement:"bottom",overlayClassName:"style-pop",getPopupContainer:function(e){return e.parentElement},destroyTooltipOnHide:!0,content:(0,j.jsx)($.Uk,{updateDrawCtrl:function(e){var n;s((function(t){return(0,l.Z)((0,l.Z)({},t),e)})),null===(n=t.current)||void 0===n||n.mutateStyle(e)},drawCtrl:c}),children:(0,j.jsx)(K.Z,(0,l.Z)({icon:(0,j.jsx)(O.Z,{})},re))}),(0,j.jsx)(K.Z,(0,l.Z)({icon:(0,j.jsx)(V.Z,{}),onClick:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.duplicateSelected()}},re)),(0,j.jsx)(K.Z,(0,l.Z)({icon:(0,j.jsx)(Y.Z,{}),onClick:function(){if(t.current){var e=t.current.rasterizeSelected();H.Z.confirm({title:"Screenshot",content:(0,j.jsx)("img",{className:"raster",src:e,alt:"raster"}),className:"raster-modal",icon:(0,j.jsx)(Q.Z,{}),okText:"Save",onOk:function(){return(0,te.saveAs)(e,document.title.split(" - ")[0]+".png")}})}}},re)),(0,j.jsx)(K.Z,(0,l.Z)({danger:!0,icon:(0,j.jsx)(U.Z,{}),onClick:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.deleteSelected()}},re))]})},ue=function(e){var t,n,r,i=e.pointText,o=e.drawRef,u=e.renderSlow,c=i.view,s=i.position,f=i.leading,v=i.content,p=i.rotation,m=i.fontFamily,h=i.fontWeight,w=i.fontSize,g=c.projectToView(s),A=g.x,x=g.y,Z=i.bounds,y=Z.topLeft,b=Z.bottomLeft,C=c.projectToView(y),P=C.x,S=C.y,M=c.projectToView(b),R=M.x,k=M.y,D=S<90,W=i.viewMatrix.scaling.x,E=i.internalBounds,N=E.width,T=E.height,I=null!==(t=+f/+w)&&void 0!==t?t:1.2,B=null!==(n=null===(r=i.fillColor)||void 0===r?void 0:r.toCSS(!0))&&void 0!==n?n:ee.Qk[0],L=(0,j.jsx)(q.Z,{content:(0,j.jsx)($.Q5,{color:B,setColor:function(e){var t;return null===(t=o.current)||void 0===t?void 0:t.mutatePointText((function(t){t.fillColor=new d.Color(e)}))}}),trigger:"click",overlayStyle:{width:200},placement:"bottom",getPopupContainer:function(e){return e.parentElement},children:(0,j.jsx)(K.Z,(0,l.Z)((0,l.Z)({},re),{},{icon:(0,j.jsx)(ne.Z,{type:"icon-circle",className:"text-color-icon",style:{color:B}})}))}),G=ce(h),z=G.isItalic,F=G.isBold,Q={fontWeight:F?"bold":"normal",fontStyle:z?"italic":"normal"},O=(0,j.jsx)(_.Z,{className:"font-select",popupClassName:"font-drop",value:m,onChange:function(e){var t;null===(t=o.current)||void 0===t||t.mutatePointText((function(t){t.fontFamily=e}))},size:"small",bordered:!1,virtual:!1,getPopupContainer:function(e){return e.parentElement.parentElement},dropdownMatchSelectWidth:100,options:[{value:"Arial, sans-serif",name:"Arial"},{value:"'Times New Roman', serif",name:"Times"},{value:"Georgia, serif",name:"Georgia"},{value:"'Courier New', monospace",name:"Courier"}].map((function(e){var t=e.value,n=e.name;return{value:t,label:(0,j.jsx)("span",{style:{fontFamily:t,fontWeight:"normal"},children:n})}}))}),V=(0,a.useMemo)((function(){return.75-de(m,I)}),[m,I]);return(0,j.jsxs)("div",{className:"text-tool",style:(0,l.Z)((0,l.Z)((0,l.Z)((0,l.Z)((0,l.Z)({},oe({scale:W,color:B})),oe({rotation:p},"deg")),oe({width:N,height:T},"px")),oe({offset:V},"em")),ie(A,x)),children:[(0,j.jsx)("div",{className:"textarea-wrapper","data-empty":!v,style:(0,l.Z)({fontSize:w,fontFamily:m,lineHeight:I},Q),children:(0,j.jsx)("textarea",{autoFocus:!v,placeholder:"Text",value:v,onChange:function(e){var t;null===(t=o.current)||void 0===t||t.mutatePointText((function(t){t.content=e.target.value}))},"data-slow":u})}),(0,j.jsxs)("div",{className:"tool-options text-options","data-bottom":D,style:(0,l.Z)({},D?ie(R,k):ie(P,S)),children:[(0,j.jsxs)("div",{className:"row",children:[O,L]}),(0,j.jsxs)("div",{className:"row",children:[(0,j.jsx)(K.Z,(0,l.Z)((0,l.Z)({onClick:function(){var e;null===(e=o.current)||void 0===e||e.mutatePointText((function(e){e.fontWeight=se(e.fontWeight)}))}},re),{},{type:F?"link":"text",icon:(0,j.jsx)(J.Z,{})})),(0,j.jsx)(K.Z,(0,l.Z)((0,l.Z)({onClick:function(){var e;null===(e=o.current)||void 0===e||e.mutatePointText((function(e){e.fontWeight=le(e.fontWeight)}))}},re),{},{type:z?"link":"text",icon:(0,j.jsx)(X.Z,{})})),(0,j.jsx)(K.Z,(0,l.Z)((0,l.Z)({},re),{},{icon:(0,j.jsx)(ne.Z,{type:"icon-font_size_down"}),onClick:function(){var e;null===(e=o.current)||void 0===e||e.mutatePointText((function(e){var t=e.bounds.topLeft;e.scale(.9,t)}))}})),(0,j.jsx)(K.Z,(0,l.Z)((0,l.Z)({},re),{},{icon:(0,j.jsx)(ne.Z,{type:"icon-font_size_up"}),onClick:function(){var e;null===(e=o.current)||void 0===e||e.mutatePointText((function(e){var t=e.bounds.topLeft;e.scale(1.1,t)}))}}))]})]})]})},ce=function(e){return{isItalic:/italic/g.test(e+=""),isBold:/bold/g.test(e)}},le=function(e){var t=ce(e);return(t.isItalic?"":"italic ")+(t.isBold?"bold":"normal")},se=function(e){var t=ce(e);return(t.isItalic?"italic ":"")+(t.isBold?"normal":"bold")},de=function(e,t){var n=document.createElement("div");n.innerText="p",Object.assign(n.style,{fontSize:"100px",fontFamily:e,lineHeight:t}),document.body.appendChild(n);var r=document.createElement("span");r.style.display="inline-block",n.appendChild(r);var i=n.getBoundingClientRect(),o=(r.getBoundingClientRect().y-i.y)/i.height;return document.body.removeChild(n),Math.max(-1,Math.min(o,1))},fe=n(763),ve=n(19348),pe=n(24124),me=function(e){var t=e.thumbnail,u=e.drawState,c=e.teamStateMap,l=e.updateState,s=e.pdfIndex,d=e.noteID,f=void 0===d?"":d,v=e.preview,p=void 0!==v&&v,m=e.onViewChange,h=e.preload,w=void 0!==h&&h,g=e.ignores,A=void 0===g?(0,pe.l4)():g,x=e.skipInView,Z=void 0!==x&&x,y=m&&(0,fe.range)(0,1.2,.2),b=(0,ve.YD)({threshold:y,skip:Z}),C=(0,o.Z)(b,3),P=C[0],S=C[1],M=C[2];(0,a.useEffect)((function(){if(m)return M&&S?void m(M.intersectionRatio):m(0)}),[S,M,m]);var R=(0,a.useState)(),k=(0,o.Z)(R,2),D=k[0],W=k[1],E=(0,a.useCallback)((0,fe.once)((0,i.Z)((0,r.Z)().mark((function e(){var t,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s&&f){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,Promise.all([n.e(574),n.e(643),n.e(138)]).then(n.bind(n,21176));case 4:return t=e.sent,i=t.getNotePageImage,e.t0=W,e.next=9,i(f,s);case 9:e.t1=e.sent,(0,e.t0)(e.t1);case 11:case"end":return e.stop()}}),e)})))),[s,f]),N=S||w;(0,a.useEffect)((function(){!p&&N&&E()}),[N,p,E]);var T=(0,a.useMemo)((function(){return null===c||void 0===c?void 0:c.deleteAll(A).toList().toArray()}),[c,A]),I=Boolean(D||!s),B=N&&I,L=u.height/u.width;return(0,j.jsxs)("div",{ref:P,className:"page-wrapper",children:[(0,j.jsx)("svg",{className:"size-holder",viewBox:"0 0 100 ".concat(100*L)}),B&&(0,j.jsx)(he,{drawState:u,otherStates:T,updateState:l,imgSrc:D||t,preview:p})]})};me.displayName="PageWrapper";var he=function(e){var t=e.drawState,n=e.updateState,r=e.otherStates,i=e.preview,l=void 0!==i&&i,s=e.imgSrc,d=(0,u.gX)(),f=(0,a.useRef)(null),v=(0,a.useState)(!1),p=(0,o.Z)(v,2),h=p[0],w=p[1],g=(0,a.useState)(P),A=(0,o.Z)(g,2),x=A[0],Z=A[1],y=(0,a.useState)(),b=(0,o.Z)(y,2),C=b[0],S=b[1],R=(0,a.useState)(!1),k=(0,o.Z)(R,2),D=k[0],W=k[1],E=(0,c.Z)((function(e){if(n){var r=e instanceof m.Dw?e:e(t);r!==t&&n(r)}}));return l?(0,j.jsx)(M,{drawState:t,otherStates:r,imgSrc:s,readonly:!0}):(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(M,{drawState:t,otherStates:r,onChange:E,imgSrc:s,drawCtrl:d,ref:f,toggleTextTool:function(e,t){S(e),W(t)},toggleSelectTool:function(e,t){Z((function(e){return null!==t&&void 0!==t?t:e})),w(e)}}),(0,j.jsx)(ae,{drawRef:f,visible:h,clickPoint:x}),C&&(0,j.jsx)(ue,{drawRef:f,pointText:C,renderSlow:D})]})},we=a.memo(me)},70587:function(e,t,n){"use strict";n.d(t,{w3:function(){return b},Hq:function(){return w},Eq:function(){return h},gX:function(){return Z},F7:function(){return y}});var r=n(74165),i=n(1413),o=n(29439),a=n(15861),u=n(72791),c=n(50419),l=n(87309),s=n(31752),d=n(98272),f=n(61842),v=n.n(f),p=n(763),m=n(80184),h=[10,20,30,50],w={mode:"draw",finger:!0,lineWidth:10,eraserWidth:10,color:"#000000",highlight:!1,lasso:!1,pixelEraser:!1,globalEraser:!1,widthList:h};function g(){return(g=(0,a.Z)((0,r.Z)().mark((function e(){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v().getItem("DRAW_CTRL");case 2:if(t=e.sent){e.next=7;break}return t=w,e.next=7,v().setItem("DRAW_CTRL",t);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(){return(A=(0,a.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v().setItem("DRAW_CTRL",t);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var x=u.createContext({drawCtrl:w,updateDrawCtrl:function(){}});function Z(){var e=(0,u.useContext)(x).drawCtrl;return(0,u.useDebugValue)(e),e}function y(){return(0,u.useContext)(x).updateDrawCtrl}var b=function(e){var t=e.children,n=(0,u.useState)(w),r=(0,o.Z)(n,2),a=r[0],c=r[1];(0,u.useEffect)((function(){(function(){return g.apply(this,arguments)})().then(c)}),[]);var l=function(e){c((function(t){var n=(0,i.Z)((0,i.Z)({},t),e);return function(e){A.apply(this,arguments)}(n),n}))},s=a.finger;return(0,u.useEffect)((function(){var e=function(e){e.isPrimary&&"pen"===e.pointerType&&s&&C((function(){return l({finger:!1})}))};return document.addEventListener("pointerup",e),function(){return document.removeEventListener("pointerup",e)}}),[s]),(0,m.jsx)(x.Provider,{value:{drawCtrl:a,updateDrawCtrl:l},children:t})},C=(0,p.once)(function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=function(){c.ZP.destroy("DETECT_PENCIL"),v().setItem("SKIP_PENCIL_MSG",!0)},e.next=3,v().getItem("SKIP_PENCIL_MSG");case 3:if(!e.sent){e.next=5;break}return e.abrupt("return");case 5:c.ZP.info({content:(0,m.jsxs)(m.Fragment,{children:["Your device supports",(0,m.jsx)(l.Z,{shape:"round",size:"small",icon:(0,m.jsx)(s.Z,{}),onClick:function(){t(),n()},children:"Pencil only"}),(0,m.jsx)(l.Z,{size:"small",type:"text",shape:"circle",icon:(0,m.jsx)(d.Z,{style:{color:"#999"}}),onClick:n})]}),key:"DETECT_PENCIL",className:"pencil-msg"});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},96153:function(e,t,n){"use strict";function r(e,t){var n=document.createElement("canvas"),r=n.getContext("2d");if(!r)throw new Error("can't get virtual canvas context");return n.width=e,n.height=t,{canvas:n,context:r}}function i(e){e.width=1,e.height=1;var t=e.getContext("2d");null===t||void 0===t||t.clearRect(0,0,1,1)}n.d(t,{j:function(){return i},v:function(){return r}})},2721:function(e,t,n){"use strict";n.d(t,{Q5:function(){return x},Uk:function(){return w},Db:function(){return g}});var r=n(4942),i=n(93433),o=n(29439),a=n(72791),u=n(70587),c=n(35873),l=n(82670),s=n(69228),d=n(96272),f=n(53163),v=n(74115),p=n(22568),m=n(24124),h=n(80184),w=function(e){var t=e.updateDrawCtrl,n=e.drawCtrl,r=n.highlight,i=n.color,u=(0,a.useState)(!1),c=(0,o.Z)(u,2),l=c[0],s=c[1];return(0,h.jsxs)("div",{className:"pen-panel","data-blur":l,"data-hi":r,children:[(0,h.jsxs)("div",{className:"pen-status",children:[(0,h.jsx)(g,{updateDrawCtrl:t,drawCtrl:n,setPanelBlur:s}),(0,h.jsx)(A,{checked:r,updateDrawCtrl:t})]}),(0,h.jsx)(x,{color:i||"",setColor:function(e){return t({color:e})}})]})},g=function(e){var t,n,v=e.updateDrawCtrl,p=e.drawCtrl,w=e.setPanelBlur,g=void 0===w?function(){}:w,A=e.field,x=void 0===A?"lineWidth":A,Z=p[x],y=null!==(t=p.widthList)&&void 0!==t?t:u.Eq,b="lineWidth"===x&&null!==(n=p.color)&&void 0!==n?n:"#aaa",C=(0,a.useMemo)((function(){return y.indexOf(null!==Z&&void 0!==Z?Z:-1)}),[Z,y]),j=(0,a.useState)((0,m.aV)([!1,!1,!1,!1])),P=(0,o.Z)(j,2),S=P[0],M=P[1];(0,a.useEffect)((function(){S.includes(!0)?g(!0):g(!1)}),[S,g]);var R=function(e){return{"--real-size":"calc(".concat(100/l.mF,"vw * ").concat(e,")")}},k=[{value:-1,label:null}].concat((0,i.Z)(y.map((function(e,t){return{value:t,label:(0,h.jsx)(s.Z,{open:S.get(t),onOpenChange:function(e){return M((function(n){return n.set(t,e)}))},trigger:C===t?["click"]:[],placement:"bottom",destroyTooltipOnHide:!0,content:(0,h.jsx)(d.Z,{min:5,max:100,className:"ctrl-slider",defaultValue:e,onAfterChange:function(e){if(y.includes(e))return M((function(e){return e.set(t,!1)})),v((0,r.Z)({},x,e));var n=y.slice();n[t]=e,v((0,r.Z)({widthList:n},x,e))}}),children:(0,h.jsx)("div",{className:"circle-wrapper",style:R(e),children:(0,h.jsx)(c.W,{className:"width-circle "+x,color:b})})})}}))));return(0,h.jsx)(f.Z,{className:"width-seg",value:C,options:k,onChange:function(e){var t;return v((0,r.Z)({},x,null!==(t=y[+e])&&void 0!==t?t:10))}})},A=function(e){var t=e.checked,n=void 0!==t&&t,r=e.updateDrawCtrl;return(0,h.jsxs)("label",{className:"hi-wrapper",children:[(0,h.jsx)("input",{type:"checkbox",name:"highlight",checked:n,onChange:function(e){return r({highlight:e.target.checked})}}),(0,h.jsx)("div",{className:"hi-switch",children:(0,h.jsx)(p.Z,{type:"icon-Highlight"})})]})},x=function(e){var t=e.setColor,n=e.color;return(0,h.jsx)("div",{className:"color-select",children:v.Qk.map((function(e){return(0,h.jsxs)("label",{children:[(0,h.jsx)("input",{checked:n===e,type:"radio",name:"color",onChange:function(n){return n.target.checked&&t(e)}}),(0,h.jsx)("div",{"data-color":e,className:"circle",style:{backgroundColor:e,borderColor:e}})]},e)}))})}},90858:function(){},64158:function(){}}]);
//# sourceMappingURL=28.cad7eb4c.chunk.js.map