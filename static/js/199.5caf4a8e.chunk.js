"use strict";(self.webpackChunkmultibility=self.webpackChunkmultibility||[]).push([[199],{27199:function(e,t,n){n.r(t),n.d(t,{default:function(){return V}});var r=n(74165),i=n(15861),o=n(29439),a=n(72791),c=n(70587),l=n(34322),s=n(91715),u=n(1413),d=n(61507),f=n(23414),p=n(82622),v=n(97804),h=n(94396),m=n(69228),x=n(87309),g=n(70776),w=n(2721),Z=n(74115),j=n(22568),C=n(80184),y={type:"text",shape:"round",size:"small"},b=function(e,t){return{"--pos-x":e+"px","--pos-y":t+"px"}},S=function(e,t){var n={};return Object.entries(e).forEach((function(e){var r=(0,o.Z)(e,2),i=r[0],a=r[1];t&&(a+=t),n["--"+i]=a})),n},k=function(e){var t=e.drawRef,n=e.visible,r=e.clickPoint,i=(0,a.useState)({}),c=(0,o.Z)(i,2),l=c[0],s=c[1];if(!r)return null;var v=r.x,h=r.y;return(0,C.jsxs)("div",{className:"select-tool tool-options","data-visible":n,style:b(v,h),children:[(0,C.jsx)(m.Z,{trigger:"click",placement:"bottom",overlayClassName:"style-pop",getPopupContainer:function(e){return e.parentElement},destroyTooltipOnHide:!0,content:(0,C.jsx)(w.Uk,{updateDrawCtrl:function(e){var n;s((function(t){return(0,u.Z)((0,u.Z)({},t),e)})),null===(n=t.current)||void 0===n||n.mutateStyle(e)},drawCtrl:l}),children:(0,C.jsx)(x.Z,(0,u.Z)({icon:(0,C.jsx)(d.Z,{})},y))}),(0,C.jsx)(x.Z,(0,u.Z)({icon:(0,C.jsx)(f.Z,{}),onClick:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.duplicateSelected()}},y)),(0,C.jsx)(x.Z,(0,u.Z)({danger:!0,icon:(0,C.jsx)(p.Z,{}),onClick:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.deleteSelected()}},y))]})},N=function(e){var t,n,r,i=e.pointText,o=e.drawRef,c=e.renderSlow,l=i.view,s=i.position,d=i.leading,f=i.content,p=i.rotation,k=i.fontFamily,N=i.fontWeight,I=i.fontSize,L=l.projectToView(s),R=L.x,W=L.y,B=i.bounds,_=B.topLeft,z=B.bottomLeft,M=l.projectToView(_),A=M.x,F=M.y,O=l.projectToView(z),V=O.x,H=O.y,G=F<90,Q=i.viewMatrix.scaling.x,U=i.internalBounds,X=U.width,K=U.height,Y=null!==(t=+d/+I)&&void 0!==t?t:1.2,q=null!==(n=null===(r=i.fillColor)||void 0===r?void 0:r.toCSS(!0))&&void 0!==n?n:Z.Qk[0],J=(0,C.jsx)(m.Z,{content:(0,C.jsx)(w.Q5,{color:q,setColor:function(e){var t;return null===(t=o.current)||void 0===t?void 0:t.mutatePointText((function(t){t.fillColor=e}))}}),trigger:"click",overlayStyle:{width:200},placement:"bottom",getPopupContainer:function(e){return e.parentElement},children:(0,C.jsx)(x.Z,(0,u.Z)((0,u.Z)({},y),{},{icon:(0,C.jsx)(j.Z,{type:"icon-circle",className:"text-color-icon",style:{color:q}})}))}),$=T(N),ee=$.isItalic,te=$.isBold,ne={fontWeight:te?"bold":"normal",fontStyle:ee?"italic":"normal"},re=(0,C.jsx)(g.Z,{className:"font-select",popupClassName:"font-drop",value:k,onChange:function(e){var t;null===(t=o.current)||void 0===t||t.mutatePointText((function(t){t.fontFamily=e}))},size:"small",bordered:!1,virtual:!1,getPopupContainer:function(e){return e.parentElement.parentElement},dropdownMatchSelectWidth:100,options:[{value:"Arial, sans-serif",name:"Arial"},{value:"'Times New Roman', serif",name:"Times"},{value:"Georgia, serif",name:"Georgia"},{value:"'Courier New', monospace",name:"Courier"}].map((function(e){var t=e.value,n=e.name;return{value:t,label:(0,C.jsx)("span",{style:{fontFamily:t,fontWeight:"normal"},children:n})}}))}),ie=(0,a.useMemo)((function(){return.75-P(k,Y)}),[k,Y]);return(0,C.jsxs)("div",{className:"text-tool",style:(0,u.Z)((0,u.Z)((0,u.Z)((0,u.Z)((0,u.Z)({},S({scale:Q,color:q})),S({rotation:p},"deg")),S({width:X,height:K},"px")),S({offset:ie},"em")),b(R,W)),children:[(0,C.jsx)("div",{className:"textarea-wrapper","data-empty":!f,style:(0,u.Z)({fontSize:I,fontFamily:k,lineHeight:Y},ne),children:(0,C.jsx)("textarea",{autoFocus:!f,placeholder:"Text",value:f,onChange:function(e){var t;null===(t=o.current)||void 0===t||t.mutatePointText((function(t){t.content=e.target.value}))},"data-slow":c})}),(0,C.jsxs)("div",{className:"tool-options text-options","data-bottom":G,style:(0,u.Z)({},G?b(V,H):b(A,F)),children:[(0,C.jsxs)("div",{className:"row",children:[re,J]}),(0,C.jsxs)("div",{className:"row",children:[(0,C.jsx)(x.Z,(0,u.Z)((0,u.Z)({onClick:function(){var e;null===(e=o.current)||void 0===e||e.mutatePointText((function(e){e.fontWeight=E(e.fontWeight)}))}},y),{},{type:te?"link":"text",icon:(0,C.jsx)(v.Z,{})})),(0,C.jsx)(x.Z,(0,u.Z)((0,u.Z)({onClick:function(){var e;null===(e=o.current)||void 0===e||e.mutatePointText((function(e){e.fontWeight=D(e.fontWeight)}))}},y),{},{type:ee?"link":"text",icon:(0,C.jsx)(h.Z,{})})),(0,C.jsx)(x.Z,(0,u.Z)((0,u.Z)({},y),{},{icon:(0,C.jsx)(j.Z,{type:"icon-font_size_down"}),onClick:function(){var e;null===(e=o.current)||void 0===e||e.mutatePointText((function(e){var t=e.bounds.topLeft;e.scale(.9,t)}))}})),(0,C.jsx)(x.Z,(0,u.Z)((0,u.Z)({},y),{},{icon:(0,C.jsx)(j.Z,{type:"icon-font_size_up"}),onClick:function(){var e;null===(e=o.current)||void 0===e||e.mutatePointText((function(e){var t=e.bounds.topLeft;e.scale(1.1,t)}))}}))]})]})]})},T=function(e){return{isItalic:/italic/g.test(e+=""),isBold:/bold/g.test(e)}},D=function(e){var t=T(e);return(t.isItalic?"":"italic ")+(t.isBold?"bold":"normal")},E=function(e){var t=T(e);return(t.isItalic?"italic ":"")+(t.isBold?"normal":"bold")},P=function(e,t){var n=document.createElement("div");n.innerText="p",Object.assign(n.style,{fontSize:"100px",fontFamily:e,lineHeight:t}),document.body.appendChild(n);var r=document.createElement("span");r.style.display="inline-block",n.appendChild(r);var i=n.getBoundingClientRect(),o=(r.getBoundingClientRect().y-i.y)/i.height;return document.body.removeChild(n),Math.max(-1,Math.min(o,1))},I=n(763),L=n(19348),R=n(24124),W=n(15671),B=n(43144),_=n(60136),z=n(27277),M=function(e){(0,_.Z)(n,e);var t=(0,z.Z)(n);function n(){var e;(0,W.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).state={hasError:!1},e}return(0,B.Z)(n,[{key:"componentDidCatch",value:function(e,t){console.error("Uncaught error:",e,t)}},{key:"render",value:function(){return this.state.hasError?(0,C.jsx)("p",{children:"Error"}):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{hasError:!0}}}]),n}(a.Component),A=n(52365),F=function(e){var t=e.thumbnail,c=e.drawState,l=e.teamStateMap,s=e.updateState,u=e.pdfIndex,d=e.noteID,f=void 0===d?"":d,p=e.preview,v=void 0!==p&&p,h=e.onViewChange,m=e.preload,x=void 0!==m&&m,g=e.ignores,w=void 0===g?(0,R.Set)():g,Z=e.skipInView,j=void 0!==Z&&Z,y=h&&(0,I.range)(0,1.2,.2),b=(0,L.YD)({threshold:y,skip:j}),S=(0,o.Z)(b,3),k=S[0],N=S[1],T=S[2];(0,a.useEffect)((function(){if(h)return T&&N?void h(T.intersectionRatio):h(0)}),[N,T,h]);var D=(0,a.useState)(),E=(0,o.Z)(D,2),P=E[0],W=E[1],B=(0,a.useCallback)((0,I.once)((0,i.Z)((0,r.Z)().mark((function e(){var t,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u&&f){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,Promise.all([n.e(643),n.e(867)]).then(n.bind(n,98338));case 4:return t=e.sent,i=t.getNotePageImage,e.t0=W,e.next=9,i(f,u);case 9:e.t1=e.sent,(0,e.t0)(e.t1);case 11:case"end":return e.stop()}}),e)})))),[u,f]),_=N||x;(0,a.useEffect)((function(){!v&&_&&B()}),[_,v,B]);var z=(0,a.useMemo)((function(){return null===l||void 0===l?void 0:l.deleteAll(w).toList().toArray()}),[l,w]),M=Boolean(P||!u),A=_&&M,F=c.height/c.width;return(0,C.jsxs)("div",{ref:k,className:"page-wrapper","data-preview":v,children:[(0,C.jsx)("svg",{className:"size-holder",viewBox:"0 0 100 ".concat(100*F)}),A&&(0,C.jsx)(O,{drawState:c,otherStates:z,updateState:s,imgSrc:P||t,preview:v})]})};F.displayName="PageWrapper";var O=function(e){var t=e.drawState,n=e.updateState,r=e.otherStates,i=e.preview,u=void 0!==i&&i,d=e.imgSrc,f=(0,c.gX)(),p=(0,a.useRef)(null),v=(0,a.useState)(!1),h=(0,o.Z)(v,2),m=h[0],x=h[1],g=(0,a.useState)(),w=(0,o.Z)(g,2),Z=w[0],j=w[1],y=(0,a.useState)(),b=(0,o.Z)(y,2),S=b[0],T=b[1],D=(0,a.useState)(!1),E=(0,o.Z)(D,2),P=E[0],I=E[1],L=(0,A.zX)((function(e){if(n){var r=e instanceof s.DrawState?e:e(t);r!==t&&n(r)}}));return u?(0,C.jsx)(l.Draw,{drawState:t,otherStates:r,imgSrc:d,readonly:!0}):(0,C.jsxs)(M,{children:[(0,C.jsx)(l.Draw,{drawState:t,otherStates:r,onChange:L,imgSrc:d,drawCtrl:f,ref:p,toggleTextTool:function(e,t){T(e),I(t)},toggleSelectTool:function(e,t){t&&j(t),x(e)}}),(0,C.jsx)(k,{drawRef:p,visible:m,clickPoint:Z}),S&&(0,C.jsx)(N,{drawRef:p,pointText:S,renderSlow:P})]})},V=a.memo(F)},70587:function(e,t,n){n.d(t,{w3:function(){return w},gX:function(){return x},F7:function(){return g}});var r=n(74165),i=n(1413),o=n(29439),a=n(15861),c=n(72791),l=n(13085),s=n(61842),u=n.n(s),d=n(763),f=n(91715),p=n(80184);function v(){return(v=(0,a.Z)((0,r.Z)().mark((function e(){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u().getItem("DRAW_CTRL");case 2:if(t=e.sent){e.next=7;break}return t=f.defaultDrawCtrl,e.next=7,u().setItem("DRAW_CTRL",t);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(){return(h=(0,a.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u().setItem("DRAW_CTRL",t);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var m=c.createContext({drawCtrl:f.defaultDrawCtrl,updateDrawCtrl:function(){}});function x(){var e=(0,c.useContext)(m).drawCtrl;return(0,c.useDebugValue)(e),e}function g(){return(0,c.useContext)(m).updateDrawCtrl}var w=function(e){var t=e.children,n=(0,c.useState)(f.defaultDrawCtrl),r=(0,o.Z)(n,2),a=r[0],l=r[1];(0,c.useEffect)((function(){(function(){return v.apply(this,arguments)})().then(l)}),[]);var s=function(e){l((function(t){var n=(0,i.Z)((0,i.Z)({},t),e);return function(e){h.apply(this,arguments)}(n),n}))},u=a.finger;return(0,c.useEffect)((function(){var e=(0,d.debounce)((function(e){e.isPrimary&&"pen"===e.pointerType&&u&&Z((function(){return s({finger:!1})}))}),1e3);return document.addEventListener("pointerup",e),function(){return document.removeEventListener("pointerup",e)}}),[u]),(0,p.jsx)(m.Provider,{value:{drawCtrl:a,updateDrawCtrl:s},children:t})},Z=(0,d.once)(function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=function(){l.Z.close("DETECT_PENCIL"),u().setItem("SKIP_PENCIL_MSG",!0)},e.next=3,u().getItem("SKIP_PENCIL_MSG");case 3:if(!e.sent){e.next=5;break}return e.abrupt("return");case 5:l.Z.info({message:"Your device supports Pencil Only",description:(0,p.jsxs)("div",{className:"pencil-noty-content",children:[(0,p.jsxs)("div",{className:"enable demo-card",onClick:function(){t(),n()},children:[(0,p.jsx)("div",{className:"title",children:"Draw with pencil only"}),(0,p.jsx)("div",{className:"stroke"}),(0,p.jsx)("div",{className:"pencil-1 emoji",children:"\u270d\ufe0f"}),(0,p.jsx)("div",{className:"finger-1 emoji",children:"\ud83e\udef5"})]}),(0,p.jsxs)("div",{className:"disable demo-card",onClick:n,children:[(0,p.jsx)("div",{className:"title",children:"Draw with fingers"}),(0,p.jsx)("div",{className:"stroke"}),(0,p.jsx)("div",{className:"finger-1 emoji",children:"\ud83e\udef5"}),(0,p.jsx)("div",{className:"finger-2 emoji",children:"\ud83e\udef5"})]})]}),icon:(0,p.jsx)(p.Fragment,{}),duration:60,className:"pencil-noty",key:"DETECT_PENCIL"});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},2721:function(e,t,n){n.d(t,{Q5:function(){return Z},Uk:function(){return x},Db:function(){return g}});var r=n(4942),i=n(93433),o=n(29439),a=n(72791),c=n(91715),l=n(35873),s=n(69228),u=n(96272),d=n(53163),f=n(74115),p=n(22568),v=n(24124),h=n(74689),m=n(80184),x=function(e){var t=e.updateDrawCtrl,n=e.drawCtrl,r=n.highlight,i=n.color,c=(0,a.useState)(!1),l=(0,o.Z)(c,2),s=l[0],u=l[1];return(0,m.jsxs)("div",{className:"pen-panel","data-blur":s,"data-hi":r,children:[(0,m.jsxs)("div",{className:"pen-status",children:[(0,m.jsx)(g,{updateDrawCtrl:t,drawCtrl:n,setPanelBlur:u}),(0,m.jsx)(w,{checked:r,updateDrawCtrl:t})]}),(0,m.jsx)(Z,{color:i||"",setColor:function(e){return t({color:e})}})]})},g=function(e){var t,n,f=e.updateDrawCtrl,p=e.drawCtrl,x=e.setPanelBlur,g=void 0===x?function(){}:x,w=e.field,Z=void 0===w?"lineWidth":w,j=p[Z],C=null!==(t=p.widthList)&&void 0!==t?t:c.defaultWidthList,y="lineWidth"===Z&&null!==(n=p.color)&&void 0!==n?n:"#aaa",b=(0,a.useMemo)((function(){return C.indexOf(null!==j&&void 0!==j?j:-1)}),[j,C]),S=(0,a.useState)((0,v.List)([!1,!1,!1,!1])),k=(0,o.Z)(S,2),N=k[0],T=k[1];(0,a.useEffect)((function(){N.includes(!0)?g(!0):g(!1)}),[N,g]);var D=(0,a.useState)((function(){var e,t=document.querySelector("section.note-page");return(null!==(e=null===t||void 0===t?void 0:t.getBoundingClientRect().width)&&void 0!==e?e:0)/document.body.getBoundingClientRect().width})),E=(0,o.Z)(D,1)[0],P=function(e){return{"--real-size":"calc(".concat(100/h.m,"vw * ").concat(e," * ").concat(E,")")}},I=[{value:-1,label:null}].concat((0,i.Z)(C.map((function(e,t){return{value:t,label:(0,m.jsx)(s.Z,{open:N.get(t),onOpenChange:function(e){return T((function(n){return n.set(t,e)}))},trigger:b===t?["click"]:[],placement:"bottom",destroyTooltipOnHide:!0,content:(0,m.jsx)(u.Z,{min:5,max:100,className:"ctrl-slider",defaultValue:e,onAfterChange:function(e){if(C.includes(e))return T((function(e){return e.set(t,!1)})),f((0,r.Z)({},Z,e));var n=C.slice();n[t]=e,f((0,r.Z)({widthList:n},Z,e))}}),children:(0,m.jsx)("div",{className:"circle-wrapper",style:P(e),children:(0,m.jsx)(l.W,{className:"width-circle "+Z,color:y})})})}}))));return(0,m.jsx)(d.Z,{className:"width-seg",value:b,options:I,onChange:function(e){var t;return f((0,r.Z)({},Z,null!==(t=C[+e])&&void 0!==t?t:10))}})},w=function(e){var t=e.checked,n=void 0!==t&&t,r=e.updateDrawCtrl;return(0,m.jsxs)("label",{className:"hi-wrapper",children:[(0,m.jsx)("input",{type:"checkbox",name:"highlight",checked:n,onChange:function(e){return r({highlight:e.target.checked})}}),(0,m.jsx)("div",{className:"hi-switch",children:(0,m.jsx)(p.Z,{type:"icon-Highlight"})})]})},Z=function(e){var t=e.setColor,n=e.color;return(0,m.jsx)("div",{className:"color-select",children:f.Qk.map((function(e){return(0,m.jsxs)("label",{children:[(0,m.jsx)("input",{checked:n===e,type:"radio",name:"color",onChange:function(n){return n.target.checked&&t(e)}}),(0,m.jsx)("div",{"data-color":e,className:"circle",style:{backgroundColor:e,borderColor:e}})]},e)}))})}}}]);
//# sourceMappingURL=199.5caf4a8e.chunk.js.map