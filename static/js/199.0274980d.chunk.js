"use strict";(self.webpackChunkmultibility=self.webpackChunkmultibility||[]).push([[199],{27199:function(e,t,n){n.r(t),n.d(t,{default:function(){return Y}});var r=n(74165),i=n(15861),o=n(29439),a=n(72791),c=n(70587),l=n(34322),s=n(91715),u=n(1413),d=n(61507),f=n(23414),p=n(82622),v=n(97804),h=n(94396),m=n(69228),x=n(87309),g=n(70776),w=n(2721),Z=n(74115),j=n(22568),C=n(80184),y={type:"text",shape:"round",size:"small"},b=function(e,t){return{"--pos-x":e+"px","--pos-y":t+"px"}},k=function(e,t){var n={};return Object.entries(e).forEach((function(e){var r=(0,o.Z)(e,2),i=r[0],a=r[1];t&&(a+=t),n["--"+i]=a})),n},N=function(e){var t=e.drawRef,n=e.visible,r=e.clickPoint,i=(0,a.useState)({}),c=(0,o.Z)(i,2),l=c[0],s=c[1];if(!r)return null;var v=r.x,h=r.y;return(0,C.jsxs)("div",{className:"select-tool tool-options","data-visible":n,style:b(v,h),children:[(0,C.jsx)(m.Z,{trigger:"click",placement:"bottom",overlayClassName:"style-pop",getPopupContainer:function(e){return e.parentElement},destroyTooltipOnHide:!0,content:(0,C.jsx)(w.Uk,{updateDrawCtrl:function(e){var n;s((function(t){return(0,u.Z)((0,u.Z)({},t),e)})),null===(n=t.current)||void 0===n||n.mutateStyle(e)},drawCtrl:l}),children:(0,C.jsx)(x.Z,(0,u.Z)({icon:(0,C.jsx)(d.Z,{})},y))}),(0,C.jsx)(x.Z,(0,u.Z)({icon:(0,C.jsx)(f.Z,{}),onClick:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.duplicateSelected()}},y)),(0,C.jsx)(x.Z,(0,u.Z)({danger:!0,icon:(0,C.jsx)(p.Z,{}),onClick:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.deleteSelected()}},y))]})},S=function(e){var t,n,r,i=e.pointText,o=e.drawRef,c=e.renderSlow,l=i.view,s=i.position,d=i.leading,f=i.content,p=i.rotation,N=i.fontFamily,S=i.fontWeight,L=i.fontSize,I=l.projectToView(s),R=I.x,W=I.y,_=i.bounds,B=_.topLeft,O=_.bottomLeft,z=l.projectToView(B),A=z.x,F=z.y,M=l.projectToView(O),Y=M.x,V=M.y,H=F<90,Q=i.viewMatrix.scaling.x,X=i.internalBounds,U=X.width,G=X.height,K=null!==(t=+d/+L)&&void 0!==t?t:1.2,q=null!==(n=null===(r=i.fillColor)||void 0===r?void 0:r.toCSS(!0))&&void 0!==n?n:Z.Qk[0],J=(0,C.jsx)(m.Z,{content:(0,C.jsx)(w.Q5,{color:q,setColor:function(e){var t;return null===(t=o.current)||void 0===t?void 0:t.mutatePointText((function(t){t.fillColor=e}))}}),trigger:"click",overlayStyle:{width:200},placement:"bottom",getPopupContainer:function(e){return e.parentElement},children:(0,C.jsx)(x.Z,(0,u.Z)((0,u.Z)({},y),{},{icon:(0,C.jsx)(j.Z,{type:"icon-circle",className:"text-color-icon",style:{color:q}})}))}),$=T(S),ee=$.isItalic,te=$.isBold,ne={fontWeight:te?"bold":"normal",fontStyle:ee?"italic":"normal"},re=(0,C.jsx)(g.Z,{className:"font-select",popupClassName:"font-drop",value:N,onChange:function(e){var t;null===(t=o.current)||void 0===t||t.mutatePointText((function(t){t.fontFamily=e}))},size:"small",bordered:!1,virtual:!1,getPopupContainer:function(e){return e.parentElement.parentElement},dropdownMatchSelectWidth:100,options:[{value:"Arial, sans-serif",name:"Arial"},{value:"'Times New Roman', serif",name:"Times"},{value:"Georgia, serif",name:"Georgia"},{value:"'Courier New', monospace",name:"Courier"}].map((function(e){var t=e.value,n=e.name;return{value:t,label:(0,C.jsx)("span",{style:{fontFamily:t,fontWeight:"normal"},children:n})}}))}),ie=(0,a.useMemo)((function(){return.75-E(N,K)}),[N,K]);return(0,C.jsxs)("div",{className:"text-tool",style:(0,u.Z)((0,u.Z)((0,u.Z)((0,u.Z)((0,u.Z)({},k({scale:Q,color:q})),k({rotation:p},"deg")),k({width:U,height:G},"px")),k({offset:ie},"em")),b(R,W)),children:[(0,C.jsx)("div",{className:"textarea-wrapper","data-empty":!f,style:(0,u.Z)({fontSize:L,fontFamily:N,lineHeight:K},ne),children:(0,C.jsx)("textarea",{autoFocus:!f,placeholder:"Text",value:f,onChange:function(e){var t;null===(t=o.current)||void 0===t||t.mutatePointText((function(t){t.content=e.target.value}))},"data-slow":c})}),(0,C.jsxs)("div",{className:"tool-options text-options","data-bottom":H,style:(0,u.Z)({},H?b(Y,V):b(A,F)),children:[(0,C.jsxs)("div",{className:"row",children:[re,J]}),(0,C.jsxs)("div",{className:"row",children:[(0,C.jsx)(x.Z,(0,u.Z)((0,u.Z)({onClick:function(){var e;null===(e=o.current)||void 0===e||e.mutatePointText((function(e){e.fontWeight=P(e.fontWeight)}))}},y),{},{type:te?"link":"text",icon:(0,C.jsx)(v.Z,{})})),(0,C.jsx)(x.Z,(0,u.Z)((0,u.Z)({onClick:function(){var e;null===(e=o.current)||void 0===e||e.mutatePointText((function(e){e.fontWeight=D(e.fontWeight)}))}},y),{},{type:ee?"link":"text",icon:(0,C.jsx)(h.Z,{})})),(0,C.jsx)(x.Z,(0,u.Z)((0,u.Z)({},y),{},{icon:(0,C.jsx)(j.Z,{type:"icon-font_size_down"}),onClick:function(){var e;null===(e=o.current)||void 0===e||e.mutatePointText((function(e){var t=e.bounds.topLeft;e.scale(.9,t)}))}})),(0,C.jsx)(x.Z,(0,u.Z)((0,u.Z)({},y),{},{icon:(0,C.jsx)(j.Z,{type:"icon-font_size_up"}),onClick:function(){var e;null===(e=o.current)||void 0===e||e.mutatePointText((function(e){var t=e.bounds.topLeft;e.scale(1.1,t)}))}}))]})]})]})},T=function(e){return{isItalic:/italic/g.test(e+=""),isBold:/bold/g.test(e)}},D=function(e){var t=T(e);return(t.isItalic?"":"italic ")+(t.isBold?"bold":"normal")},P=function(e){var t=T(e);return(t.isItalic?"italic ":"")+(t.isBold?"normal":"bold")},E=function(e,t){var n=document.createElement("div");n.innerText="p",Object.assign(n.style,{fontSize:"100px",fontFamily:e,lineHeight:t}),document.body.appendChild(n);var r=document.createElement("span");r.style.display="inline-block",n.appendChild(r);var i=n.getBoundingClientRect(),o=(r.getBoundingClientRect().y-i.y)/i.height;return document.body.removeChild(n),Math.max(-1,Math.min(o,1))},L=n(763),I=n(19348),R=n(24124),W=n(15671),_=n(43144),B=n(60136),O=n(27277),z=function(e){(0,B.Z)(n,e);var t=(0,O.Z)(n);function n(){var e;(0,W.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).state={hasError:!1},e}return(0,_.Z)(n,[{key:"componentDidCatch",value:function(e,t){console.error("Uncaught error:",e,t)}},{key:"render",value:function(){return this.state.hasError?(0,C.jsx)("p",{children:"Error"}):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{hasError:!0}}}]),n}(a.Component),A=n(52365),F=function(e){var t=e.thumbnail,c=e.drawState,l=e.teamStateMap,s=e.updateState,u=e.pdfIndex,d=e.noteID,f=void 0===d?"":d,p=e.preview,v=void 0!==p&&p,h=e.onViewChange,m=e.preload,x=void 0!==m&&m,g=e.ignores,w=void 0===g?(0,R.Set)():g,Z=e.skipInView,j=void 0!==Z&&Z,y=h&&(0,L.range)(0,1.2,.2),b=(0,I.YD)({threshold:y,skip:j}),k=(0,o.Z)(b,3),N=k[0],S=k[1],T=k[2];(0,a.useEffect)((function(){if(h)return T&&S?void h(T.intersectionRatio):h(0)}),[S,T,h]);var D=(0,a.useState)(),P=(0,o.Z)(D,2),E=P[0],W=P[1],_=(0,a.useCallback)((0,L.once)((0,i.Z)((0,r.Z)().mark((function e(){var t,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u&&f){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,Promise.all([n.e(643),n.e(867)]).then(n.bind(n,98338));case 4:return t=e.sent,i=t.getNotePageImage,e.t0=W,e.next=9,i(f,u);case 9:e.t1=e.sent,(0,e.t0)(e.t1);case 11:case"end":return e.stop()}}),e)})))),[u,f]),B=S||x;(0,a.useEffect)((function(){!v&&B&&_()}),[B,v,_]);var O=(0,a.useMemo)((function(){return null===l||void 0===l?void 0:l.deleteAll(w).toList().toArray()}),[l,w]),z=Boolean(E||!u),A=B&&z,F=c.height/c.width;return(0,C.jsxs)("div",{ref:N,className:"page-wrapper","data-preview":v,children:[(0,C.jsx)("svg",{className:"size-holder",viewBox:"0 0 100 ".concat(100*F)}),A&&(0,C.jsx)(M,{drawState:c,otherStates:O,updateState:s,imgSrc:E||t,preview:v})]})};F.displayName="PageWrapper";var M=function(e){var t=e.drawState,n=e.updateState,r=e.otherStates,i=e.preview,u=void 0!==i&&i,d=e.imgSrc,f=(0,c.gX)(),p=(0,a.useRef)(null),v=(0,a.useState)(!1),h=(0,o.Z)(v,2),m=h[0],x=h[1],g=(0,a.useState)(),w=(0,o.Z)(g,2),Z=w[0],j=w[1],y=(0,a.useState)(),b=(0,o.Z)(y,2),k=b[0],T=b[1],D=(0,a.useState)(!1),P=(0,o.Z)(D,2),E=P[0],L=P[1],I=(0,A.zX)((function(e){if(n){var r=e instanceof s.DrawState?e:e(t);r!==t&&n(r)}}));return u?(0,C.jsx)(l.Draw,{drawState:t,otherStates:r,imgSrc:d,readonly:!0}):(0,C.jsxs)(z,{children:[(0,C.jsx)(l.Draw,{drawState:t,otherStates:r,onChange:I,imgSrc:d,drawCtrl:f,ref:p,toggleTextTool:function(e,t){T(e),L(t)},toggleSelectTool:function(e,t){t&&j(t),x(e)}}),(0,C.jsx)(N,{drawRef:p,visible:m,clickPoint:Z}),k&&(0,C.jsx)(S,{drawRef:p,pointText:k,renderSlow:E})]})},Y=a.memo(F)},70587:function(e,t,n){n.d(t,{w3:function(){return w},gX:function(){return x},F7:function(){return g}});var r=n(74165),i=n(1413),o=n(29439),a=n(15861),c=n(72791),l=n(13085),s=n(61842),u=n.n(s),d=n(763),f=n(91715),p=n(80184);function v(){return(v=(0,a.Z)((0,r.Z)().mark((function e(){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u().getItem("DRAW_CTRL");case 2:if(t=e.sent){e.next=7;break}return t=f.defaultDrawCtrl,e.next=7,u().setItem("DRAW_CTRL",t);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(){return(h=(0,a.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u().setItem("DRAW_CTRL",t);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var m=c.createContext({drawCtrl:f.defaultDrawCtrl,updateDrawCtrl:function(){}});function x(){var e=(0,c.useContext)(m).drawCtrl;return(0,c.useDebugValue)(e),e}function g(){return(0,c.useContext)(m).updateDrawCtrl}var w=function(e){var t=e.children,n=(0,c.useState)(f.defaultDrawCtrl),r=(0,o.Z)(n,2),a=r[0],l=r[1];(0,c.useEffect)((function(){(function(){return v.apply(this,arguments)})().then(l)}),[]);var s=function(e){l((function(t){var n=(0,i.Z)((0,i.Z)({},t),e);return function(e){h.apply(this,arguments)}(n),n}))},u=a.finger;return(0,c.useEffect)((function(){var e=(0,d.debounce)((function(e){e.isPrimary&&"pen"===e.pointerType&&u&&Z((function(){return s({finger:!1})}))}),1e3);return document.addEventListener("pointerup",e),function(){return document.removeEventListener("pointerup",e)}}),[u]),(0,p.jsx)(m.Provider,{value:{drawCtrl:a,updateDrawCtrl:s},children:t})},Z=(0,d.once)(function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=function(){l.Z.close("PENCIL_ONLY"),u().setItem("SKIP_PENCIL_ONLY_NOTY",!0)},e.next=3,u().getItem("SKIP_PENCIL_ONLY_NOTY");case 3:if(!e.sent){e.next=5;break}return e.abrupt("return");case 5:l.Z.info({message:"Your device supports Pencil Only",description:(0,p.jsxs)("div",{className:"pencil-noty-content",children:[(0,p.jsxs)("div",{className:"enable demo-card",onClick:function(){t(),n()},children:[(0,p.jsx)("div",{className:"title",children:"Draw with pencil only"}),(0,p.jsx)("div",{className:"stroke"}),(0,p.jsx)("div",{className:"pencil-1 emoji",children:"\u270d\ufe0f"}),(0,p.jsx)("div",{className:"finger-1 emoji",children:"\ud83e\udef5"})]}),(0,p.jsxs)("div",{className:"disable demo-card",onClick:n,children:[(0,p.jsx)("div",{className:"title",children:"Draw with fingers"}),(0,p.jsx)("div",{className:"stroke"}),(0,p.jsx)("div",{className:"finger-1 emoji",children:"\ud83e\udef5"}),(0,p.jsx)("div",{className:"finger-2 emoji",children:"\ud83e\udef5"})]})]}),icon:(0,p.jsx)(p.Fragment,{}),duration:60,className:"pencil-noty",key:"PENCIL_ONLY"});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},2721:function(e,t,n){n.d(t,{Q5:function(){return j},Uk:function(){return g},Db:function(){return w}});var r=n(4942),i=n(93433),o=n(29439),a=n(72791),c=n(91715),l=n(35873),s=n(69228),u=n(96272),d=n(53163),f=n(74115),p=n(52365),v=n(22568),h=n(24124),m=n(74689),x=n(80184),g=function(e){var t=e.updateDrawCtrl,n=e.drawCtrl,r=n.highlight,i=n.color,c=(0,a.useState)(!1),l=(0,o.Z)(c,2),s=l[0],u=l[1];return(0,x.jsxs)("div",{className:"pen-panel","data-blur":s,"data-hi":r,children:[(0,x.jsxs)("div",{className:"pen-status",children:[(0,x.jsx)(w,{updateDrawCtrl:t,drawCtrl:n,setPanelBlur:u}),(0,x.jsx)(Z,{checked:r,updateDrawCtrl:t})]}),(0,x.jsx)(j,{color:i||"",setColor:function(e){return t({color:e})}})]})},w=function(e){var t,n,f=e.updateDrawCtrl,v=e.drawCtrl,g=e.setPanelBlur,w=void 0===g?function(){}:g,Z=e.field,j=void 0===Z?"lineWidth":Z,C=v[j],y=null!==(t=v.widthList)&&void 0!==t?t:c.defaultWidthList,b="lineWidth"===j&&null!==(n=v.color)&&void 0!==n?n:"#aaa",k=(0,a.useMemo)((function(){return y.indexOf(null!==C&&void 0!==C?C:-1)}),[C,y]),N=(0,a.useState)((0,h.List)([!1,!1,!1,!1])),S=(0,o.Z)(N,2),T=S[0],D=S[1];w=(0,p.zX)(w),(0,a.useEffect)((function(){T.includes(!0)?w(!0):w(!1)}),[T,w]);var P=(0,a.useState)((function(){var e,t=document.querySelector("section.note-page");return(null!==(e=null===t||void 0===t?void 0:t.getBoundingClientRect().width)&&void 0!==e?e:0)/document.body.getBoundingClientRect().width})),E=(0,o.Z)(P,1)[0],L=function(e){return{"--real-size":"calc(".concat(100/m.m,"vw * ").concat(e," * ").concat(E,")")}},I=[{value:-1,label:null}].concat((0,i.Z)(y.map((function(e,t){return{value:t,label:(0,x.jsx)(s.Z,{open:T.get(t),onOpenChange:function(e){return D((function(n){return n.set(t,e)}))},trigger:k===t?["click"]:[],placement:"bottom",destroyTooltipOnHide:!0,content:(0,x.jsx)(u.Z,{min:5,max:100,className:"ctrl-slider",defaultValue:e,onAfterChange:function(e){if(y.includes(e))return D((function(e){return e.set(t,!1)})),f((0,r.Z)({},j,e));var n=y.slice();n[t]=e,f((0,r.Z)({widthList:n},j,e))}}),children:(0,x.jsx)("div",{className:"circle-wrapper","data-chosen":k===t,style:L(e),children:(0,x.jsx)(l.W,{className:"width-circle "+j,color:b})})})}}))));return(0,x.jsx)(d.Z,{className:"width-seg",value:k,options:I,onChange:function(e){var t;return f((0,r.Z)({},j,null!==(t=y[+e])&&void 0!==t?t:10))}})},Z=function(e){var t=e.checked,n=void 0!==t&&t,r=e.updateDrawCtrl;return(0,x.jsxs)("label",{className:"hi-wrapper",children:[(0,x.jsx)("input",{type:"checkbox",name:"highlight",checked:n,onChange:function(e){return r({highlight:e.target.checked})}}),(0,x.jsx)("div",{className:"hi-switch",children:(0,x.jsx)(v.Z,{type:"icon-Highlight"})})]})},j=function(e){var t=e.setColor,n=e.color;return(0,x.jsx)("div",{className:"color-select",children:f.Qk.map((function(e){return(0,x.jsxs)("label",{children:[(0,x.jsx)("input",{checked:n===e,type:"radio",name:"color",onChange:function(n){return n.target.checked&&t(e)}}),(0,x.jsx)("div",{"data-color":e,className:"circle",style:{backgroundColor:e,borderColor:e}})]},e)}))})}}}]);
//# sourceMappingURL=199.0274980d.chunk.js.map