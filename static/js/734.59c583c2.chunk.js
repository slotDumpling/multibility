(self.webpackChunkmultibility=self.webpackChunkmultibility||[]).push([[734],{22568:function(e,t,n){"use strict";var r=n(92721);t.Z=(0,r.Z)({scriptUrl:"//at.alicdn.com/t/c/font_3181679_61bmx4utsp.js"})},97934:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return xe}});var r=n(74165),i=n(15861),o=n(29439),a=n(72791),u=n(70587),c=n(98211),l=n(1413),s=n(93433),d=n(46668),f=n.n(d),v=n(63078),h=n(1488),p=n(82670),m=n(96153),w=function(e,t){var n=new Map,r=t/2,i=(0,m.v)(t,t),o=i.canvas,a=i.context,u=new Image;return u.src=e,function(e){e=10*Math.round(e/10);var i=n.get(e);if(i)return i;a.translate(r,r),a.rotate(e*Math.PI/180),a.drawImage(u,-r,-r);var c=o.toDataURL();return a.clearRect(-r,-r,t,t),a.resetTransform(),n.set(e,c),c}},g=w("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAF0WlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNy4yLWMwMDAgNzkuMWI2NWE3OWI0LCAyMDIyLzA2LzEzLTIyOjAxOjAxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgMjMuNSAoTWFjaW50b3NoKSIgeG1wOkNyZWF0ZURhdGU9IjIwMjItMTAtMDVUMTY6Mzc6MzYrMDg6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDIyLTEwLTA2VDA5OjQ5OjQ2KzA4OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIyLTEwLTA2VDA5OjQ5OjQ2KzA4OjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozZWI2OWRkMS1lYjBhLTRlMmMtODhmOC03NTVkMDllNjhkMTgiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDoyZTdiNDZhMS05ZmE4LTVjNGMtYmM0Yi04ZDA3MzMyY2VjYjYiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDoyNDEwMDgwYi04OGRkLTRmYzktYWEwMi04NDJjM2M5MTgzM2QiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjI0MTAwODBiLTg4ZGQtNGZjOS1hYTAyLTg0MmMzYzkxODMzZCIgc3RFdnQ6d2hlbj0iMjAyMi0xMC0wNVQxNjozNzozNiswODowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIzLjUgKE1hY2ludG9zaCkiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjNlYjY5ZGQxLWViMGEtNGUyYy04OGY4LTc1NWQwOWU2OGQxOCIgc3RFdnQ6d2hlbj0iMjAyMi0xMC0wNlQwOTo0OTo0NiswODowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIzLjUgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+W4lGwQAAAuRJREFUWMPtV09ImmEY91NzavNvWjMyYaZrFJJN6NAGgbCYhw67CB1Gp0ivk0gm6zajWxDJqkMtRNq6FZ3WpUPs5kWiqWz+Wa0SiczU6dqz54lvEDvt8n679MCP7+V5Xnh/7/O+z+95PxEAiP4nRLcEbgn880TelEolZzAYlCaT6Q6htbVV2dzczIluGDMCuLgsn89vV6vV3PHx8eejo6Pk6elpPpPJbCMJGXMCer3+Ho6L09PT0N3dDX19feDz+YB8RqOxjTmBlpaW++Vy+cvQ0BA5wGazlVOp1FWpVMo0NTWZhSBgKxaLmcHBQfB4PDW8C42DgwPKwHcMW5gT0Ol0NhxX6AgqlQpEIhEK1C8vL6/C4bCPOQGpVNqxu7u7eXh4mMSdJ9Df6O3tbbjdbspCVqPR6FkSoFLTIawKheIJfl1zc3PvKBO0Zq1Wg6mpqRdMM4BGpXaXCgLRJpFIHmMs73K5YGZmBvb399dYE7hpcoRkfX19LRaLQU9PD9Tr9U+oB0qhCFwb7vz13t7etSagKBVQGW2CEgiFQuPJZJI0AVAlobOz85GgBGZnZ18mEgmwWq2QzWZL7e3tDkEJLCwsvNnZ2QGz2QwnJydplGthjwB3vzk2Ngajo6NQKBQ+okslGAGn0/mQFIjjOIjH47CxsfGWaRliw5EGAoFhlODnwWBwGBXxw+LiIuC5E48fDofjKU4TMyOg1Wo1OC6cnZ3BH0N3lcoQ8Z6eDCRWLLuhGRfPDQwMwPLy8hV9vV7vL4yXLRbLM0oSSTbLB0nX+fn515GREZDL5T/tdnuFsoDd8BuG7ZR+pncA+78dF8v19/dfNyCZTFafnJyEi4uLPB7PA+btWK1WW2nD6XQatra2IBqNAokQHYFKpbKyJsCJxWKT3+9/hVWwird/ZWlpaWV+fn51YmIiRDG+ZTN9D6hJaBAdiC4eHbxPzZqAiL9kCn5BDQ8V7xMzvwM3jPsLIuY/JqzwGwfc8bK3fn7PAAAAAElFTkSuQmCC",32),A=w("data:image/png;base64,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",64),x=function(e){var t=g(e),n=A(e);return"-webkit-image-set(url(".concat(t,")1x, url(").concat(n,")2x) 16 16, auto")};function y(e){var t=(0,a.useRef)(!1),n=function(e){return e.isPrimary&&(t.current="touch"===e.pointerType)},r=function(n){return function(n){return!t.current||function(e){var t=e.touches[0];return"stylus"===(null===t||void 0===t?void 0:t.touchType)}(n)||e&&1===n.touches.length}(n)||n.stopPropagation()};return{onPointerDownCapture:n,onPointerMoveCapture:n,onTouchStartCapture:r,onTouchMoveCapture:r}}var Z={onMouseDownCapture:function(e){0!==e.button&&e.stopPropagation()},onContextMenu:function(e){return e.preventDefault()}};var b=function(e){var t=e.topLeft,n=e.bottomRight;return[Math.floor(t.x/100),Math.ceil(n.x/100),Math.floor(t.y/100),Math.ceil(n.y/100)]},C=function(e,t,n){for(var r=(null!==n&&void 0!==n?n:t).strokeBounds,i=b(r),a=(0,o.Z)(i,4),u=a[0],c=a[1],l=a[2],s=a[3],d=u;d<=c;d+=1)for(var f=l;f<=s;f+=1){var v,h,p,m;n&&(null===(v=e[d])||void 0===v||null===(h=v[f])||void 0===h||h.delete(n)),null===(p=e[d])||void 0===p||null===(m=p[f])||void 0===m||m.add(t)}},j=function(e,t){for(var n=new Set,r=b(t),i=(0,o.Z)(r,4),a=i[0],u=i[1],c=i[2],l=i[3],s=a;s<=u;s+=1)for(var d=c;d<=l;d+=1){var f,v;null===(f=e[s])||void 0===f||null===(v=f[d])||void 0===v||v.forEach((function(e){return n.add(e)}))}return Array.from(n)},P=n(80184),M=new d.Point(0,0),S=a.forwardRef((function(e,t){var n=e.drawState,r=e.otherStates,i=e.onChange,w=void 0===i?function(){}:i,g=e.drawCtrl,A=void 0===g?u.Hq:g,b=e.readonly,S=void 0!==b&&b,E=e.imgSrc,V=e.toggleSelectTool,Y=void 0===V?function(){}:V,J=e.toggleTextTool,U=void 0===J?function(){}:J,X=n.width,H=n.height,q=(0,a.useMemo)((function(){return new d.Size(X,H)}),[X,H]),K=A.mode,_=A.finger,$=A.lasso,ee=A.eraserWidth,te=(0,a.useRef)(null),ne=(0,a.useRef)(new(f().PaperScope)),re=(0,a.useState)([]),ie=(0,o.Z)(re,2),oe=ie[0],ae=ie[1],ue=(0,a.useState)([]),ce=(0,o.Z)(ue,2),le=ce[0],se=ce[1],de=R(),fe=(0,o.Z)(de,2),ve=fe[0],he=fe[1],pe=R(),me=(0,o.Z)(pe,2),we=me[0],ge=me[1];Y=(0,c.Z)(Y),U=(0,c.Z)(U);var Ae=function(){if(ve){var e=ve.bounds.bottomCenter,t=ne.current.view;Y(!0,t.projectToView(e))}};(0,a.useLayoutEffect)((function(){var e,t=te.current,n=ne.current;if(t)return n.setup(t),n.settings.handleSize=10,n.settings.hitTolerance=20,[0,1,2].forEach((function(){return(new d.Layer).visible=!1})),null===(e=n.project.layers[2])||void 0===e||e.activate(),new n.Tool,function(){var e;null===(e=n.view)||void 0===e||e.remove(),(0,m.j)(t),n.remove(),n.clear()}}),[]),(0,a.useEffect)((function(){ne.current.activate();var e=ne.current.project.layers,t=k(e,q);return function(){return t.forEach((function(e){return e.remove()}))}}),[q]);var xe=(0,h.Z)(te),ye=(0,o.Z)(xe,1)[0],Ze=ye/X,be=(0,a.useRef)(new d.Point(q).divide(2)),Ce=(0,a.useState)(1),je=(0,o.Z)(Ce,2),Pe=je[0],Me=je[1],Se=(0,a.useRef)(1);(0,a.useEffect)((function(){if(Ze){var e=ne.current;e.view.viewSize=q.multiply(Ze),e.view.zoom=Ze*Se.current,e.view.center=be.current,e.project.layers.forEach((function(e){return e.visible=!0})),e.view.update()}}),[Ze,q]);var Ee=R(),Re=(0,o.Z)(Ee,2),De=Re[0],ke=Re[1];(0,a.useEffect)((function(){var e;if(E){ne.current.activate();var t=new d.Raster(E);null===(e=t.project.layers[0])||void 0===e||e.addChild(t),t.sendToBack(),t.onLoad=function(){t.view.update(),t.fitBounds(new d.Rectangle(q)),t.bringToFront()},ke(t)}}),[E,q,ke]);var We=(0,a.useMemo)((function(){return p.Dw.mergeStates.apply(p.Dw,[n].concat((0,s.Z)(r||[])))}),[n,r]),Ne=(0,a.useRef)(!1),Te=(0,a.useRef)(0),Ie=(0,a.useRef)(!1),Be=function(){return Ie.current=Ne.current};S&&Be(),(0,a.useEffect)((function(){var e=(0,o.Z)(ne.current.project.layers,2)[1];if(e){var t=function(){ne.current.activate();var t=[],r=[];e.removeChildren(1),We.forEach((function(i){var o=n.hasStroke(i.uid),a=D(i,e);o&&a&&t.push(a),a&&r.push(a)})),ae(t),se(r),tt(),Ie.current=!1,mt.current.forEach((function(e){return e.remove()})),mt.current=[];var i=performance.now();ne.current.view.update(),requestAnimationFrame((function(){var e=performance.now()-i;Ne.current=e>16}))};if(Ie.current)return Te.current=window.setTimeout(t,1e3),function(){return window.clearTimeout(Te.current)};t()}}),[We,n]);var Le=(0,a.useRef)(),Ge=(0,a.useState)(!1),ze=(0,o.Z)(Ge,2),Fe=ze[0],Qe=ze[1],Oe="select"===K&&Fe?"selected":K,Ve=(0,a.useState)([]),Ye=(0,o.Z)(Ve,2),Je=Ye[0],Ue=Ye[1],Xe=(0,a.useMemo)((function(){var e=new Set(Je);return le.filter((function(t){return e.has(t.name)}))}),[le,Je]),He=(0,c.Z)((function(){Qe(!1),he(void 0),ge(void 0),Ue([]),Y(!1)}));(0,a.useEffect)((function(){if("select"===K)return He}),[K,He]),(0,a.useEffect)((function(){return He}),[$,He]),(0,a.useEffect)((function(){var e,t,r=null!==(e=null===(t=n.lastOp)||void 0===t?void 0:t.type)&&void 0!==e?e:"";/^redo|undo$/.test(r)&&He()}),[n,He]),(0,a.useEffect)((function(){if(Y(!1),kt.current){var e=new Proxy(kt.current,{});U(e,Ne.current)}}),[ye,Y,U]);var qe=(0,a.useRef)(),Ke=(0,a.useRef)(!1);(0,a.useEffect)((function(){Ke.current=!1}),[We]);var _e=function(){ne.current.activate();var e=(0,o.Z)(ne.current.project.layers,2)[1],t=qe.current;e&&t&&(e.visible=!0,t.visible=!1)},$e=(0,a.useRef)();(0,a.useEffect)((function(){return function(){var e;null===(e=$e.current)||void 0===e||e.remove(),$e.current=void 0}}),[ye]),(0,a.useLayoutEffect)((function(){return function(){var e,t;(0,m.j)(null===(e=qe.current)||void 0===e?void 0:e.canvas),(0,m.j)(null===(t=$e.current)||void 0===t?void 0:t.canvas)}}),[]);var et=function(){var e,t;if(Ne.current&&!0!==(null===(e=$e.current)||void 0===e?void 0:e.visible)){ne.current.activate();var n=ne.current.view,r=null!==(t=$e.current)&&void 0!==t?t:$e.current=new d.Raster(n.viewSize.multiply(devicePixelRatio));r.drawImage(n.element,M),r.fitBounds(n.bounds),r.visible=!0,r.opacity=1;var i=(0,o.Z)(ne.current.project.layers,2)[1];i&&(i.visible=!1)}},tt=function(){var e;if(ne.current.activate(),null!==(e=ne.current)&&void 0!==e&&e.project){var t=(0,o.Z)(ne.current.project.layers,2)[1],n=$e.current,r=qe.current;t&&n&&(n.visible=!1,!0!==(null===r||void 0===r?void 0:r.visible)&&(t.visible=!0))}},nt=function(e){et(),he(N(A,e.point,Ne.current))},rt=function(e){he(N(A,e.point)),requestAnimationFrame(et)},it=function(e){he(W(e.point)),requestAnimationFrame(et)},ot=(0,a.useRef)(!1),at={draw:function(e){Be(),nt(e)},erase:nt,select:$?rt:it,selected:function(e){if(ot.current=!1,ve){if(!$){var t,n=null!==(t=ve.hitTest(e.point,{segments:!0}))&&void 0!==t?t:null===we||void 0===we?void 0:we.hitTest(e.point,{segments:!0,selected:!0});if(Le.current=n,n)return}ve.contains(e.point)||(He(),ge(void 0),$?rt(e):it(e))}},text:null}[Oe],ut=function(e){window.clearTimeout(Te.current),null===ve||void 0===ve||ve.add(e.point),null===ve||void 0===ve||ve.smooth()},ct=function(e){Xe.forEach((function(t){return t.translate(e)})),null===ve||void 0===ve||ve.translate(e),null===we||void 0===we||we.translate(e)},lt={draw:ut,erase:ut,select:$?ut:function(e){if(ve){var t=e.point,n=t.x,r=t.y,i=(0,o.Z)(ve.segments,4),a=i[1],u=i[2],c=i[3];a&&u&&c&&(a.point.x=n,u.point=e.point,c.point.y=r,ve.selected=!0)}},selected:function(e){var t=Le.current;if(ve)if(Y(!1),ot.current=!0,null!==t&&void 0!==t&&t.segment){var n=t.segment;if(n.selected){var r=ve.bounds.center,i=n.point.subtract(r),o=e.point.subtract(r);yt(x(o.angle));var a=o.angle-i.angle;ve.rotate(a,r),null===we||void 0===we||we.rotate(a,r),Xe.forEach((function(e){return null===e||void 0===e?void 0:e.rotate(a,r)}))}else{var u,c=n.point,l=n.next.next.point,s=c.subtract(l),d=e.point.subtract(l).project(s).x/s.x;if(d<0)return;if(ve.scale(d,l),Xe.forEach((function(e){e.scale(d,l),e.strokeWidth*=d})),!we)return;we.scale(d,l);var f=null===(u=we.segments[0])||void 0===u?void 0:u.point;if(!f)return;we.scale(100/we.length,f)}}else ct(e.delta)},text:null}[Oe];(0,a.useEffect)((function(){ne.current.tool.maxDistance=ee}),[ee]);var st=(0,a.useRef)(new Set),dt=(0,a.useRef)(new Map),ft=A.globalEraser,vt=A.pixelEraser,ht=(0,a.useMemo)((function(){return/^(erase|select)$/.test(K)?function(e,t,n){var r=Math.ceil(t/100),i=Math.ceil(n/100),o=Array.from({length:r},(function(){return Array.from({length:i},(function(){return new Set}))}));return e.forEach((function(e){return C(o,e)})),o}(ft&&("erase"===K&&!vt||"select"===K)?le:oe,X,H):[]}),[oe,X,H,K,le,ft,vt]),pt=function(e){var t=ne.current.project.layers[1];if("erase"===Oe&&t){var n=ee,r={class:f().Path,stroke:!0,tolerance:n/2},i=new d.Rectangle(e.point.subtract(n),new d.Size(n,n));j(ht,i).forEach((function(i){var o;st.current.has(i.name)||i.parent&&(null===(o=i.hitTestAll(e.point,r))||void 0===o||o.forEach((function(r){var i=r.item;if(i instanceof f().Path){for(var o=i;o.parent!==t&&o.parent instanceof f().PathItem;)o=o.parent;var a=o.name;if(vt){var u=(n+i.strokeWidth)/2,c=new d.Path.Circle({center:e.point,radius:u,insert:!1}),l=i.subtract(c,{trace:!1});i.replaceWith(l),o===i&&(C(ht,l,i),o=l),dt.current.set(a,o)}else o.opacity=.5,o.guide=!0,st.current.add(a)}})))}))}},mt=(0,a.useRef)([]),wt={draw:function(){if(!ve||ve.segments.length<=1)mt.current.length||tt();else{ve.simplify(),Ne.current&&mt.current.push(ve.clone());var e=ve.exportJSON();w((function(t){return p.Dw.addStroke(t,e)})),he(void 0)}},erase:function(){if(tt(),he(void 0),A.pixelEraser){var e=Array.from(dt.current);dt.current.clear();var t=e.map((function(e){var t=(0,o.Z)(e,2),n=t[0],r=t[1],i=O(r);return i.forEach((function(e){return e.name=""})),[n,i.map((function(e){return e.exportJSON()}))]}));if(!t.length)return;w((function(e){return p.Dw.splitStrokes(e,t)}))}else{var n=Array.from(st.current);if(st.current.clear(),!n.length)return;w((function(e){return p.Dw.eraseStrokes(e,n)}))}},select:function(){if(tt(),ve){if(Math.abs(ve.area)<1e3)return he(void 0);var e;if($){ve.closePath(),ve.simplify(),Ne.current||T(ve);var t=j(ht,ve.bounds);e=G(t,ve)}else{var n=j(ht,ve.bounds);e=G(n,ve);var r=new d.Path,i=ve.bounds.topCenter;r.add(i,i.subtract(new d.Point(0,100))),r.lastSegment.selected=!0,ge(r)}Qe(!0),Ue(e),Ae()}},selected:function(e){Zt(e),ve&&ot.current&&(Ae(),St())},text:function(e){if(kt.current)return Tt(),Ct(e);var t=(0,o.Z)(ne.current.project.layers,2)[1];if(t){var n=F(t,e.point),r=n&&(bt(n)||ft)?n:Q(e.point);r.justification="left",kt.current=r,Wt.current=r.exportJSON(),Ne.current&&(r.visible=!1),requestAnimationFrame((function(){et(),r.visible=!0})),U(r,Ne.current)}}}[Oe],gt=(0,a.useState)("auto"),At=(0,o.Z)(gt,2),xt=At[0],yt=At[1];(0,a.useEffect)((function(){"text"===Oe||"select"===Oe?yt("crosshair"):"selected"===Oe?yt($?"crosshair":"nwse-resize"):"draw"!==Oe&&"erase"!==Oe||yt(function(e,t){var n=e.lineWidth,r=e.eraserWidth,i=t*("erase"===e.mode?r:n);if(i<5)return"crosshair";var o=i/2,a=2*i,u=function(e){return'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" fill="%23DDD7" width="'.concat(e,'" height="').concat(e,'" viewBox="0 0 10 10"><circle cx="5" cy="5" r="5"/></svg>')},c=u(i),l=u(a);return"-webkit-image-set(url('".concat(c,"')1x, url('").concat(l,"')2x) ").concat(o," ").concat(o,", crosshair")}(A,Ze*Pe))}),[Oe,$,A,Ze,Pe]);var Zt=function(e){var t;if(ve){var n=null!==(t=ve.hitTest(e.point,{segments:!0}))&&void 0!==t?t:null===we||void 0===we?void 0:we.hitTest(e.point,{segments:!0,selected:!0});if(null!==n&&void 0!==n&&n.segment){if(n.segment.selected){var r=ve.bounds.center;if(!r)return;var i=n.segment.point.subtract(r);return yt(x(i.angle))}var o=n.segment.point,a=n.segment.next.next.point,u=o.subtract(a),c=u.x,l=u.y;return yt(c*l<0?"nesw-resize":"nwse-resize")}if(ve.contains(e.point))return yt("move");yt("crosshair")}},bt=function(e){return n.getStrokeMap().has(e.name)},Ct=function(e){if(kt.current)return yt("auto");var t=ne.current.project.layers[1];if(t){var n=F(t,e.point);n&&(bt(n)||ft)?yt("text"):yt("crosshair")}},jt=(0,l.Z)({selected:Zt,text:Ct},{select:null,draw:null,erase:null})[Oe],Pt=function(e){if("selected"===Oe){var t={up:new d.Point(0,-10),down:new d.Point(0,10),left:new d.Point(-10,0),right:new d.Point(10,0)}[e.key];t&&(e.preventDefault(),t&&ct(t),Y(!1))}},Mt=(0,l.Z)({selected:function(e){/^(delete|backspace)$/.test(e.key)&&Et(),/^(up|down|left|right)$/.test(e.key)&&St(),/escape/.test(e.key)&&He()},text:function(e){/escape/.test(e.key)&&Tt()}},{select:null,draw:null,erase:null})[Oe];(0,a.useEffect)((function(){if(!S){var e=function(e){return function(t){if(ne.current.activate(),e)return e(t)}},t=ne.current,n=t.view,r=t.tool;n.onMouseDown=e(at),n.onMouseDrag=e(lt),n.onMouseUp=e(wt),n.onMouseMove=e(jt),r.onMouseDrag=e(pt),r.onKeyDown=e(Pt),r.onKeyUp=e(Mt)}}));var St=function(){if(null!==Xe&&void 0!==Xe&&Xe.length){var e=Xe.map((function(e){var t=e.name;return e.name="",[t,e.exportJSON()]}));w((function(t){return p.Dw.mutateStrokes(t,e)}))}},Et=function(){He(),Je.length&&w((function(e){return p.Dw.eraseStrokes(e,Je)}))},Rt=function(e){ne.current.activate(),z(Xe,e),St()},Dt=function(){if(ne.current.activate(),ve&&Xe.length){var e=ve.bounds.size,t=e.width,n=e.height,r=new d.Point(t,n).divide(10),i=Xe.map((function(e){return e.clone()}));i.forEach((function(e){return e.translate(r)})),ve.translate(r),null===we||void 0===we||we.translate(r),i.forEach((function(e){return e.name=""}));var o=i.map((function(e){return e.exportJSON()}));w((function(e){return p.Dw.addStrokeList(e,o,Ue)})),Ae()}},kt=(0,a.useRef)(),Wt=(0,a.useRef)(""),Nt=(0,c.Z)((function(){var e,t;(tt(),null!==(e=kt.current)&&void 0!==e&&e.name)||(null===(t=kt.current)||void 0===t||t.remove());kt.current=void 0,U(void 0,Ne.current)})),Tt=(0,c.Z)((function(){var e=kt.current;if(e&&(Nt(),e.exportJSON()!==Wt.current)){var t=e.content,n=e.name;if(e.name="",t){var r=e.exportJSON();w(n?function(e){return p.Dw.mutateStrokes(e,[[n,r]])}:function(e){return p.Dw.addStroke(e,r)})}else n&&w((function(e){return p.Dw.eraseStrokes(e,[n])}))}})),It=function(e){var t=kt.current;t&&(ne.current.activate(),e(t),U(new Proxy(t,{}),Ne.current))};(0,a.useEffect)((function(){if("text"===K)return Tt}),[K,Tt]),(0,a.useImperativeHandle)(t,(function(){return{deleteSelected:Et,duplicateSelected:Dt,mutateStyle:Rt,mutatePointText:It}})),(0,a.useEffect)((function(){var e=function(e){return e.preventDefault()};return document.addEventListener("gesturestart",e),document.addEventListener("gesturechange",e),document.addEventListener("gestureend",e),function(){document.removeEventListener("gesturestart",e),document.removeEventListener("gesturechange",e),document.removeEventListener("gestureend",e)}}),[]);var Bt=function(){Y(!1),Nt(),function(){if(Ne.current){var e=(0,o.Z)(ne.current.project.layers,2),t=e[0],n=e[1];if(t&&n){n.visible=!0,De&&n.insertChild(1,De);var r=72*devicePixelRatio,i=ye/X*r,a=qe.current;a&&Ke.current||(a=qe.current=n.rasterize({raster:a,resolution:i}),Ke.current=!0),a.visible=!0,n.visible=!1,null===De||void 0===De||De.addTo(t)}}}(),tt()};(0,v.usePinch)((function(e){var t=e.memo,n=(0,o.Z)(e.offset,1)[0],r=e.first,i=e.last,a=e.origin;ne.current.activate();var u,c,l=ne.current.view,s=new(f().Point)(a);if(r||!t){var v=l.element.getBoundingClientRect(),h=v.x,p=v.y;c=new d.Point(h,p),u=s.subtract(c),Bt()}else{var m=(0,o.Z)(t,2);u=m[0],c=m[1]}var w=s.subtract(c),g=l.viewToProject(w),A=w.subtract(u).divide(l.zoom);l.translate(A);var x=n/Se.current;if(Se.current=n,ne.current.settings.hitTolerance/=x,!i)return l.scale(x,g),[w,c];I(l,x,q,g).then((function(){return L(l,q)})).then((function(){return _e()})).then((function(){return be.current=l.center})),Me(n)}),{scaleBounds:{min:1,max:5},rubberband:.5,target:te}),(0,v.useWheel)((function(e){var t=e.event,n=e.delta,r=e.ctrlKey,i=e.first,o=e.last;if(1!==Se.current&&!r){t.preventDefault(),i&&Bt();var a=ne.current.view,u=new(f().Point)(n),c=M.subtract(u).divide(a.zoom),l=c.x,s=c.y,d=B(a,q),v=a.center.subtract(d),h=v.x,p=v.y,m=new(f().Point)(l*h<0?Math.pow(Math.E,.1*Math.abs(h)):1,s*p<0?Math.pow(Math.E,.1*Math.abs(p)):1);a.translate(c.divide(m)),o&&L(a,q).then(_e).then((function(){return be.current=a.center}))}}),{target:te,eventOptions:{passive:!1}});var Lt=y(_);return(0,P.jsx)("div",(0,l.Z)((0,l.Z)((0,l.Z)({className:"draw-wrapper",style:{cursor:xt},"data-readonly":S},Lt),Z),{},{children:(0,P.jsx)("canvas",{ref:te,className:"draw-canvas"})}))}));S.displayName="Draw";var E=a.memo(S);function R(){var e=(0,a.useState)(),t=(0,o.Z)(e,1)[0];return(0,a.useDebugValue)(t),(0,a.useLayoutEffect)((function(){return function(){null===t||void 0===t||t.remove()}}),[t]),e}var D=function(){var e=new WeakMap;return function(t,n){var r,i,o=t.pathData,a=t.uid,u=null!==(r=e.get(n))&&void 0!==r?r:new Map;e.set(n,u);var c=u.get(a);if((null===c||void 0===c?void 0:c.stroke)===t)n.addChild(c.item),i=c.item;else{var l;try{i=n.importJSON(o)}catch(s){return void console.error(s)}null!==(l=i)&&void 0!==l||(i=new(f().Item)),i.name=a,u.set(a,{item:i,stroke:t})}return i.opacity=1,i.guide=!1,i}}(),k=function(e,t){var n=(0,o.Z)(e,3),r=n[0],i=n[1],a=n[2];if(!r||!i||!a)return[];var u=new d.Path.Rectangle(M,t),c=u.clone(),l=u.clone();return u.fillColor=new d.Color("#fff"),r.addChild(u),i.addChild(c),a.addChild(l),i.clipped=!0,a.clipped=!0,[u,c,l]},W=function(e){var t=new d.Path.Rectangle(e,new d.Size(0,0));return t.onFrame=function(){},t},N=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.mode,i=e.lineWidth,o=e.eraserWidth,a=e.color,u=e.highlight,c=new d.Path;c.add(t),"erase"===r&&(a="#ccc",i=o),"select"===r&&(a="#009dec",i=5);var l=new d.Color(a);return("draw"===r&&u||"erase"===r&&!n)&&(l.alpha=.5,c.blendMode="multiply"),c.strokeColor=l,c.strokeWidth=i,c.strokeJoin="round",c.strokeCap="round",c.guide=!0,c},T=function(e){e.dashOffset=0,e.dashArray=[30,20],e.onFrame=function(){return e.dashOffset+=3}},I=function(e,t,n,r){return new Promise((function(i){if(1===t)return i();var o=e.center,a=o.x,u=o.y,c=n.width,l=n.height;t>1&&(r=new(f().Point)((t/2*c-a)/(t-1),(t/2*l-u)/(t-1)));var s=10;t=Math.pow(t,1/s);!function n(){e.scale(t,r),--s>0?requestAnimationFrame(n):requestAnimationFrame((function(){return i()}))}()}))},B=function(e,t){var n=e.center,r=n.x,i=n.y,o=d.Size.min(e.size,t).divide(2),a=o.width,u=o.height,c=t.subtract(o),l=c.width,s=c.height,f=r<a?a:r>l?l:r,v=i<u?u:i>s?s:i;return new d.Point(f,v)},L=function(e,t){return new Promise((function(n){var r=B(e,t);if(e.center.equals(r))return n();var i=10;!function t(){var o=e.center.subtract(r);e.translate(o.divide(i)),--i>0?requestAnimationFrame(t):requestAnimationFrame((function(){return n()}))}()}))},G=function(e,t){var n=function(e){return!(4!==t.segments.length||!e.isInside(t.bounds))||!e.subtract(t,{insert:!1,trace:!1}).compare(e)};return e.filter((function(e){if(!e.name)return!1;if(!e.bounds.intersects(t.bounds))return!1;if(e instanceof f().Path)return n(e);var r=new d.Path.Rectangle(e.bounds);return r.remove(),n(r)||t.isInside(e.bounds)})).map((function(e){return e.name}))},z=function(e,t){var n=t.lineWidth,r=t.color,i=t.highlight;e.forEach((function(e){if(e instanceof f().PointText&&r){var t=new d.Color(r);e.fillColor=t}if(e instanceof f().Path){if(r){var o=new d.Color(r);"multiply"===e.blendMode&&(o.alpha=.5),e.strokeColor=o}n&&(e.strokeWidth=n),e.strokeColor&&void 0!==i&&(e.strokeColor.alpha=i?.5:1,e.blendMode=i?"multiply":"normal")}}))},F=function(e,t){var n=e.hitTest(t,{class:f().PointText,fill:!0});if((null===n||void 0===n?void 0:n.item)instanceof f().PointText)return null===n||void 0===n?void 0:n.item},Q=function(e){return new(f().PointText)({point:e.add(new d.Point(0,50)),content:"",fontSize:50,fontFamily:"Arial, sans-serif"})},O=function e(t){return t instanceof f().Path?t.isEmpty()?[]:[t]:t instanceof f().CompoundPath?t.children.map(e).flat():[]},V=n(61507),Y=n(23414),J=n(82622),U=n(97804),X=n(94396),H=n(69228),q=n(87309),K=n(70776),_=n(2721),$=n(74115),ee=n(22568),te={type:"text",shape:"round",size:"small"},ne=function(e,t){return{"--pos-x":e+"px","--pos-y":t+"px"}},re=function(e,t){var n={};return Object.entries(e).forEach((function(e){var r=(0,o.Z)(e,2),i=r[0],a=r[1];t&&(a+=t),n["--"+i]=a})),n},ie=function(e){var t=e.drawRef,n=e.visible,r=e.clickPoint,i=(0,a.useState)({}),u=(0,o.Z)(i,2),c=u[0],s=u[1],d=r.x,f=r.y;return(0,P.jsxs)("div",{className:"select-tool tool-options","data-visible":n,style:ne(d,f),children:[(0,P.jsx)(H.Z,{trigger:"click",placement:"bottom",overlayClassName:"style-pop",getPopupContainer:function(e){return e.parentElement},destroyTooltipOnHide:!0,content:(0,P.jsx)(_.Uk,{updateDrawCtrl:function(e){var n;s((function(t){return(0,l.Z)((0,l.Z)({},t),e)})),null===(n=t.current)||void 0===n||n.mutateStyle(e)},drawCtrl:c}),children:(0,P.jsx)(q.Z,(0,l.Z)({icon:(0,P.jsx)(V.Z,{})},te))}),(0,P.jsx)(q.Z,(0,l.Z)({icon:(0,P.jsx)(Y.Z,{}),onClick:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.duplicateSelected()}},te)),(0,P.jsx)(q.Z,(0,l.Z)({danger:!0,icon:(0,P.jsx)(J.Z,{}),onClick:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.deleteSelected()}},te))]})},oe=function(e){var t,n,r,i=e.pointText,o=e.drawRef,u=e.renderSlow,c=i.view,s=i.position,f=i.leading,v=i.content,h=i.rotation,p=i.fontFamily,m=i.fontWeight,w=i.fontSize,g=c.projectToView(s),A=g.x,x=g.y,y=i.bounds,Z=y.topLeft,b=y.bottomLeft,C=c.projectToView(Z),j=C.x,M=C.y,S=c.projectToView(b),E=S.x,R=S.y,D=M<90,k=i.viewMatrix.scaling.x,W=i.internalBounds,N=W.width,T=W.height,I=null!==(t=+f/+w)&&void 0!==t?t:1.2,B=null!==(n=null===(r=i.fillColor)||void 0===r?void 0:r.toCSS(!0))&&void 0!==n?n:$.Qk[0],L=(0,P.jsx)(H.Z,{content:(0,P.jsx)(_.Q5,{color:B,setColor:function(e){var t;return null===(t=o.current)||void 0===t?void 0:t.mutatePointText((function(t){t.fillColor=new d.Color(e)}))}}),trigger:"click",overlayStyle:{width:200},placement:"bottom",getPopupContainer:function(e){return e.parentElement},children:(0,P.jsx)(q.Z,(0,l.Z)((0,l.Z)({},te),{},{icon:(0,P.jsx)(ee.Z,{type:"icon-circle",className:"text-color-icon",style:{color:B}})}))}),G=ae(m),z=G.isItalic,F=G.isBold,Q={fontWeight:F?"bold":"normal",fontStyle:z?"italic":"normal"},O=(0,P.jsx)(K.Z,{className:"font-select",popupClassName:"font-drop",value:p,onChange:function(e){var t;null===(t=o.current)||void 0===t||t.mutatePointText((function(t){t.fontFamily=e}))},size:"small",bordered:!1,virtual:!1,getPopupContainer:function(e){return e.parentElement.parentElement},dropdownMatchSelectWidth:100,options:[{value:"Arial, sans-serif",name:"Arial"},{value:"'Times New Roman', serif",name:"Times"},{value:"Georgia, serif",name:"Georgia"},{value:"'Courier New', monospace",name:"Courier"}].map((function(e){var t=e.value,n=e.name;return{value:t,label:(0,P.jsx)("span",{style:{fontFamily:t,fontWeight:"normal"},children:n})}}))}),V=(0,a.useMemo)((function(){return.75-le(p,I)}),[p,I]);return(0,P.jsxs)("div",{className:"text-tool",style:(0,l.Z)((0,l.Z)((0,l.Z)((0,l.Z)((0,l.Z)({},re({scale:k,color:B})),re({rotation:h},"deg")),re({width:N,height:T},"px")),re({offset:V},"em")),ne(A,x)),children:[(0,P.jsx)("div",{className:"textarea-wrapper","data-empty":!v,style:(0,l.Z)({fontSize:w,fontFamily:p,lineHeight:I},Q),children:(0,P.jsx)("textarea",{autoFocus:!v,placeholder:"Text",value:v,onChange:function(e){var t;null===(t=o.current)||void 0===t||t.mutatePointText((function(t){t.content=e.target.value}))},"data-slow":u})}),(0,P.jsxs)("div",{className:"tool-options text-options","data-bottom":D,style:(0,l.Z)({},D?ne(E,R):ne(j,M)),children:[(0,P.jsxs)("div",{className:"row",children:[O,L]}),(0,P.jsxs)("div",{className:"row",children:[(0,P.jsx)(q.Z,(0,l.Z)((0,l.Z)({onClick:function(){var e;null===(e=o.current)||void 0===e||e.mutatePointText((function(e){e.fontWeight=ce(e.fontWeight)}))}},te),{},{type:F?"link":"text",icon:(0,P.jsx)(U.Z,{})})),(0,P.jsx)(q.Z,(0,l.Z)((0,l.Z)({onClick:function(){var e;null===(e=o.current)||void 0===e||e.mutatePointText((function(e){e.fontWeight=ue(e.fontWeight)}))}},te),{},{type:z?"link":"text",icon:(0,P.jsx)(X.Z,{})})),(0,P.jsx)(q.Z,(0,l.Z)((0,l.Z)({},te),{},{icon:(0,P.jsx)(ee.Z,{type:"icon-font_size_down"}),onClick:function(){var e;null===(e=o.current)||void 0===e||e.mutatePointText((function(e){var t=e.bounds.topLeft;e.scale(.9,t)}))}})),(0,P.jsx)(q.Z,(0,l.Z)((0,l.Z)({},te),{},{icon:(0,P.jsx)(ee.Z,{type:"icon-font_size_up"}),onClick:function(){var e;null===(e=o.current)||void 0===e||e.mutatePointText((function(e){var t=e.bounds.topLeft;e.scale(1.1,t)}))}}))]})]})]})},ae=function(e){return{isItalic:/italic/g.test(e+=""),isBold:/bold/g.test(e)}},ue=function(e){var t=ae(e);return(t.isItalic?"":"italic ")+(t.isBold?"bold":"normal")},ce=function(e){var t=ae(e);return(t.isItalic?"italic ":"")+(t.isBold?"normal":"bold")},le=function(e,t){var n=document.createElement("div");n.innerText="p",Object.assign(n.style,{fontSize:"100px",fontFamily:e,lineHeight:t}),document.body.appendChild(n);var r=document.createElement("span");r.style.display="inline-block",n.appendChild(r);var i=n.getBoundingClientRect(),o=(r.getBoundingClientRect().y-i.y)/i.height;return document.body.removeChild(n),Math.max(-1,Math.min(o,1))},se=n(763),de=n(19348),fe=n(24124),ve=n(15671),he=n(43144),pe=n(60136),me=n(27277),we=function(e){(0,pe.Z)(n,e);var t=(0,me.Z)(n);function n(){var e;(0,ve.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).state={hasError:!1},e}return(0,he.Z)(n,[{key:"componentDidCatch",value:function(e,t){console.error("Uncaught error:",e,t)}},{key:"render",value:function(){return this.state.hasError?(0,P.jsx)("p",{children:"Error"}):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{hasError:!0}}}]),n}(a.Component),ge=function(e){var t=e.thumbnail,u=e.drawState,c=e.teamStateMap,l=e.updateState,s=e.pdfIndex,d=e.noteID,f=void 0===d?"":d,v=e.preview,h=void 0!==v&&v,p=e.onViewChange,m=e.preload,w=void 0!==m&&m,g=e.ignores,A=void 0===g?(0,fe.l4)():g,x=e.skipInView,y=void 0!==x&&x,Z=p&&(0,se.range)(0,1.2,.2),b=(0,de.YD)({threshold:Z,skip:y}),C=(0,o.Z)(b,3),j=C[0],M=C[1],S=C[2];(0,a.useEffect)((function(){if(p)return S&&M?void p(S.intersectionRatio):p(0)}),[M,S,p]);var E=(0,a.useState)(),R=(0,o.Z)(E,2),D=R[0],k=R[1],W=(0,a.useCallback)((0,se.once)((0,i.Z)((0,r.Z)().mark((function e(){var t,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s&&f){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,Promise.all([n.e(574),n.e(120),n.e(138)]).then(n.bind(n,21176));case 4:return t=e.sent,i=t.getNotePageImage,e.t0=k,e.next=9,i(f,s);case 9:e.t1=e.sent,(0,e.t0)(e.t1);case 11:case"end":return e.stop()}}),e)})))),[s,f]),N=M||w;(0,a.useEffect)((function(){!h&&N&&W()}),[N,h,W]);var T=(0,a.useMemo)((function(){return null===c||void 0===c?void 0:c.deleteAll(A).toList().toArray()}),[c,A]),I=Boolean(D||!s),B=N&&I,L=u.height/u.width;return(0,P.jsxs)("div",{ref:j,className:"page-wrapper","data-preview":h,children:[(0,P.jsx)("svg",{className:"size-holder",viewBox:"0 0 100 ".concat(100*L)}),B&&(0,P.jsx)(Ae,{drawState:u,otherStates:T,updateState:l,imgSrc:D||t,preview:h})]})};ge.displayName="PageWrapper";var Ae=function(e){var t=e.drawState,n=e.updateState,r=e.otherStates,i=e.preview,l=void 0!==i&&i,s=e.imgSrc,d=(0,u.gX)(),f=(0,a.useRef)(null),v=(0,a.useState)(!1),h=(0,o.Z)(v,2),m=h[0],w=h[1],g=(0,a.useState)(M),A=(0,o.Z)(g,2),x=A[0],y=A[1],Z=(0,a.useState)(),b=(0,o.Z)(Z,2),C=b[0],j=b[1],S=(0,a.useState)(!1),R=(0,o.Z)(S,2),D=R[0],k=R[1],W=(0,c.Z)((function(e){if(n){var r=e instanceof p.Dw?e:e(t);r!==t&&n(r)}}));return l?(0,P.jsx)(E,{drawState:t,otherStates:r,imgSrc:s,readonly:!0}):(0,P.jsxs)(we,{children:[(0,P.jsx)(E,{drawState:t,otherStates:r,onChange:W,imgSrc:s,drawCtrl:d,ref:f,toggleTextTool:function(e,t){j(e),k(t)},toggleSelectTool:function(e,t){y((function(e){return null!==t&&void 0!==t?t:e})),w(e)}}),(0,P.jsx)(ie,{drawRef:f,visible:m,clickPoint:x}),C&&(0,P.jsx)(oe,{drawRef:f,pointText:C,renderSlow:D})]})},xe=a.memo(ge)},70587:function(e,t,n){"use strict";n.d(t,{w3:function(){return b},Hq:function(){return w},Eq:function(){return m},gX:function(){return y},F7:function(){return Z}});var r=n(74165),i=n(1413),o=n(29439),a=n(15861),u=n(72791),c=n(50419),l=n(87309),s=n(31752),d=n(60732),f=n(61842),v=n.n(f),h=n(763),p=n(80184),m=[10,20,30,50],w={mode:"draw",finger:!0,lineWidth:10,eraserWidth:10,color:"#000000",highlight:!1,lasso:!1,pixelEraser:!1,globalEraser:!1,widthList:m};function g(){return(g=(0,a.Z)((0,r.Z)().mark((function e(){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v().getItem("DRAW_CTRL");case 2:if(t=e.sent){e.next=7;break}return t=w,e.next=7,v().setItem("DRAW_CTRL",t);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(){return(A=(0,a.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v().setItem("DRAW_CTRL",t);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var x=u.createContext({drawCtrl:w,updateDrawCtrl:function(){}});function y(){var e=(0,u.useContext)(x).drawCtrl;return(0,u.useDebugValue)(e),e}function Z(){return(0,u.useContext)(x).updateDrawCtrl}var b=function(e){var t=e.children,n=(0,u.useState)(w),r=(0,o.Z)(n,2),a=r[0],c=r[1];(0,u.useEffect)((function(){(function(){return g.apply(this,arguments)})().then(c)}),[]);var l=function(e){c((function(t){var n=(0,i.Z)((0,i.Z)({},t),e);return function(e){A.apply(this,arguments)}(n),n}))},s=a.finger;return(0,u.useEffect)((function(){var e=function(e){e.isPrimary&&"pen"===e.pointerType&&s&&C((function(){return l({finger:!1})}))};return document.addEventListener("pointerup",e),function(){return document.removeEventListener("pointerup",e)}}),[s]),(0,p.jsx)(x.Provider,{value:{drawCtrl:a,updateDrawCtrl:l},children:t})},C=(0,h.once)(function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=function(){c.ZP.destroy("DETECT_PENCIL"),v().setItem("SKIP_PENCIL_MSG",!0)},e.next=3,v().getItem("SKIP_PENCIL_MSG");case 3:if(!e.sent){e.next=5;break}return e.abrupt("return");case 5:c.ZP.info({content:(0,p.jsxs)(p.Fragment,{children:["Your device supports",(0,p.jsx)(l.Z,{shape:"round",size:"small",icon:(0,p.jsx)(s.Z,{}),onClick:function(){t(),n()},children:"Pencil only"}),(0,p.jsx)(l.Z,{size:"small",type:"text",shape:"circle",icon:(0,p.jsx)(d.Z,{style:{color:"#999"}}),onClick:n})]}),key:"DETECT_PENCIL",className:"pencil-msg",duration:0});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},96153:function(e,t,n){"use strict";function r(e,t){var n=document.createElement("canvas"),r=n.getContext("2d");if(!r)throw new Error("can't get virtual canvas context");return n.width=e,n.height=t,{canvas:n,context:r}}function i(e){if(e){e.width=1,e.height=1;var t=e.getContext("2d");null===t||void 0===t||t.clearRect(0,0,1,1)}}n.d(t,{j:function(){return i},v:function(){return r}})},2721:function(e,t,n){"use strict";n.d(t,{Q5:function(){return x},Uk:function(){return w},Db:function(){return g}});var r=n(4942),i=n(93433),o=n(29439),a=n(72791),u=n(70587),c=n(35873),l=n(82670),s=n(69228),d=n(96272),f=n(53163),v=n(74115),h=n(22568),p=n(24124),m=n(80184),w=function(e){var t=e.updateDrawCtrl,n=e.drawCtrl,r=n.highlight,i=n.color,u=(0,a.useState)(!1),c=(0,o.Z)(u,2),l=c[0],s=c[1];return(0,m.jsxs)("div",{className:"pen-panel","data-blur":l,"data-hi":r,children:[(0,m.jsxs)("div",{className:"pen-status",children:[(0,m.jsx)(g,{updateDrawCtrl:t,drawCtrl:n,setPanelBlur:s}),(0,m.jsx)(A,{checked:r,updateDrawCtrl:t})]}),(0,m.jsx)(x,{color:i||"",setColor:function(e){return t({color:e})}})]})},g=function(e){var t,n,v=e.updateDrawCtrl,h=e.drawCtrl,w=e.setPanelBlur,g=void 0===w?function(){}:w,A=e.field,x=void 0===A?"lineWidth":A,y=h[x],Z=null!==(t=h.widthList)&&void 0!==t?t:u.Eq,b="lineWidth"===x&&null!==(n=h.color)&&void 0!==n?n:"#aaa",C=(0,a.useMemo)((function(){return Z.indexOf(null!==y&&void 0!==y?y:-1)}),[y,Z]),j=(0,a.useState)((0,p.aV)([!1,!1,!1,!1])),P=(0,o.Z)(j,2),M=P[0],S=P[1];(0,a.useEffect)((function(){M.includes(!0)?g(!0):g(!1)}),[M,g]);var E=(0,a.useState)((function(){var e,t=document.querySelector("section.note-page");return(null!==(e=null===t||void 0===t?void 0:t.getBoundingClientRect().width)&&void 0!==e?e:0)/document.body.getBoundingClientRect().width})),R=(0,o.Z)(E,1)[0],D=function(e){return{"--real-size":"calc(".concat(100/l.mF,"vw * ").concat(e," * ").concat(R,")")}},k=[{value:-1,label:null}].concat((0,i.Z)(Z.map((function(e,t){return{value:t,label:(0,m.jsx)(s.Z,{open:M.get(t),onOpenChange:function(e){return S((function(n){return n.set(t,e)}))},trigger:C===t?["click"]:[],placement:"bottom",destroyTooltipOnHide:!0,content:(0,m.jsx)(d.Z,{min:5,max:100,className:"ctrl-slider",defaultValue:e,onAfterChange:function(e){if(Z.includes(e))return S((function(e){return e.set(t,!1)})),v((0,r.Z)({},x,e));var n=Z.slice();n[t]=e,v((0,r.Z)({widthList:n},x,e))}}),children:(0,m.jsx)("div",{className:"circle-wrapper",style:D(e),children:(0,m.jsx)(c.W,{className:"width-circle "+x,color:b})})})}}))));return(0,m.jsx)(f.Z,{className:"width-seg",value:C,options:k,onChange:function(e){var t;return v((0,r.Z)({},x,null!==(t=Z[+e])&&void 0!==t?t:10))}})},A=function(e){var t=e.checked,n=void 0!==t&&t,r=e.updateDrawCtrl;return(0,m.jsxs)("label",{className:"hi-wrapper",children:[(0,m.jsx)("input",{type:"checkbox",name:"highlight",checked:n,onChange:function(e){return r({highlight:e.target.checked})}}),(0,m.jsx)("div",{className:"hi-switch",children:(0,m.jsx)(h.Z,{type:"icon-Highlight"})})]})},x=function(e){var t=e.setColor,n=e.color;return(0,m.jsx)("div",{className:"color-select",children:v.Qk.map((function(e){return(0,m.jsxs)("label",{children:[(0,m.jsx)("input",{checked:n===e,type:"radio",name:"color",onChange:function(n){return n.target.checked&&t(e)}}),(0,m.jsx)("div",{"data-color":e,className:"circle",style:{backgroundColor:e,borderColor:e}})]},e)}))})}},90858:function(){},64158:function(){}}]);
//# sourceMappingURL=734.59c583c2.chunk.js.map