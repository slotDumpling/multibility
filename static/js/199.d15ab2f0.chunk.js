"use strict";(self.webpackChunkmultibility=self.webpackChunkmultibility||[]).push([[199],{27199:function(e,t,n){n.r(t),n.d(t,{default:function(){return O}});var r=n(74165),o=n(15861),i=n(29439),a=n(72791),l=n(70587),c=n(34322),u=n(91715),s=n(1413),d=n(61507),f=n(23414),p=n(82622),v=n(97804),h=n(94396),m=n(69228),x=n(87309),g=n(70776),Z=n(2721),w=n(74115),C=n(22568),j=n(80184),y={type:"text",shape:"round",size:"small"},S=function(e,t){return{"--pos-x":e+"px","--pos-y":t+"px"}},b=function(e,t){var n={};return Object.entries(e).forEach((function(e){var r=(0,i.Z)(e,2),o=r[0],a=r[1];t&&(a+=t),n["--"+o]=a})),n},k=function(e){var t=e.drawRef,n=e.visible,r=e.clickPoint,o=(0,a.useState)({}),l=(0,i.Z)(o,2),c=l[0],u=l[1];if(!r)return null;var v=r.x,h=r.y;return(0,j.jsxs)("div",{className:"select-tool tool-options","data-visible":n,style:S(v,h),children:[(0,j.jsx)(m.Z,{trigger:"click",placement:"bottom",overlayClassName:"style-pop",getPopupContainer:function(e){return e.parentElement},destroyTooltipOnHide:!0,content:(0,j.jsx)(Z.Uk,{updateDrawCtrl:function(e){var n;u((function(t){return(0,s.Z)((0,s.Z)({},t),e)})),null===(n=t.current)||void 0===n||n.mutateStyle(e)},drawCtrl:c}),children:(0,j.jsx)(x.Z,(0,s.Z)({icon:(0,j.jsx)(d.Z,{})},y))}),(0,j.jsx)(x.Z,(0,s.Z)({icon:(0,j.jsx)(f.Z,{}),onClick:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.duplicateSelected()}},y)),(0,j.jsx)(x.Z,(0,s.Z)({danger:!0,icon:(0,j.jsx)(p.Z,{}),onClick:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.deleteSelected()}},y))]})},N=function(e){var t,n,r,o=e.pointText,i=e.drawRef,l=e.renderSlow,c=o.view,u=o.position,d=o.leading,f=o.content,p=o.rotation,k=o.fontFamily,N=o.fontWeight,I=o.fontSize,L=c.projectToView(u),R=L.x,W=L.y,B=o.bounds,_=B.topLeft,z=B.bottomLeft,M=c.projectToView(_),A=M.x,F=M.y,V=c.projectToView(z),O=V.x,H=V.y,G=F<90,Q=o.viewMatrix.scaling.x,U=o.internalBounds,X=U.width,K=U.height,Y=null!==(t=+d/+I)&&void 0!==t?t:1.2,q=null!==(n=null===(r=o.fillColor)||void 0===r?void 0:r.toCSS(!0))&&void 0!==n?n:w.Qk[0],J=(0,j.jsx)(m.Z,{content:(0,j.jsx)(Z.Q5,{color:q,setColor:function(e){var t;return null===(t=i.current)||void 0===t?void 0:t.mutatePointText((function(t){t.fillColor=e}))}}),trigger:"click",overlayStyle:{width:200},placement:"bottom",getPopupContainer:function(e){return e.parentElement},children:(0,j.jsx)(x.Z,(0,s.Z)((0,s.Z)({},y),{},{icon:(0,j.jsx)(C.Z,{type:"icon-circle",className:"text-color-icon",style:{color:q}})}))}),$=T(N),ee=$.isItalic,te=$.isBold,ne={fontWeight:te?"bold":"normal",fontStyle:ee?"italic":"normal"},re=(0,j.jsx)(g.Z,{className:"font-select",popupClassName:"font-drop",value:k,onChange:function(e){var t;null===(t=i.current)||void 0===t||t.mutatePointText((function(t){t.fontFamily=e}))},size:"small",bordered:!1,virtual:!1,getPopupContainer:function(e){return e.parentElement.parentElement},dropdownMatchSelectWidth:100,options:[{value:"Arial, sans-serif",name:"Arial"},{value:"'Times New Roman', serif",name:"Times"},{value:"Georgia, serif",name:"Georgia"},{value:"'Courier New', monospace",name:"Courier"}].map((function(e){var t=e.value,n=e.name;return{value:t,label:(0,j.jsx)("span",{style:{fontFamily:t,fontWeight:"normal"},children:n})}}))}),oe=(0,a.useMemo)((function(){return.75-D(k,Y)}),[k,Y]);return(0,j.jsxs)("div",{className:"text-tool",style:(0,s.Z)((0,s.Z)((0,s.Z)((0,s.Z)((0,s.Z)({},b({scale:Q,color:q})),b({rotation:p},"deg")),b({width:X,height:K},"px")),b({offset:oe},"em")),S(R,W)),children:[(0,j.jsx)("div",{className:"textarea-wrapper","data-empty":!f,style:(0,s.Z)({fontSize:I,fontFamily:k,lineHeight:Y},ne),children:(0,j.jsx)("textarea",{autoFocus:!f,placeholder:"Text",value:f,onChange:function(e){var t;null===(t=i.current)||void 0===t||t.mutatePointText((function(t){t.content=e.target.value}))},"data-slow":l})}),(0,j.jsxs)("div",{className:"tool-options text-options","data-bottom":G,style:(0,s.Z)({},G?S(O,H):S(A,F)),children:[(0,j.jsxs)("div",{className:"row",children:[re,J]}),(0,j.jsxs)("div",{className:"row",children:[(0,j.jsx)(x.Z,(0,s.Z)((0,s.Z)({onClick:function(){var e;null===(e=i.current)||void 0===e||e.mutatePointText((function(e){e.fontWeight=E(e.fontWeight)}))}},y),{},{type:te?"link":"text",icon:(0,j.jsx)(v.Z,{})})),(0,j.jsx)(x.Z,(0,s.Z)((0,s.Z)({onClick:function(){var e;null===(e=i.current)||void 0===e||e.mutatePointText((function(e){e.fontWeight=P(e.fontWeight)}))}},y),{},{type:ee?"link":"text",icon:(0,j.jsx)(h.Z,{})})),(0,j.jsx)(x.Z,(0,s.Z)((0,s.Z)({},y),{},{icon:(0,j.jsx)(C.Z,{type:"icon-font_size_down"}),onClick:function(){var e;null===(e=i.current)||void 0===e||e.mutatePointText((function(e){var t=e.bounds.topLeft;e.scale(.9,t)}))}})),(0,j.jsx)(x.Z,(0,s.Z)((0,s.Z)({},y),{},{icon:(0,j.jsx)(C.Z,{type:"icon-font_size_up"}),onClick:function(){var e;null===(e=i.current)||void 0===e||e.mutatePointText((function(e){var t=e.bounds.topLeft;e.scale(1.1,t)}))}}))]})]})]})},T=function(e){return{isItalic:/italic/g.test(e+=""),isBold:/bold/g.test(e)}},P=function(e){var t=T(e);return(t.isItalic?"":"italic ")+(t.isBold?"bold":"normal")},E=function(e){var t=T(e);return(t.isItalic?"italic ":"")+(t.isBold?"normal":"bold")},D=function(e,t){var n=document.createElement("div");n.innerText="p",Object.assign(n.style,{fontSize:"100px",fontFamily:e,lineHeight:t}),document.body.appendChild(n);var r=document.createElement("span");r.style.display="inline-block",n.appendChild(r);var o=n.getBoundingClientRect(),i=(r.getBoundingClientRect().y-o.y)/o.height;return document.body.removeChild(n),Math.max(-1,Math.min(i,1))},I=n(763),L=n(19348),R=n(24124),W=n(15671),B=n(43144),_=n(60136),z=n(27277),M=function(e){(0,_.Z)(n,e);var t=(0,z.Z)(n);function n(){var e;(0,W.Z)(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).state={hasError:!1},e}return(0,B.Z)(n,[{key:"componentDidCatch",value:function(e,t){console.error("Uncaught error:",e,t)}},{key:"render",value:function(){return this.state.hasError?(0,j.jsx)("p",{children:"Error"}):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{hasError:!0}}}]),n}(a.Component),A=n(52365),F=function(e){var t=e.thumbnail,l=e.drawState,c=e.teamStateMap,u=e.updateState,s=e.pdfIndex,d=e.noteID,f=void 0===d?"":d,p=e.preview,v=void 0!==p&&p,h=e.onViewChange,m=e.preload,x=void 0!==m&&m,g=e.ignores,Z=void 0===g?(0,R.Set)():g,w=e.skipInView,C=void 0!==w&&w,y=h&&(0,I.range)(0,1.2,.2),S=(0,L.YD)({threshold:y,skip:C}),b=(0,i.Z)(S,3),k=b[0],N=b[1],T=b[2];(0,a.useEffect)((function(){if(h)return T&&N?void h(T.intersectionRatio):h(0)}),[N,T,h]);var P=(0,a.useState)(),E=(0,i.Z)(P,2),D=E[0],W=E[1],B=(0,a.useCallback)((0,I.once)((0,o.Z)((0,r.Z)().mark((function e(){var t,o;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s&&f){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,Promise.all([n.e(643),n.e(867)]).then(n.bind(n,98338));case 4:return t=e.sent,o=t.getNotePageImage,e.t0=W,e.next=9,o(f,s);case 9:e.t1=e.sent,(0,e.t0)(e.t1);case 11:case"end":return e.stop()}}),e)})))),[s,f]),_=N||x;(0,a.useEffect)((function(){!v&&_&&B()}),[_,v,B]);var z=(0,a.useMemo)((function(){return null===c||void 0===c?void 0:c.deleteAll(Z).toList().toArray()}),[c,Z]),M=Boolean(D||!s),A=_&&M,F=l.height/l.width;return(0,j.jsxs)("div",{ref:k,className:"page-wrapper","data-preview":v,children:[(0,j.jsx)("svg",{className:"size-holder",viewBox:"0 0 100 ".concat(100*F)}),A&&(0,j.jsx)(V,{drawState:l,otherStates:z,updateState:u,imgSrc:D||t,preview:v})]})};F.displayName="PageWrapper";var V=function(e){var t=e.drawState,n=e.updateState,r=e.otherStates,o=e.preview,s=void 0!==o&&o,d=e.imgSrc,f=(0,l.gX)(),p=(0,a.useRef)(null),v=(0,a.useState)(!1),h=(0,i.Z)(v,2),m=h[0],x=h[1],g=(0,a.useState)(),Z=(0,i.Z)(g,2),w=Z[0],C=Z[1],y=(0,a.useState)(),S=(0,i.Z)(y,2),b=S[0],T=S[1],P=(0,a.useState)(!1),E=(0,i.Z)(P,2),D=E[0],I=E[1],L=(0,A.zX)((function(e){if(n){var r=e instanceof u.DrawState?e:e(t);r!==t&&n(r)}}));return s?(0,j.jsx)(c.Draw,{drawState:t,otherStates:r,imgSrc:d,readonly:!0}):(0,j.jsxs)(M,{children:[(0,j.jsx)(c.Draw,{drawState:t,otherStates:r,onChange:L,imgSrc:d,drawCtrl:f,ref:p,toggleTextTool:function(e,t){T(e),I(t)},toggleSelectTool:function(e,t){t&&C(t),x(e)}}),(0,j.jsx)(k,{drawRef:p,visible:m,clickPoint:w}),b&&(0,j.jsx)(N,{drawRef:p,pointText:b,renderSlow:D})]})},O=a.memo(F)},70587:function(e,t,n){n.d(t,{w3:function(){return j},gX:function(){return w},F7:function(){return C}});var r=n(74165),o=n(1413),i=n(29439),a=n(15861),l=n(72791),c=n(50419),u=n(87309),s=n(31752),d=n(60732),f=n(61842),p=n.n(f),v=n(763),h=n(91715),m=n(80184);function x(){return(x=(0,a.Z)((0,r.Z)().mark((function e(){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p().getItem("DRAW_CTRL");case 2:if(t=e.sent){e.next=7;break}return t=h.defaultDrawCtrl,e.next=7,p().setItem("DRAW_CTRL",t);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(){return(g=(0,a.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p().setItem("DRAW_CTRL",t);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Z=l.createContext({drawCtrl:h.defaultDrawCtrl,updateDrawCtrl:function(){}});function w(){var e=(0,l.useContext)(Z).drawCtrl;return(0,l.useDebugValue)(e),e}function C(){return(0,l.useContext)(Z).updateDrawCtrl}var j=function(e){var t=e.children,n=(0,l.useState)(h.defaultDrawCtrl),r=(0,i.Z)(n,2),a=r[0],c=r[1];(0,l.useEffect)((function(){(function(){return x.apply(this,arguments)})().then(c)}),[]);var u=function(e){c((function(t){var n=(0,o.Z)((0,o.Z)({},t),e);return function(e){g.apply(this,arguments)}(n),n}))},s=a.finger;return(0,l.useEffect)((function(){var e=function(e){e.isPrimary&&"pen"===e.pointerType&&s&&y((function(){return u({finger:!1})}))};return document.addEventListener("pointerup",e),function(){return document.removeEventListener("pointerup",e)}}),[s]),(0,m.jsx)(Z.Provider,{value:{drawCtrl:a,updateDrawCtrl:u},children:t})},y=(0,v.once)(function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=function(){c.ZP.destroy("DETECT_PENCIL"),p().setItem("SKIP_PENCIL_MSG",!0)},e.next=3,p().getItem("SKIP_PENCIL_MSG");case 3:if(!e.sent){e.next=5;break}return e.abrupt("return");case 5:c.ZP.info({content:(0,m.jsxs)(m.Fragment,{children:["Your device supports",(0,m.jsx)(u.Z,{shape:"round",size:"small",icon:(0,m.jsx)(s.Z,{}),onClick:function(){t(),n()},children:"Pencil only"}),(0,m.jsx)(u.Z,{size:"small",type:"text",shape:"circle",icon:(0,m.jsx)(d.Z,{style:{color:"#999"}}),onClick:n})]}),key:"DETECT_PENCIL",className:"pencil-msg",duration:0});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},2721:function(e,t,n){n.d(t,{Q5:function(){return w},Uk:function(){return x},Db:function(){return g}});var r=n(4942),o=n(93433),i=n(29439),a=n(72791),l=n(91715),c=n(35873),u=n(69228),s=n(96272),d=n(53163),f=n(74115),p=n(22568),v=n(24124),h=n(74689),m=n(80184),x=function(e){var t=e.updateDrawCtrl,n=e.drawCtrl,r=n.highlight,o=n.color,l=(0,a.useState)(!1),c=(0,i.Z)(l,2),u=c[0],s=c[1];return(0,m.jsxs)("div",{className:"pen-panel","data-blur":u,"data-hi":r,children:[(0,m.jsxs)("div",{className:"pen-status",children:[(0,m.jsx)(g,{updateDrawCtrl:t,drawCtrl:n,setPanelBlur:s}),(0,m.jsx)(Z,{checked:r,updateDrawCtrl:t})]}),(0,m.jsx)(w,{color:o||"",setColor:function(e){return t({color:e})}})]})},g=function(e){var t,n,f=e.updateDrawCtrl,p=e.drawCtrl,x=e.setPanelBlur,g=void 0===x?function(){}:x,Z=e.field,w=void 0===Z?"lineWidth":Z,C=p[w],j=null!==(t=p.widthList)&&void 0!==t?t:l.defaultWidthList,y="lineWidth"===w&&null!==(n=p.color)&&void 0!==n?n:"#aaa",S=(0,a.useMemo)((function(){return j.indexOf(null!==C&&void 0!==C?C:-1)}),[C,j]),b=(0,a.useState)((0,v.List)([!1,!1,!1,!1])),k=(0,i.Z)(b,2),N=k[0],T=k[1];(0,a.useEffect)((function(){N.includes(!0)?g(!0):g(!1)}),[N,g]);var P=(0,a.useState)((function(){var e,t=document.querySelector("section.note-page");return(null!==(e=null===t||void 0===t?void 0:t.getBoundingClientRect().width)&&void 0!==e?e:0)/document.body.getBoundingClientRect().width})),E=(0,i.Z)(P,1)[0],D=function(e){return{"--real-size":"calc(".concat(100/h.m,"vw * ").concat(e," * ").concat(E,")")}},I=[{value:-1,label:null}].concat((0,o.Z)(j.map((function(e,t){return{value:t,label:(0,m.jsx)(u.Z,{open:N.get(t),onOpenChange:function(e){return T((function(n){return n.set(t,e)}))},trigger:S===t?["click"]:[],placement:"bottom",destroyTooltipOnHide:!0,content:(0,m.jsx)(s.Z,{min:5,max:100,className:"ctrl-slider",defaultValue:e,onAfterChange:function(e){if(j.includes(e))return T((function(e){return e.set(t,!1)})),f((0,r.Z)({},w,e));var n=j.slice();n[t]=e,f((0,r.Z)({widthList:n},w,e))}}),children:(0,m.jsx)("div",{className:"circle-wrapper",style:D(e),children:(0,m.jsx)(c.W,{className:"width-circle "+w,color:y})})})}}))));return(0,m.jsx)(d.Z,{className:"width-seg",value:S,options:I,onChange:function(e){var t;return f((0,r.Z)({},w,null!==(t=j[+e])&&void 0!==t?t:10))}})},Z=function(e){var t=e.checked,n=void 0!==t&&t,r=e.updateDrawCtrl;return(0,m.jsxs)("label",{className:"hi-wrapper",children:[(0,m.jsx)("input",{type:"checkbox",name:"highlight",checked:n,onChange:function(e){return r({highlight:e.target.checked})}}),(0,m.jsx)("div",{className:"hi-switch",children:(0,m.jsx)(p.Z,{type:"icon-Highlight"})})]})},w=function(e){var t=e.setColor,n=e.color;return(0,m.jsx)("div",{className:"color-select",children:f.Qk.map((function(e){return(0,m.jsxs)("label",{children:[(0,m.jsx)("input",{checked:n===e,type:"radio",name:"color",onChange:function(n){return n.target.checked&&t(e)}}),(0,m.jsx)("div",{"data-color":e,className:"circle",style:{backgroundColor:e,borderColor:e}})]},e)}))})}}}]);
//# sourceMappingURL=199.d15ab2f0.chunk.js.map