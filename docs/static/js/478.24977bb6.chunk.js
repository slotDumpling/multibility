(self.webpackChunkmultibility=self.webpackChunkmultibility||[]).push([[478],{22568:function(e,t,n){"use strict";var r=n(92721);t.Z=(0,r.Z)({scriptUrl:"//at.alicdn.com/t/font_3181679_yo844n7qgns.js"})},50060:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return ve}});var r=n(15861),i=n(29439),o=n(87757),a=n.n(o),u=n(72791),c=n(11886),l=n(95099),s=n(1413),d=n(93433),f=n(46668),v=n.n(f),h=n(41446),p=n(1488),m=n(82670),w=n(96153),g=function(){var e=new Map,t=(0,w.v)(44,44),n=t.canvas,r=t.context,i=new Image;return i.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAAAXNSR0IArs4c6QAABWlJREFUWEftmF1IW2cYx580iaaNSTSmdWUtRVBBnENbSG40YVtRRpZM4ydqLEpJnd5sVzpxU7TipoMy8EYd6kwC6pakiDeCih/oyBGibS/qTZWaoE63RONXqiYZj5xIKtvFzhvRQl84nHPzvud3nvO8//f5Pyx4xwbrHeOF98Dn/cfeR/h9hM9EgDQlcP4VgJPNi/ezww8AeHnpO/EPIAXm2O32+3w+/xOv13vF5/O9tR6Hw/FxuVyvUChsAIDDUECTAOPca1NTU5+np6f/Zjab7X6//631cnJybjkcjp9v375dDwB7AHBMGmISYEwBocViUWVlZfVJpVLP3NwcLxjI7/fD4uJiR2Ji4vcA4AKAo4sEZgNApF6vzy4pKelCYK/Xy3K73dympqa/EaywsPD6/Px89927d78DgL/otCBiJokwAkf19vZqHjx40CGVSt8gyfLycrhMJvMMDw+fRHthYaEnNTUVgTcvJXBZWdlhZWWlID8/3z0wMCC02Wy99+7dCwCffBTJCHmEKYoKr66udra2torLy8v/7Orqik5JSUl+8eLFCgDsk8DiXFLgSKPRmFVUVPTLWZDc3NzdsbExVJFdgUDwNDY29msA2AYAHwk0CTCqhMBisahfv34tcbvdgsPDw7Dj42NOTU3Nw6mpqSO1Wv1BYWGhU6/Xc2tra+VtbW2LAOC5KGD82KsobQAgop/DASDCYDBoiouLKzUajdtisQiXlpYOfD7fr3Fxcd8CgJskyiQRxkBxACAMALj0M96FkZGRH9rt9gGj0ciuqKgQt7e3b2i1WqdIJPoUAFDy8NRjNEiBA/sA1wnUExEAcHNmZqYuNTVVJZFIIjIzM7cHBwe5XC73IwBYB4ADRrSEm+6/3on6e2N4eLhSqVRWKxSKY5fL5Xv+/HlYY2Pj/fr6egoAdi4TMKaJpL29XV1VVdWhVqv3bTZbuMPhYJtMJl1ubu7vALDFtBAKRUqcDRaqh1ilUn08NDQ0VlpaumUymSL39vaAoqgfZTLZTwDgZLrxzgMY14zKzs5ONpvNE1qt1mU2m6MQeGZmpi0tLS0AzKhyOzfg7u5uVVlZWa9ard6z2Ww8TImenp7K8vJyEx3hSwN8khKTk5NVcrm8QaFQHLlcLj9uukePHn3R2dlpvWwpcbLpnj179jghISE/OjpakJGRsd3f3w88Hi8dAOz0EY3W6X+P80gJ3p07d26+fPly1mAwcHQ6HSrGZl5e3mZMTEw2AKxdtKwFDo3Tg8NqtX4llUqbNRrNtsViEb169cqztrZmSEtLewwAGxd5cHBWV1c/293d5RwcHLA9Hg97fX2dn5GR0To+Pu5VKpW3CgoKtoxGY4RSqVSNjIws0EczY6tEkhInxY/Vas2USqXms8mYl5e3Mzo6yp+YmNjn8/m2+Pj4KgBwXGTxc1pe0iYU6wMWRVG85ubmjbq6uhs6nc7Z0dEhrq2tfdjS0jJKmg4hLeDRhCJwQ0PDQUFBgTA5OfnN7Ozs1enp6QG5XP4DrQ54JGNThfEgSYl/NaFbW1vs1dXVKysrK06xWCyhKEovk8kaaXXA3gTRCCkwwu7s7LCePHmCPQi0+RLahGJfAtXhcpnQubk5dBynAxspl87m9/X1ZWu12s7+/n7sOwT/MX9QIwUjfOF9CVQJ0eDg4JcKheKbo6MjbnBvjcVi+dls9rHT6fwjKSkJgbGkZKy/gd9GksM4l4+FDgBcRwdNe7vA2mjncZOhh8M2FboMRhVacJqRAOM6aDrROV+jzWhwjxiLG4woyh02UHDDMSp4QgmMH4zyhlegsR1YP7iZjdpL1EAJRUoQ6SnTyaQpwfS9jOe9c8D/AEaRMEuceu4YAAAAAElFTkSuQmCC",function(t){t=10*Math.round(t/10);var o=e.get(t);if(o)return o;r.translate(22,22),r.rotate(t*Math.PI/180),r.drawImage(i,-22,-22);var a=n.toDataURL();return r.clearRect(-22,-22,44,44),r.resetTransform(),e.set(t,a),a}}(),x=function(e){return"url(".concat(g(e),") 22 22, auto")};function b(e){var t=(0,u.useRef)(!1),n=function(e){return e.isPrimary&&(t.current="touch"===e.pointerType)},r=function(n){return function(n){return!t.current||function(e){var t=e.touches[0];return"stylus"===(null===t||void 0===t?void 0:t.touchType)}(n)||e&&1===n.touches.length}(n)||n.stopPropagation()};return{onPointerDownCapture:n,onPointerMoveCapture:n,onTouchStartCapture:r,onTouchMoveCapture:r}}var C=function(e){var t=e.topLeft,n=e.bottomRight;return[Math.floor(t.x/100),Math.ceil(n.x/100),Math.floor(t.y/100),Math.ceil(n.y/100)]},S=function(e,t,n){for(var r=(null!==n&&void 0!==n?n:t).strokeBounds,o=C(r),a=(0,i.Z)(o,4),u=a[0],c=a[1],l=a[2],s=a[3],d=u;d<=c;d+=1)for(var f=l;f<=s;f+=1){var v,h,p,m;n&&(null===(v=e[d])||void 0===v||null===(h=v[f])||void 0===h||h.delete(n)),null===(p=e[d])||void 0===p||null===(m=p[f])||void 0===m||m.add(t)}},y=function(e,t){for(var n=new Set,r=C(t),o=(0,i.Z)(r,4),a=o[0],u=o[1],c=o[2],l=o[3],s=a;s<=u;s+=1)for(var d=c;d<=l;d+=1){var f,v;null===(f=e[s])||void 0===f||null===(v=f[d])||void 0===v||v.forEach((function(e){return n.add(e)}))}return Array.from(n)},Z=n(80184),j=new f.Point(0,0),k=u.forwardRef((function(e,t){var n=e.drawState,r=e.otherStates,o=e.onChange,a=void 0===o?function(){}:o,l=e.drawCtrl,g=void 0===l?c.Hq:l,C=e.readonly,k=void 0!==C&&C,A=e.imgSrc,B=e.toggleSelectTool,J=void 0===B?function(){}:B,q=e.toggleTextTool,I=void 0===q?function(){}:q,U=n.width,K=n.height,Y=(0,u.useMemo)((function(){return new f.Size(U,K)}),[U,K]),H=g.mode,Q=g.finger,X=g.lasso,G=g.eraserWidth,_=(0,u.useRef)(null),$=(0,u.useRef)(new(v().PaperScope)),ee=(0,u.useState)([]),te=(0,i.Z)(ee,2),ne=te[0],re=te[1],ie=E(),oe=(0,i.Z)(ie,2),ae=oe[0],ue=oe[1],ce=E(),le=(0,i.Z)(ce,2),se=le[0],de=le[1],fe=E(),ve=(0,i.Z)(fe,2),he=ve[0],pe=ve[1];(0,u.useEffect)((function(){var e,t=_.current,n=$.current;if(t)return n.setup(t),n.settings.handleSize=10,n.settings.hitTolerance=20,[0,1,2].forEach((function(){return(new f.Layer).visible=!1})),null===(e=n.project.layers[2])||void 0===e||e.activate(),new n.Tool,function(){var e;null===(e=n.view)||void 0===e||e.remove(),(0,w.j)(t)}}),[]),(0,u.useEffect)((function(){$.current.activate();var e=$.current.project.layers,t=D(e,Y);return function(){return t.forEach((function(e){return e.remove()}))}}),[Y]);var me=(0,p.Z)(_),we=(0,i.Z)(me,1)[0],ge=we/U;(0,u.useEffect)((function(){if(ge){var e=$.current;return e.view.viewSize=Y.multiply(ge),e.view.scale(ge,j),e.project.layers.forEach((function(e){return e.visible=!0})),e.view.update(),function(){var t;return null===(t=e.view)||void 0===t?void 0:t.scale(1/ge,j)}}}),[ge,Y]);var xe=E(),be=(0,i.Z)(xe,2),Ce=be[0],Se=be[1];(0,u.useEffect)((function(){var e;if(A){$.current.activate();var t=new f.Raster(A);null===(e=t.project.layers[0])||void 0===e||e.addChild(t),t.sendToBack(),t.onLoad=function(){t.view.update(),t.fitBounds(new f.Rectangle(Y)),t.bringToFront()},Se(t)}}),[A,Y,Se]);var ye=(0,u.useMemo)((function(){return r?m.Dw.mergeStates.apply(m.Dw,[n].concat((0,d.Z)(r))):n.getStrokeList()}),[n,r]),Ze=(0,u.useRef)(!1),je=(0,u.useRef)(!1),ke=(0,u.useRef)(0);(0,u.useEffect)((function(){var e=$.current.project.layers[1];if(e){var t=function(){var t=[],r=performance.now();$.current.activate(),e.removeChildren(1),ye.forEach((function(r){var i=n.hasStroke(r.uid),o=R(r,e,!i);i&&t.push(o)})),re(t),Ie(),tt.current.forEach((function(e){return e.remove()})),tt.current=[],$.current.view.update();var i=performance.now()-r;Ze.current=i>16};return je.current?ke.current=window.setTimeout(t,1e3):t(),function(){return window.clearTimeout(ke.current)}}}),[ye,n]),(0,u.useEffect)((function(){je.current=!1}),[n]);var Ae=(0,u.useRef)(),Ee=(0,u.useState)(!1),Re=(0,i.Z)(Ee,2),De=Re[0],Te=Re[1],Pe="select"===H&&De?"selected":H,Me=(0,u.useState)([]),Ne=(0,i.Z)(Me,2),We=Ne[0],Le=Ne[1],Ve=(0,u.useMemo)((function(){var e=new Set(We);return ne.filter((function(t){return e.has(t.name)}))}),[ne,We]),ze=(0,u.useCallback)((function(){Te(!1),ue(void 0),de(void 0),pe(void 0)}),[ue,de,pe]);(0,u.useEffect)((function(){if("select"===H)return ze}),[H,ze]),(0,u.useEffect)((function(){return ze}),[X,ze]),(0,u.useEffect)((function(){if(De)return function(){Le([]),J(!1)}}),[De,J]),(0,u.useEffect)((function(){J(!1)}),[we,J]);var Fe=(0,u.useRef)(),Oe=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Ze.current||t){var n=(0,i.Z)($.current.project.layers,2),r=n[0],o=n[1];if(r&&o){o.visible=!0,e.clipMask=!0;var a=o.firstChild;a.replaceWith(e),null===Ce||void 0===Ce||Ce.insertAbove(e);var u=72*devicePixelRatio,c=we/e.bounds.width*u,l=Fe.current;(l=Fe.current=o.rasterize({raster:l,resolution:c})).visible=!0,o.visible=!1,e.replaceWith(a),null===Ce||void 0===Ce||Ce.addTo(r)}}},Be=function(){$.current.activate();var e=(0,i.Z)($.current.project.layers,2)[1],t=Fe.current;e&&t&&(e.visible=!0,t.visible=!1)},Je=(0,u.useRef)();(0,u.useEffect)((function(){return function(){var e;null===(e=Je.current)||void 0===e||e.remove(),Je.current=void 0}}),[we]);var qe=function(){var e,t;if(Ze.current&&!0!==(null===(e=Je.current)||void 0===e?void 0:e.visible)){$.current.activate();var n=$.current.view,r=null!==(t=Je.current)&&void 0!==t?t:Je.current=new f.Raster(n.viewSize.multiply(window.devicePixelRatio));r.drawImage(n.element,j),r.fitBounds(n.bounds),r.visible=!0,r.opacity=1;var o=(0,i.Z)($.current.project.layers,2)[1];o&&(o.visible=!1)}},Ie=function(){$.current.activate(),je.current=!1;var e=(0,i.Z)($.current.project.layers,2)[1],t=Je.current,n=Fe.current;e&&t&&(t.visible=!1,!0!==(null===n||void 0===n?void 0:n.visible)&&(e.visible=!0))},Ue=function(e){qe(),ue(P(g,e.point,Ze.current))},Ke=function(e){qe(),de(T(e.point))},Ye=(0,u.useRef)(j),He={draw:function(e){je.current=Ze.current,Ue(e)},erase:Ue,select:X?Ue:Ke,selected:function(e){if(J(!1),Ye.current=e.point,X){if(null!==ae&&void 0!==ae&&ae.contains(e.point))return;Te(!1),Ue(e)}else{var t,n=null!==(t=null===se||void 0===se?void 0:se.hitTest(e.point,{segments:!0}))&&void 0!==t?t:null===he||void 0===he?void 0:he.hitTest(e.point,{segments:!0,selected:!0});if(Ae.current=n,n)return;if(null!==se&&void 0!==se&&se.contains(e.point))return;pe(void 0),Te(!1),Ke(e)}},text:function(e){var t,n=$.current.project.layers[1];if(n){qe();var r=null!==(t=z(n,e.point))&&void 0!==t?t:F(e.point);xt(r)}}}[Pe],Qe=function(e){window.clearTimeout(ke.current),null===ae||void 0===ae||ae.add(e.point),null===ae||void 0===ae||ae.smooth()},Xe={draw:Qe,erase:Qe,select:X?Qe:function(e){if(se){var t=e.point,n=t.x,r=t.y,o=(0,i.Z)(se.segments,4),a=o[1],u=o[2],c=o[3];a&&u&&c&&(a.point.x=n,u.point=e.point,c.point.y=r,se.selected=!0)}},selected:function(e){var t=Ae.current;if(null!==t&&void 0!==t&&t.segment&&se&&he){var n=t.segment;if(n.selected){var r=se.bounds.center,i=n.point.subtract(r),o=e.point.subtract(r);at(x(o.angle));var a=o.angle-i.angle;se.rotate(a,r),he.rotate(a,r),Ve.forEach((function(e){return null===e||void 0===e?void 0:e.rotate(a,r)}))}else{var u,c=n.point,l=n.next.next.point,s=c.subtract(l),d=e.point.subtract(l).project(s).x/s.x;if(d<0)return;se.scale(d,l),Ve.forEach((function(e){e.scale(d,l),e.strokeWidth*=d})),he.scale(d,l);var f=null===(u=he.segments[0])||void 0===u?void 0:u.point;if(!f)return;he.scale(100/he.length,f)}}else Ve.forEach((function(t){return t.translate(e.delta)})),null===ae||void 0===ae||ae.translate(e.delta),null===se||void 0===se||se.translate(e.delta),null===he||void 0===he||he.translate(e.delta)},text:function(e){if(gt&&!gt.name){var t=gt.bounds,n=t.topCenter,r=t.bottomRight.subtract(n),i=e.point.subtract(n).project(r).x/r.x;i<0||gt.scale(i,n)}}}[Pe];(0,u.useEffect)((function(){$.current.tool.maxDistance=G}),[G]);var Ge=(0,u.useRef)(new Set),_e=(0,u.useRef)(new Map),$e=(0,u.useMemo)((function(){return/^(erase|select)$/.test(H)?function(e,t,n){var r=Math.ceil(t/100),i=Math.ceil(n/100),o=Array.from({length:r},(function(){return Array.from({length:i},(function(){return new Set}))}));return e.forEach((function(e){return S(o,e)})),o}(ne,U,K):[]}),[ne,U,K,H]),et=function(e){var t=$.current.project.layers[1];if("erase"===Pe&&t){var n=G,r={class:v().Path,stroke:!0,tolerance:n/2},i=new f.Rectangle(e.point.subtract(n),new f.Size(n,n));y($e,i).forEach((function(i){var o;Ge.current.has(i.name)||null===(o=i.hitTestAll(e.point,r))||void 0===o||o.forEach((function(r){var i=r.item;if(i instanceof v().Path){for(var o=i;o.parent!==t&&o.parent instanceof v().PathItem;)o=o.parent;var a=o.name;if(g.pixelEraser){var u=(n+i.strokeWidth)/2,c=new f.Path.Circle({center:e.point,radius:u,insert:!1}),l=i.subtract(c,{trace:!1});i.replaceWith(l),o===i&&(S($e,l,i),o=l),_e.current.set(a,o)}else o.opacity=.5,o.guide=!0,Ge.current.add(a)}}))}))}},tt=(0,u.useRef)([]),nt={draw:function(){if(!ae||ae.segments.length<=1)tt.current.length||Ie();else{ae.simplify(),Ze.current&&tt.current.push(ae.clone());var e=ae.exportJSON();a((function(t){return m.Dw.addStroke(t,e)})),ue(void 0)}},erase:function(){if(Ie(),ue(void 0),g.pixelEraser){var e=Array.from(_e.current);_e.current.clear();var t=e.map((function(e){var t=(0,i.Z)(e,2),n=t[0],r=t[1];return[n,O(r).map((function(e){return e.exportJSON()}))]}));if(!t.length)return;a((function(e){return m.Dw.splitStrokes(e,t)}))}else{var n=Array.from(Ge.current);if(Ge.current.clear(),!n.length)return;a((function(e){return m.Dw.eraseStrokes(e,n)}))}},select:function(){var e,t;Ie();var n=$.current.view;if(X){if(!ae||Math.abs(ae.area)<1e3)return ue(void 0);ae.closePath(),ae.simplify(),Ze.current||M(ae);var r=y($e,ae.bounds);t=L(r,ae)}else{if(!se||Math.abs(se.area)<1e3)return de(void 0);var i=y($e,se.bounds);t=L(i,se);var o=new f.Path,a=se.bounds.topCenter;o.add(a,a.subtract(new f.Point(0,100))),o.lastSegment.selected=!0,pe(o)}Te(!0),Le(t);var u=null===(e=null!==se&&void 0!==se?se:ae)||void 0===e?void 0:e.bounds.bottomCenter;u&&J(!0,n.projectToView(u))},selected:function(e){ut(e),Ye.current.equals(e.point)||dt()},text:function(){Ie(),I(!0,gt)}}[Pe],rt=(0,u.useState)("auto"),it=(0,i.Z)(rt,2),ot=it[0],at=it[1];(0,u.useEffect)((function(){"text"===Pe||"select"===Pe?at("crosshair"):"selected"===Pe?at(X?"crosshair":"nwse-resize"):"draw"!==Pe&&"erase"!==Pe||at(function(e,t){var n=e.lineWidth,r=e.eraserWidth,i=t*("erase"===e.mode?r:n);if(i<5)return"crosshair";var o=i/2;return'url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" fill="%23FFF7" width="'.concat(i,'" height="').concat(i,'" viewBox="0 0 10 10"><circle cx="5" cy="5" r="5"/></svg>\') ').concat(o," ").concat(o,", auto")}(g,ge))}),[Pe,X,g,ge]);var ut=function(e){var t,n,r=null!==(t=null===se||void 0===se?void 0:se.hitTest(e.point,{segments:!0}))&&void 0!==t?t:null===he||void 0===he?void 0:he.hitTest(e.point,{segments:!0,selected:!0});if(null!==r&&void 0!==r&&r.segment){if(r.segment.selected){var i=null===se||void 0===se?void 0:se.bounds.center;if(!i)return;var o=r.segment.point.subtract(i);return at(x(o.angle))}var a=r.segment.point,u=r.segment.next.next.point,c=a.subtract(u),l=c.x,s=c.y;return at(l*s<0?"nesw-resize":"nwse-resize")}if(null!==(n=null!==se&&void 0!==se?se:ae)&&void 0!==n&&n.contains(e.point))return at("pointer");at("crosshair")},ct=(0,s.Z)({selected:ut,text:function(e){var t=$.current.project.layers[1];t&&(z(t,e.point)?at("text"):at("crosshair"))}},{select:null,draw:null,erase:null})[Pe],lt=function(e){"selected"===Pe&&/^(delete|backspace)$/.test(e.key)&&ft()},st=function(e){var t;if("selected"===Pe&&null!==(t=null!==se&&void 0!==se?se:ae)&&void 0!==t&&t.contains(e.point)&&!(e.delta.subtract(j).length>10)){var n=$.current.view.projectToView(e.point);J(!0,n)}};(0,u.useEffect)((function(){if(!k){var e=function(e){return function(t){if($.current.activate(),e)return e(t)}},t=$.current,n=t.view,r=t.tool;n.onMouseDown=e(He),n.onMouseDrag=e(Xe),n.onMouseUp=e(nt),n.onMouseMove=e(ct),n.onClick=e(st),r.onMouseDrag=e(et),r.onKeyUp=e(lt)}}));var dt=function(){if(null!==Ve&&void 0!==Ve&&Ve.length){var e=Ve.map((function(e){return[e.name,e.exportJSON()]}));a((function(t){return m.Dw.mutateStrokes(t,e)}))}},ft=function(){ze(),We.length&&a((function(e){return m.Dw.eraseStrokes(e,We)}))},vt=function(e){$.current.activate(),V(Ve,e),dt()},ht=function(){var e;$.current.activate();var t=null===(e=se||ae)||void 0===e?void 0:e.bounds.size;if(t&&Ve.length){var n=t.width,r=t.height,i=new f.Point(n,r).divide(10),o=Ve.map((function(e){return e.clone()}));o.forEach((function(e){return e.translate(i)})),null===se||void 0===se||se.translate(i),null===ae||void 0===ae||ae.translate(i),null===he||void 0===he||he.translate(i);var u=o.map((function(e){return e.exportJSON()})),c=[];a((function(e){return m.Dw.addStrokes(e,u,c)})),Le(c),J(!1)}},pt=function(){var e,t,n;$.current.activate();var r=null===(e=null!==se&&void 0!==se?se:ae)||void 0===e?void 0:e.clone();return r&&Oe(r,!0),Be(),null!==(t=null===(n=Fe.current)||void 0===n?void 0:n.toDataURL())&&void 0!==t?t:""},mt=E(),wt=(0,i.Z)(mt,2),gt=wt[0],xt=wt[1],bt=(0,u.useCallback)((function(){xt(void 0),I(!1)}),[xt,I]);(0,u.useEffect)((function(){if("text"===H)return bt}),[H,bt]);var Ct=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#000",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"center";if(gt){gt.content=e,gt.fillColor=new f.Color(t),gt.justification=n;var r=gt.exportJSON(),i=gt.name;if(bt(),!i)return a((function(e){return m.Dw.addStroke(e,r)}));a((function(e){return m.Dw.mutateStrokes(e,[[i,r]])}))}};(0,u.useImperativeHandle)(t,(function(){return{deleteSelected:ft,duplicateSelected:ht,rasterizeSelected:pt,mutateStyle:vt,cancelText:bt,submitText:Ct}})),(0,u.useEffect)((function(){var e=function(e){return e.preventDefault()};return document.addEventListener("gesturestart",e),document.addEventListener("gesturechange",e),document.addEventListener("gestureend",e),function(){document.removeEventListener("gesturestart",e),document.removeEventListener("gesturechange",e),document.removeEventListener("gestureend",e)}}),[]),(0,h.usePinch)((function(e){var t=e.memo,n=(0,i.Z)(e.offset,1)[0],r=e.first,o=e.last,a=e.origin;$.current.activate();var u,c,l,s=$.current.view,d=new(v().Point)(a);if(r||!t){var h=s.element.getBoundingClientRect(),p=h.x,m=h.y;u=1,l=new f.Point(p,m),c=d.subtract(l),J(!1),Oe(new f.Path.Rectangle(j,Y)),Ie()}else{var w=(0,i.Z)(t,3);u=w[0],c=w[1],l=w[2]}var g=d.subtract(l),x=s.viewToProject(g),b=g.subtract(c).divide(s.zoom);s.translate(b);var C=r?1:n/u;if($.current.settings.hitTolerance/=C,s.scale(C,x),!o)return[n,g,l];Promise.all([W(s,Y),N(s,x,C)]).then(Be),s.scale(1/C,x)}),{scaleBounds:{max:5,min:1},rubberband:.5,target:_});var St=b(Q);return(0,Z.jsx)("div",(0,s.Z)((0,s.Z)({className:"draw-wrapper",style:{cursor:ot},"data-readonly":k},St),{},{children:(0,Z.jsx)("canvas",{ref:_,className:"draw-canvas"})}))}));k.displayName="Draw";var A=u.memo(k);function E(){var e=(0,u.useState)(),t=(0,i.Z)(e,1)[0];return(0,u.useDebugValue)(t),(0,u.useEffect)((function(){if(null===t||void 0===t||!t.name)return function(){null===t||void 0===t||t.remove()}}),[t]),e}var R=function(){var e=new WeakMap;return function(t,n){var r,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=t.pathData,a=t.uid,u=null!==(r=e.get(n))&&void 0!==r?r:new Map;e.set(n,u);var c,l=u.get(a);if((null===l||void 0===l?void 0:l.stroke)===t)n.addChild(l.item),c=l.item;else{var s;try{c=n.importJSON(o)}catch(d){console.error(d)}null!==(s=c)&&void 0!==s||(c=new(v().Item)),c.name=a,u.set(a,{item:c,stroke:t})}return c.opacity=1,c.guide=i,c}}(),D=function(e,t){var n=(0,i.Z)(e,3),r=n[0],o=n[1],a=n[2];if(!r||!o||!a)return[];var u=new f.Path.Rectangle(j,t),c=u.clone(),l=u.clone();return u.fillColor=new f.Color("#fff"),r.addChild(u),o.addChild(c),a.addChild(l),o.clipped=!0,a.clipped=!0,[u,c,l]},T=function(e){var t=new f.Path.Rectangle(e,new f.Size(0,0));return t.onFrame=function(){},t},P=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.mode,i=e.lineWidth,o=e.eraserWidth,a=e.color,u=e.highlight,c=new f.Path;c.add(t),"erase"===r&&(a="#ccc",i=o),"select"===r&&(a="#009dec",i=5);var l=new f.Color(a);return("draw"===r&&u||"erase"===r&&!n)&&(l.alpha=.5,c.blendMode="multiply"),c.strokeColor=l,c.strokeWidth=i,c.strokeJoin="round",c.strokeCap="round",c.guide=!0,c},M=function(e){e.dashOffset=0,e.dashArray=[30,20],e.onFrame=function(){return e.dashOffset+=3}},N=function(e,t,n){return new Promise((function(r){if(Math.abs(n-1)<.05)return e.scale(n,t),r();var i=10;n=Math.pow(n,1/i);!function o(){e.scale(n,t),--i>0?requestAnimationFrame(o):requestAnimationFrame((function(){return r()}))}()}))},W=function(e,t){return new Promise((function(n){var r=function(e,t){var n=e.center,r=n.x,i=n.y,o=f.Size.min(e.size,t).divide(2),a=o.width,u=o.height,c=t.subtract(o),l=c.width,s=c.height,d=r<a?a:r>l?l:r,v=i<u?u:i>s?s:i;return new f.Point(d,v)}(e,t);if(e.center.equals(r))return n();var i=10;requestAnimationFrame((function t(){var o=e.center.subtract(r);e.translate(o.divide(i)),--i>0?requestAnimationFrame(t):requestAnimationFrame((function(){return n()}))}))}))},L=function(e,t){var n=function(e){return!(4!==t.segments.length||!e.isInside(t.bounds))||!e.subtract(t,{insert:!1,trace:!1}).compare(e)};return e.filter((function(e){if(!e.name)return!1;if(!e.bounds.intersects(t.bounds))return!1;if(e instanceof v().Path)return n(e);var r=new f.Path.Rectangle(e.bounds);return r.remove(),n(r)||t.isInside(e.bounds)})).map((function(e){return e.name}))},V=function(e,t){var n=t.lineWidth,r=t.color,i=t.highlight;e.forEach((function(e){if(e instanceof v().PointText&&r){var t=new f.Color(r);e.fillColor=t}if(e instanceof v().Path){if(r){var o=new f.Color(r);"multiply"===e.blendMode&&(o.alpha=.5),e.strokeColor=o}n&&(e.strokeWidth=n),e.strokeColor&&void 0!==i&&(e.strokeColor.alpha=i?.5:1,e.blendMode=i?"multiply":"normal")}}))},z=function(e,t){var n=e.hitTest(t,{class:v().PointText,fill:!0});if((null===n||void 0===n?void 0:n.item)instanceof v().PointText)return null===n||void 0===n?void 0:n.item},F=function(e){return new(v().PointText)({point:e.add(new f.Point(0,50)),content:"Insert text...",fontSize:50,justification:"center",fillColor:"#1890ff55"})},O=function e(t){return t instanceof v().Path?t.isEmpty()?[]:[t]:t instanceof v().CompoundPath?t.children.map(e).flat():[]},B=n(36485),J=n(61507),q=n(23414),I=n(64239),U=n(82622),K=n(72785),Y=n(22925),H=n(4720),Q=n(41275),X=n(27190),G=n(69228),_=n(87309),$=n(87501),ee=n(2721),te=n(66023),ne=n(74115),re=n(64802),ie={type:"text",shape:"round",size:"small"},oe=function(e){var t=e.drawRef,n=e.visible,r=e.clickPoint,o=(0,u.useState)({}),a=(0,i.Z)(o,2),c=a[0],l=a[1],d=r.x,f=r.y;return(0,Z.jsxs)("div",{className:"select-tool","data-visible":n,style:{"--pos-x":d+"px","--pos-y":f+"px"},children:[(0,Z.jsx)(G.Z,{trigger:"click",placement:"bottom",overlayClassName:"style-pop",getPopupContainer:function(e){return e.parentElement},destroyTooltipOnHide:!0,content:(0,Z.jsx)(ee.Uk,{updateDrawCtrl:function(e){var n;l((function(t){return(0,s.Z)((0,s.Z)({},t),e)})),null===(n=t.current)||void 0===n||n.mutateStyle(e)},drawCtrl:c}),children:(0,Z.jsx)(_.Z,(0,s.Z)({icon:(0,Z.jsx)(J.Z,{})},ie))}),(0,Z.jsx)(_.Z,(0,s.Z)({icon:(0,Z.jsx)(q.Z,{}),onClick:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.duplicateSelected()}},ie)),(0,Z.jsx)(_.Z,(0,s.Z)({icon:(0,Z.jsx)(I.Z,{}),onClick:function(){if(t.current){var e=t.current.rasterizeSelected();X.Z.confirm({title:"Screenshot",content:(0,Z.jsx)("img",{className:"raster",src:e,alt:"raster"}),className:"raster-modal",icon:(0,Z.jsx)(B.Z,{}),okText:"Save",onOk:function(){return(0,re.saveAs)(e,document.title.split(" - ")[0]+".png")}})}}},ie)),(0,Z.jsx)(_.Z,(0,s.Z)({danger:!0,icon:(0,Z.jsx)(U.Z,{}),onClick:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.deleteSelected()}},ie))]})},ae=function(e){var t=e.visible,n=e.drawRef,r=e.pointText,o=(0,u.useState)(""),a=(0,i.Z)(o,2),c=a[0],l=a[1],s=(0,u.useState)(ne.Qk[0]),d=(0,i.Z)(s,2),f=d[0],v=d[1],h=(0,u.useState)("center"),p=(0,i.Z)(h,2),m=p[0],w=p[1];(0,u.useEffect)((function(){if(r){var e,t=r.name,n=r.content,i=r.justification,o=r.fillColor;if(w(i),t)l(n),v(null!==(e=null===o||void 0===o?void 0:o.toCSS(!0))&&void 0!==e?e:ne.Qk[0]);else l(""),v(ne.Qk[0])}}),[r]);var g=(0,Z.jsx)(G.Z,{content:(0,Z.jsx)(ee.Q5,{color:f,setColor:v}),overlayStyle:{width:200},placement:"bottom",getPopupContainer:function(e){return e.parentElement},children:(0,Z.jsx)(_.Z,{size:"small",icon:(0,Z.jsx)(K.Z,{className:"font-icon",style:{color:f}})})}),x=(0,Z.jsx)($.ZP.Group,{size:"small",optionType:"button",value:m,buttonStyle:"solid",onChange:function(e){return w(e.target.value)},options:[{label:(0,Z.jsx)(Y.Z,{}),value:"left"},{label:(0,Z.jsx)(H.Z,{}),value:"center"},{label:(0,Z.jsx)(Q.Z,{}),value:"right"}]});return(0,Z.jsxs)(X.Z,{visible:t,title:"Insert text",onCancel:function(){var e;return null===(e=n.current)||void 0===e?void 0:e.cancelText()},onOk:function(){var e,t,r=c.trim();if(!r)return null===(e=n.current)||void 0===e?void 0:e.cancelText();null===(t=n.current)||void 0===t||t.submitText(r,f,m)},bodyStyle:{paddingTop:0},destroyOnClose:!0,children:[(0,Z.jsxs)("div",{className:"insert-option",children:[g,x]}),(0,Z.jsx)(te.Z,{size:"large",rows:3,autoFocus:!0,value:c,onChange:function(e){return l(e.target.value)}})]})},ue=n(763),ce=n(19348),le=n(24124),se=function(e){var t=e.thumbnail,o=e.drawState,c=e.teamStateMap,l=e.updateState,s=e.pdfIndex,d=e.noteID,f=void 0===d?"":d,v=e.preview,h=void 0!==v&&v,p=e.onViewChange,m=e.preload,w=void 0!==m&&m,g=e.ignores,x=void 0===g?(0,le.l4)():g,b=e.skipInView,C=void 0!==b&&b,S=p&&(0,ue.range)(0,1.2,.2),y=(0,ce.YD)({threshold:S,skip:C}),j=(0,i.Z)(y,3),k=j[0],A=j[1],E=j[2];(0,u.useEffect)((function(){if(p)return E&&A?void p(E.intersectionRatio):p(0)}),[A,E,p]);var R=(0,u.useState)(),D=(0,i.Z)(R,2),T=D[0],P=D[1],M=(0,u.useCallback)((0,ue.once)((0,r.Z)(a().mark((function e(){var t,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s&&f){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,Promise.all([n.e(643),n.e(138)]).then(n.bind(n,21176));case 4:return t=e.sent,r=t.getNotePageImage,e.t0=P,e.next=9,r(f,s);case 9:e.t1=e.sent,(0,e.t0)(e.t1);case 11:case"end":return e.stop()}}),e)})))),[s,f]),N=A||w;(0,u.useEffect)((function(){!h&&N&&M()}),[N,h,M]);var W=(0,u.useMemo)((function(){return null===c||void 0===c?void 0:c.deleteAll(x).toList().toArray()}),[c,x]),L=Boolean(T||!s),V=N&&L,z=o.height/o.width;return(0,Z.jsxs)("div",{ref:k,className:"page-wrapper",children:[(0,Z.jsx)("svg",{className:"size-holder",viewBox:"0 0 100 ".concat(100*z)}),V&&(0,Z.jsx)(fe,{drawState:o,otherStates:W,updateState:l,imgSrc:T||t,preview:h})]})};se.displayName="PageWrapper";var de=u.memo(se),fe=function(e){var t=e.drawState,n=e.updateState,r=e.otherStates,o=e.preview,a=void 0!==o&&o,s=e.imgSrc,d=(0,c.gX)(),f=(0,u.useRef)(null),v=(0,u.useState)(!1),h=(0,i.Z)(v,2),p=h[0],w=h[1],g=(0,u.useState)(!1),x=(0,i.Z)(g,2),b=x[0],C=x[1],S=(0,u.useState)(),y=(0,i.Z)(S,2),k=y[0],E=y[1],R=(0,u.useState)(j),D=(0,i.Z)(R,2),T=D[0],P=D[1],M=(0,l.Z)((function(e){if(n){var r=e instanceof m.Dw?e:e(t);r!==t&&n(r)}})),N=(0,u.useCallback)((function(e,t){P((function(e){return null!==t&&void 0!==t?t:e})),C(e)}),[]),W=(0,u.useCallback)((function(e,t){E(t),w(e)}),[]);return a?(0,Z.jsx)(A,{drawState:t,otherStates:r,imgSrc:s,readonly:!0}):(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(A,{drawState:t,otherStates:r,onChange:M,imgSrc:s,drawCtrl:d,ref:f,toggleTextTool:W,toggleSelectTool:N}),(0,Z.jsx)(oe,{drawRef:f,visible:b,clickPoint:T}),(0,Z.jsx)(ae,{drawRef:f,visible:p,pointText:k})]})};fe.displayName="DrawWrapper";var ve=de},11886:function(e,t,n){"use strict";n.d(t,{Eq:function(){return f},F7:function(){return g},Hq:function(){return v},gX:function(){return w},w3:function(){return x}});var r=n(1413),i=n(29439),o=n(15861),a=n(87757),u=n.n(a),c=n(61842),l=n.n(c),s=n(72791),d=n(80184),f=[10,20,30,50],v={mode:"draw",finger:!0,lineWidth:10,eraserWidth:10,color:"#000000",highlight:!1,lasso:!0,pixelEraser:!1,widthList:f};function h(){return(h=(0,o.Z)(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l().getItem("DRAW_CTRL");case 2:if(t=e.sent){e.next=7;break}return t=v,e.next=7,l().setItem("DRAW_CTRL",t);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(){return(p=(0,o.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l().setItem("DRAW_CTRL",t);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var m=s.createContext({drawCtrl:v,updateDrawCtrl:function(){}});function w(){var e=(0,s.useContext)(m).drawCtrl;return(0,s.useDebugValue)(e),e}function g(){return(0,s.useContext)(m).updateDrawCtrl}var x=function(e){var t=e.children,n=(0,s.useState)(v),o=(0,i.Z)(n,2),a=o[0],u=o[1];(0,s.useEffect)((function(){(function(){return h.apply(this,arguments)})().then(u)}),[]);return(0,d.jsx)(m.Provider,{value:{drawCtrl:a,updateDrawCtrl:function(e){u((function(t){var n=(0,r.Z)((0,r.Z)({},t),e);return function(e){p.apply(this,arguments)}(n),n}))}},children:t})}},96153:function(e,t,n){"use strict";function r(e,t){var n=document.createElement("canvas"),r=n.getContext("2d");if(!r)throw new Error("can't get virtual canvas context");return n.width=e,n.height=t,{canvas:n,context:r}}function i(e){e.width=1,e.height=1;var t=e.getContext("2d");null===t||void 0===t||t.clearRect(0,0,1,1)}n.d(t,{j:function(){return i},v:function(){return r}})},2721:function(e,t,n){"use strict";n.d(t,{Q5:function(){return b},Uk:function(){return w},Db:function(){return g}});var r=n(4942),i=n(93433),o=n(29439),a=n(72791),u=n(11886),c=n(35873),l=n(82670),s=n(69228),d=n(96272),f=n(53163),v=n(74115),h=n(22568),p=n(24124),m=n(80184),w=function(e){var t=e.updateDrawCtrl,n=e.drawCtrl,r=n.highlight,i=n.color,u=(0,a.useState)(!1),c=(0,o.Z)(u,2),l=c[0],s=c[1];return(0,m.jsxs)("div",{className:"pen-panel","data-blur":l,"data-hi":r,children:[(0,m.jsxs)("div",{className:"pen-status",children:[(0,m.jsx)(g,{updateDrawCtrl:t,drawCtrl:n,setPanelBlur:s}),(0,m.jsx)(x,{checked:r,updateDrawCtrl:t})]}),(0,m.jsx)(b,{color:i||"",setColor:function(e){return t({color:e})}})]})},g=function(e){var t,n,v=e.updateDrawCtrl,h=e.drawCtrl,w=e.setPanelBlur,g=void 0===w?function(){}:w,x=e.field,b=void 0===x?"lineWidth":x,C=h[b],S=null!==(t=h.widthList)&&void 0!==t?t:u.Eq,y="lineWidth"===b&&null!==(n=h.color)&&void 0!==n?n:"#aaa",Z=(0,a.useMemo)((function(){return S.indexOf(null!==C&&void 0!==C?C:-1)}),[C,S]),j=(0,a.useState)((0,p.aV)([!1,!1,!1,!1])),k=(0,o.Z)(j,2),A=k[0],E=k[1];(0,a.useEffect)((function(){A.includes(!0)?g(!0):g(!1)}),[A,g]);var R=function(e){return{"--real-size":"calc(".concat(100/l.mF,"vw * ").concat(e,")")}},D=[{value:-1,label:null}].concat((0,i.Z)(S.map((function(e,t){return{value:t,label:(0,m.jsx)(s.Z,{visible:A.get(t),onVisibleChange:function(e){return E((function(n){return n.set(t,e)}))},trigger:Z===t?["click"]:[],placement:"bottom",destroyTooltipOnHide:!0,content:(0,m.jsx)(d.Z,{min:5,max:100,className:"ctrl-slider",defaultValue:e,onAfterChange:function(e){if(S.includes(e))return E((function(e){return e.set(t,!1)})),v((0,r.Z)({},b,e));var n=S.slice();n[t]=e,v((0,r.Z)({widthList:n},b,e))}}),children:(0,m.jsx)("div",{className:"circle-wrapper",style:R(e),children:(0,m.jsx)(c.W,{className:"width-circle "+b,color:y})})})}}))));return(0,m.jsx)(f.Z,{className:"width-seg",value:Z,options:D,onChange:function(e){var t;return v((0,r.Z)({},b,null!==(t=S[+e])&&void 0!==t?t:10))}})},x=function(e){var t=e.checked,n=void 0!==t&&t,r=e.updateDrawCtrl;return(0,m.jsxs)("label",{className:"hi-wrapper",children:[(0,m.jsx)("input",{type:"checkbox",name:"highlight",checked:n,onChange:function(e){return r({highlight:e.target.checked})}}),(0,m.jsx)("div",{className:"hi-switch",children:(0,m.jsx)(h.Z,{type:"icon-Highlight"})})]})},b=function(e){var t=e.setColor,n=e.color;return(0,m.jsx)("div",{className:"color-select",children:v.Qk.map((function(e){return(0,m.jsxs)("label",{children:[(0,m.jsx)("input",{checked:n===e,type:"radio",name:"color",onChange:function(n){return n.target.checked&&t(e)}}),(0,m.jsx)("div",{"data-color":e,className:"circle",style:{backgroundColor:e,borderColor:e}})]},e)}))})}},90858:function(){},64158:function(){}}]);
//# sourceMappingURL=478.24977bb6.chunk.js.map