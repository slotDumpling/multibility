(this.webpackJsonpmultibility=this.webpackJsonpmultibility||[]).push([[0],{186:function(e,t){},263:function(e,t,n){},264:function(e,t,n){},270:function(e,t){},271:function(e,t){},272:function(e,t){},273:function(e,t){},274:function(e,t){},293:function(e,t,n){},295:function(e,t,n){},480:function(e,t){},482:function(e,t){},483:function(e,t,n){},484:function(e,t,n){},510:function(e,t,n){},511:function(e,t,n){},512:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(34),u=n.n(c),s=(n(263),n(80)),i=n(24),o=n(11),l=n.n(o),d=n(22),j=n(13),b=(n(264),n(62)),f=n(134),p=n(135),O=n(35),h=n(51),m={state:"drawing",strokes:Object(O.a)(),uidStack:Object(O.a)(),undoStack:Object(O.c)(),eraseStack:Object(O.a)(),deleted:Object(O.e)()},v=Object(O.d)(m),x={strokes:[]},g=function(){function e(t,n,r,a){Object(f.a)(this,e),this.immutable=t,this.width=n,this.height=r,this.lastOp=a}return Object(p.a)(e,[{key:"getImmutable",value:function(){return this.immutable}},{key:"getUidStack",value:function(){return this.getImmutable().get("uidStack")}},{key:"getUndoStack",value:function(){return this.getImmutable().get("undoStack")}},{key:"getEraseStack",value:function(){return this.getImmutable().get("eraseStack")}},{key:"getValidEraseStack",value:function(){var e=this.getDeleted(),t=this.getUndoStack();return this.getEraseStack().filter((function(n){var r=n.uid;return!e.has(r)&&!t.has(r)}))}},{key:"getStrokes",value:function(){return this.getImmutable().get("strokes")}},{key:"getValidStrokes",value:function(){var e=this.getDeleted(),t=this.getUndoStack(),n=this.getValidEraseStack();return this.getStrokes().filter((function(r){var a=r.uid;return!e.has(a)&&!t.has(a)&&!n.some((function(e){return e.erased.has(a)}))}))}},{key:"getDeleted",value:function(){return this.getImmutable().get("deleted")}},{key:"getState",value:function(){return this.getImmutable().get("state")}},{key:"getLastStroke",value:function(){return this.getImmutable().get("strokes").last()}}],[{key:"createEmpty",value:function(t,n){return new e(v(),t,n)}},{key:"undo",value:function(t){var n=t.getUidStack().last();if(!n)return t;var r={type:"undo",undoUid:n};return new e(t.getImmutable().set("state","revoking").update("undoStack",(function(e){return e.add(n)})).update("uidStack",(function(e){return e.pop()})),t.width,t.height,r)}},{key:"redo",value:function(t){var n=t.getUndoStack().last();if(!n)return t;var r={type:"redo",redoUid:n};return new e(t.getImmutable().update("undoStack",(function(e){return e.butLast()})).update("uidStack",(function(e){return e.push(n)})),t.width,t.height,r)}},{key:"addStroke",value:function(t,n,r,a){var c={uid:Object(h.v4)(),pathData:n,color:a,lineWidth:r};return e.pushStroke(t,c)}},{key:"pushStroke",value:function(t,n){var r=t.getUndoStack(),a=k(t.getImmutable().set("state","drawing").update("deleted",(function(e){return e.concat(r)})).set("undoStack",Object(O.c)()).update("strokes",(function(e){return e.push(n)})).update("uidStack",(function(e){return e.push(n.uid)}))),c={type:"add",stroke:n};return new e(a,t.width,t.height,c)}},{key:"eraseStrokes",value:function(t,n){var r={uid:Object(h.v4)(),erased:n};return e.pushErase(t,r)}},{key:"pushErase",value:function(t,n){var r=n.uid,a=n.erased,c={uid:r,erased:Object(O.e)(a)},u={type:"erase",erase:n};return new e(t.getImmutable().update("eraseStack",(function(e){return e.push(c)})).update("uidStack",(function(e){return e.push(r)})),t.width,t.height,u)}},{key:"pushUndo",value:function(t,n){return new e(t.getImmutable().update("undoStack",(function(e){return e.add(n)})),t.width,t.height)}},{key:"pushRedo",value:function(t,n){return new e(t.getImmutable().update("undoStack",(function(e){return e.delete(n)})),t.width,t.height)}},{key:"flaten",value:function(e){var t=k(e.getImmutable()),n=t.get("deleted"),r=e.getValidEraseStack().reduce((function(e,t){return e.concat(t.erased)}),Object(O.e)()),a=n.concat(r);return{strokes:t.get("strokes").filter((function(e){return!a.has(e.uid)})).toArray()}}},{key:"loadFromFlat",value:function(t,n,r){var a=t.strokes;return new e(v().set("strokes",Object(O.a)(a)),n,r)}}]),e}();function k(e){var t=e.get("undoStack");return e.update("deleted",(function(e){return e.concat(t)})).set("undoStack",Object(O.c)()).update("uidStack",(function(e){return e.filter((function(e){return!t.has(e)}))}))}function y(){return{uid:Object(h.v4)(),name:"New note ".concat(Date.now()),tagId:"DEFAULT",team:!1,withImg:!1,pages:Object(b.a)({},Object(h.v4)(),{ratio:1.5,state:x})}}var S=n(155),w=n(25),I=n(40),C=n.n(I),N=function(){var e;return function(){if(e)return e;var t=localStorage.getItem("user_id");return t||(t=Object(h.v4)(),localStorage.setItem("user_id",t)),e=t,t}}(),E=function(){var e=localStorage.getItem("USER_NAME");return e||(e="User_"+Object(h.v4)().slice(0,8),localStorage.setItem("USER_NAME",e)),e},L=["#000000","#9ca3af","#64748b","#78716c","#f97316","#eab308","#84cc16","#22c55e","#10b981","#14b8a6","#06b6d4","#0ea5e9","#3b82f6","#6366f1","#8b5cf6","#a855f7","#d946ef","#ec4899","#f43f5e","#ef4444"],T=function(){var e=Math.floor(Math.random()*L.length);return L[e]};function U(){return A.apply(this,arguments)}function A(){return(A=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.a.getItem("ALL_NOTES");case 2:if(!(t=e.sent)){e.next=7;break}return e.abrupt("return",t);case 7:return C.a.setItem("ALL_NOTES",{}),e.abrupt("return",{});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(){return R.apply(this,arguments)}function R(){return(R=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.a.getItem("ALL_TAGS");case 2:if(!(t=e.sent)){e.next=7;break}return e.abrupt("return",t);case 7:return C.a.setItem("ALL_TAGS",{}),e.abrupt("return",{});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e){return P.apply(this,arguments)}function P(){return(P=Object(d.a)(l.a.mark((function e(t){var n,r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(h.v4)(),r={uid:n,name:t,color:T(),notes:[]},e.t0=w.a,e.t1=w.a,e.t2={},e.next=7,D();case 7:return e.t3=e.sent,e.t4=(0,e.t1)(e.t2,e.t3),e.t5={},e.t6=Object(b.a)({},n,r),a=(0,e.t0)(e.t4,e.t5,e.t6),e.next=14,C.a.setItem("ALL_TAGS",a);case 14:return e.abrupt("return",a);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return _.apply(this,arguments)}function _(){return(_=Object(d.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D();case 2:return delete(n=e.sent)[t],e.next=6,C.a.setItem("ALL_TAGS",n);case 6:return e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(e){return G.apply(this,arguments)}function G(){return(G=Object(d.a)(l.a.mark((function e(t){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D();case 2:return n=e.sent,(r=n[t.uid]).name=t.name,r.color=t.color,r.notes=t.notes,e.next=9,C.a.setItem("ALL_TAGS",n);case 9:return e.abrupt("return",n);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e){return B.apply(this,arguments)}function B(){return(B=Object(d.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.a.getItem(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e,t){return K.apply(this,arguments)}function K(){return(K=Object(d.a)(l.a.mark((function e(t,n){var r,a,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U();case 2:return r=e.sent,n.pages,n.pdf,a=Object(S.a)(n,["pages","pdf"]),r[t]=Object(w.a)(Object(w.a)({},r[t]),a),e.next=7,C.a.setItem("ALL_NOTES",r);case 7:return e.next=9,z(t);case 9:if(c=e.sent){e.next=12;break}return e.abrupt("return");case 12:return e.next=14,C.a.setItem(t,Object(w.a)(Object(w.a)({},c),n));case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e){return J.apply(this,arguments)}function J(){return(J=Object(d.a)(l.a.mark((function e(t){var n,r,a,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.uid,r=t.tagId,e.next=3,U();case 3:return(a=e.sent)[n]=t,e.next=7,C.a.setItem("ALL_NOTES",a);case 7:return e.next=9,D();case 9:if(c=e.sent,"DEFAULT"===r){e.next=14;break}return c[r].notes.push(t.uid),e.next=14,C.a.setItem("ALL_TAGS",c);case 14:return e.abrupt("return",{tags:c,allNotes:a});case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(e){return q.apply(this,arguments)}function q(){return(q=Object(d.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.a.setItem(t.uid,t);case 2:return t.pdf,t.pages,n=Object(S.a)(t,["pdf","pages"]),e.next=5,H(n);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(e){return Q.apply(this,arguments)}function Q(){return(Q=Object(d.a)(l.a.mark((function e(t){var n,r,a,c,u,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z(t);case 2:return n=e.sent,e.next=5,U();case 5:return r=e.sent,e.next=8,D();case 8:if(a=e.sent,n){e.next=11;break}return e.abrupt("return",{tags:a,allNotes:r});case 11:return e.next=13,C.a.removeItem(t);case 13:return n.pdf,n.pages,c=Object(S.a)(n,["pdf","pages"]),delete r[t],e.next=17,C.a.setItem("ALL_NOTES",r);case 17:if("DEFAULT"===(u=c.tagId)){e.next=23;break}return s=a[u].notes,a[u].notes=s.filter((function(e){return e!==t})),e.next=23,C.a.setItem("ALL_TAGS",a);case 23:return e.abrupt("return",{tags:a,allNotes:r});case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function X(e,t){return Z.apply(this,arguments)}function Z(){return(Z=Object(d.a)(l.a.mark((function e(t,n){var r,a,c,u,s,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z(t);case 2:return c=e.sent,e.next=5,U();case 5:return u=e.sent,e.next=8,D();case 8:if(s=e.sent,c){e.next=11;break}return e.abrupt("return",{tags:s,allNotes:u});case 11:return i=c.tagId,c.tagId=n,e.next=15,C.a.setItem(t,c);case 15:return u[t].tagId=n,e.next=18,C.a.setItem("ALL_NOTES",u);case 18:return i in s&&(s[i].notes=s[i].notes.filter((function(e){return e!==t}))),null===(r=s[n])||void 0===r||null===(a=r.notes)||void 0===a||a.push(t),e.next=22,C.a.setItem("ALL_TAGS",s);case 22:return e.abrupt("return",{tags:s,allNotes:u});case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ee(e){return te.apply(this,arguments)}function te(){return(te=Object(d.a)(l.a.mark((function e(t){var n,r,a,c,u,s,i,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n={},r=0,a=Object.entries(t);r<a.length;r++)c=Object(j.a)(a[r],2),u=c[0],s=c[1],i=s.ratio,delete(o=s.states)[N()],n[u]={ratio:i,state:{strokes:Object.values(o).flat(1)}};return e.abrupt("return",n);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ne(e,t,n){return re.apply(this,arguments)}function re(){return(re=Object(d.a)(l.a.mark((function e(t,n,r){var a,c,u,s,i,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z(t);case 2:if(!e.sent){for(a={},c=0,u=Object.entries(r);c<u.length;c++)s=Object(j.a)(u[c],2),i=s[0],o=s[1],a[i]=Object(w.a)(Object(w.a)({},o),{},{state:x});Y(Object(w.a)(Object(w.a)({},n),{},{tagId:"DEFAULT",team:!0,pages:a}))}case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ae=n(518),ce=n(65),ue=n(254),se=n(520),ie=n(517),oe=n(248),le=n(181),de=n(244),je=n.n(de);function be(e,t){var n=document.createElement("canvas"),r=n.getContext("2d");if(!r)throw new Error("can't get virtual canvas context");return n.width=e,n.height=t,{canvas:n,context:r}}function fe(e){return new Promise((function(t){e.toBlob(t)}))}function pe(e,t,n){return Oe.apply(this,arguments)}function Oe(){return(Oe=Object(d.a)(l.a.mark((function e(t,n,r){var a,c,u,s,i,o,d,j,b;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getPage(n);case 2:return a=e.sent,c=a.getViewport({scale:r}),console.log(c),u=c.height,s=c.width,i=u/s,o=be(Math.floor(s*r),Math.floor(u*r)),d=o.canvas,j=o.context,console.time("render"),e.next=11,a.render({canvasContext:j,viewport:c,transform:[r,0,0,r,0,0]}).promise;case 11:return console.timeEnd("render"),console.time("img"),e.next=15,fe(d);case 15:if(b=e.sent){e.next=18;break}throw new Error("can't get canvas image blob");case 18:return console.timeEnd("img"),e.abrupt("return",[b,i]);case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function he(e){return me.apply(this,arguments)}function me(){return(me=Object(d.a)(l.a.mark((function e(t){var n,r,a,c,u,s,i,o,d,b,f,p,O,h,m=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=m.length>1&&void 0!==m[1]?m[1]:2,r=m.length>2?m[2]:void 0,e.next=4,le.getDocument(t).promise;case 4:a=e.sent,c=a.numPages,u=[],s=[],i=1;case 9:if(!(i<=c)){e.next=22;break}return e.next=12,pe(a,i,n);case 12:o=e.sent,d=Object(j.a)(o,2),b=d[0],f=d[1],u.push(b),s.push(f),r&&r(Math.floor(i/c*100));case 19:i+=1,e.next=9;break;case 22:return e.next=24,pe(a,1,.5);case 24:return p=e.sent,O=Object(j.a)(p,1),h=O[0],e.abrupt("return",{images:u,ratios:s,thumbnail:h});case 28:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ve(e,t){return xe.apply(this,arguments)}function xe(){return(xe=Object(d.a)(l.a.mark((function e(t,n){var r,a,c,u,s,i,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=URL.createObjectURL(t),e.next=3,he(r,2,n);case 3:return a=e.sent,c=a.images,u=a.ratios,s=a.thumbnail,i={},c.forEach((function(e,t){i[Object(h.v4)()]={image:e,ratio:u[t],state:{strokes:[]}}})),o=t.name.replace(".pdf",""),e.abrupt("return",{uid:Object(h.v4)(),name:o,tagId:"DEFAULT",team:!1,withImg:!0,pdf:t,thumbnail:s,pages:i});case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}le.GlobalWorkerOptions.workerSrc=je.a;var ge=n(527),ke=n(528),ye=n(529),Se=n(530),we=n(531),Ie=n(532),Ce=n(77),Ne=n.n(Ce),Ee="https://api.slotdumpling.top/paint";function Le(e){return Te.apply(this,arguments)}function Te(){return(Te=Object(d.a)(l.a.mark((function e(t){var n,r,a,c,u,s,i,o,d,b,f,p,O;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Ne.a.get("code/".concat(t));case 3:if(n=e.sent,200!==(r=n.data).statusCode){e.next=24;break}if(c=(a=r).noteId,u=a.pageInfos,!(s=a.noteInfo).withImg){e.next=19;break}i=0,o=Object.entries(u);case 9:if(!(i<o.length)){e.next=19;break}return d=Object(j.a)(o[i],2),b=d[0],f=d[1],e.next=13,Ne()({method:"GET",url:b,responseType:"blob"});case 13:p=e.sent,O=p.data,f.image=O;case 16:i++,e.next=9;break;case 19:return e.next=21,ne(c,s,u);case 21:return e.abrupt("return",c);case 24:return e.abrupt("return",null);case 25:e.next=31;break;case 27:return e.prev=27,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 31:case"end":return e.stop()}}),e,null,[[0,27]])})))).apply(this,arguments)}function Ue(e,t,n){return Ae.apply(this,arguments)}function Ae(){return(Ae=Object(d.a)(l.a.mark((function e(t,n,r){var a,c,u,s,i,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.uid,c=n.name,u=n.withImg,s=n.pages,e.prev=1,e.next=4,Ne.a.put("create/".concat(t),{userId:N(),pageRecord:r,noteInfo:{uid:a,name:c,withImg:u}});case 4:if(i=e.sent,o=i.data,u&&Object.entries(s).forEach((function(e){var t=Object(j.a)(e,2),n=t[0],r=t[1].image;if(r){var a=new FormData;a.append("pageId",n),a.append("file",r),Ne()({method:"POST",url:"upload",data:a,headers:{"Content-Type":"multipart/form-data"}})}})),201!==o.statusCode){e.next=11;break}return e.abrupt("return",o.code);case 11:return e.abrupt("return",null);case 12:e.next=18;break;case 14:return e.prev=14,e.t0=e.catch(1),console.error(e.t0),e.abrupt("return",null);case 18:case"end":return e.stop()}}),e,null,[[1,14]])})))).apply(this,arguments)}function De(e,t){return Re.apply(this,arguments)}function Re(){return(Re=Object(d.a)(l.a.mark((function e(t,n){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Ne.a.put("pages/".concat(t),{userId:N(),pageRecord:n});case 3:if(r=e.sent,201!==r.data.statusCode){e.next=9;break}return e.abrupt("return",!0);case 9:return e.abrupt("return",!1);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,null,[[0,12]])})))).apply(this,arguments)}function Fe(e){return Pe.apply(this,arguments)}function Pe(){return(Pe=Object(d.a)(l.a.mark((function e(t){var n,r,a,c,u,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Ne.a.get("room/".concat(t));case 3:if(n=e.sent,200!==(r=n.data).statusCode){e.next=13;break}return a=r.teamPages,c=r.code,u=r.noteInfo,e.next=9,ee(a);case 9:return s=e.sent,e.abrupt("return",{code:c,pages:s,info:u});case 13:return e.abrupt("return",null);case 14:e.next=20;break;case 16:return e.prev=16,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 20:case"end":return e.stop()}}),e,null,[[0,16]])})))).apply(this,arguments)}Ne.a.defaults.baseURL=Ee,Ne.a.interceptors.request.use((function(e){return console.log(e.method,e.url),e}));n(293);var Me=n(3);function _e(e){var t=e.value,n=void 0===t?0:t,a=e.digitNum,c=void 0===a?4:a,u=e.onChange,s=void 0===u?function(){}:u,i=e.onSubmit;function o(e){return 0===e?new Array(c).fill(""):String(e).slice(0,c).padEnd(c,"x").split("").map((function(e){return"x"===e?"":e}))}var l=Object(r.useState)(0),d=Object(j.a)(l,2),b=d[0],f=d[1],p=Object(r.useState)(o(n)),O=Object(j.a)(p,2),h=O[0],m=O[1];function v(){-1===b?x.current.forEach((function(e){return e.blur()})):x.current[b].focus()}Object(r.useEffect)((function(){var e=o(n);m(e)}),[n]),Object(r.useEffect)((function(){var e=h.findIndex((function(e){return""===e}));f(e);var t=Number(h.join(""));t!==n&&(s(t),-1===e&&i(t))}),[h]),Object(r.useEffect)((function(){v()}),[b]);var x=Object(r.useRef)([]);function g(e){if("Backspace"===e.key){var t=Math.max(0,b-1);f(t),m((function(e){var n=e.slice();return n[t]="",n}))}}return Object(r.useEffect)((function(){x.current=x.current.slice(0,c)}),[c]),Object(Me.jsxs)("div",{className:"digit-input",children:[h.map((function(e,t){return Object(Me.jsx)("input",{ref:function(e){e&&(x.current[t]=e)},value:e,pattern:"\\d*",onChange:function(e){return function(e,t){/^[0-9]$/.test(e)&&m((function(n){var r=n.slice();return r[t]=e,r}))}(e.target.value,t)},onKeyUp:g},t)})),Object(Me.jsx)("div",{className:"click-area",onClick:v})]})}var We=n(519),Ge=(n(295),n(144)),ze=n.n(Ge),Be=n(177),Ve=n.n(Be),Ke=Object(r.createContext)({setActive:function(){}});function He(){return Object(Me.jsxs)("div",{id:"right-tools",children:[Object(Me.jsx)(Ze,{}),Object(Me.jsx)(Xe,{})]})}var Je=function(){var e=Object(r.useContext)(Ke).setActive,t=ae.a.Item;return Object(Me.jsxs)(ae.a,{onClick:function(t){var n=t.key;return e(n)},children:[Object(Me.jsxs)(t,{children:[Object(Me.jsx)(ge.a,{}),Object(Me.jsx)("span",{children:"Load PDF"})]},"pdf"),Object(Me.jsxs)(t,{children:[Object(Me.jsx)(ke.a,{}),Object(Me.jsx)("span",{children:"My profile"})]},"profile")]})},Ye=function(e){var t=e.children,n=e.title,a=Object(r.useContext)(Ke).setActive;return Object(Me.jsxs)("div",{className:"secondary",children:[Object(Me.jsxs)("div",{className:"title",children:[Object(Me.jsx)(ce.a,{type:"text",shape:"circle",onClick:function(){return a("menu")},icon:Object(Me.jsx)(ye.a,{})}),Object(Me.jsx)(ze.a,{level:5,children:n})]}),t]})};function qe(){var e=Object(r.useState)(!1),t=Object(j.a)(e,2),n=t[0],a=t[1],c=Object(r.useContext)(It).tagUid,u=Object(r.useContext)(Ct),s=u.setAllTags,i=u.setAllNotes,o=Object(r.useState)(0),b=Object(j.a)(o,2),f=b[0],p=b[1];function O(){return(O=Object(d.a)(l.a.mark((function e(t){var n,r,u,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("application/pdf"===t.type){e.next=2;break}return e.abrupt("return");case 2:return a(!0),e.next=5,ve(t,p);case 5:return(n=e.sent).tagId=c,e.next=9,Y(n);case 9:return r=e.sent,u=r.tags,o=r.allNotes,s(u),i(o),a(!1),ue.b.success("PDF Loaded"),e.abrupt("return",!1);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(Me.jsx)(Ye,{title:"Load PDF",children:Object(Me.jsxs)(Ve.a,{disabled:n,multiple:!1,action:"#",accept:"application/pdf",beforeUpload:function(e){return O.apply(this,arguments)},children:[Object(Me.jsx)("p",{className:"ant-upload-drag-icon",children:n?Object(Me.jsx)(se.a,{width:48,type:"circle",percent:f}):Object(Me.jsx)(Se.a,{})}),Object(Me.jsx)("p",{className:"ant-upload-hint",children:"Click or drag a pdf file here."})]})})}var $e=function(){var e=E(),t=Object(r.useState)(e),n=Object(j.a)(t,2),a=n[0],c=n[1];return Object(Me.jsx)(Ye,{title:"My profile",children:Object(Me.jsxs)("div",{className:"profile-page",children:[Object(Me.jsx)(ie.a,{prefix:Object(Me.jsx)(ke.a,{}),value:a,onChange:function(e){return c(e.target.value)}}),Object(Me.jsx)(ce.a,{onClick:function(){!function(e){!!(e=e.trim())&&localStorage.setItem("USER_NAME",e)}(a)},type:"primary",block:!0,children:"Enter"})]})})},Qe=function(){var e=Object(r.useState)(100),t=Object(j.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)("menu"),u=Object(j.a)(c,2),s=u[0],i=u[1],o={timeout:300,onEnter:function(e){a(e.clientHeight)},unmountOnExit:!0},l=Object(w.a)(Object(w.a)({},o),{},{classNames:"secondary"});return Object(Me.jsx)(Ke.Provider,{value:{setActive:i},children:Object(Me.jsxs)("section",{className:"others-menu",style:{height:n},children:[Object(Me.jsx)(We.a,Object(w.a)(Object(w.a)({classNames:"primary",in:"menu"===s},o),{},{children:Object(Me.jsx)(Je,{})})),Object(Me.jsx)(We.a,Object(w.a)(Object(w.a)({in:"pdf"===s},l),{},{children:Object(Me.jsx)(qe,{})})),Object(Me.jsx)(We.a,Object(w.a)(Object(w.a)({in:"profile"===s},l),{},{children:Object(Me.jsx)($e,{})}))]})})},Xe=function(){return Object(Me.jsx)(oe.a,{placement:"bottomRight",trigger:"click",content:Object(Me.jsx)(Qe,{}),children:Object(Me.jsx)(ce.a,{shape:"circle",icon:Object(Me.jsx)(we.a,{})})})};function Ze(){var e=Object(r.useState)(0),t=Object(j.a)(e,2),n=t[0],a=t[1],c=Object(i.f)();function u(){return(u=Object(d.a)(l.a.mark((function e(t){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=ue.b.loading("Loading team note...",0),e.next=3,Le(t);case 3:r=e.sent,n(),r?c("/team/".concat(r)):(a(0),ue.b.error("Room doesn't exist."));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(Me.jsx)(oe.a,{placement:"bottomRight",trigger:"click",title:"Join a team note",destroyTooltipOnHide:!0,content:Object(Me.jsx)(_e,{value:n,onChange:a,onSubmit:function(e){return u.apply(this,arguments)}}),children:Object(Me.jsx)(ce.a,{shape:"round",icon:Object(Me.jsx)(Ie.a,{}),children:"Team"})})}function et(){var e=Object(r.useContext)(It).editing,t=Object(r.useContext)(Ct).setEditing;return Object(Me.jsx)("div",{className:"left-tools",children:Object(Me.jsx)(ce.a,{onClick:function(){t((function(e){return!e}))},type:e?"primary":"text",block:!0,children:e?"Done":"Edit"})})}var tt=n(522),nt=n(523),rt=n(533),at=n(152),ct=n(86),ut=n(534),st=n(535),it=n(536),ot=n(537),lt=n(538),dt=n(250),jt=n.n(dt),bt=function(e){var t={backgroundColor:e.color};return Object(Me.jsx)("div",{className:"tag-circle",style:t})};function ft(e){var t=e.noteTag,n=t.uid,a=t.color,c=t.name,u=t.notes,s=Object(r.useContext)(It).editing,i=Object(r.useContext)(Ct),o=i.setTagUid,b=i.setAllTags,f=Object(r.useState)(!1),p=Object(j.a)(f,2),O=p[0],h=p[1],m=Object(r.useState)(c),v=Object(j.a)(m,2),x=v[0],g=v[1],k=Object(r.useState)(a),y=Object(j.a)(k,2),S=y[0],w=y[1];function I(){return(I=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M(n);case 2:t=e.sent,o("DEFAULT"),b(t);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(){return(C=Object(d.a)(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={uid:n,name:x,color:S,notes:u},e.next=3,W(t);case 3:r=e.sent,b(r),h(!1);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var N=Object(Me.jsx)(tt.a,{value:S,onSelect:w,children:L.map((function(e){return Object(Me.jsx)(tt.a.Option,{value:e,children:Object(Me.jsx)(bt,{color:e})},e)}))}),E=function(){return Object(Me.jsx)(ie.a,{className:"tag-name-input",addonBefore:N,value:x,onChange:function(e){return g(e.target.value)}})};return Object(Me.jsxs)("div",{className:"menu-item",children:[s&&O?Object(Me.jsxs)(Me.Fragment,{children:[Object(Me.jsx)(nt.a,{title:"Delete this tag?",onConfirm:function(){return I.apply(this,arguments)},placement:"left",okText:"Yes",cancelText:"No",children:Object(Me.jsx)(ce.a,{type:"text",danger:!0,size:"small",icon:Object(Me.jsx)(rt.a,{})})}),Object(Me.jsx)(E,{})]}):Object(Me.jsxs)(Me.Fragment,{children:[Object(Me.jsx)(bt,{color:S}),Object(Me.jsx)("span",{className:"tag-name",children:x})]}),s&&O&&Object(Me.jsxs)(Me.Fragment,{children:[Object(Me.jsx)(ce.a,{disabled:""===x,size:"small",type:"link",onClick:function(){return C.apply(this,arguments)},icon:Object(Me.jsx)(at.a,{})}),Object(Me.jsx)(ce.a,{size:"small",type:"text",onClick:function(){g(c),w(a),h(!1)},icon:Object(Me.jsx)(ct.a,{})})]}),s&&!O&&Object(Me.jsx)(ce.a,{size:"small",type:"text",onClick:function(){return h(!0)},icon:Object(Me.jsx)(ut.a,{})})]})}var pt=function(){var e=Object(r.useContext)(Ct).setAllTags;function t(){return(t=Object(d.a)(l.a.mark((function t(n){var r,a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.trim()){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,F(r);case 7:a=t.sent,e(a);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var n=Object(Me.jsx)(jt.a,{placeholder:"Tag name...",onSearch:function(e){return t.apply(this,arguments)},allowClear:!0,enterButton:Object(Me.jsx)(st.a,{})});return Object(Me.jsx)("div",{id:"add-tag",children:Object(Me.jsx)(oe.a,{content:n,trigger:"click",placement:"topLeft",destroyTooltipOnHide:!0,children:Object(Me.jsx)(ce.a,{shape:"circle",type:"text",icon:Object(Me.jsx)(it.a,{})})})})};function Ot(){var e=Object(r.useContext)(It).allTags,t=Object(r.useContext)(Ct).setTagUid;var n=ae.a.Item;return Object(Me.jsxs)("aside",{children:[Object(Me.jsx)("label",{htmlFor:"aside-checkbox",id:"aside-label",children:Object(Me.jsx)(ot.a,{})}),Object(Me.jsx)("input",{type:"checkbox",id:"aside-checkbox"}),Object(Me.jsxs)("div",{id:"side-wrapper",children:[Object(Me.jsxs)(ae.a,{onClick:function(e){var n=e.key;t(n)},id:"side-menu",defaultSelectedKeys:["DEFAULT"],defaultOpenKeys:["sub1"],mode:"inline",children:[Object(Me.jsx)(n,{children:Object(Me.jsxs)("div",{className:"menu-item",children:[Object(Me.jsx)(lt.a,{id:"all-note-icon"}),Object(Me.jsx)("span",{className:"tag-name",children:"All Notes"})]})},"DEFAULT"),Object.values(e).map((function(e){return Object(Me.jsx)(n,{children:Object(Me.jsx)(ft,{noteTag:e})},e.uid)}))]}),Object(Me.jsx)("footer",{children:Object(Me.jsx)(pt,{})})]})]})}var ht=n(524),mt=n(525),vt=n(539),xt=n(540),gt=n(541),kt=n.p+"static/media/default.dd551273.png";function yt(e){var t=e.noteList;return Object(Me.jsx)("div",{id:"note-list",children:t.map((function(e){return Object(Me.jsx)(St,{noteInfo:e},e.uid)}))})}var St=function(e){var t=e.noteInfo,n=Object(r.useContext)(It),a=n.editing,c=n.allTags,u=t.team,i=t.uid,o=t.name,f=t.thumbnail,p=a?"#":"".concat(u?"team":"reader","/").concat(i),O=Object(r.useContext)(Ct),h=O.setAllTags,m=O.setAllNotes,v=Object(r.useState)(o),x=Object(j.a)(v,2),g=x[0],k=x[1],y=Object(r.useState)(!1),S=Object(j.a)(y,2),I=S[0],C=S[1];function N(){return E.apply(this,arguments)}function E(){return(E=Object(d.a)(l.a.mark((function e(){var t,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$(i);case 2:t=e.sent,n=t.tags,r=t.allNotes,h(n),m(r);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var L=Object(r.useMemo)((function(){return f?URL.createObjectURL(f):null}),[f]);Object(r.useEffect)((function(){var e=L||"";return function(){return URL.revokeObjectURL(e)}}),[L]);var T=function(){var e=Object(d.a)(l.a.mark((function e(t){var n,r,a,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.key,e.next=3,X(i,n);case 3:r=e.sent,a=r.tags,c=r.allNotes,h(a),m(c);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),U=function(){var e=ae.a.Item,t=Object(Me.jsxs)(ae.a,{onClick:T,children:[Object(Me.jsx)(e,{children:Object(Me.jsxs)("div",{className:"tag-select",children:[Object(Me.jsx)(ct.a,{className:"none-tag-icon"}),Object(Me.jsx)("span",{children:"None Tag"})]})},"DEFAULT"),Object.values(c).map((function(t){return Object(Me.jsx)(e,{children:Object(Me.jsxs)("div",{className:"tag-select",children:[Object(Me.jsx)(bt,{color:t.color}),Object(Me.jsx)("span",{children:t.name})]})},t.uid)}))]});return Object(Me.jsx)(ht.a,{overlay:t,trigger:["click"],children:Object(Me.jsx)(ce.a,{className:"note-delete",type:"text",icon:Object(Me.jsx)(vt.a,{})})})},A=function(){return Object(Me.jsx)(nt.a,{title:"Delete this note?",onConfirm:N,okText:"Yes",cancelText:"No",children:Object(Me.jsx)(ce.a,{className:"note-delete",type:"text",danger:!0,icon:Object(Me.jsx)(xt.a,{})})})};return Object(Me.jsx)(s.b,{to:p,children:Object(Me.jsxs)("div",{className:"list-item",children:[Object(Me.jsxs)("div",{className:"thumbnail-wrapper",children:[Object(Me.jsx)("img",{src:L||kt,alt:o,className:"thumbnail".concat(I?" loaded":""),onLoad:function(){return C(!0)}}),u&&Object(Me.jsx)(mt.a,{color:"blue",className:"cloud-icon",children:Object(Me.jsx)(gt.a,{})})]}),a||Object(Me.jsx)("p",{className:"note-name",children:o}),a&&Object(Me.jsxs)(Me.Fragment,{children:[Object(Me.jsx)(ie.a,{className:"note-name-input",value:g,onChange:function(e){return k(e.target.value)},onBlur:function(){V(i,{name:g}),m((function(e){return Object(w.a)(Object(w.a)({},e),{},Object(b.a)({},i,Object(w.a)(Object(w.a)({},e[i]),{},{name:g})))}))}}),Object(Me.jsx)(U,{}),Object(Me.jsx)(A,{})]})]})})},wt=n(542),It=Object(r.createContext)({tagUid:"DEFAULT",editing:!1,allNotes:{},allTags:{}}),Ct=Object(r.createContext)({setAllNotes:function(){},setAllTags:function(){},setTagUid:function(){},setEditing:function(){}});function Nt(){var e=Object(r.useState)({}),t=Object(j.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)({}),u=Object(j.a)(c,2),s=u[0],i=u[1],o=Object(r.useState)("DEFAULT"),l=Object(j.a)(o,2),d=l[0],b=l[1],f=Object(r.useState)(!1),p=Object(j.a)(f,2),O=p[0],h=p[1],m=Object(r.useMemo)((function(){return"DEFAULT"===d?{uid:"",name:"All Notes",color:"#000000",notes:Object.keys(n)}:s[d]}),[d,s,n]),v=Object(r.useMemo)((function(){return m.notes.filter((function(e){return e in n})).map((function(e){return n[e]}))}),[m,n]);return Object(r.useEffect)((function(){U().then(a),D().then(i),document.title="Multibility"}),[]),Object(Me.jsx)(It.Provider,{value:{tagUid:d,editing:O,allNotes:n,allTags:s},children:Object(Me.jsx)(Ct.Provider,{value:{setAllNotes:a,setAllTags:i,setEditing:h,setTagUid:b},children:Object(Me.jsxs)("div",{id:"menu-container",children:[Object(Me.jsxs)("header",{children:[Object(Me.jsx)(et,{}),Object(Me.jsx)(ze.a,{level:4,children:m.name}),Object(Me.jsx)(He,{})]}),Object(Me.jsxs)("main",{children:[Object(Me.jsx)(Ot,{}),Object(Me.jsx)(yt,{noteList:v}),Object(Me.jsx)(Et,{})]})]})})})}var Et=function(){var e=Object(r.useContext)(It).tagUid,t=Object(r.useContext)(Ct),n=t.setAllTags,a=t.setAllNotes;function c(){return(c=Object(d.a)(l.a.mark((function t(){var r,c,u,s;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(r=y()).tagId=e,t.next=4,Y(r);case 4:c=t.sent,u=c.tags,s=c.allNotes,n(u),a(s);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return Object(Me.jsx)(ce.a,{id:"new-note",size:"large",type:"primary",shape:"circle",onClick:function(){return c.apply(this,arguments)},icon:Object(Me.jsx)(wt.a,{})})};var Lt=n(108),Tt=n.n(Lt);n(483);function Ut(e){var t=e.drawState,n=e.onChange,a=void 0===n?function(){}:n,c=e.erasing,u=void 0!==c&&c,s=e.finger,i=void 0!==s&&s,o=e.lineWidth,l=void 0===o?10:o,d=e.color,b=void 0===d?"#000000":d,f=t.width,p=t.height,h=Object(r.useRef)(null),m=Object(r.useRef)(new Tt.a.PaperScope),v=Object(r.useRef)(),x=Object(r.useRef)(1),k=Object(r.useRef)(),y=Object(r.useState)(Object(O.e)()),S=Object(j.a)(y,2),w=S[0],I=S[1];u&&(l=10,b="#eee");var C=function(){m.current.activate(),k.current=new m.current.Path,k.current.strokeColor=new Tt.a.Color(b),k.current.strokeWidth=l,k.current.strokeCap="round",function(){var e,t=null===(e=h.current)||void 0===e?void 0:e.clientWidth;t&&(x.current=f/t)}()},N=function(e){var t;k.current&&(k.current.add(e.point.multiply(x.current)),k.current.smooth(),u&&(null===(t=v.current)||void 0===t||t.children.forEach((function(e){var t;e instanceof Tt.a.Path&&(null===(t=k.current)||void 0===t?void 0:t.intersects(e))&&I((function(t){return t.add(e.name)}))}))))},E=u?function(){k.current&&(a((function(e){return g.eraseStrokes(e,w.toArray())})),I(Object(O.e)()))}:function(){if(k.current){k.current.simplify();var e=k.current.pathData;a((function(t){return g.addStroke(t,e,l,b)}))}},L=function(e){(function(e){return i||function(e){var t=e.touches[0];return"stylus"===(null===t||void 0===t?void 0:t.touchType)}(e)})(e)||e.stopPropagation()};return Object(r.useEffect)((function(){h.current&&(m.current.setup(h.current),m.current.view.viewSize.width=f,m.current.view.viewSize.height=p)}),[]),Object(r.useEffect)((function(){var e;null===(e=k.current)||void 0===e||e.remove()}),[t]),Object(r.useEffect)((function(){m.current.view.onMouseDown=C,m.current.view.onMouseDrag=N,m.current.view.onMouseUp=E})),Object(r.useEffect)((function(){return m.current.activate(),v.current=new m.current.Group,t.getValidStrokes().forEach((function(e){var t,n=e.pathData,r=e.lineWidth,a=e.color,c=e.uid;w.has(c)&&(a+="55");var u=new Tt.a.Path(n);u.strokeWidth=r,u.strokeCap="round",u.strokeColor=new Tt.a.Color(a),u.name=c,null===(t=v.current)||void 0===t||t.addChild(u)})),function(){var e;null===(e=v.current)||void 0===e||e.removeChildren()}}),[t,w]),Object(Me.jsx)("canvas",{"data-paper-hidpi":!1,className:"draw-canvas",ref:h,onTouchStartCapture:L,onTouchMoveCapture:L})}var At={states:Object(O.b)(),keys:Object(O.a)(),editStack:Object(O.a)(),undoStack:Object(O.a)()},Dt=Object(O.d)(At),Rt=function(){function e(t,n){Object(f.a)(this,e),this.immutable=t,this.lastOp=n}return Object(p.a)(e,[{key:"getImmutable",value:function(){return this.immutable}},{key:"getStates",value:function(){return this.getImmutable().get("states")}},{key:"getKeys",value:function(){return this.getImmutable().get("keys")}},{key:"getEditStack",value:function(){return this.getImmutable().get("editStack")}},{key:"getUndoStack",value:function(){return this.getImmutable().get("undoStack")}},{key:"setState",value:function(t,n){var r,a=this.getImmutable().update("states",(function(e){return e.set(t,n)}));return this.getStates().has(t)&&(a=a.update("editStack",(function(e){return e.push(t)}))),n.lastOp&&(r=Object(w.a)(Object(w.a)({},n.lastOp),{},{pageId:t})),new e(a,r)}},{key:"getOneState",value:function(e){return this.getImmutable().get("states").get(e)}},{key:"isUndoable",value:function(){return this.getEditStack().size>0}},{key:"isRedoable",value:function(){return this.getUndoStack().size>0}},{key:"undo",value:function(){if(!this.isUndoable())return this;var t=this.getImmutable().get("editStack").last();if(!t)return this;var n=this.getImmutable().get("states").get(t);if(!n)return this;var r,a=g.undo(n),c=a.lastOp;return c&&(r=Object(w.a)({pageId:t},c)),new e(this.getImmutable().update("editStack",(function(e){return e.pop()})).update("undoStack",(function(e){return e.push(t)})).update("states",(function(e){return e.set(t,a)})),r)}},{key:"redo",value:function(){if(this.isRedoable()){var t=this.getImmutable().get("undoStack").last();if(!t)return this;var n=this.getImmutable().get("states").get(t);if(!n)return this;var r,a=g.redo(n),c=a.lastOp;return c&&(r=Object(w.a)({pageId:t},c)),new e(this.getImmutable().update("undoStack",(function(e){return e.pop()})).update("editStack",(function(e){return e.push(t)})).update("states",(function(e){return e.set(t,a)})),r)}return this}},{key:"pushStroke",value:function(e,t){var n=this.getImmutable().get("states").get(e);if(!n)return this;var r=g.pushStroke(n,t);return this.setState(e,r)}},{key:"pushOperation",value:function(e){var t,n=e.type,r=e.pageId,a=this.getImmutable().get("states").get(r);if(!a)return this;switch(n){case"add":t=g.pushStroke(a,e.stroke);break;case"erase":t=g.pushErase(a,e.erase);break;case"undo":t=g.pushUndo(a,e.undoUid);break;case"redo":t=g.pushRedo(a,e.redoUid)}return this.setState(r,t)}}],[{key:"createEmpty",value:function(){return new e(Dt())}},{key:"createKeyed",value:function(t){return new e(Dt().set("keys",Object(O.a)(t)))}},{key:"createFromList",value:function(t){return new e(Dt().set("keys",Object(O.a)(t.map((function(e){return e[0]})))).set("states",Object(O.b)(t)))}},{key:"createFromPages",value:function(t,n){var r=Object.entries(t);return e.createFromList(r.map((function(e){var t=Object(j.a)(e,2),r=t[0],a=t[1],c=a.state,u=a.ratio;return[r,g.loadFromFlat(c,n,n*u)]})))}}]),e}(),Ft=n(251),Pt=n(256),Mt=n(94),_t=n(516),Wt=n(521),Gt=n(515),zt=n(526),Bt=n(182),Vt=n(545),Kt=n(546),Ht=n(547),Jt=n(548),Yt=(n(484),n(252)),qt=n(543),$t=n(544),Qt=Object(r.createContext)({code:-2,userList:[]});function Xt(){var e,t=null!==(e=Object(i.g)().noteId)&&void 0!==e?e:"",n=Object(r.useState)(),a=Object(j.a)(n,2),c=a[0],u=a[1],s=Object(r.useState)(-2),o=Object(j.a)(s,2),b=o[0],f=o[1],p=Object(r.useState)([]),O=Object(j.a)(p,2),h=O[0],m=O[1],v=Object(r.useState)(function(e){return function(){return Object(Yt.io)(Ee,{autoConnect:!1,query:{userId:N(),userName:E(),noteId:e}})}}(t)),x=Object(j.a)(v,1)[0],g=Object(i.f)();function k(){return y.apply(this,arguments)}function y(){return(y=Object(d.a)(l.a.mark((function e(){var n,r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Fe(t);case 2:if(n=e.sent){e.next=6;break}return ue.b.error("Failed loading the team note"),e.abrupt("return",g("/"));case 6:r=n.code,a=n.pages,f(r),u(Rt.createFromPages(a,ln));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var S=function(){var e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k();case 2:x.on("push",(function(e){var t=e.operation;u((function(e){return null===e||void 0===e?void 0:e.pushOperation(t)}))})),x.on("joined",(function(e){var t=e.joined,n=e.members,r=t.userId,a=t.userName;m(n),r!==N()&&ue.b.success({icon:Object(Me.jsx)(qt.a,{}),content:a+" joined room"})})),x.on("leaved",(function(e){var t=e.leaved,n=e.members,r=t.userId,a=t.userName;m(n),r!==N()&&ue.b.warning({icon:Object(Me.jsx)($t.a,{}),content:a+" leaved room"})})),x.connect();case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),w=function(){x.off("connect"),x.off("push"),x.off("joined"),x.off("leaved"),x.disconnect()};Object(r.useEffect)((function(){return S(),w}),[t]);return Object(Me.jsx)(Qt.Provider,{value:{code:b,userList:h},children:Object(Me.jsx)(pn,{teamOn:!0,teamStateSet:c,pushOperation:function(e){x.emit("push",{operation:e})}})})}n(510);function Zt(e){var t=e.value,n=Object(r.useState)(9999),a=Object(j.a)(n,2),c=a[0],u=a[1],s=String(t>=0?t:c).padStart(4,"0").split("").map((function(e){return Number(e)}));function i(){u(Math.floor(1e4*Math.random()))}return Object(r.useEffect)((function(){if(-1!==t)return u(9999);var e=setTimeout(i,100);return function(){return clearTimeout(e)}}),[t]),Object(Me.jsx)("div",{className:"digit-display ".concat(-2===t?"disabled":""),children:s.map((function(e,t){return Object(Me.jsx)(en,{digit:e},t)}))})}function en(e){var t=e.digit;return t<=9&&t>=0?Object(Me.jsx)("div",{className:"digit",children:t}):Object(Me.jsx)("div",{className:"digit",children:"*"})}var tn=Object(zt.a)({scriptUrl:"//at.alicdn.com/t/font_3181679_dsms7mr75hd.js"});function nn(e){var t=e.setDrawCtrl,n=e.handleUndo,a=e.handleRedo,c=e.instantSave,u=Object(r.useContext)(jn),s=u.erasing,o=u.finger,l=Object(r.useContext)(bn),d=l.saved,j=l.stateSet,b=l.teamOn,f=Object(i.f)(),p=function(e){t((function(t){return Object(w.a)(Object(w.a)({},t),e)}))};return Object(Me.jsxs)("div",{className:"tool-bar",children:[Object(Me.jsxs)("div",{className:"left-buttons",children:[Object(Me.jsx)(ce.a,{type:"text",onClick:function(){return f("/")},icon:Object(Me.jsx)(Bt.a,{}),children:"Back"}),Object(Me.jsx)(ce.a,{type:"text",onClick:c,disabled:d,icon:Object(Me.jsx)(Vt.a,{})})]}),Object(Me.jsxs)("div",{className:"middle-buttons",children:[Object(Me.jsx)(ce.a,{type:"text",icon:Object(Me.jsx)(Kt.a,{}),onClick:n,disabled:!(null===j||void 0===j?void 0:j.isUndoable())}),Object(Me.jsx)(ce.a,{className:"redo-button",type:"text",icon:Object(Me.jsx)(Ht.a,{}),onClick:a,disabled:!(null===j||void 0===j?void 0:j.isRedoable())}),Object(Me.jsx)(rn,{erasing:s,updateDrawCtrl:p}),Object(Me.jsx)(ce.a,{type:s?"default":"text",shape:"circle",onClick:function(){return p({erasing:!0})},icon:Object(Me.jsx)(tn,{type:"icon-eraser"})}),Object(Me.jsx)(ce.a,{type:o?"primary":"text",ghost:o,shape:"circle",onClick:function(){return p({finger:!o})},icon:Object(Me.jsx)(tn,{type:"icon-finger"})})]}),Object(Me.jsxs)("div",{className:"right-buttons",children:[b&&Object(Me.jsx)(sn,{}),b||Object(Me.jsx)(on,{})]})]})}var rn=a.a.memo((function(e){var t=e.erasing,n=e.updateDrawCtrl;return t?Object(Me.jsx)(ce.a,{type:"text",shape:"circle",onClick:function(){return n({erasing:!1})},icon:Object(Me.jsx)(Jt.a,{})}):Object(Me.jsx)(oe.a,{content:Object(Me.jsx)(an,{updateDrawCtrl:n}),trigger:"click",placement:"bottom",getPopupContainer:function(e){var t;return(null===(t=e.parentElement)||void 0===t?void 0:t.parentElement)||e},children:Object(Me.jsx)(ce.a,{type:"default",shape:"circle",icon:Object(Me.jsx)(Jt.a,{})})})})),an=function(e){var t=e.updateDrawCtrl,n=Object(r.useContext)(jn).lineWidth;return Object(Me.jsxs)("div",{className:"pen-panel",children:[Object(Me.jsx)(_t.a,{min:5,max:50,value:n,onChange:function(e){return t({lineWidth:e})}}),Object(Me.jsx)(cn,{updateDrawCtrl:t})]})},cn=function(e){var t=e.updateDrawCtrl,n=Object(r.useContext)(jn).color;return Object(Me.jsx)("div",{className:"color-select",children:L.map((function(e){return Object(Me.jsx)("input",{checked:n===e,type:"radio",name:"color",onChange:function(){return t({color:e})},style:{borderColor:e,backgroundColor:e}},e)}))})},un=function(e){var t=e.userInfo.userName;return Object(Me.jsxs)("div",{className:"user-card",children:[Object(Me.jsx)(Wt.a,{className:"avatar",size:"small",style:{backgroundColor:T()},children:t.slice(0,4)}),Object(Me.jsx)("span",{children:t})]})};function sn(){var e=Object(r.useContext)(Qt),t=e.code,n=e.userList,a=Object(Me.jsxs)("div",{className:"team-popover",children:[Object(Me.jsx)(Zt,{value:t}),Object(Me.jsx)(Gt.a,{}),Object(Me.jsx)("div",{className:"user-list",children:n.map((function(e){return Object(Me.jsx)(un,{userInfo:e},e.userId)}))})]});return Object(Me.jsx)(oe.a,{content:a,trigger:"click",placement:"bottomRight",title:"Team info",defaultVisible:!0,getPopupContainer:function(e){var t;return(null===(t=e.parentElement)||void 0===t?void 0:t.parentElement)||e},children:Object(Me.jsx)(ce.a,{shape:"round",icon:Object(Me.jsx)(Ie.a,{}),children:"Team"})})}var on=function(){var e=Object(r.useContext)(fn).createRoom;return Object(Me.jsx)(nt.a,{placement:"bottomRight",title:"Enable team editing?",onConfirm:e,okText:"Yes",cancelText:"No",children:Object(Me.jsx)(ce.a,{shape:"round",icon:Object(Me.jsx)(Ie.a,{}),children:"Team"})})},ln=(n(511),2e3),dn={erasing:!1,finger:!1,even:!0,lineWidth:10,color:"#000000"},jn=Object(r.createContext)(dn),bn=Object(r.createContext)({noteId:"",stateSet:void 0,saved:!0,teamOn:!1}),fn=Object(r.createContext)({setSaved:function(){},createRoom:function(){}});function pn(e){var t,n=e.teamOn,a=e.teamStateSet,c=e.pushOperation,u=null!==(t=Object(i.g)().noteId)&&void 0!==t?t:"",s=Object(i.f)(),o=Object(r.useState)(),f=Object(j.a)(o,2),p=f[0],O=f[1],h=Object(r.useState)(),m=Object(j.a)(h,2),v=m[0],x=m[1],k=Object(r.useState)(),y=Object(j.a)(k,2),S=y[0],I=y[1],C=Object(r.useState)(dn),N=Object(j.a)(C,2),E=N[0],L=N[1],T=Object(r.useState)(!0),U=Object(j.a)(T,2),A=U[0],D=U[1],R=function(){var e=Object(d.a)(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z(u);case 2:if(t=e.sent){e.next=6;break}return ue.b.error("Note not found"),e.abrupt("return",s("/"));case 6:r=t.pages,O(r),x(t),I(Rt.createFromPages(r,ln)),n&&De(u,r);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),F=Object(r.useCallback)(Object(Ft.debounce)(function(){var e=Object(d.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V(u,{pages:t});case 2:D(!0);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),1e3),[]),P=F.flush,M=function(){var e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v&&p){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,Ue(u,v,p);case 4:if(e.sent){e.next=8;break}return ue.b.error("Can't create room."),e.abrupt("return");case 8:return e.next=10,V(u,{team:!0});case 10:s("/team/"+u);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_=function(){P()};Object(r.useEffect)((function(){return R(),_}),[u,n]),Object(r.useEffect)((function(){v&&(document.title=v.name)}),[v]),Object(Pt.a)(_),Object(r.useEffect)((function(){(null===S||void 0===S?void 0:S.lastOp)&&c&&(console.log(S.lastOp),c(S.lastOp))}),[S]),Object(r.useEffect)((function(){p&&(F(p),D(!1))}),[p]);var W=Object(r.useCallback)((function(e,t){I((function(n){return null===n||void 0===n?void 0:n.setState(e,t)})),O((function(n){if(n)return Object(w.a)(Object(w.a)({},n),{},Object(b.a)({},e,Object(w.a)(Object(w.a)({},n[e]),{},{state:g.flaten(t)})))}))}),[]);return Object(Me.jsx)(jn.Provider,{value:E,children:Object(Me.jsx)(bn.Provider,{value:{noteId:u,stateSet:S,saved:A,teamOn:n},children:Object(Me.jsx)(fn.Provider,{value:{setSaved:D,createRoom:M},children:Object(Me.jsxs)("div",{className:"reader-container",children:[Object(Me.jsx)(nn,{setDrawCtrl:L,instantSave:P,handleUndo:function(){I((function(e){return null===e||void 0===e?void 0:e.undo()}))},handleRedo:function(){I((function(e){return null===e||void 0===e?void 0:e.redo()}))}}),null===S||void 0===S?void 0:S.getKeys().map((function(e){if(!p)return Object(Me.jsx)(Me.Fragment,{});var t=p[e],n=S.getOneState(e),r=null===a||void 0===a?void 0:a.getOneState(e);return t&&n?Object(Me.jsx)(On,{drawState:n,teamState:r,updateState:W,imageBlob:t.image,uid:e},e):Object(Me.jsx)(Me.Fragment,{})})),Object(Me.jsx)(Mt.a,{className:"page-loading"})]})})})})}var On=a.a.memo((function(e){var t=e.imageBlob,n=e.drawState,a=e.teamState,c=e.uid,u=e.updateState,s=Object(r.useState)(!1),i=Object(j.a)(s,2),o=i[0],l=i[1],d=Object(r.useMemo)((function(){return t?URL.createObjectURL(t):null}),[t]);return Object(r.useEffect)((function(){var e=d||"";return function(){return URL.revokeObjectURL(e)}}),[d]),Object(Me.jsxs)("div",{className:"pdf-page ".concat(o?"loaded":""),children:[Object(Me.jsx)("img",{src:d||kt,alt:"pdf-page",onLoad:function(){return l(!0)}}),Object(Me.jsxs)("div",{className:"page-draw",children:[a&&Object(Me.jsx)(Ut,{drawState:a}),Object(Me.jsx)(hn,{updateState:u,drawState:n,uid:c})]})]})})),hn=function(e){var t=e.drawState,n=e.uid,a=e.updateState,c=Object(r.useContext)(jn),u=c.erasing,s=c.lineWidth,i=c.color,o=c.finger;return Object(Me.jsx)(Ut,{drawState:t,onChange:function(e){var r=e instanceof g?e:e(t);a(n,r)},erasing:u,lineWidth:s,color:i,finger:o})};function mn(){var e=Object(r.useState)(g.createEmpty(500,500)),t=Object(j.a)(e,2),n=t[0],a=t[1];return Object(Me.jsxs)(Me.Fragment,{children:[Object(Me.jsx)(Ut,{drawState:n,onChange:a,finger:!0}),Object(Me.jsx)("h1",{children:"title"})]})}var vn=Object(Me.jsx)("main",{style:{padding:"1rem"},children:Object(Me.jsx)("p",{children:"There's nothing here!"})});u.a.render(Object(Me.jsx)(s.a,{children:Object(Me.jsxs)(i.c,{children:[Object(Me.jsx)(i.a,{path:"/",element:Object(Me.jsx)(Nt,{})}),Object(Me.jsx)(i.a,{path:"/reader",children:Object(Me.jsx)(i.a,{path:":noteId",element:Object(Me.jsx)(pn,{teamOn:!1})})}),Object(Me.jsx)(i.a,{path:"/team",children:Object(Me.jsx)(i.a,{path:":noteId",element:Object(Me.jsx)(Xt,{})})}),Object(Me.jsx)(i.a,{path:"/test",element:Object(Me.jsx)(mn,{})}),Object(Me.jsx)(i.a,{path:"*",element:vn})]})}),document.getElementById("root"))}},[[512,1,2]]]);
//# sourceMappingURL=main.1f2a88ff.chunk.js.map