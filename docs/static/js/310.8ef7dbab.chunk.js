"use strict";(self.webpackChunkmultibility=self.webpackChunkmultibility||[]).push([[310,479],{24657:function(e,n,t){t.r(n),t.d(n,{default:function(){return on}});var r=t(93433),a=t(1413),i=t(45987),o=t(15861),s=t(29439),u=t(87757),c=t.n(u),l=t(72791),d=t(92198),f=t(11886),p=t(81832),v=t(76807),x=t(95099),g=t(15671),m=t(43144),Z=t(82670),h=t(24124),j={states:(0,h.D5)(),editStack:(0,h.aV)(),undoStack:(0,h.aV)()},k=(0,h.WV)(j),b=function(){function e(n,t){(0,g.Z)(this,e),this.immutable=n,this.lastOp=t}return(0,m.Z)(e,[{key:"getImmutable",value:function(){return this.immutable}},{key:"getStates",value:function(){return this.getImmutable().get("states")}},{key:"getOneState",value:function(e){return this.getStates().get(e)}},{key:"getEditStack",value:function(){return this.getImmutable().get("editStack")}},{key:"getUndoStack",value:function(){return this.getImmutable().get("undoStack")}},{key:"setState",value:function(n,t){var r=this.getOneState(n);if(!r||r===t)return this;var i=this.getImmutable().update("states",(function(e){return e.set(n,t)})).update("editStack",(function(e){return e.push(n)})).delete("undoStack"),o=t.lastOp;return new e(i,o&&(0,a.Z)((0,a.Z)({},o),{},{pageID:n}))}},{key:"syncStrokeTime",value:function(e,n){var t=this.getOneState(e);return t&&Z.Dw.syncStrokeTime(t,n),this}},{key:"addState",value:function(n,t){var r=t.state,a=t.ratio,i=Z.Dw.loadFromFlat(r,a);return new e(this.getImmutable().update("states",(function(e){return e.set(n,i)})))}},{key:"deleteState",value:function(n){return new e(this.getImmutable().update("states",(function(e){return e.delete(n)})))}},{key:"isUndoable",value:function(){return this.getEditStack().size>0}},{key:"isRedoable",value:function(){return this.getUndoStack().size>0}},{key:"undo",value:function(){if(!this.isUndoable())return this;var n=this.getEditStack().last(),t=n&&this.getOneState(n);if(!t)return this;var r=Z.Dw.undo(t),i=r.lastOp,o=i&&(0,a.Z)({pageID:n},i);return new e(this.getImmutable().update("editStack",(function(e){return e.pop()})).update("undoStack",(function(e){return e.push(n)})).update("states",(function(e){return e.set(n,r)})),o)}},{key:"redo",value:function(){if(!this.isRedoable())return this;var n=this.getUndoStack().last(),t=n&&this.getOneState(n);if(!t)return this;var r=Z.Dw.redo(t),i=r.lastOp,o=i&&(0,a.Z)({pageID:n},i);return new e(this.getImmutable().update("undoStack",(function(e){return e.pop()})).update("editStack",(function(e){return e.push(n)})).update("states",(function(e){return e.set(n,r)})),o)}},{key:"getLastDS",value:function(){var e,n=null===(e=this.lastOp)||void 0===e?void 0:e.pageID,t=n&&this.getOneState(n);if(t)return[n,t]}}],[{key:"createFromPages",value:function(n){return new e(k().set("states",(0,h.D5)(n).map((function(e){var n=e.state,t=e.ratio;return Z.Dw.loadFromFlat(n,t)}))))}}]),e}(),S=t(75783),y=t(87309),w=t(50419),I=t(79286),D=t(80184),P=function(e){var n=e.addFinalPage;return(0,D.jsx)("div",{className:"add-btn-wrapper",children:(0,D.jsx)(y.Z,{type:"dashed",icon:(0,D.jsx)(I.Z,{}),block:!0,onClick:n,children:"New page"})})},C=t(16871),N=t(96801),O=t(37762),R=t(61842),E=t.n(R)().createInstance({name:"scroll"});var T=function(e,n){var t,r="",a=0,i=(0,O.Z)(n);try{for(i.s();!(t=i.n()).done;){var o=t.value,s=e.get(o);if(s){if(1===s)return o;s>a&&(r=o,a=s)}}}catch(u){i.e(u)}finally{i.f()}return r},F=t(79930),L=t(82898);function M(e,n,t){var r=e.indexOf(n),a=e.slice();return-1===r||a.splice(r+1,0,t),a}var A=t(23414),z=t(82622),V=t(10711),U=t(18780),H=t(2491),K=t(70140),W=t(69228),_=t(87661),G=t(52365),X=t(74115),B=function(e){var n=e.userInfo,t=e.size,r=void 0===t?"default":t,a=e.onClick,i=void 0===a?function(){}:a,o=e.chosen,s=void 0!==o&&o,u=e.className,c=(0,l.useMemo)((function(){return(0,X.bM)(n.userID)}),[n]);if(!n)return null;var d=n.userName;return(0,D.jsx)(H.C,{className:u,"data-chosen":s,size:r,style:{backgroundColor:c},children:(0,D.jsx)("div",{className:"avatar-wrapper",onClick:i,children:null===d||void 0===d?void 0:d.slice(0,3)})})},q=t(22568),J=t(81694),Q=t.n(J),Y=t(60559),$=t(13892),ee=t(79856),ne=["left"],te=["ref"],re=["uid","pageIndex","refRec"],ae=["uid","index","chosen","setChosen","page","userIDs"],ie=function(e){var n=(0,l.useState)(!1),t=(0,s.Z)(n,2),r=t[0],i=t[1],o=(0,G.LH)(),u=(0,s.Z)(o,1)[0],c=(0,D.jsx)(U._l,{draggableId:"opposite",index:r?1:0,children:function(e){var n=e.innerRef,t=e.draggableProps,r=e.dragHandleProps;return(0,D.jsx)("div",(0,a.Z)((0,a.Z)({className:"opposite",ref:n},t),r))}});return(0,D.jsx)(G.s2,{initKey:"ALL",children:(0,D.jsx)(U.Z5,{onDragEnd:function(e){var n=e.draggableId,t=e.destination;"CARD"===n&&(0===(null===t||void 0===t?void 0:t.index)&&i(!0),1===(null===t||void 0===t?void 0:t.index)&&i(!1))},children:(0,D.jsx)(U.bK,{droppableId:"preview-drop",direction:"horizontal",children:function(n,t){var i=n.droppableProps,o=n.innerRef,s=n.placeholder,l=t.isDraggingOver;return(0,D.jsxs)("div",(0,a.Z)((0,a.Z)({className:"preview-drop","data-left":r,"data-open":u,"data-dragged":l,ref:o},i),{},{children:[c,(0,D.jsx)(oe,(0,a.Z)({left:r},e)),s]}))}})})})},oe=function(e){var n=e.left,t=(0,i.Z)(e,ne),r=(0,G.zI)(),o=(0,s.Z)(r,1)[0],u=(0,G.LH)(),c=(0,s.Z)(u,2),d=c[0],f=c[1],p={ALL:"All Pages",MARKED:"Bookmarks",WRITTEN:"Notes"}[o],v=(0,$.QS)({onSwipedLeft:function(){n&&f(!1)},onSwipedRight:function(){n||f(!1)},swipeDuration:200}),x=v.ref,g=(0,i.Z)(v,te),m=(0,l.useMemo)((function(){return(0,D.jsx)(fe,{})}),[]),Z=(0,l.useMemo)((function(){return(0,D.jsx)(se,(0,a.Z)({},t))}),[t]);return(0,D.jsx)(U._l,{draggableId:"CARD",index:n?0:1,children:function(e,n){var t=e.innerRef,r=e.draggableProps,i=e.dragHandleProps,o=n.isDragging,s=n.isDropAnimating;return(0,D.jsxs)("div",(0,a.Z)((0,a.Z)((0,a.Z)({className:"preview-card",ref:function(e){t(e),x(e)},"data-open":d,"data-dragged":o,"data-animating":s},r),g),{},{children:[(0,D.jsx)("div",(0,a.Z)({className:"drag-handle"},i)),(0,D.jsx)("h3",{children:p}),m,Z]}))}})},se=function(e){var n=(0,l.useRef)({}),t=(0,G.zI)(),r=(0,s.Z)(t,1)[0],i=(0,G.LH)(),o=(0,s.Z)(i,1)[0],u=e.pageOrder,c=e.currPageID,d=e.saveReorder,f=e.scrollPage,p=e.addFinalPage,v=(0,x.Z)((function(){var e;null===(e=n.current[c])||void 0===e||e.scrollIntoView()}));return(0,l.useLayoutEffect)((function(){o&&v()}),[o,v]),(0,D.jsx)(U.Z5,{onDragEnd:function(e){var n=e.source,t=e.destination;if(t&&u){var r=n.index,a=t.index,i=u[r];if(r!==a&&i){var o=function(e,n,t){var r=e.slice(),a=r.splice(n,1),i=(0,s.Z)(a,1)[0];return i?(r.splice(t,0,i),r):e}(u,r,a);d(o,!0),requestAnimationFrame((function(){return f(i)}))}}},children:(0,D.jsx)(U.bK,{droppableId:"preview-list",children:function(t){var i=t.droppableProps,o=t.innerRef,s=t.placeholder;return(0,D.jsxs)("div",(0,a.Z)((0,a.Z)({className:"page-list",ref:o},i),{},{children:[null===u||void 0===u?void 0:u.map((function(t,r){return(0,D.jsx)(ue,(0,a.Z)({uid:t,pageIndex:r,refRec:n.current},e),t)})),s,"ALL"===r&&(0,D.jsx)(P,{addFinalPage:p})]}))}})})},ue=function(e){var n=e.uid,t=e.pageIndex,r=e.refRec,o=(0,i.Z)(e,re),u=o.stateSet,c=o.pageRec,d=o.currPageID,f=(0,l.useContext)(Y.TeamCtx),p=f.teamState,v=f.ignores,x=(0,G.zI)(),g=(0,s.Z)(x,1)[0],m=(0,l.useState)(""),Z=(0,s.Z)(m,2),h=Z[0],j=Z[1],k=null===c||void 0===c?void 0:c.get(n),b=null===u||void 0===u?void 0:u.getOneState(n),S=null===p||void 0===p?void 0:p.getOnePageStateMap(n),y=(0,l.useRef)(!1);(0,l.useEffect)((function(){"MARKED"!==g&&(y.current=!1)}),[g]);var w=(0,l.useMemo)((function(){return ee.f.getValidUsers(S,v)}),[S,v]);if(!k||!b)return null;if(y.current=k.marked||y.current,"WRITTEN"===g&&b.isEmpty()&&(!S||S.every((function(e){return e.isEmpty()}))))return null;if("MARKED"===g&&!y.current)return null;var I=d===n,P=o.scrollPage;return(0,D.jsx)(U._l,{draggableId:n,index:t,isDragDisabled:"ALL"!==g,children:function(e,i){var s=e.innerRef,u=e.draggableProps,c=e.dragHandleProps,l=i.isDragging,d=i.isDropAnimating;return(0,D.jsxs)("div",(0,a.Z)((0,a.Z)((0,a.Z)({ref:function(e){s(e),e&&(r[n]=e)},className:"page","data-curr":I,"data-dragged":l,"data-animating":d,onClick:function(){return P(n)}},u),c),{},{children:[(0,D.jsx)(N.default,{drawState:(null===S||void 0===S?void 0:S.get(h))||b,teamStateMap:h?void 0:S,thumbnail:k.image,ignores:v,preview:!0}),(0,D.jsx)(ce,(0,a.Z)({uid:n,index:t,chosen:h,setChosen:j,page:k,userIDs:w},o))]}))}})},ce=l.memo((function(e){var n=e.uid,t=e.index,r=e.chosen,o=e.setChosen,s=e.page,u=e.userIDs,c=(0,i.Z)(e,ae),l=c.switchPageMarked;return(0,D.jsxs)("div",{className:"tools",onClick:function(e){return e.stopPropagation()},children:[(0,D.jsx)("div",{className:"bookmark","data-marked":s.marked,onClick:function(){return l(n)}}),(0,D.jsx)("div",{className:"index",children:t+1}),(0,D.jsx)(de,(0,a.Z)({uid:n},c)),(0,D.jsx)(le,{userIDs:u,chosen:r,setChosen:o})]})}));ce.displayName="PreviewTools";var le=function(e){var n=e.userIDs,t=e.chosen,r=e.setChosen,a=(0,l.useContext)(Y.TeamCtx).userRec;return(0,D.jsx)(H.C.Group,{maxCount:2,size:"default",className:Q()("team-group",{chosen:t}),maxPopoverPlacement:"bottom",children:n.map((function(e){var n=a[e];return n?(0,D.jsx)(B,{size:"default",userInfo:n,className:"preview-avatar",chosen:t===e,onClick:function(){return r((function(n){return n===e?"":e}))}},e):null}))})},de=function(e){var n=e.uid,t=e.addPage,r=e.deletePage,a=(0,D.jsx)(K.Z,{items:[{key:"ADD",icon:(0,D.jsx)(I.Z,{}),label:"Add page",onClick:function(){return t(n)}},{key:"COPY",icon:(0,D.jsx)(A.Z,{}),label:"Duplicate",onClick:function(){return t(n,!0)}},{key:"DELETE",icon:(0,D.jsx)(z.Z,{}),label:"Delete",danger:!0,onClick:function(){return r(n)}}]});return(0,D.jsx)(W.Z,{content:a,trigger:"click",placement:"left",destroyTooltipOnHide:!0,getPopupContainer:function(e){var n,t;return null===(n=e.parentElement)||void 0===n||null===(t=n.parentElement)||void 0===t?void 0:t.parentElement},children:(0,D.jsx)("div",{className:"option",children:(0,D.jsx)(V.Z,{})})})},fe=function(){var e=(0,G.zI)(),n=(0,s.Z)(e,2),t=n[0],r=n[1],a=_.Z.TabPane;return(0,D.jsxs)(_.Z,{className:"tabs",activeKey:t,onChange:r,tabBarGutter:0,size:"small",centered:!0,children:[(0,D.jsx)(a,{tab:(0,D.jsx)(q.Z,{type:"icon-uf_paper"})},"ALL"),(0,D.jsx)(a,{tab:(0,D.jsx)(q.Z,{type:"icon-bookmark2"})},"MARKED"),(0,D.jsx)(a,{tab:(0,D.jsx)(q.Z,{type:"icon-write"})},"WRITTEN")]})},pe=t(52242),ve=t(65323),xe=function(e){var n=e.saved,t=e.instantSave,r=(0,C.s0)();return(0,D.jsxs)("div",{className:"left",children:[(0,D.jsx)(y.Z,{type:"text",onClick:(0,o.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t();case 2:r("/");case 3:case"end":return e.stop()}}),e)}))),icon:(0,D.jsx)(pe.Z,{style:{opacity:.8}})}),(0,D.jsx)(y.Z,{type:"text",className:"save",onClick:t,disabled:n,icon:(0,D.jsx)(ve.Z,{})})]})},ge=t(78985),me=t(78030),Ze=t(50446),he=t(74006),je=t(52542),ke=t(76849),be=t(62),Se=t(14965),ye=t(48),we=function(e){var n=e.handleUndo,t=e.handleRedo,r=e.undoable,a=e.redoable,i=(0,f.gX)(),o=i.mode,u=i.finger,c=(0,f.F7)(),l=(0,p.iX)(),d=(0,s.Z)(l,2),v=d[0],x=d[1];return(0,D.jsxs)("div",{className:"middle","data-force-light":v,children:[(0,D.jsx)(y.Z,{type:"text",icon:(0,D.jsx)(me.Z,{}),onClick:n,disabled:!r}),(0,D.jsx)(y.Z,{type:"text",icon:(0,D.jsx)(Ze.Z,{}),onClick:t,disabled:!a}),(0,D.jsx)(y.Z,{type:u?"link":"text",onClick:function(){c({finger:!u}),w.ZP.destroy("FINGER"),w.ZP.open({content:u?"Pencil only":"Draw with finger",key:"FINGER"})},icon:(0,D.jsx)(q.Z,{type:"icon-finger"})}),(0,D.jsx)(y.Z,{className:"force-light-btn",type:"text",icon:v?(0,D.jsx)(he.Z,{}):(0,D.jsx)(je.Z,{}),onClick:function(){return x((function(e){return!e}))}}),(0,D.jsx)(Ie,{}),(0,D.jsx)(De,{}),(0,D.jsx)(y.Z,{type:"text"===o?"link":"text",onClick:function(){return c({mode:"text"})},icon:(0,D.jsx)(q.Z,{type:"icon-text1"})}),(0,D.jsx)(Pe,{})]})},Ie=function(){var e=(0,f.gX)(),n=e.mode,t=e.color,r=(0,f.F7)();return"draw"===n?(0,D.jsx)(W.Z,{content:(0,D.jsx)(ye.Uk,{updateDrawCtrl:r,drawCtrl:e}),trigger:"click",placement:"bottom",getPopupContainer:function(e){return e.parentElement},destroyTooltipOnHide:!0,children:(0,D.jsx)(y.Z,{type:"link",icon:(0,D.jsx)(ke.Z,{twoToneColor:t,className:"pen-icon"})})}):(0,D.jsx)(y.Z,{type:"text",onClick:function(){return r({mode:"draw"})},icon:(0,D.jsx)(be.Z,{})})},De=function(){var e=(0,f.gX)(),n=e.mode,t=e.pixelEraser,r=(0,f.F7)(),i={shape:"circle",icon:(0,D.jsx)(q.Z,{type:"icon-eraser"})};return"erase"===n?(0,D.jsx)(W.Z,{content:(0,D.jsxs)("div",{className:"width-seg-wrapper",children:[(0,D.jsx)(ge.Z,{block:!0,size:"small",className:"pixel-seg",options:["Pixel","Object"],value:t?"Pixel":"Object",onChange:function(e){r("Pixel"===e?{pixelEraser:!0}:{pixelEraser:!1})}}),(0,D.jsx)(ye.Db,{drawCtrl:e,updateDrawCtrl:r,field:"eraserWidth"})]}),trigger:"click",placement:"bottom",getPopupContainer:function(e){return e.parentElement},destroyTooltipOnHide:!0,children:(0,D.jsx)(y.Z,(0,a.Z)({type:"link"},i))}):(0,D.jsx)(y.Z,(0,a.Z)({type:"text",onClick:function(){return r({mode:"erase"})}},i))},Pe=function(){var e=(0,f.gX)(),n=e.lasso,t=e.mode,r=(0,f.F7)(),a=n?(0,D.jsx)(q.Z,{type:"icon-lasso1"}):(0,D.jsx)(Se.Z,{});return"select"===t?(0,D.jsx)(y.Z,{type:"link",icon:a,onClick:function(){return r({lasso:!n})}}):(0,D.jsx)(y.Z,{type:"text",icon:a,onClick:function(){return r({mode:"select"})}})},Ce=t(49142),Ne=t(90785),Oe=t(91333),Re=t(75594),Ee=t(461),Te=t(95055),Fe=t(67415),Le=t(69951),Me=t(96324),Ae=t(67575),ze=t(30501),Ve=t(98272),Ue=t(24215),He=t(17973),Ke=t(19951),We=t(23605),_e=t(56200),Ge=t(18301),Xe=t(51570),Be=t(1829),qe=t.n(Be),Je=function(e){var n=e.instantSave,t=(0,l.useContext)(Y.TeamCtx).teamOn;return(0,D.jsxs)("div",{className:"right",children:[t?(0,D.jsx)($e,{}):(0,D.jsx)(en,{instantSave:n}),(0,D.jsx)(Qe,{})]})},Qe=function(){var e=(0,G.LH)(),n=(0,s.Z)(e,2),t=n[0],r=n[1];return(0,D.jsx)(y.Z,{type:t?"link":"text",icon:(0,D.jsx)(Me.Z,{}),onClick:function(){return r((function(e){return!e}))}})},Ye=function(e){var n=e.userID,t=(0,l.useState)(!1),r=(0,s.Z)(t,2),a=r[0],i=r[1],o=(0,l.useContext)(Y.TeamCtx),u=o.ignores,c=o.setIgnores,d=o.resetIO,f=o.userRec[n];if((0,l.useEffect)((function(){return i(!1)}),[f]),!f)return null;var p=f.userName,v=f.online,x=n===(0,Le.VN)(),g=u.has(n)&&!x;return(0,D.jsxs)("div",{className:"user-item","data-online":v,children:[(0,D.jsx)(B,{userInfo:f,size:"small",className:"room-avatar"}),a||(0,D.jsx)("span",{className:"user-name",children:p}),a&&(0,D.jsx)(Te.Z,{autoFocus:!0,className:"rename-input",defaultValue:p,onSearch:function(e){var n=e.trim();if(!n||n===p)return i(!1);(0,Le.lu)(n),d()},enterButton:(0,D.jsx)(y.Z,{icon:(0,D.jsx)(Ae.Z,{})})}),x?a||(0,D.jsx)(y.Z,{type:"text",icon:(0,D.jsx)(ze.Z,{}),onClick:function(){return i(!0)}}):(0,D.jsx)(y.Z,{type:"text",icon:g?(0,D.jsx)(Ve.Z,{}):(0,D.jsx)(Ue.Z,{}),onClick:function(){c((function(e){return e.has(n)?e.delete(n):e.add(n)}))}})]})},$e=function(){var e=(0,l.useContext)(Y.TeamCtx),n=e.code,t=e.userRec,a=e.connected,u=e.loadInfo,d=e.loadState,f=e.resetIO,p=window.location.href,v=function(){var e=(0,o.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,qe()("".concat(document.title,"\n").concat(p));case 3:w.ZP.destroy("copy"),w.ZP.success({content:"Link copied!",icon:(0,D.jsx)(A.Z,{}),key:"copy"}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),x=(0,l.useMemo)((function(){var e=(0,Le.VN)(),n=t[e],a=(0,i.Z)(t,[e].map(Ce.Z)),o=n?[n]:[],s=Object.values(a);return o.push.apply(o,(0,r.Z)(s.filter((function(e){return e.online}))).concat((0,r.Z)(s.filter((function(e){return!e.online}))))),o}),[t]),g=(0,l.useMemo)((function(){return x.filter((function(e){return e.online})).length}),[x]),m=(0,D.jsxs)("div",{className:"team-popover",children:[a||(0,D.jsx)(Ne.Z,{className:"disconn-alert",message:"Network failed.",icon:(0,D.jsx)(He.Z,{}),type:"error",showIcon:!0,banner:!0}),(0,D.jsx)(Fe.GD,{className:"code-display",value:String(n),length:4,plain:!0}),(0,D.jsx)(y.Z,{icon:(0,D.jsx)(Ke.Z,{}),className:"share-btn",onClick:v,block:!0,children:"Share"}),(0,D.jsx)(Oe.Z,{}),(0,D.jsx)("div",{className:"user-list",children:x.map((function(e){return(0,D.jsx)(Ye,{userID:e.userID},e.userID)}))})]}),Z=(0,l.useState)(!1),h=(0,s.Z)(Z,2),j=h[0],k=h[1],b=(0,D.jsxs)("div",{className:"team-title",children:[(0,D.jsx)("span",{children:"Team info"}),(0,D.jsx)(y.Z,{shape:"circle",type:"text",size:"small",loading:j,icon:(0,D.jsx)(We.Z,{}),onClick:(0,o.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k(!0),e.next=3,u();case 3:return e.next=5,d();case 5:k(!1),f();case 7:case"end":return e.stop()}}),e)})))})]});return(0,D.jsx)(W.Z,{content:m,trigger:"click",placement:"bottomRight",title:b,getPopupContainer:function(e){return e.parentElement},children:(0,D.jsx)(y.Z,{type:"text",icon:(0,D.jsx)(Re.Z,{status:a?"success":"error",count:a?g:"!",size:"small",children:(0,D.jsx)(_e.Z,{})})})})},en=function(e){var n,t=e.instantSave,r=null!==(n=(0,C.UO)().noteID)&&void 0!==n?n:"",a=(0,C.s0)(),i=function(){var e=(0,o.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t();case 2:return e.next=4,(0,Xe.r8)(r);case 4:if(e.sent){e.next=7;break}return e.abrupt("return",w.ZP.error("Can't create room."));case 7:return e.next=9,(0,S.SP)(r,{team:!0});case 9:a("/team/"+r);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,D.jsx)(y.Z,{type:"text",icon:(0,D.jsx)(Ge.Z,{}),onClick:function(){Ee.Z.confirm({title:"Enable team editing",content:"This will make your note public to anyone with the link.",icon:(0,D.jsx)(_e.Z,{style:{color:"#555"}}),onOk:i})}})},nn=["saved","instantSave"],tn=function(e){var n=e.saved,t=e.instantSave,r=(0,i.Z)(e,nn);return(0,D.jsxs)("header",{children:[(0,D.jsx)(xe,{saved:n,instantSave:t}),(0,D.jsx)(we,(0,a.Z)({},r)),(0,D.jsx)(Je,{instantSave:t})]})},rn=["pageRec","pdf","pageOrder"],an=["image","marked"];function on(){var e,n,t,u=null!==(e=(0,C.UO)().noteID)&&void 0!==e?e:"",g=(0,C.s0)(),m=(0,l.useState)(),j=(0,s.Z)(m,2),k=j[0],I=j[1],N=(0,l.useState)(),O=(0,s.Z)(N,2),R=O[0],A=O[1],z=(0,l.useState)(),V=(0,s.Z)(z,2),U=V[0],H=V[1],K=(0,l.useState)(),W=(0,s.Z)(K,2),_=W[0],X=W[1],B=(0,v.Z)(!0),q=(0,s.Z)(B,2),J=q[0],Q=q[1],$=(0,l.useContext)(Y.TeamCtx),ee=$.io,ne=$.teamOn,te=$.addTeamStatePage,re=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t=(0,l.useState)((0,h.D5)()),r=(0,s.Z)(t,2),a=r[0],i=r[1],u=(0,l.useRef)(!1),d=(0,l.useState)(""),f=(0,s.Z)(d,2),p=f[0],v=f[1],x=(0,l.useState)((0,h.D5)()),g=(0,s.Z)(x,2),m=g[0],Z=g[1],j=(0,l.useMemo)((function(){return T(m,n)}),[m,n]);return(0,l.useDebugValue)(j),(0,l.useEffect)((function(){(0,o.Z)(c().mark((function n(){var t;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,E.getItem(e);case 2:if(t=n.sent){n.next=5;break}return n.abrupt("return",u.current=!0);case 5:v(t);case 6:case"end":return n.stop()}}),n)})))()}),[e]),(0,l.useEffect)((function(){!u.current&&a.has(p)&&requestAnimationFrame((function(){var e;null===(e=a.get(p))||void 0===e||e.scrollIntoView(),u.current=!0}))}),[p,a]),(0,l.useEffect)((function(){u.current&&E.setItem(e,j)}),[e,j]),{scrollPage:function(e){var n;null===(n=a.get(e))||void 0===n||n.scrollIntoView()},setInviewRatios:Z,sectionRef:function(e){return function(n){n&&i((function(t){return t.set(e,n)}))}},currPageID:j}}(u,_),ae=re.setInviewRatios,oe=re.scrollPage,se=re.sectionRef,ue=re.currPageID;(0,l.useEffect)((function(){(0,o.Z)(c().mark((function e(){var n,t,r,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,S.U9)(u);case 2:if(n=e.sent){e.next=6;break}return w.ZP.error("Note not found"),e.abrupt("return",g("/"));case 6:t=n.pageRec,n.pdf,r=n.pageOrder,a=(0,i.Z)(n,rn),I((0,h.D5)(t)),X(r),A(a),H(b.createFromPages(t));case 11:case"end":return e.stop()}}),e)})))()}),[g,u,ne]),(0,l.useEffect)((function(){R&&(document.title=R.name+" - Multibility")}),[R]);var ce=(0,x.Z)((0,o.Z)(c().mark((function e(){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null===k||void 0===k?void 0:k.toObject(),e.next=3,(0,S.SP)(u,{pageRec:n});case 3:Q(!0);case 4:case"end":return e.stop()}}),e)})))),le=(0,l.useCallback)((0,F.Z)(ce,2e3),[ce]),de=le.flush,fe=function(e,n){I((function(t){return null===t||void 0===t?void 0:t.update(e,d.BJ,n)})),Q(!1),le()},pe=function(){var e=(0,o.Z)(c().mark((function e(n){var t,r=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>1&&void 0!==r[1]&&r[1],X(n),e.next=4,(0,S.SP)(u,{pageOrder:n});case 4:return e.next=6,de();case 6:t&&ve(n);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ve=function(e){return null===ee||void 0===ee?void 0:ee.emit("reorder",{pageOrder:e})},xe=(0,x.Z)((function(e){var n,t=e.deleted,r=e.pageOrder,a=e.prevOrder;(pe(r),t)&&(n=function(){return pe(a,!0)},w.ZP.warning({content:(0,D.jsxs)(D.Fragment,{children:["One page was deleted.",(0,D.jsx)(y.Z,{size:"small",type:"link",onClick:function(){w.ZP.destroy("DELETE"),n()},children:"Undo"})]}),key:"DELETE",duration:10}))})),ge=(0,x.Z)((function(e){var n=e.pageOrder,t=e.pageID,r=e.newPage;pe(n),fe(t,(function(){return r})),H((function(e){return null===e||void 0===e?void 0:e.addState(t,r)}))}));(0,l.useEffect)((function(){return null===ee||void 0===ee||ee.on("reorder",xe),null===ee||void 0===ee||ee.on("newPage",ge),function(){null===ee||void 0===ee||ee.removeAllListeners()}}),[ee,xe,ge]);var me=function(e,n,t){t.image,t.marked;var r=(0,i.Z)(t,an);null===ee||void 0===ee||ee.emit("newPage",{pageOrder:e,pageID:n,newPage:r}),te(n,t)},Ze=function(e,n){var t=Z.Dw.flaten(n);fe(e,(function(e){return(0,a.Z)((0,a.Z)({},e),{},{state:t})}))},he=function(e){if(U){var n=e(U);if(n!==U){H(n);var t,a=n.getLastDS(),i=n.lastOp;if(a&&i)Ze.apply(void 0,(0,r.Z)(a)),t=i,null===ee||void 0===ee||ee.emit("push",{operation:t},(function(e){var n=e.pageID,t=e.stroke;return H((function(e){return null===e||void 0===e?void 0:e.syncStrokeTime(n,t)}))}))}}},je=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(_){var t=n?null===k||void 0===k?void 0:k.get(e):void 0,r=(0,d.D4)(t),a=(0,s.Z)(r,2),i=a[0],o=a[1],u=M(_,e,i);me(u,i,o),pe(u),fe(i,(function(){return o})),H((function(e){return null===e||void 0===e?void 0:e.addState(i,o)}))}},ke=function(){var e=(0,L.Z)(_);e&&je(e)},be={noteID:u,pageRec:k,pageOrder:_,stateSet:U,currPageID:ue},Se=(0,D.jsxs)("div",{className:"reader container",children:[(0,D.jsx)(tn,{saved:J,instantSave:de,handleUndo:function(){return he((function(e){return e.undo()}))},handleRedo:function(){return he((function(e){return e.redo()}))},undoable:null!==(n=null===U||void 0===U?void 0:U.isUndoable())&&void 0!==n&&n,redoable:null!==(t=null===U||void 0===U?void 0:U.isRedoable())&&void 0!==t&&t}),(0,D.jsxs)("main",{children:[null===_||void 0===_?void 0:_.map((function(e){return(0,D.jsx)("section",{className:"note-page",ref:se(e),children:(0,D.jsx)(sn,(0,a.Z)({uid:e,updateStateSet:he,setInviewRatios:ae},be))},e)})),(0,D.jsx)(P,{addFinalPage:ke})]}),(0,D.jsx)(ie,(0,a.Z)({addPage:je,addFinalPage:ke,scrollPage:oe,deletePage:function(e){var n=null===_||void 0===_?void 0:_.filter((function(n){return n!==e}));(null===n||void 0===n?void 0:n.length)&&pe(n,!0)},saveReorder:pe,switchPageMarked:function(e){return fe(e,(function(e){return(0,a.Z)((0,a.Z)({},e),{},{marked:!e.marked})}))}},be))]});return(0,D.jsx)(G.kV,{children:(0,D.jsx)(p.Wk,{children:(0,D.jsx)(f.w3,{children:Se})})})}var sn=function(e){var n=e.uid,t=e.updateStateSet,r=e.setInviewRatios,a=e.pageRec,i=e.stateSet,o=e.currPageID,s=e.pageOrder,u=e.noteID,c=(0,l.useContext)(Y.TeamCtx),d=c.teamState,f=c.ignores,p=null===a||void 0===a?void 0:a.get(n),v=null===i||void 0===i?void 0:i.getOneState(n),x=null===d||void 0===d?void 0:d.getOnePageStateMap(n),g=(0,l.useMemo)((function(){if(!s)return!1;var e=s.indexOf(o),t=s.indexOf(n);return Math.abs(t-e)<=1}),[o,n,s]);return p&&v?(0,D.jsx)(N.default,{drawState:v,teamStateMap:x,updateState:function(e){t((function(t){return t.setState(n,e)}))},pdfIndex:p.pdfIndex,noteID:u,ignores:f,onViewChange:function(e,t){if(!e)return r((function(e){return e.delete(n)}));r((function(e){return e.set(n,t)}))},preload:g}):null}},60559:function(e,n,t){t.r(n),t.d(n,{TeamCtx:function(){return k},default:function(){return b}});var r=t(29439),a=t(15861),i=t(87757),o=t.n(i),s=t(72791),u=t(51570),c=t(56058),l=t(87962),d=t(78577),f=t(69951),p=function(e){return function(){return(0,d.io)(u._n,{query:{userID:(0,f.VN)(),userName:(0,f.vW)(),noteID:e}})}},v=t(16871),x=t(79856),g=t(91835),m=t(50419),Z=t(24124),h=t(24657),j=t(80184),k=s.createContext({io:void 0,code:0,teamOn:!1,connected:!1,ignores:(0,Z.l4)(),userRec:{},teamState:void 0,resetIO:function(){},loadInfo:function(){var e=(0,a.Z)(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!1);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),loadState:function(){var e=(0,a.Z)(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!1);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),setIgnores:function(){},addTeamStatePage:function(e,n){}});function b(){var e,n=null!==(e=(0,v.UO)().noteID)&&void 0!==e?e:"",t=(0,s.useState)(),i=(0,r.Z)(t,2),c=i[0],l=i[1],d=(0,s.useState)(-2),b=(0,r.Z)(d,2),w=b[0],I=b[1],D=(0,s.useState)({}),P=(0,r.Z)(D,2),C=P[0],N=P[1],O=(0,s.useState)((0,Z.l4)()),R=(0,r.Z)(O,2),E=R[0],T=R[1],F=(0,s.useState)(p(n)),L=(0,r.Z)(F,2),M=L[0],A=L[1],z=(0,s.useState)(!1),V=(0,r.Z)(z,2),U=V[0],H=V[1],K=(0,s.useState)(!1),W=(0,r.Z)(K,2),_=W[0],G=W[1],X=(0,v.s0)(),B=(0,s.useCallback)((0,a.Z)(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.dn)(n);case 2:if(t=e.sent){e.next=6;break}return m.ZP.error("Failed loading the team note info"),e.abrupt("return",!1);case 6:return I(t.code),e.abrupt("return",!0);case 8:case"end":return e.stop()}}),e)}))),[n]),q=(0,s.useCallback)((0,a.Z)(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.CD)(n);case 2:if(t=e.sent){e.next=6;break}return m.ZP.error("Failed loading the team note state"),e.abrupt("return",!1);case 6:return l(x.f.createFromTeamPages(t)),e.abrupt("return",!0);case 8:case"end":return e.stop()}}),e)}))),[n]),J=(0,s.useCallback)((function(){(0,u.f1)(n)}),[n]);(0,s.useEffect)((function(){var e=function(){var e=(0,a.Z)(o().mark((function e(){var n,t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B();case 2:return n=e.sent,e.next=5,q();case 5:if(t=e.sent,n&&t){e.next=8;break}return e.abrupt("return",X("/"));case 8:H(!0),J();case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return e(),J}),[B,q,X,J]),(0,s.useEffect)((function(){return M.on("push",(function(e){var n=e.operation,t=e.userID;l((function(e){return null===e||void 0===e?void 0:e.pushOperation(n,t)}))})),M.on("join",(function(e){var n=e.joined,t=e.members,r=n.userID,a=n.userName;N(t),r!==(0,f.VN)()&&S(r,a)})),M.on("leave",(function(e){var n=e.leaved,t=e.members,r=n.userID,a=n.userName;if(N(t),r===(0,f.VN)())return M.emit("join");y(r,a)})),M.on("newPage",(function(e){var n=e.pageID,t=e.newPage;l((function(e){return null===e||void 0===e?void 0:e.addPage(n,t)}))})),M.on("reset",(function(e){var n=e.userID,t=e.pageRec;n!==(0,f.VN)()&&l((function(e){return null===e||void 0===e?void 0:e.resetUser(n,t)}))})),M.on("connect_error",console.error),M.on("connect",(function(){return G(!0)})),M.on("disconnect",(function(){return G(!1)})),function(){M.removeAllListeners(),M.close()}}),[M]);return(0,j.jsx)(g.g,{loading:!U,children:(0,j.jsx)(k.Provider,{value:{io:M,code:w,teamOn:!0,ignores:E,userRec:C,connected:_,teamState:c,resetIO:function(){return A(p(n))},loadInfo:B,loadState:q,setIgnores:T,addTeamStatePage:function(e,n){l((function(t){return null===t||void 0===t?void 0:t.addPage(e,n)}))}},children:(0,j.jsx)(h.default,{})})})}var S=function(e,n){m.ZP.destroy(e),m.ZP.success({content:"".concat(n," joined the room"),icon:(0,j.jsx)(c.Z,{}),key:e})},y=function(e,n){m.ZP.destroy(e),m.ZP.warning({content:"".concat(n," leaved the room"),icon:(0,j.jsx)(l.Z,{}),key:e})}}}]);
//# sourceMappingURL=310.8ef7dbab.chunk.js.map