(this.webpackJsonpmultibility=this.webpackJsonpmultibility||[]).push([[0],{191:function(t,e){},220:function(t,e,n){},236:function(t,e,n){},237:function(t,e,n){},285:function(t,e){},286:function(t,e){},287:function(t,e){},288:function(t,e){},289:function(t,e){},291:function(t,e,n){},450:function(t,e,n){},451:function(t,e,n){},452:function(t,e,n){"use strict";n.r(e);var r=n(0),a=n.n(r),c=n(35),u=n.n(c),i=(n(236),n(74)),s=n(23),o=n(12),l=(n(237),n(104)),d=n(56),f=n(32),b=n(8),j=n.n(b),p=n(22),h=n(33),O=n.n(h),v=n(49),x=n(77),m=n(78),g=n(28),k={state:"drawing",strokes:Object(g.a)(),uidStack:Object(g.a)(),undoStack:Object(g.c)(),eraseStack:Object(g.a)(),deleted:Object(g.e)(),position:Object(g.a)()},w=Object(g.d)(k),y={strokes:[],position:[]},S=function(){function t(e,n,r){Object(x.a)(this,t),this.immutable=e,this.width=n,this.height=r}return Object(m.a)(t,[{key:"getImmutable",value:function(){return this.immutable}},{key:"getUidStack",value:function(){return this.getImmutable().get("uidStack")}},{key:"getUndoStack",value:function(){return this.getImmutable().get("undoStack")}},{key:"getEraseStack",value:function(){return this.getImmutable().get("eraseStack")}},{key:"getValidEraseStack",value:function(){var t=this.getDeleted(),e=this.getUndoStack();return this.getEraseStack().filter((function(n){var r=n.uid;return!t.has(r)&&!e.has(r)}))}},{key:"getStrokes",value:function(){return this.getImmutable().get("strokes")}},{key:"getValidStrokes",value:function(){var t=this.getDeleted(),e=this.getUndoStack(),n=this.getValidEraseStack();return this.getStrokes().filter((function(r){var a=r.uid;return!t.has(a)&&!e.has(a)&&!n.some((function(t){return t.erased.has(a)}))}))}},{key:"getDeleted",value:function(){return this.getImmutable().get("deleted")}},{key:"getState",value:function(){return this.getImmutable().get("state")}},{key:"getPosition",value:function(){return this.getImmutable().get("position")}},{key:"getLastStroke",value:function(){return this.getImmutable().get("strokes").last()}}],[{key:"createEmpty",value:function(e,n){return new t(w(),e,n)}},{key:"createFromStored",value:function(){}},{key:"undo",value:function(e){var n=e.getUidStack().last();return n?new t(e.getImmutable().set("state","revoking").update("undoStack",(function(t){return t.add(n)})).update("uidStack",(function(t){return t.pop()})),e.width,e.height):e}},{key:"redo",value:function(e){var n=e.getUndoStack().last();return n?new t(e.getImmutable().update("undoStack",(function(t){return t.butLast()})).update("uidStack",(function(t){return t.push(n)})),e.width,e.height):e}},{key:"pushStroke",value:function(e,n,r){var a=Object(v.v4)(),c=e.getUndoStack(),u=I(e.getImmutable().set("state","drawing").update("deleted",(function(t){return t.concat(c)})).set("undoStack",Object(g.c)()).update("strokes",(function(t){return t.push({uid:a,points:r})})).update("uidStack",(function(t){return t.push(a)}))),i=e.getPosition();return i=function(t,e,n){for(var r=e.data,a=r.length,c=0;c<a;c+=4)r[c+3]&&(t=t.update(c/4,Object(g.e)(),(function(t){return(null!==t&&void 0!==t?t:Object(g.e)()).add(n)})));return t}(i,n,a),new t(u.set("position",i),e.width,e.height)}},{key:"simplePush",value:function(e,n){return new t(e.getImmutable().update("strokes",(function(t){return t.push(n)})),e.width,e.height)}},{key:"eraseStrokes",value:function(e,n){var r=e.getPosition();if(!r)return e;var a=Object(v.v4)(),c=function(t,e){for(var n=e.data,r=Object(g.e)(),a=n.length,c=0;c<a;c+=4){var u;if(n[c+3])r=r.concat(null!==(u=t.get(c/4))&&void 0!==u?u:Object(g.e)())}return r}(r,n);return new t(I(e.getImmutable().update("eraseStack",(function(t){return t.push({uid:a,erased:c})})).update("uidStack",(function(t){return t.push(a)}))),e.width,e.height)}},{key:"flaten",value:function(t){var e=I(t.getImmutable()),n=e.get("deleted"),r=t.getValidEraseStack().reduce((function(t,e){return t.concat(e.erased)}),Object(g.e)()),a=n.concat(r);return{strokes:e.get("strokes").filter((function(t){return!a.has(t.uid)})).toArray(),position:e.get("position").map((function(t){return t?t.toArray():t})).toArray()}}},{key:"loadFromFlat",value:function(e,n,r){var a=e.strokes,c=e.position;return new t(w().set("strokes",Object(g.a)(a)).set("position",Object(g.a)(null===c||void 0===c?void 0:c.map((function(t){return t?Object(g.e)(t):t})))),n,r)}}]),t}();function I(t){var e=t.get("undoStack");return t.update("deleted",(function(t){return t.concat(e)})).set("undoStack",Object(g.c)()).update("uidStack",(function(t){return t.filter((function(t){return!e.has(t)}))}))}var C=n(221),L="https://api.slotdumpling.top/paint",T=function(){return Object(C.io)(L)},E=n(81),A=n.n(E),N=n(127);A.a.defaults.baseURL=L,A.a.interceptors.request.use((function(t){return console.log(t.method,t.url),t}));var U=function(){var t;return function(){if(t)return t;var e=localStorage.getItem("user_id");return e||(e=Object(v.v4)(),localStorage.setItem("user_id",e)),t=e,e}}();function D(t){return R.apply(this,arguments)}function R(){return(R=Object(p.a)(j.a.mark((function t(e){var n,r,a,c,u;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,A.a.get("code/".concat(e));case 3:if(n=t.sent,200!==(r=n.data).statusCode){t.next=12;break}return a=r.noteId,c=r.pageInfos,u=r.noteInfo,t.next=9,bt(a,u,c);case 9:return t.abrupt("return",a);case 12:return t.abrupt("return",null);case 13:t.next=19;break;case 15:return t.prev=15,t.t0=t.catch(0),console.error(t.t0),t.abrupt("return",null);case 19:case"end":return t.stop()}}),t,null,[[0,15]])})))).apply(this,arguments)}var F=function(t){for(var e=Object(N.cloneDeep)(t),n=0,r=Object.keys(e);n<r.length;n++){delete e[r[n]].state.position}return e};function P(t,e,n){return W.apply(this,arguments)}function W(){return(W=Object(p.a)(j.a.mark((function t(e,n,r){var a,c,u,i;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=F(r),a=n.uid,c=n.name,t.prev=2,t.next=5,A.a.put("create/".concat(e),{userId:U(),pageRecord:r,noteInfo:{uid:a,name:c}});case 5:if(u=t.sent,201!==(i=u.data).statusCode){t.next=11;break}return t.abrupt("return",i.code);case 11:return t.abrupt("return",null);case 12:t.next=18;break;case 14:return t.prev=14,t.t0=t.catch(2),console.error(t.t0),t.abrupt("return",null);case 18:case"end":return t.stop()}}),t,null,[[2,14]])})))).apply(this,arguments)}function M(t){return _.apply(this,arguments)}function _(){return(_=Object(p.a)(j.a.mark((function t(e){var n,r,a,c,u,i;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,A.a.get("room/".concat(e));case 3:if(n=t.sent,200!==(r=n.data).statusCode){t.next=13;break}return a=r.teamPages,c=r.code,u=r.noteInfo,t.next=9,dt(a);case 9:return i=t.sent,t.abrupt("return",{code:c,pages:i,info:u});case 13:return t.abrupt("return",null);case 14:t.next=20;break;case 16:return t.prev=16,t.t0=t.catch(0),console.error(t.t0),t.abrupt("return",null);case 20:case"end":return t.stop()}}),t,null,[[0,16]])})))).apply(this,arguments)}var B=["#64748b","#78716c","#ef4444","#f97316","#eab308","#84cc16","#22c55e","#10b981","#14b8a6","#06b6d4","#0ea5e9","#3b82f6","#6366f1","#8b5cf6","#a855f7","#d946ef","#ec4899","#f43f5e"];function G(){var t=Math.floor(Math.random()*B.length);return B[t]}function z(){return K.apply(this,arguments)}function K(){return(K=Object(p.a)(j.a.mark((function t(){var e;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,O.a.getItem("ALL_NOTES");case 2:if(!(e=t.sent)){t.next=7;break}return t.abrupt("return",e);case 7:return O.a.setItem("ALL_NOTES",{}),t.abrupt("return",{});case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function V(){return q.apply(this,arguments)}function q(){return(q=Object(p.a)(j.a.mark((function t(){var e;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,O.a.getItem("TAG_LIST");case 2:if(!(e=t.sent)){t.next=7;break}return t.abrupt("return",e);case 7:return O.a.setItem("TAG_LIST",[]),t.abrupt("return",[]);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function J(){return Y.apply(this,arguments)}function Y(){return(Y=Object(p.a)(j.a.mark((function t(){var e;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,O.a.getItem("ALL_TAGS");case 2:if(!(e=t.sent)){t.next=7;break}return t.abrupt("return",e);case 7:return O.a.setItem("ALL_TAGS",{}),t.abrupt("return",{});case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function H(t){return X.apply(this,arguments)}function X(){return(X=Object(p.a)(j.a.mark((function t(e){var n,r,a,c;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Object(v.v4)(),r={uid:n,name:e,color:G(),notes:[]},t.t0=f.a,t.t1=f.a,t.t2={},t.next=7,J();case 7:return t.t3=t.sent,t.t4=(0,t.t1)(t.t2,t.t3),t.t5={},t.t6=Object(d.a)({},n,r),a=(0,t.t0)(t.t4,t.t5,t.t6),t.next=14,O.a.setItem("ALL_TAGS",a);case 14:return t.next=16,V();case 16:return(c=t.sent).push(n),t.next=20,O.a.setItem("TAG_LIST",c);case 20:return t.abrupt("return",[a,c]);case 21:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function $(t){return Q.apply(this,arguments)}function Q(){return(Q=Object(p.a)(j.a.mark((function t(e){var n,r;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,J();case 2:return delete(n=t.sent)[e],t.next=6,O.a.setItem("ALL_TAGS",n);case 6:return t.next=8,V();case 8:return r=(r=t.sent).filter((function(t){return t!==e})),t.next=12,O.a.setItem("TAG_LIST",r);case 12:return t.abrupt("return",[n,r]);case 13:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Z(t){return tt.apply(this,arguments)}function tt(){return(tt=Object(p.a)(j.a.mark((function t(e){var n,r;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,J();case 2:return n=t.sent,(r=n[e.uid]).name=e.name,r.color=e.color,r.notes=e.notes,t.next=9,O.a.setItem("ALL_TAGS",n);case 9:return t.abrupt("return",n);case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function et(t){return nt.apply(this,arguments)}function nt(){return(nt=Object(p.a)(j.a.mark((function t(e){return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,O.a.getItem(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function rt(t,e){return at.apply(this,arguments)}function at(){return(at=Object(p.a)(j.a.mark((function t(e,n){var r,a,c;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,z();case 2:return r=t.sent,n.pages,n.pdf,a=Object(l.a)(n,["pages","pdf"]),r[e]=Object(f.a)(Object(f.a)({},r[e]),a),t.next=7,O.a.setItem("ALL_NOTES",r);case 7:return t.next=9,et(e);case 9:if(c=t.sent){t.next=12;break}return t.abrupt("return");case 12:return t.next=14,O.a.setItem(e,Object(f.a)(Object(f.a)({},c),n));case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ct(t){return ut.apply(this,arguments)}function ut(){return(ut=Object(p.a)(j.a.mark((function t(e){var n,r,a,c;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.uid,r=e.tagId,t.next=3,z();case 3:return(a=t.sent)[n]=e,t.next=7,O.a.setItem("ALL_NOTES",a);case 7:return t.next=9,J();case 9:if(c=t.sent,"DEFAULT"===r){t.next=14;break}return c[r].notes.push(e.uid),t.next=14,O.a.setItem("ALL_TAGS",c);case 14:return t.abrupt("return",{tags:c,allNotes:a});case 15:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function it(t){return st.apply(this,arguments)}function st(){return(st=Object(p.a)(j.a.mark((function t(e){var n;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,O.a.setItem(e.uid,e);case 2:return e.pdf,e.pages,n=Object(l.a)(e,["pdf","pages"]),t.next=5,ct(n);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ot(t){return lt.apply(this,arguments)}function lt(){return(lt=Object(p.a)(j.a.mark((function t(e){var n,r,a,c,u,i;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,et(e);case 2:return n=t.sent,t.next=5,z();case 5:return r=t.sent,t.next=8,J();case 8:if(a=t.sent,n){t.next=11;break}return t.abrupt("return",{tags:a,allNotes:r});case 11:return t.next=13,O.a.removeItem(e);case 13:return n.pdf,n.pages,c=Object(l.a)(n,["pdf","pages"]),delete r[e],t.next=17,O.a.setItem("ALL_NOTES",r);case 17:if("DEFAULT"===(u=c.tagId)){t.next=23;break}return i=a[u].notes,a[u].notes=i.filter((function(t){return t!==e})),t.next=23,O.a.setItem("ALL_TAGS",a);case 23:return t.abrupt("return",{tags:a,allNotes:r});case 24:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function dt(t){return ft.apply(this,arguments)}function ft(){return(ft=Object(p.a)(j.a.mark((function t(e){var n,r,a,c,u,i,s,l;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(n={},r=0,a=Object.entries(e);r<a.length;r++)c=Object(o.a)(a[r],2),u=c[0],i=c[1],s=i.ratio,delete(l=i.states)[U()],n[u]={ratio:s,state:{strokes:Object.values(l).flat(1)}};return t.abrupt("return",n);case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function bt(t,e,n){return jt.apply(this,arguments)}function jt(){return(jt=Object(p.a)(j.a.mark((function t(e,n,r){var a,c,u,i,s,l;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,et(e);case 2:if(!t.sent){for(a={},c=0,u=Object.entries(r);c<u.length;c++)i=Object(o.a)(u[c],2),s=i[0],l=i[1].ratio,a[s]={ratio:l,state:y};it(Object(f.a)(Object(f.a)({},n),{},{tagId:"DEFAULT",team:!0,pages:a}))}case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var pt=n(229),ht=n(95),Ot=n(453),vt=n(163),xt=n(222),mt=n.n(xt);function gt(t){return new Promise((function(e){t.toBlob(e)}))}function kt(t,e,n){return wt.apply(this,arguments)}function wt(){return(wt=Object(p.a)(j.a.mark((function t(e,n,r){var a,c,u,i,s,o,l,d;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getPage(n);case 2:if(a=t.sent,c=a.getViewport({scale:r}),console.log(c),u=document.createElement("canvas"),i=u.getContext("2d")){t.next=9;break}throw new Error("can't get virtual canvas context");case 9:return s=c.height,o=c.width,l=s/o,u.width=Math.floor(o*r),u.height=Math.floor(s*r),t.next=15,a.render({canvasContext:i,viewport:c,transform:[r,0,0,r,0,0]}).promise;case 15:return t.next=17,gt(u);case 17:if(d=t.sent){t.next=20;break}throw new Error("can't get canvas image blob");case 20:return t.abrupt("return",[d,l]);case 21:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function yt(t){return St.apply(this,arguments)}function St(){return(St=Object(p.a)(j.a.mark((function t(e){var n,r,a,c,u,i,s,l,d,f,b,p,h,O=arguments;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=O.length>1&&void 0!==O[1]?O[1]:2,t.next=3,vt.getDocument(e).promise;case 3:r=t.sent,a=r.numPages,c=[],u=[],i=1;case 8:if(!(i<=a)){t.next=20;break}return t.next=11,kt(r,i,n);case 11:s=t.sent,l=Object(o.a)(s,2),d=l[0],f=l[1],c.push(d),u.push(f);case 17:i+=1,t.next=8;break;case 20:return t.next=22,kt(r,1,.5);case 22:return b=t.sent,p=Object(o.a)(b,1),h=p[0],t.abrupt("return",{images:c,ratios:u,thumbnail:h});case 26:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function It(t){return Ct.apply(this,arguments)}function Ct(){return(Ct=Object(p.a)(j.a.mark((function t(e){var n,r,a,c,u,i,s;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=URL.createObjectURL(e),t.next=3,yt(n);case 3:return r=t.sent,a=r.images,c=r.ratios,u=r.thumbnail,i={},a.forEach((function(t,e){i[Object(v.v4)()]={image:t,ratio:c[e],state:{strokes:[],position:[]}}})),s=e.name.replace(".pdf",""),t.abrupt("return",{uid:Object(v.v4)(),name:s,tagId:"DEFAULT",team:!1,pdf:e,thumbnail:u,pages:i});case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}vt.GlobalWorkerOptions.workerSrc=mt.a;var Lt=n(79),Tt=n(461),Et=n(462),At=n(463);function Nt(){return{uid:Object(v.v4)(),name:"New note ".concat(Date.now()),tagId:"DEFAULT",team:!1,pages:Object(d.a)({},Object(v.v4)(),{ratio:1.5,state:y})}}n(291);var Ut=n(4);function Dt(t){var e=t.value,n=void 0===e?0:e,a=t.digitNum,c=void 0===a?4:a,u=t.onChange,i=void 0===u?function(){}:u,s=t.onSubmit;function l(t){return 0===t?new Array(c).fill(""):String(t).slice(0,c).padEnd(c,"x").split("").map((function(t){return"x"===t?"":t}))}var d=Object(r.useState)(0),f=Object(o.a)(d,2),b=f[0],j=f[1],p=Object(r.useState)(l(n)),h=Object(o.a)(p,2),O=h[0],v=h[1];function x(){-1===b?m.current.forEach((function(t){return t.blur()})):m.current[b].focus()}Object(r.useEffect)((function(){var t=l(n);v(t)}),[n]),Object(r.useEffect)((function(){var t=O.findIndex((function(t){return""===t}));j(t);var e=Number(O.join(""));e!==n&&(i(e),-1===t&&s(e))}),[O]),Object(r.useEffect)((function(){x()}),[b]);var m=Object(r.useRef)([]);function g(t){if("Backspace"===t.key){var e=Math.max(0,b-1);j(e),v((function(t){var n=t.slice();return n[e]="",n}))}}return Object(r.useEffect)((function(){m.current=m.current.slice(0,c)}),[c]),Object(Ut.jsxs)("div",{className:"digit-input",children:[O.map((function(t,e){return Object(Ut.jsx)("input",{ref:function(t){t&&(m.current[e]=t)},value:t,pattern:"\\d*",onChange:function(t){return function(t,e){/^[0-9]$/.test(t)&&v((function(n){var r=n.slice();return r[e]=t,r}))}(t.target.value,e)},onKeyUp:g},e)})),Object(Ut.jsx)("div",{className:"click-area",onClick:x})]})}function Rt(){return Object(Ut.jsxs)("div",{id:"right-tools",children:[Object(Ut.jsx)(Wt,{}),Object(Ut.jsx)(Ft,{}),Object(Ut.jsx)(Pt,{})]})}function Ft(){var t=Object(r.useState)(!1),e=Object(o.a)(t,2),n=e[0],a=e[1],c=Object(r.useRef)(null),u=Object(r.useContext)(ue).tagUid,i=Object(r.useContext)(ie),s=i.setAllTags,l=i.setAllNotes;function d(){return(d=Object(p.a)(j.a.mark((function t(e){var n,r,c,i,o,d;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((n=e.target.files)&&1===n.length){t.next=3;break}return t.abrupt("return");case 3:if("application/pdf"===(r=n[0]).type){t.next=6;break}return t.abrupt("return");case 6:return a(!0),t.next=9,It(r);case 9:return(c=t.sent).tagId=u,t.next=13,it(c);case 13:i=t.sent,o=i.tags,d=i.allNotes,s(o),l(d),a(!1),pt.b.success("PDF Loaded");case 20:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return Object(Ut.jsxs)(Ut.Fragment,{children:[Object(Ut.jsx)("input",{ref:c,type:"file",onChange:function(t){return d.apply(this,arguments)},accept:"application/pdf",multiple:!1}),Object(Ut.jsx)(ht.a,{onClick:function(){var t;null===(t=c.current)||void 0===t||t.click()},type:"text",shape:"circle",disabled:n,icon:n?Object(Ut.jsx)(Lt.a,{}):Object(Ut.jsx)(Tt.a,{})})]})}function Pt(){var t=Object(r.useContext)(ue).tagUid,e=Object(r.useContext)(ie),n=e.setAllTags,a=e.setAllNotes;function c(){return(c=Object(p.a)(j.a.mark((function e(){var r,c,u,i;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=Nt()).tagId=t,e.next=4,it(r);case 4:c=e.sent,u=c.tags,i=c.allNotes,n(u),a(i);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(Ut.jsx)(ht.a,{type:"primary",shape:"circle",onClick:function(){return c.apply(this,arguments)},icon:Object(Ut.jsx)(Et.a,{})})}function Wt(){var t=Object(r.useState)(0),e=Object(o.a)(t,2),n=e[0],a=e[1],c=Object(s.f)();function u(){return(u=Object(p.a)(j.a.mark((function t(e){var n;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,D(e);case 2:(n=t.sent)?c("/team/".concat(n)):(a(0),pt.b.error("Room doesn't exist."));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return Object(Ut.jsx)(Ot.a,{trigger:"click",title:"Join a team note.",content:Object(Ut.jsx)(Dt,{value:n,onChange:a,onSubmit:function(t){return u.apply(this,arguments)}}),children:Object(Ut.jsx)(ht.a,{icon:Object(Ut.jsx)(At.a,{}),type:"text",shape:"circle"})})}var Mt=n(457),_t=n(230),Bt=n(101),Gt=n(464);function zt(){var t=Object(r.useState)(!1),e=Object(o.a)(t,2),n=e[0],a=e[1],c=Object(r.useState)(""),u=Object(o.a)(c,2),i=u[0],s=u[1],l=Object(r.useContext)(ue).editing,d=Object(r.useContext)(ie),f=d.setAllTags,b=d.setTagList,h=d.setEditing;function O(){return(O=Object(p.a)(j.a.mark((function t(){var e,n,r,c,u;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=i.trim()){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,H(e);case 7:n=t.sent,r=Object(o.a)(n,2),c=r[0],u=r[1],f(c),b(u),a(!1),s("");case 15:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return Object(Ut.jsxs)("div",{id:"left-tools",children:[Object(Ut.jsx)("span",{id:"edit-button",children:Object(Ut.jsx)(ht.a,{onClick:function(){h((function(t){return!t}))},type:l?"primary":"text",block:!0,children:l?"Done":"Edit"})}),n?Object(Ut.jsxs)(Ut.Fragment,{children:[Object(Ut.jsx)(Mt.a,{placeholder:"Tag name...",style:{width:150},value:i,onChange:function(t){s(t.target.value)}}),Object(Ut.jsx)(ht.a,{disabled:""===i,type:"link",size:"small",onClick:function(){return O.apply(this,arguments)},icon:Object(Ut.jsx)(_t.a,{})}),Object(Ut.jsx)(ht.a,{type:"text",size:"small",onClick:function(){s(""),a(!1)},icon:Object(Ut.jsx)(Bt.a,{})})]}):Object(Ut.jsx)(ht.a,{type:"text",onClick:function(){a(!0)},icon:Object(Ut.jsx)(Gt.a,{})})]})}var Kt=n(458),Vt=n(459),qt=n(456),Jt=n(460),Yt=n(465),Ht=n(466),Xt=n(467),$t=n(468);function Qt(t){var e,n,a=t.uid,c=Object(r.useContext)(ue),u=c.editing,i=c.allTags,s=Object(r.useContext)(ie),l=s.setTagUid,d=s.setTagList,f=s.setAllTags,b=i[a],h=Object(r.useState)(!1),O=Object(o.a)(h,2),v=O[0],x=O[1],m=Object(r.useState)(null!==(e=null===b||void 0===b?void 0:b.name)&&void 0!==e?e:""),g=Object(o.a)(m,2),k=g[0],w=g[1],y=Object(r.useState)(null!==(n=null===b||void 0===b?void 0:b.color)&&void 0!==n?n:""),S=Object(o.a)(y,2),I=S[0],C=S[1];if(!b)return Object(Ut.jsx)(Ut.Fragment,{});function L(){return(L=Object(p.a)(j.a.mark((function t(){var e,n,r,c;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,$(a);case 2:e=t.sent,n=Object(o.a)(e,2),r=n[0],c=n[1],l("DEFAULT"),d(c),f(r);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function T(){return(T=Object(p.a)(j.a.mark((function t(){var e,n;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={uid:a,name:k,color:I,notes:b.notes},t.next=3,Z(e);case 3:n=t.sent,f(n),x(!1);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var E=function(t){var e={backgroundColor:t.color};return Object(Ut.jsx)("div",{className:"tag-circle",style:e})},A=Object(Ut.jsx)(Kt.a,{value:I,onSelect:C,children:B.map((function(t){return Object(Ut.jsx)(Kt.a.Option,{value:t,children:Object(Ut.jsx)(E,{color:t})},t)}))}),N=function(){return Object(Ut.jsx)(Mt.a,{size:"small",className:"tag-name-input",addonBefore:A,value:k,onChange:function(t){return w(t.target.value)}})};return Object(Ut.jsxs)("div",{className:"menu-item",children:[u&&v?Object(Ut.jsxs)(Ut.Fragment,{children:[Object(Ut.jsx)(Vt.a,{title:"Delete this tag?",onConfirm:function(){return L.apply(this,arguments)},placement:"left",okText:"Yes",cancelText:"No",children:Object(Ut.jsx)(ht.a,{type:"text",danger:!0,size:"small",icon:Object(Ut.jsx)(Yt.a,{})})}),Object(Ut.jsx)(N,{})]}):Object(Ut.jsxs)(Ut.Fragment,{children:[Object(Ut.jsx)(E,{color:I}),Object(Ut.jsx)("span",{children:k})]}),u&&v&&Object(Ut.jsxs)(Ut.Fragment,{children:[Object(Ut.jsx)(ht.a,{disabled:""===k,size:"small",type:"link",onClick:function(){return T.apply(this,arguments)},icon:Object(Ut.jsx)(_t.a,{})}),Object(Ut.jsx)(ht.a,{size:"small",type:"text",onClick:function(){w(b.name),C(b.color),x(!1)},icon:Object(Ut.jsx)(Bt.a,{})})]}),u&&!v&&Object(Ut.jsx)(ht.a,{size:"small",type:"text",onClick:function(){return x(!0)},icon:Object(Ut.jsx)(Ht.a,{})})]})}function Zt(){var t=Object(r.useContext)(ue).tagList,e=Object(r.useContext)(ie).setTagUid;var n=qt.a.Item;return Object(Ut.jsxs)("aside",{children:[Object(Ut.jsx)("label",{htmlFor:"aside-checkbox",id:"aside-label",children:Object(Ut.jsx)(Jt.a,{children:Object(Ut.jsx)(Xt.a,{})})}),Object(Ut.jsx)("input",{type:"checkbox",id:"aside-checkbox"}),Object(Ut.jsxs)(qt.a,{onClick:function(t){var n=t.key;e(n)},id:"side-menu",defaultSelectedKeys:["DEFAULT"],defaultOpenKeys:["sub1"],mode:"inline",children:[Object(Ut.jsxs)(n,{children:[Object(Ut.jsx)($t.a,{id:"all-note-icon"}),Object(Ut.jsx)("span",{children:"All Notes"})]},"DEFAULT"),t.map((function(t){return Object(Ut.jsx)(n,{children:Object(Ut.jsx)(Qt,{uid:t})},t)}))]})]})}var te=n(469),ee=n(470);function ne(t){var e=t.noteList;return Object(Ut.jsx)("div",{id:"note-list",children:e.map((function(t){return Object(Ut.jsx)(re,{noteInfo:t},t.uid)}))})}var re=function(t){var e=t.noteInfo,n=Object(r.useContext)(ue).editing,a=e.team,c=e.uid,u=e.name,s=e.thumbnail,l=n?"#":"".concat(a?"team":"reader","/").concat(c),b=Object(r.useContext)(ie),h=b.setAllTags,O=b.setAllNotes,v=Object(r.useState)(u),x=Object(o.a)(v,2),m=x[0],g=x[1];function k(){return(k=Object(p.a)(j.a.mark((function t(){var e,n,r;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ot(c);case 2:e=t.sent,n=e.tags,r=e.allNotes,h(n),O(r);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var w=Object(r.useMemo)((function(){return s?URL.createObjectURL(s):null}),[s]);Object(r.useEffect)((function(){var t=w||"";return function(){return URL.revokeObjectURL(t)}}),[w]);return Object(Ut.jsx)(i.b,{to:l,children:Object(Ut.jsxs)("div",{className:"list-item",children:[Object(Ut.jsxs)("div",{className:"thumbnail-wrapper",children:[Object(Ut.jsx)("img",{src:w||"./default.png",alt:u,className:"thumbnail"}),a&&Object(Ut.jsx)(Jt.a,{color:"blue",className:"cloud-icon",children:Object(Ut.jsx)(te.a,{})})]}),n||Object(Ut.jsx)("p",{className:"note-name",children:u}),n&&Object(Ut.jsx)(Mt.a,{className:"note-name-input",value:m,onChange:function(t){return g(t.target.value)},onBlur:function(){rt(c,{name:m}),O((function(t){return Object(f.a)(Object(f.a)({},t),{},Object(d.a)({},c,Object(f.a)(Object(f.a)({},t[c]),{},{name:m})))}))}}),n&&Object(Ut.jsx)(Vt.a,{title:"Delete this note?",onConfirm:function(){return k.apply(this,arguments)},okText:"Yes",cancelText:"No",children:Object(Ut.jsx)(ht.a,{className:"note-delete",type:"text",danger:!0,icon:Object(Ut.jsx)(ee.a,{})})})]})})},ae=n(227),ce=n.n(ae),ue=Object(r.createContext)({tagUid:"DEFAULT",editing:!1,tagList:[],allNotes:{},allTags:{}}),ie=Object(r.createContext)({setTagList:function(){},setAllNotes:function(){},setAllTags:function(){},setTagUid:function(){},setEditing:function(){}});function se(){var t=Object(r.useState)([]),e=Object(o.a)(t,2),n=e[0],a=e[1],c=Object(r.useState)({}),u=Object(o.a)(c,2),i=u[0],s=u[1],l=Object(r.useState)({}),d=Object(o.a)(l,2),f=d[0],b=d[1],j=Object(r.useState)("DEFAULT"),p=Object(o.a)(j,2),h=p[0],O=p[1],v=Object(r.useState)(!1),x=Object(o.a)(v,2),m=x[0],g=x[1],k=Object(r.useMemo)((function(){return"DEFAULT"===h?{uid:"",name:"All Notes",color:"#000",notes:Object.keys(i)}:f[h]}),[h,f,i]),w=Object(r.useMemo)((function(){return k.notes.filter((function(t){return t in i})).map((function(t){return i[t]}))}),[k,i]);return Object(r.useEffect)((function(){z().then(s),J().then(b),V().then(a)}),[]),Object(Ut.jsx)(ue.Provider,{value:{tagUid:h,editing:m,allNotes:i,allTags:f,tagList:n},children:Object(Ut.jsx)(ie.Provider,{value:{setAllNotes:s,setAllTags:b,setEditing:g,setTagList:a,setTagUid:O},children:Object(Ut.jsxs)("div",{id:"container",children:[Object(Ut.jsxs)("div",{id:"header",children:[Object(Ut.jsx)(zt,{}),Object(Ut.jsx)(ce.a,{level:4,children:k.name}),Object(Ut.jsx)(Rt,{})]}),Object(Ut.jsxs)("div",{id:"main",children:[Object(Ut.jsx)(Zt,{}),Object(Ut.jsx)(ne,{noteList:w})]})]})})})}var oe=n(455),le=n(471),de=n(472),fe=n(164),be=n(473),je=n(474),pe=n(475),he=n(476),Oe=n(477),ve=function(){function t(e,n,r){Object(x.a)(this,t),this.context=e,this.width=n,this.height=r,this.points=[]}return Object(m.a)(t,[{key:"drawBegin",value:function(t){this.points.push(t);var e=t.x,n=t.y,r=t.lineWidth;this.context.lineWidth=r,this.context.beginPath(),this.context.moveTo(e,n),this.context.stroke()}},{key:"drawCurve",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"black",n=this.points.slice(-1)[0];if(this.points.push(t),!(this.points.length<3)){var r=(t.x+n.x)/2,a=(t.y+n.y)/2;this.context.strokeStyle=e,this.context.lineCap="round",this.context.lineJoin="round",this.context.lineWidth=n.lineWidth,this.context.quadraticCurveTo(n.x,n.y,r,a),this.context.stroke(),this.context.beginPath(),this.context.moveTo(r,a)}}},{key:"getImageData",value:function(){return this.context.getImageData(0,0,this.width,this.height)}}],[{key:"createRaw",value:function(e,n){var r=document.createElement("canvas");r.width=e,r.height=n;var a=r.getContext("2d");if(!a)throw Error("can't get canvas context");return new t(a,e,n)}}]),t}(),xe=100,me=function(){function t(e,n,r){Object(x.a)(this,t),this.context=e,this.width=n,this.height=r,this.points=[],this.mainDrawer=void 0,this.mirrorDrawer=void 0,this.ratio=void 0,this.mainDrawer=new ve(e,n,r),n<=xe&&r<=xe?(this.ratio=1,this.mirrorDrawer=ve.createRaw(n,r)):n>r?(this.ratio=n/xe,this.mirrorDrawer=ve.createRaw(xe,r/this.ratio)):(this.ratio=r/xe,this.mirrorDrawer=ve.createRaw(n/this.ratio,xe))}return Object(m.a)(t,[{key:"drawBegin",value:function(t){this.points.push(t),this.mainDrawer.drawBegin(t),this.mirrorDrawer.drawBegin(this.computeMirrorPoint(t))}},{key:"drawCurve",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"black";this.points.push(t),this.mainDrawer.drawCurve(t,e),this.mirrorDrawer.drawCurve(this.computeMirrorPoint(t),"black")}},{key:"computeLineWidth",value:function(t){var e,n;return 5*Math.log(t+1)+.8*(null!==(e=null===(n=this.points.slice(-1)[0])||void 0===n?void 0:n.lineWidth)&&void 0!==e?e:0)}},{key:"getMirrorImageData",value:function(){return this.mirrorDrawer.getImageData()}},{key:"computeMirrorPoint",value:function(t){return{x:t.x/this.ratio,y:t.y/this.ratio,lineWidth:t.lineWidth/this.ratio}}}]),t}();var ge=a.a.memo((function(t){var e=t.drawState,n=Object(r.useRef)(null),a=Object(r.useRef)(),c=e.width,u=e.height;return Object(r.useEffect)((function(){if(n.current){n.current.addEventListener("touchstart",(function(t){t.preventDefault()}),{passive:!1});var t=n.current.getContext("2d");t&&(a.current=t)}}),[]),Object(r.useEffect)((function(){var t;console.log("display rerender"),null===(t=a.current)||void 0===t||t.clearRect(0,0,c,u),e.getValidStrokes().forEach((function(t){a.current&&function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"black",r=new ve(t,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0),a=e.slice(),c=a.shift();c&&(r.drawBegin(c),a.forEach((function(t){r.drawCurve(t,n)})))}(a.current,t.points,"black",c,u)}))})),Object(Ut.jsx)("canvas",{width:c,height:u,ref:n})}));function ke(t){var e=t.drawState,n=t.setDrawState,a=t.method,c=t.finger,u=t.even,i=t.lineWidth,s=e.width,l=e.height,d=Object(r.useRef)(null),f=Object(r.useRef)(s),b=Object(r.useRef)(l),j=Object(r.useRef)(!1),p=Object(r.useRef)();function h(){if(!d.current)throw Error("can't get canvas element");return d.current}function O(){var t=h().getContext("2d");if(!t)throw Error("can't get canvas context");return t}function v(t){var e=h().getBoundingClientRect(),n=t.clientX-e.left,r=t.clientY-e.top;return[n/f.current*s,r/b.current*l]}function x(){f.current=h().clientWidth,b.current=h().clientHeight}function m(t){return"direct"===t.touches[0].touchType}function g(){var t=p.current;if(j.current&&t){var e=t.points,r=function(){j.current=!1,n((function(n){return a(n,t.getMirrorImageData(),e)}))};requestAnimationFrame((function(){requestAnimationFrame(r)}))}}return Object(r.useEffect)((function(){var t=h(),e=function(t){!c&&m(t)||t.preventDefault()};return t.addEventListener("touchstart",e,{passive:!1}),function(){t.removeEventListener("touchstart",e)}}),[c]),Object(r.useEffect)(x,[]),Object(r.useEffect)((function(){O().clearRect(0,0,s,l)}),[e,s,l]),Object(Ut.jsx)("canvas",{width:s,height:l,ref:d,onTouchStart:function(t){var e;j.current=!0,x(),p.current=new me(O(),s,l);var n=t.touches[0];if(c||!m(t)){var r=(null!==(e=n.force)&&void 0!==e?e:0)*i,a=v(n),d=Object(o.a)(a,2),f={x:d[0],y:d[1],lineWidth:u?i:p.current.computeLineWidth(r)};p.current.drawBegin(f)}},onMouseDown:function(t){j.current=!0,x();var e=v(t),n=Object(o.a)(e,2),r=n[0],a=n[1];p.current=new me(O(),s,l);var c={x:r,y:a,lineWidth:i};p.current.drawBegin(c)},onTouchMove:function(t){var e;if(j.current&&p.current){var n=t.touches[0];if(c||"direct"!==n.touchType){var r=(null!==(e=n.force)&&void 0!==e?e:0)*i,a=v(n),s=Object(o.a)(a,2),l={x:s[0],y:s[1],lineWidth:u?i:p.current.computeLineWidth(r)};p.current.drawCurve(l)}}},onMouseMove:function(t){if(j.current&&p.current){var e=v(t),n=Object(o.a)(e,2),r={x:n[0],y:n[1],lineWidth:i};p.current.drawCurve(r)}},onTouchEnd:g,onMouseUp:g,onMouseLeave:g})}n(450);function we(t){var e=t.drawState,n=t.onChange,r=t.erasing,a=void 0!==r&&r,c=t.finger,u=void 0!==c&&c,i=t.even,s=void 0===i||i,o=t.lineWidth,l=void 0===o?10:o,d=a?S.eraseStrokes:S.pushStroke;return Object(Ut.jsxs)("div",{className:"draw-wrapper",children:[Object(Ut.jsx)(ge,{drawState:e}),Object(Ut.jsx)(ke,{drawState:e,method:d,finger:u,even:s,lineWidth:l,setDrawState:n})]})}n(220);var ye={states:Object(g.b)(),keys:Object(g.a)(),editStack:Object(g.a)(),undoStack:Object(g.a)()},Se=Object(g.d)(ye),Ie=function(){function t(e){Object(x.a)(this,t),this.immutable=e}return Object(m.a)(t,[{key:"getImmutable",value:function(){return this.immutable}},{key:"getStates",value:function(){return this.getImmutable().get("states")}},{key:"getKeys",value:function(){return this.getImmutable().get("keys")}},{key:"getEditStack",value:function(){return this.getImmutable().get("editStack")}},{key:"getUndoStack",value:function(){return this.getImmutable().get("undoStack")}},{key:"setState",value:function(e,n){var r=this.getImmutable().update("states",(function(t){return t.set(e,n)}));return this.getStates().has(e)&&(r=r.update("editStack",(function(t){return t.push(e)}))),new t(r)}},{key:"getOneState",value:function(t){return this.getImmutable().get("states").get(t)}},{key:"isUndoable",value:function(){return this.getEditStack().size>0}},{key:"isRedoable",value:function(){return this.getUndoStack().size>0}},{key:"undo",value:function(){if(this.isUndoable()){var e=this.getImmutable().get("editStack").last();return e?new t(this.getImmutable().update("states",(function(t){return t.update(e,(function(t){if(!t)throw new Error("undo wrong uid");return S.undo(t)}))})).update("editStack",(function(t){return t.pop()})).update("undoStack",(function(t){return t.push(e)}))):this}return this}},{key:"redo",value:function(){if(this.isRedoable()){var e=this.getImmutable().get("undoStack").last();return e?new t(this.getImmutable().update("states",(function(t){return t.update(e,(function(t){if(!t)throw new Error("redo wrong uid");return S.redo(t)}))})).update("undoStack",(function(t){return t.pop()})).update("editStack",(function(t){return t.push(e)}))):this}return this}},{key:"pushStroke",value:function(t,e){var n=this.getImmutable().get("states").get(t);if(!n)return this;var r=S.simplePush(n,e);return this.setState(t,r)}}],[{key:"createEmpty",value:function(){return new t(Se())}},{key:"createKeyed",value:function(e){return new t(Se().set("keys",Object(g.a)(e)))}},{key:"createFromList",value:function(e){return new t(Se().set("keys",Object(g.a)(e.map((function(t){return t[0]})))).set("states",Object(g.b)(e)))}},{key:"createFromPages",value:function(e,n){var r=Object.entries(e);return t.createFromList(r.map((function(t){var e=Object(o.a)(t,2),r=e[0],a=e[1],c=a.state,u=a.ratio;return[r,S.loadFromFlat(c,n,n*u)]})))}}]),t}(),Ce=n(454);n(451);function Le(t){var e=t.value,n=Object(r.useState)(9999),a=Object(o.a)(n,2),c=a[0],u=a[1],i=String(e>=0?e:c).padStart(4,"0").split("").map((function(t){return Number(t)}));function s(){u(Math.floor(1e4*Math.random()))}return Object(r.useEffect)((function(){if(-1!==e)return u(9999);var t=setTimeout(s,100);return function(){return clearTimeout(t)}}),[e]),Object(Ut.jsx)("div",{className:"digit-display ".concat(-2===e?"disabled":""),children:i.map((function(t,e){return Object(Ut.jsx)(Te,{digit:t},e)}))})}function Te(t){var e=t.digit;return e<=9&&e>=0?Object(Ut.jsx)("div",{className:"digit",children:e}):Object(Ut.jsx)("div",{className:"digit",children:"*"})}var Ee=Object(r.createContext)({code:-2});function Ae(){var t,e=Object(r.useState)(),n=Object(o.a)(e,2),a=n[0],c=n[1],u=Object(r.useState)(-2),i=Object(o.a)(u,2),l=i[0],d=i[1],f=Object(r.useState)(T),b=Object(o.a)(f,1)[0],h=null!==(t=Object(s.g)().noteId)&&void 0!==t?t:"";function O(){return v.apply(this,arguments)}function v(){return(v=Object(p.a)(j.a.mark((function t(){var e,n,r;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,M(h);case 2:if(e=t.sent){t.next=5;break}return t.abrupt("return");case 5:n=e.code,r=e.pages,d(n),c(Ie.createFromPages(r,Ue));case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var x=function(){b.emit("joinRoom",{noteId:h,userId:U()})},m=function(){var t=Object(p.a)(j.a.mark((function t(){return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,O();case 2:x(),b.on("connect",(function(){console.log("on-conn"),x()})),b.on("addStroke",(function(t){var e=t.pageId,n=t.stroke;console.log("on-add"),c((function(t){return null===t||void 0===t?void 0:t.pushStroke(e,n)}))}));case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),g=function(){b.emit("leaveRoom",{noteId:h,userId:U()}),b.off("connect"),b.off("addStroke")};Object(r.useEffect)((function(){return m(),g}),[h]);return Object(Ut.jsx)(Ee.Provider,{value:{code:l},children:Object(Ut.jsx)(We,{teamOn:!0,teamStateSet:a,pushStroke:function(t,e){b.emit("pushStroke",{pageId:t,userId:U(),stroke:e})}})})}function Ne(){var t=Object(r.useContext)(Ee).code,e=Object(Ut.jsxs)("div",{className:"team-popover",children:[Object(Ut.jsx)("p",{children:"Room Code:"}),Object(Ut.jsx)(Le,{value:t}),Object(Ut.jsx)(Ce.a,{})]});return Object(Ut.jsx)(Ot.a,{content:e,trigger:"click",placement:"bottomRight",title:"Team info",children:Object(Ut.jsx)(ht.a,{type:"text",icon:Object(Ut.jsx)(At.a,{})})})}var Ue=2e3,De={erasing:!1,finger:!1,even:!0,lineWidth:5,color:"#000"},Re=Object(r.createContext)(De),Fe=Object(r.createContext)({noteId:"",stateSet:void 0,saved:!0,teamOn:!1}),Pe=Object(r.createContext)({setSaved:function(){}});function We(t){var e,n=t.teamOn,a=t.teamStateSet,c=t.pushStroke,u=null!==(e=Object(s.g)().noteId)&&void 0!==e?e:"",i=Object(s.f)(),b=Object(r.useState)({}),h=Object(o.a)(b,2),O=h[0],v=h[1],x=Object(r.useState)(),m=Object(o.a)(x,2),g=m[0],k=m[1],w=Object(r.useState)(),y=Object(o.a)(w,2),I=y[0],C=y[1],L=Object(r.useState)(De),T=Object(o.a)(L,2),E=T[0],A=T[1],U=Object(r.useState)(!0),D=Object(o.a)(U,2),R=D[0],F=D[1];function W(){return(W=Object(p.a)(j.a.mark((function t(){var e,n,r;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,et(u);case 2:if(e=t.sent){t.next=6;break}return pt.b.error("Note not found"),t.abrupt("return",i("/"));case 6:n=e.pages,e.pdf,r=Object(l.a)(e,["pages","pdf"]),v(n),k(r),C(Ie.createFromPages(n,Ue));case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var M=Object(r.useCallback)(Object(N.debounce)(function(){var t=Object(p.a)(j.a.mark((function t(e){return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,rt(u,{pages:e});case 2:F(!0);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),5e3),[]),_=M.flush,B=function(){var t=Object(p.a)(j.a.mark((function t(){return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(g){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,P(u,g,O);case 4:if(t.sent){t.next=7;break}return t.abrupt("return",pt.b.error("Can't create room."));case 7:return t.next=9,rt(u,{team:!0});case 9:i("/team/"+u);case 10:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),G=function(){!function(){W.apply(this,arguments)}()},z=function(){_()};Object(r.useEffect)((function(){return G(),z}),[u,n]);var K=Object(r.useCallback)((function(t,e){C((function(n){return null===n||void 0===n?void 0:n.setState(t,e)})),v((function(n){var r=Object(f.a)(Object(f.a)({},n),{},Object(d.a)({},t,Object(f.a)(Object(f.a)({},n[t]),{},{state:S.flaten(e)})));return M(r),r})),F(!1);var n=e.getLastStroke();n&&c&&c(t,n)}),[M]);return Object(Ut.jsx)(Re.Provider,{value:E,children:Object(Ut.jsx)(Fe.Provider,{value:{noteId:u,stateSet:I,saved:R,teamOn:n},children:Object(Ut.jsx)(Pe.Provider,{value:{setSaved:F},children:Object(Ut.jsxs)("div",{className:"reader-wrapper",children:[Object(Ut.jsx)(Me,{setDrawCtrl:A,handleUndo:function(){C((function(t){return null===t||void 0===t?void 0:t.undo()}))},handleRedo:function(){C((function(t){return null===t||void 0===t?void 0:t.redo()}))},instantSave:_,createRoom:B}),null===I||void 0===I?void 0:I.getKeys().map((function(t){var e=O[t],n=I.getOneState(t),r=null===a||void 0===a?void 0:a.getOneState(t);return e&&n?Object(Ut.jsx)(Be,{drawState:n,teamState:r,updateState:K,imageBlob:e.image,uid:t},t):Object(Ut.jsx)(Ut.Fragment,{})}))]})})})})}var Me=function(t){var e=t.setDrawCtrl,n=t.handleUndo,a=t.handleRedo,c=t.instantSave,u=t.createRoom,i=Object(r.useContext)(Re),o=Object(s.f)();function l(t){e((function(e){return Object(f.a)(Object(f.a)({},e),t)}))}var d=Object(r.useContext)(Fe),b=d.saved,j=d.stateSet,p=d.teamOn,h=Object(Ut.jsx)("div",{id:"pen-panel",children:Object(Ut.jsx)(oe.a,{min:1,max:20,value:i.lineWidth,onChange:function(t){return l({lineWidth:t})}})}),O=i.erasing?Object(Ut.jsx)(ht.a,{type:"text",onClick:function(){return l({erasing:!1})},icon:Object(Ut.jsx)(le.a,{})}):Object(Ut.jsx)(Ot.a,{content:h,trigger:"click",placement:"bottom",children:Object(Ut.jsx)(ht.a,{type:"text",icon:Object(Ut.jsx)(de.a,{})})});return Object(Ut.jsxs)("div",{id:"tool-bar",children:[Object(Ut.jsxs)("div",{id:"left-buttons",children:[Object(Ut.jsx)(ht.a,{type:"text",onClick:function(){return o("/")},icon:Object(Ut.jsx)(fe.a,{}),children:"Back"}),Object(Ut.jsx)(ht.a,{type:"text",onClick:c,disabled:b,icon:Object(Ut.jsx)(be.a,{})})]}),Object(Ut.jsxs)("div",{id:"middle-buttons",children:[Object(Ut.jsx)(ht.a,{type:"text",icon:Object(Ut.jsx)(je.a,{}),onClick:n,disabled:!(null===j||void 0===j?void 0:j.isUndoable())}),Object(Ut.jsx)(ht.a,{id:"redo-button",type:"text",icon:Object(Ut.jsx)(pe.a,{}),onClick:a,disabled:!(null===j||void 0===j?void 0:j.isRedoable())}),O,Object(Ut.jsx)(ht.a,{type:"text",onClick:function(){return l({erasing:!0})},icon:i.erasing?Object(Ut.jsx)(he.a,{}):Object(Ut.jsx)(Oe.a,{})})]}),Object(Ut.jsxs)("div",{id:"right-buttons",children:[p&&Object(Ut.jsx)(Ne,{}),p||Object(Ut.jsx)(_e,{createRoom:u})]})]})},_e=function(t){var e=t.createRoom;return Object(Ut.jsx)(Vt.a,{placement:"bottomRight",title:"Enable team editing?",onConfirm:e,okText:"Yes",cancelText:"No",children:Object(Ut.jsx)(ht.a,{shape:"round",icon:Object(Ut.jsx)(At.a,{}),children:"Team"})})},Be=a.a.memo((function(t){var e=t.imageBlob,n=t.drawState,a=t.teamState,c=t.uid,u=t.updateState,i=Object(r.useState)(!1),s=Object(o.a)(i,2),l=s[0],d=s[1],f=Object(r.useMemo)((function(){return e?URL.createObjectURL(e):null}),[e]);return Object(r.useEffect)((function(){var t=f||"";return function(){return URL.revokeObjectURL(t)}}),[f]),Object(Ut.jsxs)("div",{className:"pdf-page".concat(l?" loaded":""),children:[Object(Ut.jsx)("img",{src:f||"./default.png",alt:"pdf-page",onLoad:function(){return d(!0)}}),Object(Ut.jsxs)("div",{className:"page-draw",children:[a&&Object(Ut.jsx)(ge,{drawState:a}),Object(Ut.jsx)(Ge,{updateState:u,drawState:n,uid:c})]})]})})),Ge=function(t){var e=t.drawState,n=t.uid,a=t.updateState,c=Object(r.useContext)(Re);return Object(Ut.jsx)(we,{drawState:e,onChange:function(t){var r=t instanceof S?t:t(e);a(n,r)},erasing:c.erasing,lineWidth:c.lineWidth})};function ze(){var t=Object(r.useState)(""),e=Object(o.a)(t,2),n=e[0],a=e[1];return Object(Ut.jsxs)(Ut.Fragment,{children:[Object(Ut.jsx)("h1",{children:n}),Object(Ut.jsx)(Mt.a,{value:n,onChange:function(t){return a(t.target.value)}}),Object(Ut.jsx)("input",{value:n,onChange:function(t){return a(t.target.value)}}),Object(Ut.jsx)("input",{type:"text"})]})}var Ke=Object(Ut.jsx)("main",{style:{padding:"1rem"},children:Object(Ut.jsx)("p",{children:"There's nothing here!"})});u.a.render(Object(Ut.jsx)(i.a,{children:Object(Ut.jsxs)(s.c,{children:[Object(Ut.jsx)(s.a,{path:"/",element:Object(Ut.jsx)(se,{})}),Object(Ut.jsx)(s.a,{path:"/reader",children:Object(Ut.jsx)(s.a,{path:":noteId",element:Object(Ut.jsx)(We,{teamOn:!1})})}),Object(Ut.jsx)(s.a,{path:"/team",children:Object(Ut.jsx)(s.a,{path:":noteId",element:Object(Ut.jsx)(Ae,{})})}),Object(Ut.jsx)(s.a,{path:"/test",element:Object(Ut.jsx)(ze,{})}),Object(Ut.jsx)(s.a,{path:"*",element:Ke})]})}),document.getElementById("root"))}},[[452,1,2]]]);
//# sourceMappingURL=main.be1e483a.chunk.js.map