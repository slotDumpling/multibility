(self.webpackChunkmultibility=self.webpackChunkmultibility||[]).push([[857],{22568:function(e,t,n){"use strict";var r=n(92721);t.Z=(0,r.Z)({scriptUrl:"//at.alicdn.com/t/font_3181679_yo844n7qgns.js"})},96801:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return xe}});var r=n(15861),i=n(29439),o=n(87757),a=n.n(o),u=n(72791),c=n(11886),s=n(81832),l=n(95099),d=n(1413),f=n(93433),v=n(12262),h=n.n(v),p=n(53557),m=n(1488),w=n(82670),g=n(96153),x=n(77838),C=function(){var e=new Map,t=(0,g.v)(44,44),n=t.canvas,r=t.context,i=new Image;return i.src=x,function(t){t=10*Math.round(t/10);var o=e.get(t);if(o)return o;r.translate(22,22),r.rotate(t*Math.PI/180),r.drawImage(i,-22,-22);var a=n.toDataURL();return r.clearRect(-22,-22,44,44),r.resetTransform(),e.set(t,a),a}}(),j=function(e){return"url(".concat(C(e),") 22 22, auto")};function Z(e){var t=(0,u.useRef)(!1),n=function(e){return e.isPrimary&&(t.current="touch"===e.pointerType)},r=function(n){return function(n){return!t.current||function(e){var t=e.touches[0];return"stylus"===(null===t||void 0===t?void 0:t.touchType)}(n)||e&&1===n.touches.length}(n)||n.stopPropagation()};return{onPointerDownCapture:n,onPointerMoveCapture:n,onTouchStartCapture:r,onTouchMoveCapture:r}}var S=n(80184),b=h().Path,y=h().Size,A=h().Point,E=h().Group,k=h().Color,D=h().Raster,R=h().Layer,T=u.forwardRef((function(e,t){var n=e.drawState,r=e.otherStates,o=e.onChange,a=void 0===o?function(){}:o,s=e.drawCtrl,l=void 0===s?c.Hq:s,v=e.readonly,x=void 0!==v&&v,C=e.imgSrc,T=e.setActiveTool,N=void 0===T?function(){}:T,K=n.width,q=n.height,Y=l.mode,H=l.finger,Q=l.lasso,X=l.eraserWidth,G=(0,u.useRef)(null),_=(0,u.useRef)(new(h().PaperScope)),$=(0,u.useState)([]),ee=(0,i.Z)($,2),te=ee[0],ne=ee[1],re=P(),ie=(0,i.Z)(re,2),oe=ie[0],ae=ie[1],ue=P(),ce=(0,i.Z)(ue,2),se=ce[0],le=ce[1],de=P(),fe=(0,i.Z)(de,2),ve=fe[0],he=fe[1];(0,u.useEffect)((function(){var e,t=G.current,n=_.current;if(t)return n.setup(t),n.settings.handleSize=10,n.settings.hitTolerance=20,[0,1,2].forEach((function(){return n.project.addLayer(new R)})),n.project.layers.forEach((function(e){return e.visible=!1})),null===(e=n.project.layers[2])||void 0===e||e.activate(),new n.Tool,function(){n.remove(),(0,g.j)(t)}}),[]),(0,u.useEffect)((function(){var e=L(_.current,K,q);return function(){e.remove()}}),[K,q]);var pe=(0,m.Z)(G),me=(0,i.Z)(pe,1)[0]/K;(0,u.useEffect)((function(){if(me){var e=_.current,t=new A(0,0);return e.view.viewSize=new y(K,q).multiply(me),e.view.scale(me,t),e.project.layers.forEach((function(e){return e.visible=!0})),e.view.update(),function(){var n;return null===(n=e.view)||void 0===n?void 0:n.scale(1/me,t)}}}),[K,q,me]),(0,u.useEffect)((function(){var e;if(C){_.current.activate();var t=new D(C);return null===(e=t.project.layers[0])||void 0===e||e.addChild(t),t.sendToBack(),t.onLoad=function(){t.view.update(),t.fitBounds(new(h().Rectangle)(0,0,K,q)),t.bringToFront()},function(){null===t||void 0===t||t.remove()}}}),[C,K,q]);var we=(0,u.useMemo)((function(){return r?w.Dw.mergeStates.apply(w.Dw,[n].concat((0,f.Z)(r))):n.getStrokeList()}),[n,r]);(0,u.useEffect)((function(){var e=[],t=_.current.project.layers[1];if(t)return _.current.activate(),we.forEach((function(r){var i=n.hasStroke(r.uid),o=M(r,t,!i);i&&e.push(o)})),ne(e),function(){t.removeChildren()}}),[we,n]);var ge=(0,u.useRef)(),xe=(0,u.useState)(!1),Ce=(0,i.Z)(xe,2),je=Ce[0],Ze=Ce[1],Se="select"===Y&&je?"selected":Y,be=(0,u.useState)([]),ye=(0,i.Z)(be,2),Ae=ye[0],Ee=ye[1],ke=(0,u.useMemo)((function(){var e=new Set(Ae);return te.filter((function(t){return e.has(t.name)}))}),[te,Ae]),De=(0,u.useCallback)((function(){Ze(!1),ae(void 0),le(void 0),he(void 0)}),[ae,le,he]);(0,u.useEffect)((function(){if("select"===Y)return De}),[Y,De]),(0,u.useEffect)((function(){return De}),[Q,De]),(0,u.useEffect)((function(){if(je)return function(){Ee([]),N("")}}),[je,N]);var Re=function(){return ae(V(l))},Te=function(e){return le(W(e.point))},Ne={draw:Re,erase:Re,select:Q?Re:Te,selected:function(e){if(Q){if(null!==oe&&void 0!==oe&&oe.contains(e.point))return;Re(),Ze(!1)}else{var t,n=null!==(t=null===se||void 0===se?void 0:se.hitTest(e.point,{segments:!0}))&&void 0!==t?t:null===ve||void 0===ve?void 0:ve.hitTest(e.point,{segments:!0,selected:!0});if(ge.current=n,n)return;if(null!==se&&void 0!==se&&se.contains(e.point))return;Te(e),he(void 0),Ze(!1)}},text:function(e){var t,n=_.current.project.layers[1];if(n){var r=null!==(t=B(n,e.point))&&void 0!==t?t:U(e.point);$e(r)}}}[Se],Pe=function(e){null===oe||void 0===oe||oe.add(e.point),null===oe||void 0===oe||oe.smooth()},Me={draw:Pe,erase:Pe,select:Q?Pe:function(e){if(se){var t=e.point,n=t.x,r=t.y,o=(0,i.Z)(se.segments,4),a=o[1],u=o[2],c=o[3];a&&u&&c&&(a.point.x=n,u.point=e.point,c.point.y=r,se.selected=!0)}},selected:function(e){var t=ge.current;if(null!==t&&void 0!==t&&t.segment&&se){var n=t.segment;if(n.selected){var r=se.bounds.center,i=n.point.subtract(r),o=e.point.subtract(r);Be(j(o.angle));var a=o.angle-i.angle;se.rotate(a,r),null===ve||void 0===ve||ve.rotate(a,r),ke.forEach((function(e){return null===e||void 0===e?void 0:e.rotate(a,r)}))}else{var u=n.point,c=n.next.next.point,s=u.subtract(c),l=e.point.subtract(c).project(s).x/s.x;if(l<0)return;se.scale(l,c),null===ve||void 0===ve||ve.scale(l,c),ke.forEach((function(e){e.scale(l,c),e.strokeWidth*=l}))}}else ke.forEach((function(t){return t.translate(e.delta)})),null===oe||void 0===oe||oe.translate(e.delta),null===se||void 0===se||se.translate(e.delta),null===ve||void 0===ve||ve.translate(e.delta)},text:function(e){if(_e&&!_e.name){var t=_e.bounds,n=t.topCenter,r=t.bottomRight.subtract(n),i=e.point.subtract(n).project(r).x/r.x;i<0||_e.scale(i,n)}}}[Se];(0,u.useEffect)((function(){_.current.tool.maxDistance=X}),[X]);var Le=(0,u.useRef)(new Set),We=(0,u.useRef)(new Map),Ve=function(e){if("erase"===Se){var t=_.current.project.layers[1],n=null===t||void 0===t?void 0:t.hitTestAll(e.point,{class:h().Path,stroke:!0,tolerance:X/2});null===n||void 0===n||n.forEach((function(n){var r=n.item;if(r instanceof h().Path){for(var i=r;i.parent!==t&&i.parent instanceof h().PathItem;)i=i.parent;var o=i.name;if(l.pixelEraser){var a=(X+r.strokeWidth)/2,u=new b.Circle(e.point,a);u.remove();var c=r.subtract(u,{trace:!1});r.replaceWith(c),i===r&&(i=c),We.current.set(o,i)}else i.opacity=.5,i.guide=!0,Le.current.add(o)}}))}},Oe={draw:function(){if(oe&&!oe.isEmpty()){oe.simplify();var e=oe.exportJSON();ae(void 0),a((function(t){return w.Dw.addStroke(t,e)}))}},erase:function(){if(ae(void 0),l.pixelEraser){var e=Array.from(We.current);We.current.clear();var t=e.map((function(e){var t=(0,i.Z)(e,2),n=t[0],r=t[1];return[n,I(r).map((function(e){return e.exportJSON()}))]}));if(!t.length)return;a((function(e){return w.Dw.splitStrokes(e,t)}))}else{var n=Array.from(Le.current);if(Le.current.clear(),!n.length)return;a((function(e){return w.Dw.eraseStrokes(e,n)}))}},select:function(){var e;if(Q){if(!oe||Math.abs(oe.area)<1e3)return ae(void 0);oe.closePath(),oe.simplify(),O(oe),e=J(te,oe)}else{if(!se||Math.abs(se.area)<1e3)return le(void 0);e=J(te,se);var t=new b,n=se.bounds.topCenter;t.add(n,n.subtract(new A(0,100))),t.lastSegment.selected=!0,he(t)}Ze(!0),Ee(e),N("select")},selected:function(e){Ke(),Ue(e)},text:function(){N("text")}}[Se],ze=(0,u.useState)("auto"),Je=(0,i.Z)(ze,2),Fe=Je[0],Be=Je[1];(0,u.useEffect)((function(){"text"===Se||"select"===Se?Be("crosshair"):"selected"===Se?Be(Q?"crosshair":"nwse-resize"):"draw"!==Se&&"erase"!==Se||Be(function(e,t){var n=e.lineWidth,r=e.eraserWidth,i=t*("erase"===e.mode?r:n);if(i<5)return"crosshair";var o=i/2;return'url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" fill="%23FFF7" width="'.concat(i,'" height="').concat(i,'" viewBox="0 0 10 10"><circle cx="5" cy="5" r="5"/></svg>\') ').concat(o," ").concat(o,", auto")}(l,me))}),[Se,Q,l,me]);var Ue=function(e){var t,n,r=null!==(t=null===se||void 0===se?void 0:se.hitTest(e.point,{segments:!0}))&&void 0!==t?t:null===ve||void 0===ve?void 0:ve.hitTest(e.point,{segments:!0,selected:!0});if(null!==r&&void 0!==r&&r.segment){if(r.segment.selected){var i=null===se||void 0===se?void 0:se.bounds.center;if(!i)return;var o=r.segment.point.subtract(i);return Be(j(o.angle))}var a=r.segment.point,u=r.segment.next.next.point,c=a.subtract(u),s=c.x,l=c.y;return Be(s*l<0?"nesw-resize":"nwse-resize")}if(null!==(n=null!==se&&void 0!==se?se:oe)&&void 0!==n&&n.contains(e.point))return Be("move");Be("crosshair")},Ie=(0,d.Z)({selected:Ue,text:function(e){var t=_.current.project.layers[1];t&&(B(t,e.point)?Be("text"):Be("crosshair"))}},{select:null,draw:null,erase:null})[Se];(0,u.useEffect)((function(){if(!x){var e=function(e){return function(t){if(_.current.activate(),e)return e(t)}},t=_.current,n=t.view,r=t.tool;n.onMouseDown=e(Ne),n.onMouseDrag=e(Me),n.onMouseUp=e(Oe),n.onMouseMove=e(Ie),r.onMouseDrag=e(Ve)}}));var Ke=function(){if(null!==ke&&void 0!==ke&&ke.length){var e=ke.map((function(e){return[e.name,e.exportJSON()]}));a((function(t){return w.Dw.mutateStrokes(t,e)}))}},qe=function(){Ee([]),De(),Ae.length&&a((function(e){return w.Dw.eraseStrokes(e,Ae)}))},Ye=function(e){_.current.activate(),F(ke,e),Ke()},He=function(){var e;_.current.activate();var t=null===(e=se||oe)||void 0===e?void 0:e.bounds.size;if(t&&ke.length){var n=t.width,r=t.height,o=new A(n,r).divide(10),u=ke.map((function(e){return e.clone()}));u.forEach((function(e){return e.translate(o)})),null===se||void 0===se||se.translate(o),null===oe||void 0===oe||oe.translate(o);var c=u.map((function(e){return[w.Dw.getUid(),e.exportJSON()]}));a((function(e){return w.Dw.mutateStrokes(e,c)})),Ee(c.map((function(e){return(0,i.Z)(e,1)[0]})))}},Qe=function(){var e=new E(ke),t=_.current.project.layers[1];return t?(e.addTo(t),e.rasterize({insert:!1}).toDataURL()):""},Xe=P(),Ge=(0,i.Z)(Xe,2),_e=Ge[0],$e=Ge[1],et=(0,u.useCallback)((function(){$e(void 0),N("")}),[$e,N]);(0,u.useEffect)((function(){if("text"===Y)return et}),[Y,et]);var tt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#000",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"center";if(_e){_e.content=e,_e.fillColor=new k(t),_e.justification=n;var r=_e.exportJSON(),i=_e.name;if(et(),!i)return a((function(e){return w.Dw.addStroke(e,r)}));a((function(e){return w.Dw.mutateStrokes(e,[[i,r]])}))}};(0,u.useImperativeHandle)(t,(function(){return{deleteSelected:qe,duplicateSelected:He,cancelText:et,submitText:tt,mutateStyle:Ye,rasterize:Qe,pointText:_e}})),(0,u.useEffect)((function(){var e=function(e){return e.preventDefault()};return document.addEventListener("gesturestart",e),document.addEventListener("gesturechange",e),document.addEventListener("gestureend",e),function(){document.removeEventListener("gesturestart",e),document.removeEventListener("gesturechange",e),document.removeEventListener("gestureend",e)}}),[]),(0,p.usePinch)((function(e){var t=e.memo,n=(0,i.Z)(e.offset,1)[0],r=e.first,o=e.last,a=e.origin;_.current.activate();var u,c,s,l=_.current.view,d=new A(a);if(r||!t){var f=G.current.getBoundingClientRect(),v=f.x,h=f.y;u=1,s=new A(v,h),c=d.subtract(s)}else{var p=(0,i.Z)(t,3);u=p[0],c=p[1],s=p[2]}var m=d.subtract(s),w=l.viewToProject(m);Math.abs(1-n)<.05&&(n=1);var g=r?1:n/u,x=o?10:1;g=Math.pow(g,1/x);!function e(){l.scale(g,w),--x>0?requestAnimationFrame(e):o&&z(l,new y(K,q))}();var C=m.subtract(c).divide(l.zoom);if(l.translate(C),!o)return[n,m,s]}),{scaleBounds:{max:10,min:.3},rubberband:.5,target:G});var nt=Z(H);return(0,S.jsx)("div",(0,d.Z)((0,d.Z)({className:"draw-wrapper",style:{cursor:Fe},"data-readonly":x},nt),{},{children:(0,S.jsx)("canvas",{ref:G,className:"draw-canvas"})}))}));T.displayName="Draw";var N=u.memo(T);function P(){var e=(0,u.useState)(),t=(0,i.Z)(e,1)[0];return(0,u.useDebugValue)(t),(0,u.useEffect)((function(){return function(){null!==t&&void 0!==t&&t.name||null===t||void 0===t||t.remove()}}),[t]),e}var M=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.pathData,i=e.uid;try{var o=t.importJSON(r);return o?(o.name=i,o.guide=n,o):new(h().Item)}catch(a){return console.error(a),new(h().Item)}},L=function(e,t,n){var r;e.activate();var i=new b.Rectangle(new A(0,0),new A(t,n));return i.fillColor=new k("#fff"),null===(r=e.project.layers[0])||void 0===r||r.addChild(i),i},W=function(e){var t=new b.Rectangle(e,new y(0,0));return t.onFrame=function(){},t},V=function(e){var t=e.mode,n=e.lineWidth,r=e.eraserWidth,i=e.color,o=e.highlight,a=new b;"erase"===t&&(i="#ccc",n=r),"select"===t&&(i="#1890ff",n=5);var u=new k(i);return(o||"erase"===t)&&(u.alpha=.5,a.blendMode="multiply"),a.strokeColor=u,a.strokeWidth=n,a.strokeJoin="round",a.strokeCap="round",a.guide=!0,a},O=function(e){e.dashOffset=0,e.dashArray=[30,20],e.onFrame=function(){return e.dashOffset+=3}},z=function(e,t){var n=function(e,t){var n=e.center,r=n.x,i=n.y,o=e.size,a=o.width,u=o.height,c=t.width,s=t.height,l=Math.min(a,c)/2,d=Math.min(u,s)/2,f=c-l,v=s-d;return[r<l?l-r:r>f?f-r:0,i<d?d-i:i>v?v-i:0]}(e,t),r=(0,i.Z)(n,2),o=r[0],a=r[1],u=10,c=new A(o,a).divide(-u);!function t(){e.translate(c),--u>0&&requestAnimationFrame(t)}()},J=function(e,t){var n=function(e){var n=e.subtract(t,{insert:!1,trace:!1});return n.remove(),!n.compare(e)};return e.filter((function(e){if(!e.name)return!1;if(!e.bounds.intersects(t.bounds))return!1;if(e instanceof h().Path)return n(e);var r=new b.Rectangle(e.bounds);return r.remove(),n(r)||t.isInside(e.bounds)})).map((function(e){return e.name}))},F=function(e,t){var n=t.lineWidth,r=t.color,i=t.highlight;e.forEach((function(e){if(e instanceof h().PointText&&r){var t=new k(r);e.fillColor=t}if(e instanceof h().Path){if(r){var o=new k(r);"multiply"===e.blendMode&&(o.alpha=.5),e.strokeColor=o}n&&(e.strokeWidth=n),e.strokeColor&&void 0!==i&&(e.strokeColor.alpha=i?.5:1,e.blendMode=i?"multiply":"normal")}}))},B=function(e,t){var n=e.hitTest(t,{class:h().PointText,fill:!0});if((null===n||void 0===n?void 0:n.item)instanceof h().PointText)return null===n||void 0===n?void 0:n.item},U=function(e){return new(h().PointText)({point:e.add(new A(0,50)),content:"Insert text...",fontSize:50,justification:"center",fillColor:"#1890ff55"})},I=function e(t){return t instanceof h().Path?t.isEmpty()?[]:[t]:t instanceof h().CompoundPath?t.children.map(e).flat():[]},K=n(64239),q=n(61507),Y=n(23414),H=n(82622),Q=n(72785),X=n(22925),G=n(4720),_=n(41275),$=n(461),ee=n(69228),te=n(87309),ne=n(87501),re=n(89295),ie=n(48),oe=n(66023),ae=n(74115),ue=n(54164),ce=n(64802),se=function(e){var t=e.drawRef,n=e.visible;return(0,S.jsx)(re.Z,{timeout:300,in:n,unmountOnExit:!0,children:(0,S.jsx)(le,{drawRef:t})})},le=function(e){var t=e.drawRef,n={type:"text",shape:"round",size:"small"},r=(0,u.useState)({}),o=(0,i.Z)(r,2),a=o[0],c=o[1];return(0,ue.createPortal)((0,S.jsxs)("div",{className:"select-tool",children:[(0,S.jsx)(ee.Z,{trigger:"click",placement:"bottom",getPopupContainer:function(e){return e.parentElement},destroyTooltipOnHide:!0,content:(0,S.jsx)(ie.Uk,{updateDrawCtrl:function(e){var n;c((function(t){return(0,d.Z)((0,d.Z)({},t),e)})),null===(n=t.current)||void 0===n||n.mutateStyle(e)},drawCtrl:a}),children:(0,S.jsx)(te.Z,(0,d.Z)({icon:(0,S.jsx)(q.Z,{})},n))}),(0,S.jsx)(te.Z,(0,d.Z)({icon:(0,S.jsx)(Y.Z,{}),onClick:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.duplicateSelected()}},n)),(0,S.jsx)(te.Z,(0,d.Z)({icon:(0,S.jsx)(K.Z,{}),onClick:function(){if(t.current){var e=t.current.rasterize();$.Z.confirm({title:"Screenshot",content:(0,S.jsx)("img",{className:"raster",src:e,alt:"raster"}),className:"raster-modal",icon:(0,S.jsx)(K.Z,{}),okText:"Save",onOk:function(){return(0,ce.saveAs)(e,"screenshot")}})}}},n)),(0,S.jsx)(te.Z,(0,d.Z)({danger:!0,icon:(0,S.jsx)(H.Z,{}),onClick:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.deleteSelected()}},n))]}),document.querySelector(".reader.container > header"))},de=function(e){var t=e.visible,n=e.drawRef,r=(0,u.useState)(""),o=(0,i.Z)(r,2),a=o[0],c=o[1],l=(0,u.useState)(ae.Qk[0]),d=(0,i.Z)(l,2),f=d[0],v=d[1],h=(0,u.useState)("center"),p=(0,i.Z)(h,2),m=p[0],w=p[1],g=(0,s.iX)(),x=(0,i.Z)(g,1)[0];(0,u.useEffect)((function(){var e,r=null===(e=n.current)||void 0===e?void 0:e.pointText;if(r&&t){var i,o=r.name,a=r.content,u=r.justification,s=r.fillColor;if(w(u),o)c(a),v(null!==(i=null===s||void 0===s?void 0:s.toCSS(!0))&&void 0!==i?i:ae.Qk[0]);else c(""),v(ae.Qk[0])}}),[t,n]);var C=(0,S.jsx)(ee.Z,{content:(0,S.jsx)(ie.Q5,{color:f,setColor:v}),overlayStyle:{width:200},placement:"bottom",getPopupContainer:function(e){return e.parentElement},children:(0,S.jsx)(te.Z,{size:"small",icon:(0,S.jsx)(Q.Z,{className:"font-icon",style:{color:f}})})}),j=(0,S.jsx)(ne.ZP.Group,{size:"small",optionType:"button",value:m,buttonStyle:"solid",onChange:function(e){return w(e.target.value)},options:[{label:(0,S.jsx)(X.Z,{}),value:"left"},{label:(0,S.jsx)(G.Z,{}),value:"center"},{label:(0,S.jsx)(_.Z,{}),value:"right"}]});return(0,S.jsxs)($.Z,{visible:t,title:"Insert text",onCancel:function(){var e;return null===(e=n.current)||void 0===e?void 0:e.cancelText()},onOk:function(){var e,t,r=a.trim();if(!r)return null===(e=n.current)||void 0===e?void 0:e.cancelText();null===(t=n.current)||void 0===t||t.submitText(r,f,m)},bodyStyle:{paddingTop:0},destroyOnClose:!0,children:[(0,S.jsxs)("div",{className:"insert-option","data-force-light":x,children:[C,j]}),(0,S.jsx)(oe.Z,{size:"large",rows:3,autoFocus:!0,value:a,onChange:function(e){return c(e.target.value)}})]})},fe=n(85168),ve=n(58826),he=n(58105),pe=n(24124),me=function(e){var t=e.thumbnail,o=e.drawState,c=e.teamStateMap,l=e.updateState,d=e.pdfIndex,f=e.noteID,v=void 0===f?"":f,h=e.preview,p=void 0!==h&&h,m=e.onViewChange,w=e.preload,g=void 0!==w&&w,x=e.ignores,C=void 0===x?(0,pe.l4)():x;(0,u.useEffect)((function(){return console.log(p)}));var j=m&&(0,fe.Z)(0,1.2,.2),Z=(0,he.YD)({threshold:j}),b=(0,i.Z)(Z,3),y=b[0],A=b[1],E=b[2];(0,u.useEffect)((function(){if(!E||!A)return null===m||void 0===m?void 0:m(!1,0);null===m||void 0===m||m(!0,E.intersectionRatio)}),[A,E,m]);var k=(0,u.useState)(),D=(0,i.Z)(k,2),R=D[0],T=D[1],N=(0,u.useCallback)((0,ve.Z)((0,r.Z)(a().mark((function e(){var t,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d&&v){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,Promise.all([n.e(643),n.e(138)]).then(n.bind(n,21176));case 4:return t=e.sent,r=t.getNotePageImage,e.t0=T,e.next=9,r(v,d);case 9:e.t1=e.sent,(0,e.t0)(e.t1);case 11:case"end":return e.stop()}}),e)})))),[d,v]),P=A||g;(0,u.useEffect)((function(){!p&&P&&N()}),[P,p,N]);var M=(0,u.useMemo)((function(){return null===c||void 0===c?void 0:c.deleteAll(C).toList().toArray()}),[c,C]),L=Boolean(R||!d),W=P&&L,V=o.height/o.width,O=(0,s.iX)(),z=(0,i.Z)(O,1)[0];return(0,S.jsxs)("div",{ref:y,className:"page-wrapper","data-force-light":z,children:[(0,S.jsx)("svg",{viewBox:"0 0 100 ".concat(100*V)}),W&&(0,S.jsx)(ge,{drawState:o,otherStates:M,updateState:l,imgSrc:R||t,preview:p})]})};me.displayName="PageWrapper";var we=u.memo(me),ge=function(e){var t=e.drawState,n=e.updateState,r=e.otherStates,o=e.preview,a=void 0!==o&&o,s=e.imgSrc,d=(0,c.gX)(),f=(0,u.useState)(""),v=(0,i.Z)(f,2),h=v[0],p=v[1],m=(0,u.useRef)(null),g=(0,l.Z)((function(e){if(n){var r=e instanceof w.Dw?e:e(t);r!==t&&n(r)}}));return a?(0,S.jsx)(N,{drawState:t,otherStates:r,imgSrc:s,readonly:!0}):(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(N,{drawState:t,otherStates:r,onChange:g,imgSrc:s,drawCtrl:d,ref:m,setActiveTool:p}),(0,S.jsx)(se,{drawRef:m,visible:"select"===h}),(0,S.jsx)(de,{drawRef:m,visible:"text"===h})]})};ge.displayName="DrawWrapper";var xe=we},11886:function(e,t,n){"use strict";n.d(t,{Eq:function(){return f},F7:function(){return g},Hq:function(){return v},gX:function(){return w},w3:function(){return x}});var r=n(1413),i=n(29439),o=n(15861),a=n(87757),u=n.n(a),c=n(61842),s=n.n(c),l=n(72791),d=n(80184),f=[10,20,30,50],v={mode:"draw",finger:!0,lineWidth:10,eraserWidth:10,color:"#000000",highlight:!1,lasso:!0,pixelEraser:!1,widthList:f};function h(){return(h=(0,o.Z)(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s().getItem("DRAW_CTRL");case 2:if(t=e.sent){e.next=7;break}return t=v,e.next=7,s().setItem("DRAW_CTRL",t);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(){return(p=(0,o.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s().setItem("DRAW_CTRL",t);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var m=l.createContext({drawCtrl:v,updateDrawCtrl:function(){}});function w(){var e=(0,l.useContext)(m).drawCtrl;return(0,l.useDebugValue)(e),e}function g(){return(0,l.useContext)(m).updateDrawCtrl}var x=function(e){var t=e.children,n=(0,l.useState)(v),o=(0,i.Z)(n,2),a=o[0],u=o[1];(0,l.useEffect)((function(){(function(){return h.apply(this,arguments)})().then(u)}),[]);return(0,d.jsx)(m.Provider,{value:{drawCtrl:a,updateDrawCtrl:function(e){u((function(t){var n=(0,r.Z)((0,r.Z)({},t),e);return function(e){p.apply(this,arguments)}(n),n}))}},children:t})}},96153:function(e,t,n){"use strict";function r(e,t){var n=document.createElement("canvas"),r=n.getContext("2d");if(!r)throw new Error("can't get virtual canvas context");return n.width=e,n.height=t,{canvas:n,context:r}}function i(e){e.width=1,e.height=1;var t=e.getContext("2d");null===t||void 0===t||t.clearRect(0,0,1,1)}n.d(t,{j:function(){return i},v:function(){return r}})},48:function(e,t,n){"use strict";n.d(t,{Q5:function(){return j},Uk:function(){return g},Db:function(){return x}});var r=n(4942),i=n(93433),o=n(29439),a=n(72791),u=n(11886),c=n(35873),s=n(82670),l=n(69228),d=n(96272),f=n(78985),v=n(74115),h=n(22568),p=n(24124),m=n(81832),w=n(80184),g=function(e){var t=e.updateDrawCtrl,n=e.drawCtrl,r=n.highlight,i=n.color,u=(0,a.useState)(!1),c=(0,o.Z)(u,2),s=c[0],l=c[1];return(0,w.jsxs)("div",{className:"pen-panel","data-blur":s,"data-hi":r,children:[(0,w.jsxs)("div",{className:"pen-status",children:[(0,w.jsx)(x,{updateDrawCtrl:t,drawCtrl:n,setPanelBlur:l}),(0,w.jsx)(C,{checked:r,updateDrawCtrl:t})]}),(0,w.jsx)(j,{color:i||"",setColor:function(e){return t({color:e})}})]})},x=function(e){var t,n,v=e.updateDrawCtrl,h=e.drawCtrl,m=e.setPanelBlur,g=void 0===m?function(){}:m,x=e.field,C=void 0===x?"lineWidth":x,j=h[C],Z=null!==(t=h.widthList)&&void 0!==t?t:u.Eq,S="lineWidth"===C&&null!==(n=h.color)&&void 0!==n?n:"#aaa",b=(0,a.useMemo)((function(){return Z.indexOf(null!==j&&void 0!==j?j:-1)}),[j,Z]),y=(0,a.useState)((0,p.aV)([!1,!1,!1,!1])),A=(0,o.Z)(y,2),E=A[0],k=A[1];(0,a.useEffect)((function(){E.includes(!0)?g(!0):g(!1)}),[E,g]);var D=function(e){return{"--real-size":"calc(".concat(100/s.mF,"vw * ").concat(e,")")}},R=[{value:-1,label:null}].concat((0,i.Z)(Z.map((function(e,t){return{value:t,label:(0,w.jsx)(l.Z,{visible:E.get(t),onVisibleChange:function(e){return k((function(n){return n.set(t,e)}))},trigger:b===t?["click"]:[],placement:"bottom",destroyTooltipOnHide:!0,content:(0,w.jsx)(d.Z,{min:5,max:100,className:"ctrl-slider",defaultValue:e,onAfterChange:function(e){if(Z.includes(e))return k((function(e){return e.set(t,!1)})),v((0,r.Z)({},C,e));var n=Z.slice();n[t]=e,v((0,r.Z)({widthList:n},C,e))}}),children:(0,w.jsx)("div",{className:"circle-wrapper",style:D(e),children:(0,w.jsx)(c.W,{className:"width-circle "+C,color:S})})})}}))));return(0,w.jsx)(f.Z,{className:"width-seg",value:b,options:R,onChange:function(e){var t;return v((0,r.Z)({},C,null!==(t=Z[+e])&&void 0!==t?t:10))}})},C=function(e){var t=e.checked,n=void 0!==t&&t,r=e.updateDrawCtrl;return(0,w.jsxs)("label",{className:"hi-wrapper",children:[(0,w.jsx)("input",{type:"checkbox",name:"highlight",checked:n,onChange:function(e){return r({highlight:e.target.checked})}}),(0,w.jsx)("div",{className:"hi-switch",children:(0,w.jsx)(h.Z,{type:"icon-Highlight"})})]})},j=function(e){var t=e.setColor,n=e.color,r=(0,m.iX)(),i=(0,o.Z)(r,1)[0];return(0,w.jsx)("div",{className:"color-select","data-force-light":i,children:v.Qk.map((function(e){return(0,w.jsxs)("label",{children:[(0,w.jsx)("input",{checked:n===e,type:"radio",name:"color",onChange:function(n){return n.target.checked&&t(e)}}),(0,w.jsx)("div",{"data-color":e,className:"circle",style:{backgroundColor:e,borderColor:e}})]},e)}))})}},77838:function(e){"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAAAXNSR0IArs4c6QAABWlJREFUWEftmF1IW2cYx580iaaNSTSmdWUtRVBBnENbSG40YVtRRpZM4ydqLEpJnd5sVzpxU7TipoMy8EYd6kwC6pakiDeCih/oyBGibS/qTZWaoE63RONXqiYZj5xIKtvFzhvRQl84nHPzvud3nvO8//f5Pyx4xwbrHeOF98Dn/cfeR/h9hM9EgDQlcP4VgJPNi/ezww8AeHnpO/EPIAXm2O32+3w+/xOv13vF5/O9tR6Hw/FxuVyvUChsAIDDUECTAOPca1NTU5+np6f/Zjab7X6//631cnJybjkcjp9v375dDwB7AHBMGmISYEwBocViUWVlZfVJpVLP3NwcLxjI7/fD4uJiR2Ji4vcA4AKAo4sEZgNApF6vzy4pKelCYK/Xy3K73dympqa/EaywsPD6/Px89927d78DgL/otCBiJokwAkf19vZqHjx40CGVSt8gyfLycrhMJvMMDw+fRHthYaEnNTUVgTcvJXBZWdlhZWWlID8/3z0wMCC02Wy99+7dCwCffBTJCHmEKYoKr66udra2torLy8v/7Orqik5JSUl+8eLFCgDsk8DiXFLgSKPRmFVUVPTLWZDc3NzdsbExVJFdgUDwNDY29msA2AYAHwk0CTCqhMBisahfv34tcbvdgsPDw7Dj42NOTU3Nw6mpqSO1Wv1BYWGhU6/Xc2tra+VtbW2LAOC5KGD82KsobQAgop/DASDCYDBoiouLKzUajdtisQiXlpYOfD7fr3Fxcd8CgJskyiQRxkBxACAMALj0M96FkZGRH9rt9gGj0ciuqKgQt7e3b2i1WqdIJPoUAFDy8NRjNEiBA/sA1wnUExEAcHNmZqYuNTVVJZFIIjIzM7cHBwe5XC73IwBYB4ADRrSEm+6/3on6e2N4eLhSqVRWKxSKY5fL5Xv+/HlYY2Pj/fr6egoAdi4TMKaJpL29XV1VVdWhVqv3bTZbuMPhYJtMJl1ubu7vALDFtBAKRUqcDRaqh1ilUn08NDQ0VlpaumUymSL39vaAoqgfZTLZTwDgZLrxzgMY14zKzs5ONpvNE1qt1mU2m6MQeGZmpi0tLS0AzKhyOzfg7u5uVVlZWa9ard6z2Ww8TImenp7K8vJyEx3hSwN8khKTk5NVcrm8QaFQHLlcLj9uukePHn3R2dlpvWwpcbLpnj179jghISE/OjpakJGRsd3f3w88Hi8dAOz0EY3W6X+P80gJ3p07d26+fPly1mAwcHQ6HSrGZl5e3mZMTEw2AKxdtKwFDo3Tg8NqtX4llUqbNRrNtsViEb169cqztrZmSEtLewwAGxd5cHBWV1c/293d5RwcHLA9Hg97fX2dn5GR0To+Pu5VKpW3CgoKtoxGY4RSqVSNjIws0EczY6tEkhInxY/Vas2USqXms8mYl5e3Mzo6yp+YmNjn8/m2+Pj4KgBwXGTxc1pe0iYU6wMWRVG85ubmjbq6uhs6nc7Z0dEhrq2tfdjS0jJKmg4hLeDRhCJwQ0PDQUFBgTA5OfnN7Ozs1enp6QG5XP4DrQ54JGNThfEgSYl/NaFbW1vs1dXVKysrK06xWCyhKEovk8kaaXXA3gTRCCkwwu7s7LCePHmCPQi0+RLahGJfAtXhcpnQubk5dBynAxspl87m9/X1ZWu12s7+/n7sOwT/MX9QIwUjfOF9CVQJ0eDg4JcKheKbo6MjbnBvjcVi+dls9rHT6fwjKSkJgbGkZKy/gd9GksM4l4+FDgBcRwdNe7vA2mjncZOhh8M2FboMRhVacJqRAOM6aDrROV+jzWhwjxiLG4woyh02UHDDMSp4QgmMH4zyhlegsR1YP7iZjdpL1EAJRUoQ6SnTyaQpwfS9jOe9c8D/AEaRMEuceu4YAAAAAElFTkSuQmCC"},90858:function(){},64158:function(){}}]);
//# sourceMappingURL=857.4f4df4d3.chunk.js.map