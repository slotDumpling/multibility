(this.webpackJsonpmultibility=this.webpackJsonpmultibility||[]).push([[0],{186:function(e,t){},264:function(e,t,n){},265:function(e,t,n){},271:function(e,t){},272:function(e,t){},273:function(e,t){},274:function(e,t){},275:function(e,t){},294:function(e,t,n){},296:function(e,t,n){},481:function(e,t,n){},482:function(e,t,n){},483:function(e,t,n){},509:function(e,t,n){},510:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(34),u=n.n(c),s=(n(264),n(80)),i=n(24),o=n(11),l=n.n(o),d=n(22),j=n(12),b=(n(265),n(62)),f=n(81),p=n(82),h=n(38),O=n(51),v={state:"drawing",strokes:Object(h.a)(),uidStack:Object(h.a)(),undoStack:Object(h.c)(),eraseStack:Object(h.a)(),deleted:Object(h.e)()},x=Object(h.d)(v),m={strokes:[]},g=function(){function e(t,n,r,a){Object(f.a)(this,e),this.immutable=t,this.width=n,this.height=r,this.lastOp=a}return Object(p.a)(e,[{key:"getImmutable",value:function(){return this.immutable}},{key:"getUidStack",value:function(){return this.getImmutable().get("uidStack")}},{key:"getUndoStack",value:function(){return this.getImmutable().get("undoStack")}},{key:"getEraseStack",value:function(){return this.getImmutable().get("eraseStack")}},{key:"getValidEraseStack",value:function(){var e=this.getDeleted(),t=this.getUndoStack();return this.getEraseStack().filter((function(n){var r=n.uid;return!e.has(r)&&!t.has(r)}))}},{key:"getStrokes",value:function(){return this.getImmutable().get("strokes")}},{key:"getValidStrokes",value:function(){var e=this.getDeleted(),t=this.getUndoStack(),n=this.getValidEraseStack();return this.getStrokes().filter((function(r){var a=r.uid;return!e.has(a)&&!t.has(a)&&!n.some((function(e){return e.erased.has(a)}))}))}},{key:"getDeleted",value:function(){return this.getImmutable().get("deleted")}},{key:"getState",value:function(){return this.getImmutable().get("state")}},{key:"getLastStroke",value:function(){return this.getImmutable().get("strokes").last()}}],[{key:"createEmpty",value:function(t,n){return new e(x(),t,n)}},{key:"undo",value:function(t){var n=t.getUidStack().last();if(!n)return t;var r={type:"undo",undoUid:n};return new e(t.getImmutable().set("state","revoking").update("undoStack",(function(e){return e.add(n)})).update("uidStack",(function(e){return e.pop()})),t.width,t.height,r)}},{key:"redo",value:function(t){var n=t.getUndoStack().last();if(!n)return t;var r={type:"redo",redoUid:n};return new e(t.getImmutable().update("undoStack",(function(e){return e.butLast()})).update("uidStack",(function(e){return e.push(n)})),t.width,t.height,r)}},{key:"addStroke",value:function(t,n){var r=Object(O.v4)(),a={uid:r,points:n},c=t.getUndoStack(),u=k(t.getImmutable().set("state","drawing").update("deleted",(function(e){return e.concat(c)})).set("undoStack",Object(h.c)()).update("strokes",(function(e){return e.push(a)})).update("uidStack",(function(e){return e.push(r)}))),s={type:"add",stroke:a};return new e(u,t.width,t.height,s)}},{key:"pushStroke",value:function(t,n){return new e(t.getImmutable().update("strokes",(function(e){return e.push(n)})),t.width,t.height)}},{key:"pushErase",value:function(t,n){var r=n.uid,a=n.erased,c={uid:r,erased:Object(h.e)(a)};return new e(t.getImmutable().update("eraseStack",(function(e){return e.push(c)})).update("uidStack",(function(e){return e.push(r)})),t.width,t.height)}},{key:"eraseStrokes",value:function(t,n){var r={uid:Object(O.v4)(),erased:n};return e.pushErase(t,r)}},{key:"pushUndo",value:function(t,n){return new e(t.getImmutable().update("undoStack",(function(e){return e.add(n)})),t.width,t.height)}},{key:"pushRedo",value:function(t,n){return new e(t.getImmutable().update("undoStack",(function(e){return e.delete(n)})),t.width,t.height)}},{key:"flaten",value:function(e){var t=k(e.getImmutable()),n=t.get("deleted"),r=e.getValidEraseStack().reduce((function(e,t){return e.concat(t.erased)}),Object(h.e)()),a=n.concat(r);return{strokes:t.get("strokes").filter((function(e){return!a.has(e.uid)})).toArray()}}},{key:"loadFromFlat",value:function(t,n,r){var a=t.strokes;return new e(x().set("strokes",Object(h.a)(a)),n,r)}}]),e}();function k(e){var t=e.get("undoStack");return e.update("deleted",(function(e){return e.concat(t)})).set("undoStack",Object(h.c)()).update("uidStack",(function(e){return e.filter((function(e){return!t.has(e)}))}))}function y(){return{uid:Object(O.v4)(),name:"New note ".concat(Date.now()),tagId:"DEFAULT",team:!1,withImg:!1,pages:Object(b.a)({},Object(O.v4)(),{ratio:1.5,state:m})}}var S=n(155),w=n(25),I=n(40),C=n.n(I),E=function(){var e;return function(){if(e)return e;var t=localStorage.getItem("user_id");return t||(t=Object(O.v4)(),localStorage.setItem("user_id",t)),e=t,t}}(),N=function(){var e=localStorage.getItem("USER_NAME");return e||(e="User_"+Object(O.v4)().slice(0,8),localStorage.setItem("USER_NAME",e)),e},T=["#64748b","#78716c","#ef4444","#f97316","#eab308","#84cc16","#22c55e","#10b981","#14b8a6","#06b6d4","#0ea5e9","#3b82f6","#6366f1","#8b5cf6","#a855f7","#d946ef","#ec4899","#f43f5e"],L=function(){var e=Math.floor(Math.random()*T.length);return T[e]};function A(){return U.apply(this,arguments)}function U(){return(U=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.a.getItem("ALL_NOTES");case 2:if(!(t=e.sent)){e.next=7;break}return e.abrupt("return",t);case 7:return C.a.setItem("ALL_NOTES",{}),e.abrupt("return",{});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(){return F.apply(this,arguments)}function F(){return(F=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.a.getItem("ALL_TAGS");case 2:if(!(t=e.sent)){e.next=7;break}return e.abrupt("return",t);case 7:return C.a.setItem("ALL_TAGS",{}),e.abrupt("return",{});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return P.apply(this,arguments)}function P(){return(P=Object(d.a)(l.a.mark((function e(t){var n,r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(O.v4)(),r={uid:n,name:t,color:L(),notes:[]},e.t0=w.a,e.t1=w.a,e.t2={},e.next=7,R();case 7:return e.t3=e.sent,e.t4=(0,e.t1)(e.t2,e.t3),e.t5={},e.t6=Object(b.a)({},n,r),a=(0,e.t0)(e.t4,e.t5,e.t6),e.next=14,C.a.setItem("ALL_TAGS",a);case 14:return e.abrupt("return",a);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e){return W.apply(this,arguments)}function W(){return(W=Object(d.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R();case 2:return delete(n=e.sent)[t],e.next=6,C.a.setItem("ALL_TAGS",n);case 6:return e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e){return B.apply(this,arguments)}function B(){return(B=Object(d.a)(l.a.mark((function e(t){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R();case 2:return n=e.sent,(r=n[t.uid]).name=t.name,r.color=t.color,r.notes=t.notes,e.next=9,C.a.setItem("ALL_TAGS",n);case 9:return e.abrupt("return",n);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function G(e){return q.apply(this,arguments)}function q(){return(q=Object(d.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.a.getItem(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e,t){return V.apply(this,arguments)}function V(){return(V=Object(d.a)(l.a.mark((function e(t,n){var r,a,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A();case 2:return r=e.sent,n.pages,n.pdf,a=Object(S.a)(n,["pages","pdf"]),r[t]=Object(w.a)(Object(w.a)({},r[t]),a),e.next=7,C.a.setItem("ALL_NOTES",r);case 7:return e.next=9,G(t);case 9:if(c=e.sent){e.next=12;break}return e.abrupt("return");case 12:return e.next=14,C.a.setItem(t,Object(w.a)(Object(w.a)({},c),n));case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function K(e){return J.apply(this,arguments)}function J(){return(J=Object(d.a)(l.a.mark((function e(t){var n,r,a,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.uid,r=t.tagId,e.next=3,A();case 3:return(a=e.sent)[n]=t,e.next=7,C.a.setItem("ALL_NOTES",a);case 7:return e.next=9,R();case 9:if(c=e.sent,"DEFAULT"===r){e.next=14;break}return c[r].notes.push(t.uid),e.next=14,C.a.setItem("ALL_TAGS",c);case 14:return e.abrupt("return",{tags:c,allNotes:a});case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(e){return H.apply(this,arguments)}function H(){return(H=Object(d.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.a.setItem(t.uid,t);case 2:return t.pdf,t.pages,n=Object(S.a)(t,["pdf","pages"]),e.next=5,K(n);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function X(e){return $.apply(this,arguments)}function $(){return($=Object(d.a)(l.a.mark((function e(t){var n,r,a,c,u,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G(t);case 2:return n=e.sent,e.next=5,A();case 5:return r=e.sent,e.next=8,R();case 8:if(a=e.sent,n){e.next=11;break}return e.abrupt("return",{tags:a,allNotes:r});case 11:return e.next=13,C.a.removeItem(t);case 13:return n.pdf,n.pages,c=Object(S.a)(n,["pdf","pages"]),delete r[t],e.next=17,C.a.setItem("ALL_NOTES",r);case 17:if("DEFAULT"===(u=c.tagId)){e.next=23;break}return s=a[u].notes,a[u].notes=s.filter((function(e){return e!==t})),e.next=23,C.a.setItem("ALL_TAGS",a);case 23:return e.abrupt("return",{tags:a,allNotes:r});case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(e,t){return Z.apply(this,arguments)}function Z(){return(Z=Object(d.a)(l.a.mark((function e(t,n){var r,a,c,u,s,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G(t);case 2:return c=e.sent,e.next=5,A();case 5:return u=e.sent,e.next=8,R();case 8:if(s=e.sent,c){e.next=11;break}return e.abrupt("return",{tags:s,allNotes:u});case 11:return i=c.tagId,c.tagId=n,e.next=15,C.a.setItem(t,c);case 15:return u[t].tagId=n,e.next=18,C.a.setItem("ALL_NOTES",u);case 18:return i in s&&(s[i].notes=s[i].notes.filter((function(e){return e!==t}))),null===(r=s[n])||void 0===r||null===(a=r.notes)||void 0===a||a.push(t),e.next=22,C.a.setItem("ALL_TAGS",s);case 22:return e.abrupt("return",{tags:s,allNotes:u});case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ee(e){return te.apply(this,arguments)}function te(){return(te=Object(d.a)(l.a.mark((function e(t){var n,r,a,c,u,s,i,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n={},r=0,a=Object.entries(t);r<a.length;r++)c=Object(j.a)(a[r],2),u=c[0],s=c[1],i=s.ratio,delete(o=s.states)[E()],n[u]={ratio:i,state:{strokes:Object.values(o).flat(1)}};return e.abrupt("return",n);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ne(e,t,n){return re.apply(this,arguments)}function re(){return(re=Object(d.a)(l.a.mark((function e(t,n,r){var a,c,u,s,i,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G(t);case 2:if(!e.sent){for(a={},c=0,u=Object.entries(r);c<u.length;c++)s=Object(j.a)(u[c],2),i=s[0],o=s[1],a[i]=Object(w.a)(Object(w.a)({},o),{},{state:m});Y(Object(w.a)(Object(w.a)({},n),{},{tagId:"DEFAULT",team:!0,pages:a}))}case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ae=n(516),ce=n(65),ue=n(254),se=n(518),ie=n(515),oe=n(248),le=n(181),de=n(244),je=n.n(de),be=n(255),fe=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];Object(f.a)(this,e),this.context=t,this.points=n}return Object(p.a)(e,[{key:"drawBegin",value:function(e){this.points.push(e);var t=e.x,n=e.y,r=e.lineWidth;this.context.lineWidth=r,this.context.beginPath(),this.context.moveTo(t,n)}},{key:"drawCurve",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"black",n=this.points.slice(-1)[0];if(this.points.push(e),!(this.points.length<3)){var r=(e.x+n.x)/2,a=(e.y+n.y)/2;this.context.strokeStyle=t,this.context.lineCap="round",this.context.lineJoin="round",this.context.lineWidth=n.lineWidth,this.context.quadraticCurveTo(n.x,n.y,r,a),this.context.stroke(),this.context.beginPath(),this.context.moveTo(r,a)}}},{key:"drawCurveComplete",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"black";if(!(this.points.length<3)){this.context.lineWidth=Math.max.apply(Math,Object(be.a)(this.points.map((function(e){return e.lineWidth}))));var t=this.points[0];this.context.beginPath(),this.context.strokeStyle=e,this.context.lineCap="round",this.context.lineJoin="round",this.context.moveTo(t.x,t.y);for(var n=1;n<this.points.length;n+=1){var r=(this.points[n].x+t.x)/2,a=(this.points[n].y+t.y)/2;this.context.quadraticCurveTo(t.x,t.y,r,a),t=this.points[n]}this.context.stroke()}}},{key:"computeLineWidth",value:function(e){var t,n;return 5*Math.log(e+1)+.8*(null!==(t=null===(n=this.points.slice(-1)[0])||void 0===n?void 0:n.lineWidth)&&void 0!==t?t:0)}}],[{key:"createRaw",value:function(t,n){var r=document.createElement("canvas");r.width=t,r.height=n;var a=r.getContext("2d");if(!a)throw Error("can't get canvas context");return new e(a)}}]),e}();function pe(e,t){var n=new fe(e,t);n.drawCurveComplete()}function he(e,t){var n=document.createElement("canvas"),r=n.getContext("2d");if(!r)throw new Error("can't get virtual canvas context");return n.width=e,n.height=t,{canvas:n,context:r}}function Oe(e){return new Promise((function(t){e.toBlob(t)}))}function ve(e,t,n){return xe.apply(this,arguments)}function xe(){return(xe=Object(d.a)(l.a.mark((function e(t,n,r){var a,c,u,s,i,o,d,j,b;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getPage(n);case 2:return a=e.sent,c=a.getViewport({scale:r}),console.log(c),u=c.height,s=c.width,i=u/s,o=he(Math.floor(s*r),Math.floor(u*r)),d=o.canvas,j=o.context,console.time("render"),e.next=11,a.render({canvasContext:j,viewport:c,transform:[r,0,0,r,0,0]}).promise;case 11:return console.timeEnd("render"),console.time("img"),e.next=15,Oe(d);case 15:if(b=e.sent){e.next=18;break}throw new Error("can't get canvas image blob");case 18:return console.timeEnd("img"),e.abrupt("return",[b,i]);case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function me(e){return ge.apply(this,arguments)}function ge(){return(ge=Object(d.a)(l.a.mark((function e(t){var n,r,a,c,u,s,i,o,d,b,f,p,h,O,v=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=v.length>1&&void 0!==v[1]?v[1]:2,r=v.length>2?v[2]:void 0,e.next=4,le.getDocument(t).promise;case 4:a=e.sent,c=a.numPages,u=[],s=[],i=1;case 9:if(!(i<=c)){e.next=22;break}return e.next=12,ve(a,i,n);case 12:o=e.sent,d=Object(j.a)(o,2),b=d[0],f=d[1],u.push(b),s.push(f),r&&r(Math.floor(i/c*100));case 19:i+=1,e.next=9;break;case 22:return e.next=24,ve(a,1,.5);case 24:return p=e.sent,h=Object(j.a)(p,1),O=h[0],e.abrupt("return",{images:u,ratios:s,thumbnail:O});case 28:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ke(e,t){return ye.apply(this,arguments)}function ye(){return(ye=Object(d.a)(l.a.mark((function e(t,n){var r,a,c,u,s,i,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=URL.createObjectURL(t),e.next=3,me(r,2,n);case 3:return a=e.sent,c=a.images,u=a.ratios,s=a.thumbnail,i={},c.forEach((function(e,t){i[Object(O.v4)()]={image:e,ratio:u[t],state:{strokes:[]}}})),o=t.name.replace(".pdf",""),e.abrupt("return",{uid:Object(O.v4)(),name:o,tagId:"DEFAULT",team:!1,withImg:!0,pdf:t,thumbnail:s,pages:i});case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}le.GlobalWorkerOptions.workerSrc=je.a;var Se=n(525),we=n(526),Ie=n(527),Ce=n(528),Ee=n(529),Ne=n(530),Te=n(77),Le=n.n(Te),Ae="https://api.slotdumpling.top/paint";function Ue(e){return Re.apply(this,arguments)}function Re(){return(Re=Object(d.a)(l.a.mark((function e(t){var n,r,a,c,u,s,i,o,d,b,f,p,h;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Le.a.get("code/".concat(t));case 3:if(n=e.sent,200!==(r=n.data).statusCode){e.next=24;break}if(c=(a=r).noteId,u=a.pageInfos,!(s=a.noteInfo).withImg){e.next=19;break}i=0,o=Object.entries(u);case 9:if(!(i<o.length)){e.next=19;break}return d=Object(j.a)(o[i],2),b=d[0],f=d[1],e.next=13,Le()({method:"GET",url:b,responseType:"blob"});case 13:p=e.sent,h=p.data,f.image=h;case 16:i++,e.next=9;break;case 19:return e.next=21,ne(c,s,u);case 21:return e.abrupt("return",c);case 24:return e.abrupt("return",null);case 25:e.next=31;break;case 27:return e.prev=27,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 31:case"end":return e.stop()}}),e,null,[[0,27]])})))).apply(this,arguments)}function Fe(e,t,n){return Me.apply(this,arguments)}function Me(){return(Me=Object(d.a)(l.a.mark((function e(t,n,r){var a,c,u,s,i,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.uid,c=n.name,u=n.withImg,s=n.pages,e.prev=1,e.next=4,Le.a.put("create/".concat(t),{userId:E(),pageRecord:r,noteInfo:{uid:a,name:c,withImg:u}});case 4:if(i=e.sent,o=i.data,u&&Object.entries(s).forEach((function(e){var t=Object(j.a)(e,2),n=t[0],r=t[1].image;if(r){var a=new FormData;a.append("pageId",n),a.append("file",r),Le()({method:"POST",url:"upload",data:a,headers:{"Content-Type":"multipart/form-data"}})}})),201!==o.statusCode){e.next=11;break}return e.abrupt("return",o.code);case 11:return e.abrupt("return",null);case 12:e.next=18;break;case 14:return e.prev=14,e.t0=e.catch(1),console.error(e.t0),e.abrupt("return",null);case 18:case"end":return e.stop()}}),e,null,[[1,14]])})))).apply(this,arguments)}function Pe(e,t){return De.apply(this,arguments)}function De(){return(De=Object(d.a)(l.a.mark((function e(t,n){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Le.a.put("pages/".concat(t),{userId:E(),pageRecord:n});case 3:if(r=e.sent,201!==r.data.statusCode){e.next=9;break}return e.abrupt("return",!0);case 9:return e.abrupt("return",!1);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,null,[[0,12]])})))).apply(this,arguments)}function We(e){return _e.apply(this,arguments)}function _e(){return(_e=Object(d.a)(l.a.mark((function e(t){var n,r,a,c,u,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Le.a.get("room/".concat(t));case 3:if(n=e.sent,200!==(r=n.data).statusCode){e.next=13;break}return a=r.teamPages,c=r.code,u=r.noteInfo,e.next=9,ee(a);case 9:return s=e.sent,e.abrupt("return",{code:c,pages:s,info:u});case 13:return e.abrupt("return",null);case 14:e.next=20;break;case 16:return e.prev=16,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 20:case"end":return e.stop()}}),e,null,[[0,16]])})))).apply(this,arguments)}Le.a.defaults.baseURL=Ae,Le.a.interceptors.request.use((function(e){return console.log(e.method,e.url),e}));n(294);var Be=n(4);function Ge(e){var t=e.value,n=void 0===t?0:t,a=e.digitNum,c=void 0===a?4:a,u=e.onChange,s=void 0===u?function(){}:u,i=e.onSubmit;function o(e){return 0===e?new Array(c).fill(""):String(e).slice(0,c).padEnd(c,"x").split("").map((function(e){return"x"===e?"":e}))}var l=Object(r.useState)(0),d=Object(j.a)(l,2),b=d[0],f=d[1],p=Object(r.useState)(o(n)),h=Object(j.a)(p,2),O=h[0],v=h[1];function x(){-1===b?m.current.forEach((function(e){return e.blur()})):m.current[b].focus()}Object(r.useEffect)((function(){var e=o(n);v(e)}),[n]),Object(r.useEffect)((function(){var e=O.findIndex((function(e){return""===e}));f(e);var t=Number(O.join(""));t!==n&&(s(t),-1===e&&i(t))}),[O]),Object(r.useEffect)((function(){x()}),[b]);var m=Object(r.useRef)([]);function g(e){if("Backspace"===e.key){var t=Math.max(0,b-1);f(t),v((function(e){var n=e.slice();return n[t]="",n}))}}return Object(r.useEffect)((function(){m.current=m.current.slice(0,c)}),[c]),Object(Be.jsxs)("div",{className:"digit-input",children:[O.map((function(e,t){return Object(Be.jsx)("input",{ref:function(e){e&&(m.current[t]=e)},value:e,pattern:"\\d*",onChange:function(e){return function(e,t){/^[0-9]$/.test(e)&&v((function(n){var r=n.slice();return r[t]=e,r}))}(e.target.value,t)},onKeyUp:g},t)})),Object(Be.jsx)("div",{className:"click-area",onClick:x})]})}var qe=n(517),ze=(n(296),n(145)),Ve=n.n(ze),Ke=n(177),Je=n.n(Ke),Ye=Object(r.createContext)({setActive:function(){}});function He(){return Object(Be.jsxs)("div",{id:"right-tools",children:[Object(Be.jsx)(nt,{}),Object(Be.jsx)(tt,{})]})}var Xe=function(){var e=Object(r.useContext)(Ye).setActive,t=ae.a.Item;return Object(Be.jsxs)(ae.a,{onClick:function(t){var n=t.key;return e(n)},children:[Object(Be.jsxs)(t,{children:[Object(Be.jsx)(Se.a,{}),Object(Be.jsx)("span",{children:"Load PDF"})]},"pdf"),Object(Be.jsxs)(t,{children:[Object(Be.jsx)(we.a,{}),Object(Be.jsx)("span",{children:"My profile"})]},"profile")]})},$e=function(e){var t=e.children,n=e.title,a=Object(r.useContext)(Ye).setActive;return Object(Be.jsxs)("div",{className:"secondary",children:[Object(Be.jsxs)("div",{className:"title",children:[Object(Be.jsx)(ce.a,{type:"text",shape:"circle",onClick:function(){return a("menu")},icon:Object(Be.jsx)(Ie.a,{})}),Object(Be.jsx)(Ve.a,{level:5,children:n})]}),t]})};function Qe(){var e=Object(r.useState)(!1),t=Object(j.a)(e,2),n=t[0],a=t[1],c=Object(r.useContext)(Nt).tagUid,u=Object(r.useContext)(Tt),s=u.setAllTags,i=u.setAllNotes,o=Object(r.useState)(0),b=Object(j.a)(o,2),f=b[0],p=b[1];function h(){return(h=Object(d.a)(l.a.mark((function e(t){var n,r,u,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("application/pdf"===t.type){e.next=2;break}return e.abrupt("return");case 2:return a(!0),e.next=5,ke(t,p);case 5:return(n=e.sent).tagId=c,e.next=9,Y(n);case 9:return r=e.sent,u=r.tags,o=r.allNotes,s(u),i(o),a(!1),ue.b.success("PDF Loaded"),e.abrupt("return",!1);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(Be.jsx)($e,{title:"Load PDF",children:Object(Be.jsxs)(Je.a,{disabled:n,multiple:!1,action:"#",accept:"application/pdf",beforeUpload:function(e){return h.apply(this,arguments)},children:[Object(Be.jsx)("p",{className:"ant-upload-drag-icon",children:n?Object(Be.jsx)(se.a,{width:48,type:"circle",percent:f}):Object(Be.jsx)(Ce.a,{})}),Object(Be.jsx)("p",{className:"ant-upload-hint",children:"Click or drag a pdf file here."})]})})}var Ze=function(){var e=N(),t=Object(r.useState)(e),n=Object(j.a)(t,2),a=n[0],c=n[1];return Object(Be.jsx)($e,{title:"My profile",children:Object(Be.jsxs)("div",{className:"profile-page",children:[Object(Be.jsx)(ie.a,{prefix:Object(Be.jsx)(we.a,{}),value:a,onChange:function(e){return c(e.target.value)}}),Object(Be.jsx)(ce.a,{onClick:function(){!function(e){!!(e=e.trim())&&localStorage.setItem("USER_NAME",e)}(a)},type:"primary",block:!0,children:"Enter"})]})})},et=function(){var e=Object(r.useState)(100),t=Object(j.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)("menu"),u=Object(j.a)(c,2),s=u[0],i=u[1],o={timeout:300,onEnter:function(e){a(e.clientHeight)},unmountOnExit:!0},l=Object(w.a)(Object(w.a)({},o),{},{classNames:"secondary"});return Object(Be.jsx)(Ye.Provider,{value:{setActive:i},children:Object(Be.jsxs)("section",{className:"others-menu",style:{height:n},children:[Object(Be.jsx)(qe.a,Object(w.a)(Object(w.a)({classNames:"primary",in:"menu"===s},o),{},{children:Object(Be.jsx)(Xe,{})})),Object(Be.jsx)(qe.a,Object(w.a)(Object(w.a)({in:"pdf"===s},l),{},{children:Object(Be.jsx)(Qe,{})})),Object(Be.jsx)(qe.a,Object(w.a)(Object(w.a)({in:"profile"===s},l),{},{children:Object(Be.jsx)(Ze,{})}))]})})},tt=function(){return Object(Be.jsx)(oe.a,{placement:"bottomRight",trigger:"click",content:Object(Be.jsx)(et,{}),children:Object(Be.jsx)(ce.a,{shape:"circle",icon:Object(Be.jsx)(Ee.a,{})})})};function nt(){var e=Object(r.useState)(0),t=Object(j.a)(e,2),n=t[0],a=t[1],c=Object(i.f)();function u(){return(u=Object(d.a)(l.a.mark((function e(t){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=ue.b.loading("Loading team note...",0),e.next=3,Ue(t);case 3:r=e.sent,n(),r?c("/team/".concat(r)):(a(0),ue.b.error("Room doesn't exist."));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(Be.jsx)(oe.a,{placement:"bottomRight",trigger:"click",title:"Join a team note",destroyTooltipOnHide:!0,content:Object(Be.jsx)(Ge,{value:n,onChange:a,onSubmit:function(e){return u.apply(this,arguments)}}),children:Object(Be.jsx)(ce.a,{shape:"round",icon:Object(Be.jsx)(Ne.a,{}),children:"Team"})})}function rt(){var e=Object(r.useContext)(Nt).editing,t=Object(r.useContext)(Tt).setEditing;return Object(Be.jsx)("div",{id:"left-tools",children:Object(Be.jsx)(ce.a,{onClick:function(){t((function(e){return!e}))},type:e?"primary":"text",children:e?"Done":"Edit"})})}var at=n(520),ct=n(521),ut=n(531),st=n(152),it=n(88),ot=n(532),lt=n(533),dt=n(534),jt=n(535),bt=n(536),ft=n(250),pt=n.n(ft),ht=function(e){var t={backgroundColor:e.color};return Object(Be.jsx)("div",{className:"tag-circle",style:t})};function Ot(e){var t=e.noteTag,n=t.uid,a=t.color,c=t.name,u=t.notes,s=Object(r.useContext)(Nt).editing,i=Object(r.useContext)(Tt),o=i.setTagUid,b=i.setAllTags,f=Object(r.useState)(!1),p=Object(j.a)(f,2),h=p[0],O=p[1],v=Object(r.useState)(c),x=Object(j.a)(v,2),m=x[0],g=x[1],k=Object(r.useState)(a),y=Object(j.a)(k,2),S=y[0],w=y[1];function I(){return(I=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D(n);case 2:t=e.sent,o("DEFAULT"),b(t);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(){return(C=Object(d.a)(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={uid:n,name:m,color:S,notes:u},e.next=3,_(t);case 3:r=e.sent,b(r),O(!1);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var E=Object(Be.jsx)(at.a,{value:S,onSelect:w,children:T.map((function(e){return Object(Be.jsx)(at.a.Option,{value:e,children:Object(Be.jsx)(ht,{color:e})},e)}))}),N=function(){return Object(Be.jsx)(ie.a,{className:"tag-name-input",addonBefore:E,value:m,onChange:function(e){return g(e.target.value)}})};return Object(Be.jsxs)("div",{className:"menu-item",children:[s&&h?Object(Be.jsxs)(Be.Fragment,{children:[Object(Be.jsx)(ct.a,{title:"Delete this tag?",onConfirm:function(){return I.apply(this,arguments)},placement:"left",okText:"Yes",cancelText:"No",children:Object(Be.jsx)(ce.a,{type:"text",danger:!0,size:"small",icon:Object(Be.jsx)(ut.a,{})})}),Object(Be.jsx)(N,{})]}):Object(Be.jsxs)(Be.Fragment,{children:[Object(Be.jsx)(ht,{color:S}),Object(Be.jsx)("span",{className:"tag-name",children:m})]}),s&&h&&Object(Be.jsxs)(Be.Fragment,{children:[Object(Be.jsx)(ce.a,{disabled:""===m,size:"small",type:"link",onClick:function(){return C.apply(this,arguments)},icon:Object(Be.jsx)(st.a,{})}),Object(Be.jsx)(ce.a,{size:"small",type:"text",onClick:function(){g(c),w(a),O(!1)},icon:Object(Be.jsx)(it.a,{})})]}),s&&!h&&Object(Be.jsx)(ce.a,{size:"small",type:"text",onClick:function(){return O(!0)},icon:Object(Be.jsx)(ot.a,{})})]})}var vt=function(){var e=Object(r.useContext)(Tt).setAllTags;function t(){return(t=Object(d.a)(l.a.mark((function t(n){var r,a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.trim()){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,M(r);case 7:a=t.sent,e(a);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var n=Object(Be.jsx)(pt.a,{placeholder:"Tag name...",onSearch:function(e){return t.apply(this,arguments)},allowClear:!0,enterButton:Object(Be.jsx)(lt.a,{})});return Object(Be.jsx)("div",{id:"add-tag",children:Object(Be.jsx)(oe.a,{content:n,trigger:"click",placement:"topLeft",destroyTooltipOnHide:!0,children:Object(Be.jsx)(ce.a,{shape:"circle",type:"text",icon:Object(Be.jsx)(dt.a,{})})})})};function xt(){var e=Object(r.useContext)(Nt).allTags,t=Object(r.useContext)(Tt).setTagUid;var n=ae.a.Item;return Object(Be.jsxs)("aside",{children:[Object(Be.jsx)("label",{htmlFor:"aside-checkbox",id:"aside-label",children:Object(Be.jsx)(jt.a,{})}),Object(Be.jsx)("input",{type:"checkbox",id:"aside-checkbox"}),Object(Be.jsxs)("div",{id:"side-wrapper",children:[Object(Be.jsxs)(ae.a,{onClick:function(e){var n=e.key;t(n)},id:"side-menu",defaultSelectedKeys:["DEFAULT"],defaultOpenKeys:["sub1"],mode:"inline",children:[Object(Be.jsx)(n,{children:Object(Be.jsxs)("div",{className:"menu-item",children:[Object(Be.jsx)(bt.a,{id:"all-note-icon"}),Object(Be.jsx)("span",{className:"tag-name",children:"All Notes"})]})},"DEFAULT"),Object.values(e).map((function(e){return Object(Be.jsx)(n,{children:Object(Be.jsx)(Ot,{noteTag:e})},e.uid)}))]}),Object(Be.jsx)("footer",{children:Object(Be.jsx)(vt,{})})]})]})}var mt=n(522),gt=n(523),kt=n(537),yt=n(538),St=n(539),wt=n.p+"static/media/default.dd551273.png";function It(e){var t=e.noteList;return Object(Be.jsx)("div",{id:"note-list",children:t.map((function(e){return Object(Be.jsx)(Ct,{noteInfo:e},e.uid)}))})}var Ct=function(e){var t=e.noteInfo,n=Object(r.useContext)(Nt),a=n.editing,c=n.allTags,u=t.team,i=t.uid,o=t.name,f=t.thumbnail,p=a?"#":"".concat(u?"team":"reader","/").concat(i),h=Object(r.useContext)(Tt),O=h.setAllTags,v=h.setAllNotes,x=Object(r.useState)(o),m=Object(j.a)(x,2),g=m[0],k=m[1],y=Object(r.useState)(!1),S=Object(j.a)(y,2),I=S[0],C=S[1];function E(){return N.apply(this,arguments)}function N(){return(N=Object(d.a)(l.a.mark((function e(){var t,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X(i);case 2:t=e.sent,n=t.tags,r=t.allNotes,O(n),v(r);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var T=Object(r.useMemo)((function(){return f?URL.createObjectURL(f):null}),[f]);Object(r.useEffect)((function(){var e=T||"";return function(){return URL.revokeObjectURL(e)}}),[T]);var L=function(){var e=Object(d.a)(l.a.mark((function e(t){var n,r,a,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.key,e.next=3,Q(i,n);case 3:r=e.sent,a=r.tags,c=r.allNotes,O(a),v(c);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),A=function(){var e=ae.a.Item,t=Object(Be.jsxs)(ae.a,{onClick:L,children:[Object(Be.jsx)(e,{children:Object(Be.jsxs)("div",{className:"tag-select",children:[Object(Be.jsx)(it.a,{className:"none-tag-icon"}),Object(Be.jsx)("span",{children:"None Tag"})]})},"DEFAULT"),Object.values(c).map((function(t){return Object(Be.jsx)(e,{children:Object(Be.jsxs)("div",{className:"tag-select",children:[Object(Be.jsx)(ht,{color:t.color}),Object(Be.jsx)("span",{children:t.name})]})},t.uid)}))]});return Object(Be.jsx)(mt.a,{overlay:t,trigger:["click"],children:Object(Be.jsx)(ce.a,{className:"note-delete",type:"text",icon:Object(Be.jsx)(kt.a,{})})})},U=function(){return Object(Be.jsx)(ct.a,{title:"Delete this note?",onConfirm:E,okText:"Yes",cancelText:"No",children:Object(Be.jsx)(ce.a,{className:"note-delete",type:"text",danger:!0,icon:Object(Be.jsx)(yt.a,{})})})};return Object(Be.jsx)(s.b,{to:p,children:Object(Be.jsxs)("div",{className:"list-item",children:[Object(Be.jsxs)("div",{className:"thumbnail-wrapper",children:[Object(Be.jsx)("img",{src:T||wt,alt:o,className:"thumbnail".concat(I?" loaded":""),onLoad:function(){return C(!0)}}),u&&Object(Be.jsx)(gt.a,{color:"blue",className:"cloud-icon",children:Object(Be.jsx)(St.a,{})})]}),a||Object(Be.jsx)("p",{className:"note-name",children:o}),a&&Object(Be.jsxs)(Be.Fragment,{children:[Object(Be.jsx)(ie.a,{className:"note-name-input",value:g,onChange:function(e){return k(e.target.value)},onBlur:function(){z(i,{name:g}),v((function(e){return Object(w.a)(Object(w.a)({},e),{},Object(b.a)({},i,Object(w.a)(Object(w.a)({},e[i]),{},{name:g})))}))}}),Object(Be.jsx)(A,{}),Object(Be.jsx)(U,{})]})]})})},Et=n(540),Nt=Object(r.createContext)({tagUid:"DEFAULT",editing:!1,allNotes:{},allTags:{}}),Tt=Object(r.createContext)({setAllNotes:function(){},setAllTags:function(){},setTagUid:function(){},setEditing:function(){}});function Lt(){var e=Object(r.useState)({}),t=Object(j.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)({}),u=Object(j.a)(c,2),s=u[0],i=u[1],o=Object(r.useState)("DEFAULT"),l=Object(j.a)(o,2),d=l[0],b=l[1],f=Object(r.useState)(!1),p=Object(j.a)(f,2),h=p[0],O=p[1],v=Object(r.useMemo)((function(){return"DEFAULT"===d?{uid:"",name:"All Notes",color:"#000",notes:Object.keys(n)}:s[d]}),[d,s,n]),x=Object(r.useMemo)((function(){return v.notes.filter((function(e){return e in n})).map((function(e){return n[e]}))}),[v,n]);return Object(r.useEffect)((function(){A().then(a),R().then(i),document.title="Multibility"}),[]),Object(Be.jsx)(Nt.Provider,{value:{tagUid:d,editing:h,allNotes:n,allTags:s},children:Object(Be.jsx)(Tt.Provider,{value:{setAllNotes:a,setAllTags:i,setEditing:O,setTagUid:b},children:Object(Be.jsxs)("div",{id:"menu-container",children:[Object(Be.jsxs)("header",{children:[Object(Be.jsx)(rt,{}),Object(Be.jsx)(Ve.a,{level:4,children:v.name}),Object(Be.jsx)(He,{})]}),Object(Be.jsxs)("main",{children:[Object(Be.jsx)(xt,{}),Object(Be.jsx)(It,{noteList:x}),Object(Be.jsx)(At,{})]})]})})})}var At=function(){var e=Object(r.useContext)(Nt).tagUid,t=Object(r.useContext)(Tt),n=t.setAllTags,a=t.setAllNotes;function c(){return(c=Object(d.a)(l.a.mark((function t(){var r,c,u,s;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(r=y()).tagId=e,t.next=4,Y(r);case 4:c=t.sent,u=c.tags,s=c.allNotes,n(u),a(s);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return Object(Be.jsx)(ce.a,{id:"new-note",size:"large",type:"primary",shape:"circle",onClick:function(){return c.apply(this,arguments)},icon:Object(Be.jsx)(Et.a,{})})},Ut=a.a.memo((function(e){var t=e.drawState,n=Object(r.useRef)(null),a=Object(r.useRef)(),c=t.width,u=t.height;return Object(r.useEffect)((function(){if(n.current){n.current.addEventListener("touchstart",(function(e){e.preventDefault()}),{passive:!1});var e=n.current.getContext("2d");e&&(a.current=e)}}),[]),Object(r.useEffect)((function(){var e;console.log("display rerender"),null===(e=a.current)||void 0===e||e.clearRect(0,0,c,u),t.getValidStrokes().forEach((function(e){a.current&&pe(a.current,e.points,"black")}))})),Object(Be.jsx)("canvas",{width:c,height:u,ref:n})}));function Rt(e){return"direct"===e.touches[0].touchType}function Ft(e){var t=e.drawState,n=e.setDrawState,a=e.finger,c=e.even,u=e.lineWidth,s=e.erasing,i=e.eraser,o=t.width,l=t.height,d=Object(r.useRef)(null),b=Object(r.useRef)(o),f=Object(r.useRef)(l),p=Object(r.useRef)(!1),h=Object(r.useRef)(),O=Object(r.useRef)(new Set);function v(){if(!d.current)throw Error("can't get canvas element");return d.current}function x(){var e=v().getContext("2d");if(!e)throw Error("can't get canvas context");return e}function m(e){var t=v().getBoundingClientRect(),n=e.clientX-t.left,r=e.clientY-t.top;return[n/b.current*o,r/f.current*l]}function k(){b.current=v().clientWidth,f.current=v().clientHeight}function y(){var e=h.current;if(p.current&&e){p.current=!1;var t=s?function(){n((function(e){return g.eraseStrokes(e,Array.from(O.current))})),O.current.clear()}:function(){var t=e.points;t.length<3||n((function(e){return g.addStroke(e,t)}))};requestAnimationFrame((function(){requestAnimationFrame(t)}))}}return Object(r.useEffect)(k,[]),Object(r.useEffect)((function(){var e=v(),t=function(e){!a&&Rt(e)||e.preventDefault()};return e.addEventListener("touchstart",t,{passive:!1}),function(){e.removeEventListener("touchstart",t)}}),[a]),Object(r.useEffect)((function(){x().clearRect(0,0,o,l)}),[t,o,l]),Object(Be.jsx)("canvas",{width:o,height:l,ref:d,onTouchStart:function(e){var t;if(a||!Rt(e)){p.current=!0,k(),h.current=new fe(x());var n=e.touches[0],r=(null!==(t=n.force)&&void 0!==t?t:0)*u,s=m(n),i=Object(j.a)(s,2),o={x:i[0],y:i[1],lineWidth:c?u:h.current.computeLineWidth(r)};h.current.drawBegin(o)}},onMouseDown:function(e){p.current=!0,k();var t=m(e),n=Object(j.a)(t,2),r=n[0],a=n[1];h.current=new fe(x());var c={x:r,y:a,lineWidth:u};h.current.drawBegin(c)},onTouchMove:function(e){var t;if(p.current&&h.current){var n=e.touches[0];if(a||!Rt(e)){var r=(null!==(t=n.force)&&void 0!==t?t:0)*u,o=m(n),l=Object(j.a)(o,2),d=l[0],b=l[1],f={x:d,y:b,lineWidth:c?u:h.current.computeLineWidth(r)};h.current.drawCurve(f,s?"#ccc":void 0),s&&(null===i||void 0===i||i.checkWithIntrpl([d,b]).forEach((function(e){O.current.add(e)})))}}},onMouseMove:function(e){if(p.current&&h.current){var t=m(e),n=Object(j.a)(t,2),r=n[0],a=n[1],c={x:r,y:a,lineWidth:u};h.current.drawCurve(c,s?"#ccc":void 0),s&&(null===i||void 0===i||i.checkWithIntrpl([r,a]).forEach((function(e){O.current.add(e)})))}},onTouchEnd:y,onMouseUp:y,onMouseLeave:y})}n(481);var Mt=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(f.a)(this,e),this.ctxRec={},this.prevPoint=void 0;var a=t.getValidStrokes(),c=t.width,u=t.height;a.forEach((function(e){var t=e.points,a=e.uid;if(a in r)n.ctxRec[a]=r[a];else{var s=he(c,u).context;n.ctxRec[a]=s,pe(s,t,"black")}}))}return Object(p.a)(e,[{key:"checkPoint",value:function(e){var t=Object(j.a)(e,2),n=t[0],r=t[1];return Object.entries(this.ctxRec).filter((function(e){return Object(j.a)(e,2)[1].isPointInStroke(n,r)})).map((function(e){return Object(j.a)(e,1)[0]}))}},{key:"checkWithIntrpl",value:function(e){var t=this,n=Object(j.a)(e,2),r=n[0],a=n[1],c=this.prevPoint?function(e,t){var n=Object(j.a)(e,2),r=n[0],a=n[1],c=Object(j.a)(t,2),u=c[0],s=c[1],i=u-r,o=s-a,l=Math.max(Math.abs(i),Math.abs(o));if(0===l)return[[u,s]];var d=i/l,b=o/l,f=[];for(;(i<=0&&r>=u||i>0&&r<=u)&&(o<=0&&a>=s||o>0&&a<=s);)r+=d,a+=b,f.push([r,a]);return f}(this.prevPoint,[r,a]):[[r,a]];return this.prevPoint=[r,a],c.map((function(e){return t.checkPoint(e)})).reduce((function(e,t){return t.forEach((function(t){return e.add(t)})),e}),new Set)}}]),e}();function Pt(e){var t=e.drawState,n=e.onChange,a=e.erasing,c=void 0!==a&&a,u=e.finger,s=void 0!==u&&u,i=e.even,o=void 0===i||i,l=e.lineWidth,d=void 0===l?10:l,j=Object(r.useRef)({}),b=Object(r.useMemo)((function(){var e=new Mt(t,j.current);return j.current=e.ctxRec,e}),[t]);return Object(Be.jsxs)("div",{className:"draw-wrapper",children:[Object(Be.jsx)(Ut,{drawState:t}),Object(Be.jsx)(Ft,{drawState:t,finger:s,even:o,lineWidth:d,setDrawState:n,eraser:b,erasing:c})]})}n(482);var Dt={states:Object(h.b)(),keys:Object(h.a)(),editStack:Object(h.a)(),undoStack:Object(h.a)()},Wt=Object(h.d)(Dt),_t=function(){function e(t,n){Object(f.a)(this,e),this.immutable=t,this.lastOp=n}return Object(p.a)(e,[{key:"getImmutable",value:function(){return this.immutable}},{key:"getStates",value:function(){return this.getImmutable().get("states")}},{key:"getKeys",value:function(){return this.getImmutable().get("keys")}},{key:"getEditStack",value:function(){return this.getImmutable().get("editStack")}},{key:"getUndoStack",value:function(){return this.getImmutable().get("undoStack")}},{key:"setState",value:function(t,n){var r,a=this.getImmutable().update("states",(function(e){return e.set(t,n)}));return this.getStates().has(t)&&(a=a.update("editStack",(function(e){return e.push(t)}))),n.lastOp&&(r=Object(w.a)(Object(w.a)({},n.lastOp),{},{pageId:t})),new e(a,r)}},{key:"getOneState",value:function(e){return this.getImmutable().get("states").get(e)}},{key:"isUndoable",value:function(){return this.getEditStack().size>0}},{key:"isRedoable",value:function(){return this.getUndoStack().size>0}},{key:"undo",value:function(){if(!this.isUndoable())return this;var t=this.getImmutable().get("editStack").last();if(!t)return this;var n=this.getImmutable().get("states").get(t);if(!n)return this;var r,a=g.undo(n),c=a.lastOp;return c&&(r=Object(w.a)({pageId:t},c)),new e(this.getImmutable().update("editStack",(function(e){return e.pop()})).update("undoStack",(function(e){return e.push(t)})).update("states",(function(e){return e.set(t,a)})),r)}},{key:"redo",value:function(){if(this.isRedoable()){var t=this.getImmutable().get("undoStack").last();if(!t)return this;var n=this.getImmutable().get("states").get(t);if(!n)return this;var r,a=g.redo(n),c=a.lastOp;return c&&(r=Object(w.a)({pageId:t},c)),new e(this.getImmutable().update("undoStack",(function(e){return e.pop()})).update("editStack",(function(e){return e.push(t)})).update("states",(function(e){return e.set(t,a)})),r)}return this}},{key:"pushStroke",value:function(e,t){var n=this.getImmutable().get("states").get(e);if(!n)return this;var r=g.pushStroke(n,t);return this.setState(e,r)}},{key:"pushOperation",value:function(e){var t,n=e.type,r=e.pageId,a=this.getImmutable().get("states").get(r);if(!a)return this;switch(n){case"add":t=g.pushStroke(a,e.stroke);break;case"erase":t=g.pushErase(a,e.erase);break;case"undo":t=g.pushUndo(a,e.undoUid);break;case"redo":t=g.pushRedo(a,e.redoUid)}return this.setState(r,t)}}],[{key:"createEmpty",value:function(){return new e(Wt())}},{key:"createKeyed",value:function(t){return new e(Wt().set("keys",Object(h.a)(t)))}},{key:"createFromList",value:function(t){return new e(Wt().set("keys",Object(h.a)(t.map((function(e){return e[0]})))).set("states",Object(h.b)(t)))}},{key:"createFromPages",value:function(t,n){var r=Object.entries(t);return e.createFromList(r.map((function(e){var t=Object(j.a)(e,2),r=t[0],a=t[1],c=a.state,u=a.ratio;return[r,g.loadFromFlat(c,n,n*u)]})))}}]),e}(),Bt=n(251),Gt=n(514),qt=n(519),zt=n(513),Vt=n(524),Kt=n(543),Jt=n(182),Yt=n(544),Ht=n(545),Xt=n(546),$t=(n(483),n(252)),Qt=n(541),Zt=n(542),en=Object(r.createContext)({code:-2,userList:[]});function tn(){var e,t=null!==(e=Object(i.g)().noteId)&&void 0!==e?e:"",n=Object(r.useState)(),a=Object(j.a)(n,2),c=a[0],u=a[1],s=Object(r.useState)(-2),o=Object(j.a)(s,2),b=o[0],f=o[1],p=Object(r.useState)([]),h=Object(j.a)(p,2),O=h[0],v=h[1],x=Object(r.useState)(function(e){return function(){return Object($t.io)(Ae,{autoConnect:!1,query:{userId:E(),userName:N(),noteId:e}})}}(t)),m=Object(j.a)(x,1)[0],g=Object(i.f)();function k(){return y.apply(this,arguments)}function y(){return(y=Object(d.a)(l.a.mark((function e(){var n,r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,We(t);case 2:if(n=e.sent){e.next=6;break}return ue.b.error("Failed loading the team note"),e.abrupt("return",g("/"));case 6:r=n.code,a=n.pages,f(r),u(_t.createFromPages(a,jn));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var S=function(){var e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k();case 2:m.on("push",(function(e){var t=e.operation;u((function(e){return null===e||void 0===e?void 0:e.pushOperation(t)}))})),m.on("joined",(function(e){var t=e.joined,n=e.members,r=t.userId,a=t.userName;v(n),r!==E()&&ue.b.success({icon:Object(Be.jsx)(Qt.a,{}),content:a+" joined room"})})),m.on("leaved",(function(e){var t=e.leaved,n=e.members,r=t.userId,a=t.userName;v(n),r!==E()&&ue.b.warning({icon:Object(Be.jsx)(Zt.a,{}),content:a+" leaved room"})})),m.connect();case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),w=function(){m.off("connect"),m.off("push"),m.off("joined"),m.off("leaved"),m.disconnect()};Object(r.useEffect)((function(){return S(),w}),[t]);return Object(Be.jsx)(en.Provider,{value:{code:b,userList:O},children:Object(Be.jsx)(On,{teamOn:!0,teamStateSet:c,pushOperation:function(e){m.emit("push",{operation:e})}})})}n(509);function nn(e){var t=e.value,n=Object(r.useState)(9999),a=Object(j.a)(n,2),c=a[0],u=a[1],s=String(t>=0?t:c).padStart(4,"0").split("").map((function(e){return Number(e)}));function i(){u(Math.floor(1e4*Math.random()))}return Object(r.useEffect)((function(){if(-1!==t)return u(9999);var e=setTimeout(i,100);return function(){return clearTimeout(e)}}),[t]),Object(Be.jsx)("div",{className:"digit-display ".concat(-2===t?"disabled":""),children:s.map((function(e,t){return Object(Be.jsx)(rn,{digit:e},t)}))})}function rn(e){var t=e.digit;return t<=9&&t>=0?Object(Be.jsx)("div",{className:"digit",children:t}):Object(Be.jsx)("div",{className:"digit",children:"*"})}var an=Object(Vt.a)({scriptUrl:"//at.alicdn.com/t/font_3181679_ofhwjwfs5hb.js"});function cn(e){var t=e.setDrawCtrl,n=e.handleUndo,a=e.handleRedo,c=e.instantSave,u=Object(r.useContext)(fn),s=Object(r.useContext)(pn),o=s.saved,l=s.stateSet,d=s.teamOn,j=Object(i.f)(),b=function(e){t((function(t){return Object(w.a)(Object(w.a)({},t),e)}))},f=Object(Be.jsx)("div",{className:"pen-panel",children:Object(Be.jsx)(Gt.a,{min:1,max:20,value:u.lineWidth,onChange:function(e){return b({lineWidth:e})}})}),p=function(){return u.erasing?Object(Be.jsx)(ce.a,{type:"text",shape:"circle",onClick:function(){return b({erasing:!1})},icon:Object(Be.jsx)(Kt.a,{})}):Object(Be.jsx)(oe.a,{content:f,trigger:"click",placement:"bottom",getPopupContainer:function(e){var t;return(null===(t=e.parentElement)||void 0===t?void 0:t.parentElement)||e},children:Object(Be.jsx)(ce.a,{type:"default",shape:"circle",icon:Object(Be.jsx)(Kt.a,{})})})};return Object(Be.jsxs)("div",{className:"tool-bar",children:[Object(Be.jsxs)("div",{className:"left-buttons",children:[Object(Be.jsx)(ce.a,{type:"text",onClick:function(){return j("/")},icon:Object(Be.jsx)(Jt.a,{}),children:"Back"}),Object(Be.jsx)(ce.a,{type:"text",onClick:c,disabled:o,icon:Object(Be.jsx)(Yt.a,{})})]}),Object(Be.jsxs)("div",{className:"middle-buttons",children:[Object(Be.jsx)(ce.a,{type:"text",icon:Object(Be.jsx)(Ht.a,{}),onClick:n,disabled:!(null===l||void 0===l?void 0:l.isUndoable())}),Object(Be.jsx)(ce.a,{className:"redo-button",type:"text",icon:Object(Be.jsx)(Xt.a,{}),onClick:a,disabled:!(null===l||void 0===l?void 0:l.isRedoable())}),Object(Be.jsx)(p,{}),Object(Be.jsx)(ce.a,{type:u.erasing?"default":"text",shape:"circle",onClick:function(){return b({erasing:!0})},icon:Object(Be.jsx)(an,{type:"icon-eraser"})})]}),Object(Be.jsxs)("div",{className:"right-buttons",children:[d&&Object(Be.jsx)(sn,{}),d||Object(Be.jsx)(on,{})]})]})}var un=function(e){var t=e.userInfo.userName;return Object(Be.jsxs)("div",{className:"user-card",children:[Object(Be.jsx)(qt.a,{className:"avatar",size:"small",style:{backgroundColor:L()},children:t.slice(0,4)}),Object(Be.jsx)("span",{children:t})]})};function sn(){var e=Object(r.useContext)(en),t=e.code,n=e.userList,a=Object(Be.jsxs)("div",{className:"team-popover",children:[Object(Be.jsx)(nn,{value:t}),Object(Be.jsx)(zt.a,{}),Object(Be.jsx)("div",{className:"user-list",children:n.map((function(e){return Object(Be.jsx)(un,{userInfo:e},e.userId)}))})]});return Object(Be.jsx)(oe.a,{content:a,trigger:"click",placement:"bottomRight",title:"Team info",defaultVisible:!0,getPopupContainer:function(e){var t;return(null===(t=e.parentElement)||void 0===t?void 0:t.parentElement)||e},children:Object(Be.jsx)(ce.a,{shape:"round",icon:Object(Be.jsx)(Ne.a,{}),children:"Team"})})}var on=function(){var e=Object(r.useContext)(hn).createRoom;return Object(Be.jsx)(ct.a,{placement:"bottomRight",title:"Enable team editing?",onConfirm:e,okText:"Yes",cancelText:"No",children:Object(Be.jsx)(ce.a,{shape:"round",icon:Object(Be.jsx)(Ne.a,{}),children:"Team"})})},ln=n(257),dn=n(96),jn=2e3,bn={erasing:!1,finger:!1,even:!0,lineWidth:5,color:"#000"},fn=Object(r.createContext)(bn),pn=Object(r.createContext)({noteId:"",stateSet:void 0,saved:!0,teamOn:!1}),hn=Object(r.createContext)({setSaved:function(){},createRoom:function(){}});function On(e){var t,n=e.teamOn,a=e.teamStateSet,c=e.pushOperation,u=null!==(t=Object(i.g)().noteId)&&void 0!==t?t:"",s=Object(i.f)(),o=Object(r.useState)(),f=Object(j.a)(o,2),p=f[0],h=f[1],O=Object(r.useState)(),v=Object(j.a)(O,2),x=v[0],m=v[1],k=Object(r.useState)(),y=Object(j.a)(k,2),S=y[0],I=y[1],C=Object(r.useState)(bn),E=Object(j.a)(C,2),N=E[0],T=E[1],L=Object(r.useState)(!0),A=Object(j.a)(L,2),U=A[0],R=A[1],F=function(){var e=Object(d.a)(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G(u);case 2:if(t=e.sent){e.next=6;break}return ue.b.error("Note not found"),e.abrupt("return",s("/"));case 6:r=t.pages,h(r),m(t),I(_t.createFromPages(r,jn)),n&&Pe(u,r);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),M=Object(r.useCallback)(Object(Bt.debounce)(function(){var e=Object(d.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z(u,{pages:t});case 2:R(!0);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),1e3),[]),P=M.flush,D=function(){var e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(x&&p){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,Fe(u,x,p);case 4:if(e.sent){e.next=8;break}return ue.b.error("Can't create room."),e.abrupt("return");case 8:return e.next=10,z(u,{team:!0});case 10:s("/team/"+u);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),W=function(){P()};Object(r.useEffect)((function(){return F(),W}),[u,n]),Object(r.useEffect)((function(){x&&(document.title=x.name)}),[x]),Object(ln.a)(W),Object(r.useEffect)((function(){(null===S||void 0===S?void 0:S.lastOp)&&c&&c(S.lastOp)}),[S]),Object(r.useEffect)((function(){p&&(M(p),R(!1))}),[p]);var _=Object(r.useCallback)((function(e,t){I((function(n){return null===n||void 0===n?void 0:n.setState(e,t)})),h((function(n){if(n)return Object(w.a)(Object(w.a)({},n),{},Object(b.a)({},e,Object(w.a)(Object(w.a)({},n[e]),{},{state:g.flaten(t)})))}))}),[]);return Object(Be.jsx)(fn.Provider,{value:N,children:Object(Be.jsx)(pn.Provider,{value:{noteId:u,stateSet:S,saved:U,teamOn:n},children:Object(Be.jsx)(hn.Provider,{value:{setSaved:R,createRoom:D},children:Object(Be.jsxs)("div",{className:"reader-container",children:[Object(Be.jsx)(cn,{setDrawCtrl:T,instantSave:P,handleUndo:function(){I((function(e){return null===e||void 0===e?void 0:e.undo()}))},handleRedo:function(){I((function(e){return null===e||void 0===e?void 0:e.redo()}))}}),null===S||void 0===S?void 0:S.getKeys().map((function(e){if(!p)return Object(Be.jsx)(Be.Fragment,{});var t=p[e],n=S.getOneState(e),r=null===a||void 0===a?void 0:a.getOneState(e);return t&&n?Object(Be.jsx)(vn,{drawState:n,teamState:r,updateState:_,imageBlob:t.image,uid:e},e):Object(Be.jsx)(Be.Fragment,{})})),Object(Be.jsx)(dn.a,{className:"page-loading"})]})})})})}var vn=a.a.memo((function(e){var t=e.imageBlob,n=e.drawState,a=e.teamState,c=e.uid,u=e.updateState,s=Object(r.useState)(!1),i=Object(j.a)(s,2),o=i[0],l=i[1],d=Object(r.useMemo)((function(){return t?URL.createObjectURL(t):null}),[t]);return Object(r.useEffect)((function(){var e=d||"";return function(){return URL.revokeObjectURL(e)}}),[d]),Object(Be.jsxs)("div",{className:"pdf-page ".concat(o?"loaded":""),children:[Object(Be.jsx)("img",{src:d||wt,alt:"pdf-page",onLoad:function(){return l(!0)}}),Object(Be.jsxs)("div",{className:"page-draw",children:[a&&Object(Be.jsx)(Ut,{drawState:a}),Object(Be.jsx)(xn,{updateState:u,drawState:n,uid:c})]})]})})),xn=function(e){var t=e.drawState,n=e.uid,a=e.updateState,c=Object(r.useContext)(fn);return Object(Be.jsx)(Pt,{drawState:t,onChange:function(e){var r=e instanceof g?e:e(t);a(n,r)},erasing:c.erasing,lineWidth:c.lineWidth})};function mn(){var e=Object(r.useRef)(null);return Object(r.useEffect)((function(){var t,n=null===(t=e.current)||void 0===t?void 0:t.getContext("2d");if(n)return n.lineWidth=20,n.beginPath(),n.moveTo(0,0),n.quadraticCurveTo(100,0,100,100),n.stroke(),n.beginPath(),n.moveTo(100,100),n.quadraticCurveTo(100,200,200,200),n.stroke(),function(){return n.clearRect(0,0,300,300)}}),[]),Object(Be.jsx)("div",{children:Object(Be.jsx)("canvas",{width:1e3,height:1e3,ref:e,onMouseMove:function(t){var n,r=t.clientX,a=t.clientY;console.log(r,a);var c=null===(n=e.current)||void 0===n?void 0:n.getContext("2d");c&&(console.time("in"),console.assert(!c.isPointInStroke(r,a)),console.timeEnd("in"))}})})}var gn=Object(Be.jsx)("main",{style:{padding:"1rem"},children:Object(Be.jsx)("p",{children:"There's nothing here!"})});u.a.render(Object(Be.jsx)(s.a,{children:Object(Be.jsxs)(i.c,{children:[Object(Be.jsx)(i.a,{path:"/",element:Object(Be.jsx)(Lt,{})}),Object(Be.jsx)(i.a,{path:"/reader",children:Object(Be.jsx)(i.a,{path:":noteId",element:Object(Be.jsx)(On,{teamOn:!1})})}),Object(Be.jsx)(i.a,{path:"/team",children:Object(Be.jsx)(i.a,{path:":noteId",element:Object(Be.jsx)(tn,{})})}),Object(Be.jsx)(i.a,{path:"/test",element:Object(Be.jsx)(mn,{})}),Object(Be.jsx)(i.a,{path:"*",element:gn})]})}),document.getElementById("root"))}},[[510,1,2]]]);
//# sourceMappingURL=main.10a31264.chunk.js.map