(self.webpackChunkmultibility=self.webpackChunkmultibility||[]).push([[25],{22568:function(e,t,n){"use strict";var r=n(92721);t.Z=(0,r.Z)({scriptUrl:"//at.alicdn.com/t/font_3181679_yo844n7qgns.js"})},38117:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return xe}});var r=n(15861),i=n(29439),a=n(87757),o=n.n(a),u=n(72791),c=n(11886),s=n(81832),l=n(95099),d=n(1413),f=n(93433),v=n(12262),h=n.n(v),p=n(41446),m=n(1488),w=n(82670),g=n(96153),x=function(){var e=new Map,t=(0,g.v)(44,44),n=t.canvas,r=t.context,i=new Image;return i.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAAAXNSR0IArs4c6QAABWlJREFUWEftmF1IW2cYx580iaaNSTSmdWUtRVBBnENbSG40YVtRRpZM4ydqLEpJnd5sVzpxU7TipoMy8EYd6kwC6pakiDeCih/oyBGibS/qTZWaoE63RONXqiYZj5xIKtvFzhvRQl84nHPzvud3nvO8//f5Pyx4xwbrHeOF98Dn/cfeR/h9hM9EgDQlcP4VgJPNi/ezww8AeHnpO/EPIAXm2O32+3w+/xOv13vF5/O9tR6Hw/FxuVyvUChsAIDDUECTAOPca1NTU5+np6f/Zjab7X6//631cnJybjkcjp9v375dDwB7AHBMGmISYEwBocViUWVlZfVJpVLP3NwcLxjI7/fD4uJiR2Ji4vcA4AKAo4sEZgNApF6vzy4pKelCYK/Xy3K73dympqa/EaywsPD6/Px89927d78DgL/otCBiJokwAkf19vZqHjx40CGVSt8gyfLycrhMJvMMDw+fRHthYaEnNTUVgTcvJXBZWdlhZWWlID8/3z0wMCC02Wy99+7dCwCffBTJCHmEKYoKr66udra2torLy8v/7Orqik5JSUl+8eLFCgDsk8DiXFLgSKPRmFVUVPTLWZDc3NzdsbExVJFdgUDwNDY29msA2AYAHwk0CTCqhMBisahfv34tcbvdgsPDw7Dj42NOTU3Nw6mpqSO1Wv1BYWGhU6/Xc2tra+VtbW2LAOC5KGD82KsobQAgop/DASDCYDBoiouLKzUajdtisQiXlpYOfD7fr3Fxcd8CgJskyiQRxkBxACAMALj0M96FkZGRH9rt9gGj0ciuqKgQt7e3b2i1WqdIJPoUAFDy8NRjNEiBA/sA1wnUExEAcHNmZqYuNTVVJZFIIjIzM7cHBwe5XC73IwBYB4ADRrSEm+6/3on6e2N4eLhSqVRWKxSKY5fL5Xv+/HlYY2Pj/fr6egoAdi4TMKaJpL29XV1VVdWhVqv3bTZbuMPhYJtMJl1ubu7vALDFtBAKRUqcDRaqh1ilUn08NDQ0VlpaumUymSL39vaAoqgfZTLZTwDgZLrxzgMY14zKzs5ONpvNE1qt1mU2m6MQeGZmpi0tLS0AzKhyOzfg7u5uVVlZWa9ard6z2Ww8TImenp7K8vJyEx3hSwN8khKTk5NVcrm8QaFQHLlcLj9uukePHn3R2dlpvWwpcbLpnj179jghISE/OjpakJGRsd3f3w88Hi8dAOz0EY3W6X+P80gJ3p07d26+fPly1mAwcHQ6HSrGZl5e3mZMTEw2AKxdtKwFDo3Tg8NqtX4llUqbNRrNtsViEb169cqztrZmSEtLewwAGxd5cHBWV1c/293d5RwcHLA9Hg97fX2dn5GR0To+Pu5VKpW3CgoKtoxGY4RSqVSNjIws0EczY6tEkhInxY/Vas2USqXms8mYl5e3Mzo6yp+YmNjn8/m2+Pj4KgBwXGTxc1pe0iYU6wMWRVG85ubmjbq6uhs6nc7Z0dEhrq2tfdjS0jJKmg4hLeDRhCJwQ0PDQUFBgTA5OfnN7Ozs1enp6QG5XP4DrQ54JGNThfEgSYl/NaFbW1vs1dXVKysrK06xWCyhKEovk8kaaXXA3gTRCCkwwu7s7LCePHmCPQi0+RLahGJfAtXhcpnQubk5dBynAxspl87m9/X1ZWu12s7+/n7sOwT/MX9QIwUjfOF9CVQJ0eDg4JcKheKbo6MjbnBvjcVi+dls9rHT6fwjKSkJgbGkZKy/gd9GksM4l4+FDgBcRwdNe7vA2mjncZOhh8M2FboMRhVacJqRAOM6aDrROV+jzWhwjxiLG4woyh02UHDDMSp4QgmMH4zyhlegsR1YP7iZjdpL1EAJRUoQ6SnTyaQpwfS9jOe9c8D/AEaRMEuceu4YAAAAAElFTkSuQmCC",function(t){t=10*Math.round(t/10);var a=e.get(t);if(a)return a;r.translate(22,22),r.rotate(t*Math.PI/180),r.drawImage(i,-22,-22);var o=n.toDataURL();return r.clearRect(-22,-22,44,44),r.resetTransform(),e.set(t,o),o}}(),C=function(e){return"url(".concat(x(e),") 22 22, auto")};function Z(e){var t=(0,u.useRef)(!1),n=function(e){return e.isPrimary&&(t.current="touch"===e.pointerType)},r=function(n){return function(n){return!t.current||function(e){var t=e.touches[0];return"stylus"===(null===t||void 0===t?void 0:t.touchType)}(n)||e&&1===n.touches.length}(n)||n.stopPropagation()};return{onPointerDownCapture:n,onPointerMoveCapture:n,onTouchStartCapture:r,onTouchMoveCapture:r}}var j=n(80184),S=h().Path,b=h().Size,y=h().Point,A=h().Group,k=h().Color,E=h().Raster,D=h().Layer,R=u.forwardRef((function(e,t){var n=e.drawState,r=e.otherStates,a=e.onChange,o=void 0===a?function(){}:a,s=e.drawCtrl,l=void 0===s?c.Hq:s,v=e.readonly,x=void 0!==v&&v,R=e.imgSrc,T=e.setActiveTool,K=void 0===T?function(){}:T,q=n.width,Y=n.height,H=l.mode,Q=l.finger,X=l.lasso,G=l.eraserWidth,_=(0,u.useRef)(null),$=(0,u.useRef)(new(h().PaperScope)),ee=(0,u.useState)([]),te=(0,i.Z)(ee,2),ne=te[0],re=te[1],ie=N(),ae=(0,i.Z)(ie,2),oe=ae[0],ue=ae[1],ce=N(),se=(0,i.Z)(ce,2),le=se[0],de=se[1],fe=N(),ve=(0,i.Z)(fe,2),he=ve[0],pe=ve[1];(0,u.useEffect)((function(){var e,t=_.current,n=$.current;if(t)return n.setup(t),n.settings.handleSize=10,n.settings.hitTolerance=20,[0,1,2].forEach((function(){return(new D).visible=!1})),null===(e=n.project.layers[2])||void 0===e||e.activate(),new n.Tool,function(){var e;null===(e=n.view)||void 0===e||e.remove(),(0,g.j)(t)}}),[]),(0,u.useEffect)((function(){$.current.activate();var e=$.current.project.layers,t=M(e,q,Y),n=W(e,q,Y);return function(){t.remove(),n.forEach((function(e){return e.remove()}))}}),[q,Y]);var me=(0,m.Z)(_),we=(0,i.Z)(me,1)[0]/q;(0,u.useEffect)((function(){if(we){var e=$.current,t=new y(0,0);return e.view.viewSize=new b(q,Y).multiply(we),e.view.scale(we,t),e.project.layers.forEach((function(e){return e.visible=!0})),e.view.update(),function(){var n;return null===(n=e.view)||void 0===n?void 0:n.scale(1/we,t)}}}),[q,Y,we]),(0,u.useEffect)((function(){var e;if(R){$.current.activate();var t=new E(R);return null===(e=t.project.layers[0])||void 0===e||e.addChild(t),t.sendToBack(),t.onLoad=function(){t.view.update(),t.fitBounds(new(h().Rectangle)(0,0,q,Y)),t.bringToFront()},function(){null===t||void 0===t||t.remove()}}}),[R,q,Y]);var ge=(0,u.useMemo)((function(){return r?w.Dw.mergeStates.apply(w.Dw,[n].concat((0,f.Z)(r))):n.getStrokeList()}),[n,r]);(0,u.useEffect)((function(){var e=[],t=$.current.project.layers[1];if(t)return $.current.activate(),ge.forEach((function(r){var i=n.hasStroke(r.uid),a=P(r,t,!i);i&&e.push(a)})),re(e),function(){t.removeChildren(1)}}),[ge,n]);var xe=(0,u.useRef)(),Ce=(0,u.useState)(!1),Ze=(0,i.Z)(Ce,2),je=Ze[0],Se=Ze[1],be="select"===H&&je?"selected":H,ye=(0,u.useState)([]),Ae=(0,i.Z)(ye,2),ke=Ae[0],Ee=Ae[1],De=(0,u.useMemo)((function(){var e=new Set(ke);return ne.filter((function(t){return e.has(t.name)}))}),[ne,ke]),Re=(0,u.useCallback)((function(){Se(!1),ue(void 0),de(void 0),pe(void 0)}),[ue,de,pe]);(0,u.useEffect)((function(){if("select"===H)return Re}),[H,Re]),(0,u.useEffect)((function(){return Re}),[X,Re]),(0,u.useEffect)((function(){if(je)return function(){Ee([]),K("")}}),[je,K]);var Te=function(){return ue(V(l))},Ne=function(e){return de(L(e.point))},Pe={draw:Te,erase:Te,select:X?Te:Ne,selected:function(e){if(X){if(null!==oe&&void 0!==oe&&oe.contains(e.point))return;Te(),Se(!1)}else{var t,n=null!==(t=null===le||void 0===le?void 0:le.hitTest(e.point,{segments:!0}))&&void 0!==t?t:null===he||void 0===he?void 0:he.hitTest(e.point,{segments:!0,selected:!0});if(xe.current=n,n)return;if(null!==le&&void 0!==le&&le.contains(e.point))return;Ne(e),pe(void 0),Se(!1)}},text:function(e){var t,n=$.current.project.layers[1];if(n){var r=null!==(t=U(n,e.point))&&void 0!==t?t:B(e.point);tt(r)}}}[be],Me=function(e){null===oe||void 0===oe||oe.add(e.point),null===oe||void 0===oe||oe.smooth()},We={draw:Me,erase:Me,select:X?Me:function(e){if(le){var t=e.point,n=t.x,r=t.y,a=(0,i.Z)(le.segments,4),o=a[1],u=a[2],c=a[3];o&&u&&c&&(o.point.x=n,u.point=e.point,c.point.y=r,le.selected=!0)}},selected:function(e){var t=xe.current;if(null!==t&&void 0!==t&&t.segment&&le&&he){var n=t.segment;if(n.selected){var r=le.bounds.center,i=n.point.subtract(r),a=e.point.subtract(r);Be(C(a.angle));var o=a.angle-i.angle;le.rotate(o,r),he.rotate(o,r),De.forEach((function(e){return null===e||void 0===e?void 0:e.rotate(o,r)}))}else{var u,c=n.point,s=n.next.next.point,l=c.subtract(s),d=e.point.subtract(s).project(l).x/l.x;if(d<0)return;le.scale(d,s),De.forEach((function(e){e.scale(d,s),e.strokeWidth*=d})),he.scale(d,s);var f=null===(u=he.segments[0])||void 0===u?void 0:u.point;if(!f)return;he.scale(100/he.length,f)}}else De.forEach((function(t){return t.translate(e.delta)})),null===oe||void 0===oe||oe.translate(e.delta),null===le||void 0===le||le.translate(e.delta),null===he||void 0===he||he.translate(e.delta)},text:function(e){if(et&&!et.name){var t=et.bounds,n=t.topCenter,r=t.bottomRight.subtract(n),i=e.point.subtract(n).project(r).x/r.x;i<0||et.scale(i,n)}}}[be];(0,u.useEffect)((function(){$.current.tool.maxDistance=G}),[G]);var Le=(0,u.useRef)(new Set),Ve=(0,u.useRef)(new Map),Oe=function(e){if("erase"===be){var t=$.current.project.layers[1],n=null===t||void 0===t?void 0:t.hitTestAll(e.point,{class:h().Path,stroke:!0,tolerance:G/2});null===n||void 0===n||n.forEach((function(n){var r=n.item;if(r instanceof h().Path){for(var i=r;i.parent!==t&&i.parent instanceof h().PathItem;)i=i.parent;var a=i.name;if(l.pixelEraser){var o=(G+r.strokeWidth)/2,u=new S.Circle(e.point,o);u.remove();var c=r.subtract(u,{trace:!1});r.replaceWith(c),i===r&&(i=c),Ve.current.set(a,i)}else i.opacity=.5,i.guide=!0,Le.current.add(a)}}))}},ze={draw:function(){if(oe&&!oe.isEmpty()){oe.simplify();var e=oe.exportJSON();ue(void 0),o((function(t){return w.Dw.addStroke(t,e)}))}},erase:function(){if(ue(void 0),l.pixelEraser){var e=Array.from(Ve.current);Ve.current.clear();var t=e.map((function(e){var t=(0,i.Z)(e,2),n=t[0],r=t[1];return[n,I(r).map((function(e){return e.exportJSON()}))]}));if(!t.length)return;o((function(e){return w.Dw.splitStrokes(e,t)}))}else{var n=Array.from(Le.current);if(Le.current.clear(),!n.length)return;o((function(e){return w.Dw.eraseStrokes(e,n)}))}},select:function(){var e;if(X){if(!oe||Math.abs(oe.area)<1e3)return ue(void 0);oe.closePath(),oe.simplify(),O(oe),e=J(ne,oe)}else{if(!le||Math.abs(le.area)<1e3)return de(void 0);e=J(ne,le);var t=new S,n=le.bounds.topCenter;t.add(n,n.subtract(new y(0,100))),t.lastSegment.selected=!0,pe(t)}Se(!0),Ee(e),K("select")},selected:function(e){Ye(),Ie(e)},text:function(){K("text")}}[be],Je=(0,u.useState)("auto"),Fe=(0,i.Z)(Je,2),Ue=Fe[0],Be=Fe[1];(0,u.useEffect)((function(){"text"===be||"select"===be?Be("crosshair"):"selected"===be?Be(X?"crosshair":"nwse-resize"):"draw"!==be&&"erase"!==be||Be(function(e,t){var n=e.lineWidth,r=e.eraserWidth,i=t*("erase"===e.mode?r:n);if(i<5)return"crosshair";var a=i/2;return'url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" fill="%23FFF7" width="'.concat(i,'" height="').concat(i,'" viewBox="0 0 10 10"><circle cx="5" cy="5" r="5"/></svg>\') ').concat(a," ").concat(a,", auto")}(l,we))}),[be,X,l,we]);var Ie=function(e){var t,n,r=null!==(t=null===le||void 0===le?void 0:le.hitTest(e.point,{segments:!0}))&&void 0!==t?t:null===he||void 0===he?void 0:he.hitTest(e.point,{segments:!0,selected:!0});if(null!==r&&void 0!==r&&r.segment){if(r.segment.selected){var i=null===le||void 0===le?void 0:le.bounds.center;if(!i)return;var a=r.segment.point.subtract(i);return Be(C(a.angle))}var o=r.segment.point,u=r.segment.next.next.point,c=o.subtract(u),s=c.x,l=c.y;return Be(s*l<0?"nesw-resize":"nwse-resize")}if(null!==(n=null!==le&&void 0!==le?le:oe)&&void 0!==n&&n.contains(e.point))return Be("move");Be("crosshair")},Ke=(0,d.Z)({selected:Ie,text:function(e){var t=$.current.project.layers[1];t&&(U(t,e.point)?Be("text"):Be("crosshair"))}},{select:null,draw:null,erase:null})[be],qe="selected"===be?function(e){["delete","backspace"].includes(e.key)&&He()}:null;(0,u.useEffect)((function(){if(!x){var e=function(e){return function(t){if($.current.activate(),e)return e(t)}},t=$.current,n=t.view,r=t.tool;n.onMouseDown=e(Pe),n.onMouseDrag=e(We),n.onMouseUp=e(ze),n.onMouseMove=e(Ke),r.onMouseDrag=e(Oe),r.onKeyUp=e(qe)}}));var Ye=function(){if(null!==De&&void 0!==De&&De.length){var e=De.map((function(e){return[e.name,e.exportJSON()]}));o((function(t){return w.Dw.mutateStrokes(t,e)}))}},He=function(){Re(),ke.length&&o((function(e){return w.Dw.eraseStrokes(e,ke)}))},Qe=function(e){$.current.activate(),F(De,e),Ye()},Xe=function(){var e;$.current.activate();var t=null===(e=le||oe)||void 0===e?void 0:e.bounds.size;if(t&&De.length){var n=t.width,r=t.height,a=new y(n,r).divide(10),u=De.map((function(e){return e.clone()}));u.forEach((function(e){return e.translate(a)})),null===le||void 0===le||le.translate(a),null===oe||void 0===oe||oe.translate(a),null===he||void 0===he||he.translate(a);var c=u.map((function(e){return[w.Dw.getUid(),e.exportJSON()]}));o((function(e){return w.Dw.mutateStrokes(e,c)})),Ee(c.map((function(e){return(0,i.Z)(e,1)[0]})))}},Ge=function(){var e=new A(De),t=$.current.project.layers[1];return t?(e.addTo(t),e.rasterize({insert:!1}).toDataURL()):""},_e=N(),$e=(0,i.Z)(_e,2),et=$e[0],tt=$e[1],nt=(0,u.useCallback)((function(){tt(void 0),K("")}),[tt,K]);(0,u.useEffect)((function(){if("text"===H)return nt}),[H,nt]);var rt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#000",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"center";if(et){et.content=e,et.fillColor=new k(t),et.justification=n;var r=et.exportJSON(),i=et.name;if(nt(),!i)return o((function(e){return w.Dw.addStroke(e,r)}));o((function(e){return w.Dw.mutateStrokes(e,[[i,r]])}))}};(0,u.useImperativeHandle)(t,(function(){return{deleteSelected:He,duplicateSelected:Xe,cancelText:nt,submitText:rt,mutateStyle:Qe,rasterize:Ge,pointText:et}})),(0,u.useEffect)((function(){var e=function(e){return e.preventDefault()};return document.addEventListener("gesturestart",e),document.addEventListener("gesturechange",e),document.addEventListener("gestureend",e),function(){document.removeEventListener("gesturestart",e),document.removeEventListener("gesturechange",e),document.removeEventListener("gestureend",e)}}),[]),(0,p.usePinch)((function(e){var t=e.memo,n=(0,i.Z)(e.offset,1)[0],r=e.first,a=e.last,o=e.origin;$.current.activate();var u,c,s,l=$.current.view,d=new y(o);if(r||!t){var f=_.current.getBoundingClientRect(),v=f.x,h=f.y;u=1,s=new y(v,h),c=d.subtract(s)}else{var p=(0,i.Z)(t,3);u=p[0],c=p[1],s=p[2]}var m=d.subtract(s),w=l.viewToProject(m);Math.abs(1-n)<.05&&(n=1);var g=r?1:n/u,x=a?10:1;g=Math.pow(g,1/x);!function e(){l.scale(g,w),$.current.settings.hitTolerance/=g,--x>0?requestAnimationFrame(e):a&&z(l,new b(q,Y))}();var C=m.subtract(c).divide(l.zoom);if(l.translate(C),!a)return[n,m,s]}),{scaleBounds:{max:10,min:.3},rubberband:.5,target:_});var it=Z(Q);return(0,j.jsx)("div",(0,d.Z)((0,d.Z)({className:"draw-wrapper",style:{cursor:Ue},"data-readonly":x},it),{},{children:(0,j.jsx)("canvas",{ref:_,className:"draw-canvas"})}))}));R.displayName="Draw";var T=u.memo(R);function N(){var e=(0,u.useState)(),t=(0,i.Z)(e,1)[0];return(0,u.useDebugValue)(t),(0,u.useEffect)((function(){return function(){null!==t&&void 0!==t&&t.name||null===t||void 0===t||t.remove()}}),[t]),e}var P=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.pathData,i=e.uid;try{var a=t.importJSON(r);return a?(a.name=i,a.guide=n,a):new(h().Item)}catch(o){return console.error(o),new(h().Item)}},M=function(e,t,n){var r,i=new S.Rectangle(new y(0,0),new y(t,n));return i.fillColor=new k("#fff"),null===(r=e[0])||void 0===r||r.addChild(i),i},W=function(e,t,n){var r=(0,i.Z)(e,3),a=r[1],o=r[2];if(!a||!o)return[];var u=new S.Rectangle(new y(0,0),new y(t,n)),c=u.clone();return a.addChild(u),o.addChild(c),a.clipped=!0,o.clipped=!0,[u,c]},L=function(e){var t=new S.Rectangle(e,new b(0,0));return t.onFrame=function(){},t},V=function(e){var t=e.mode,n=e.lineWidth,r=e.eraserWidth,i=e.color,a=e.highlight,o=new S;"erase"===t&&(i="#ccc",n=r),"select"===t&&(i="#1890ff",n=5);var u=new k(i);return(a||"erase"===t)&&(u.alpha=.5,o.blendMode="multiply"),o.strokeColor=u,o.strokeWidth=n,o.strokeJoin="round",o.strokeCap="round",o.guide=!0,o},O=function(e){e.dashOffset=0,e.dashArray=[30,20],e.onFrame=function(){return e.dashOffset+=3}},z=function(e,t){var n=function(e,t){var n=e.center,r=n.x,i=n.y,a=e.size,o=a.width,u=a.height,c=t.width,s=t.height,l=Math.min(o,c)/2,d=Math.min(u,s)/2,f=c-l,v=s-d;return[r<l?l-r:r>f?f-r:0,i<d?d-i:i>v?v-i:0]}(e,t),r=(0,i.Z)(n,2),a=r[0],o=r[1],u=10,c=new y(a,o).divide(-u);!function t(){e.translate(c),--u>0&&requestAnimationFrame(t)}()},J=function(e,t){var n=function(e){var n=e.subtract(t,{insert:!1,trace:!1});return n.remove(),!n.compare(e)};return e.filter((function(e){if(!e.name)return!1;if(!e.bounds.intersects(t.bounds))return!1;if(e instanceof h().Path)return n(e);var r=new S.Rectangle(e.bounds);return r.remove(),n(r)||t.isInside(e.bounds)})).map((function(e){return e.name}))},F=function(e,t){var n=t.lineWidth,r=t.color,i=t.highlight;e.forEach((function(e){if(e instanceof h().PointText&&r){var t=new k(r);e.fillColor=t}if(e instanceof h().Path){if(r){var a=new k(r);"multiply"===e.blendMode&&(a.alpha=.5),e.strokeColor=a}n&&(e.strokeWidth=n),e.strokeColor&&void 0!==i&&(e.strokeColor.alpha=i?.5:1,e.blendMode=i?"multiply":"normal")}}))},U=function(e,t){var n=e.hitTest(t,{class:h().PointText,fill:!0});if((null===n||void 0===n?void 0:n.item)instanceof h().PointText)return null===n||void 0===n?void 0:n.item},B=function(e){return new(h().PointText)({point:e.add(new y(0,50)),content:"Insert text...",fontSize:50,justification:"center",fillColor:"#1890ff55"})},I=function e(t){return t instanceof h().Path?t.isEmpty()?[]:[t]:t instanceof h().CompoundPath?t.children.map(e).flat():[]},K=n(64239),q=n(61507),Y=n(23414),H=n(82622),Q=n(72785),X=n(22925),G=n(4720),_=n(41275),$=n(27190),ee=n(69228),te=n(87309),ne=n(87501),re=n(89295),ie=n(48),ae=n(66023),oe=n(74115),ue=n(54164),ce=n(64802),se=function(e){var t=e.drawRef,n=e.visible;return(0,j.jsx)(re.Z,{timeout:300,in:n,unmountOnExit:!0,children:(0,j.jsx)(le,{drawRef:t})})},le=function(e){var t=e.drawRef,n={type:"text",shape:"round",size:"small"},r=(0,u.useState)({}),a=(0,i.Z)(r,2),o=a[0],c=a[1];return(0,ue.createPortal)((0,j.jsxs)("div",{className:"select-tool",children:[(0,j.jsx)(ee.Z,{trigger:"click",placement:"bottom",getPopupContainer:function(e){return e.parentElement},destroyTooltipOnHide:!0,content:(0,j.jsx)(ie.Uk,{updateDrawCtrl:function(e){var n;c((function(t){return(0,d.Z)((0,d.Z)({},t),e)})),null===(n=t.current)||void 0===n||n.mutateStyle(e)},drawCtrl:o}),children:(0,j.jsx)(te.Z,(0,d.Z)({icon:(0,j.jsx)(q.Z,{})},n))}),(0,j.jsx)(te.Z,(0,d.Z)({icon:(0,j.jsx)(Y.Z,{}),onClick:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.duplicateSelected()}},n)),(0,j.jsx)(te.Z,(0,d.Z)({icon:(0,j.jsx)(K.Z,{}),onClick:function(){if(t.current){var e=t.current.rasterize();$.Z.confirm({title:"Screenshot",content:(0,j.jsx)("img",{className:"raster",src:e,alt:"raster"}),className:"raster-modal",icon:(0,j.jsx)(K.Z,{}),okText:"Save",onOk:function(){return(0,ce.saveAs)(e,"screenshot")}})}}},n)),(0,j.jsx)(te.Z,(0,d.Z)({danger:!0,icon:(0,j.jsx)(H.Z,{}),onClick:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.deleteSelected()}},n))]}),document.querySelector(".reader.container > header"))},de=function(e){var t=e.visible,n=e.drawRef,r=(0,u.useState)(""),a=(0,i.Z)(r,2),o=a[0],c=a[1],l=(0,u.useState)(oe.Qk[0]),d=(0,i.Z)(l,2),f=d[0],v=d[1],h=(0,u.useState)("center"),p=(0,i.Z)(h,2),m=p[0],w=p[1],g=(0,s.iX)(),x=(0,i.Z)(g,1)[0];(0,u.useEffect)((function(){var e,r=null===(e=n.current)||void 0===e?void 0:e.pointText;if(r&&t){var i,a=r.name,o=r.content,u=r.justification,s=r.fillColor;if(w(u),a)c(o),v(null!==(i=null===s||void 0===s?void 0:s.toCSS(!0))&&void 0!==i?i:oe.Qk[0]);else c(""),v(oe.Qk[0])}}),[t,n]);var C=(0,j.jsx)(ee.Z,{content:(0,j.jsx)(ie.Q5,{color:f,setColor:v}),overlayStyle:{width:200},placement:"bottom",getPopupContainer:function(e){return e.parentElement},children:(0,j.jsx)(te.Z,{size:"small",icon:(0,j.jsx)(Q.Z,{className:"font-icon",style:{color:f}})})}),Z=(0,j.jsx)(ne.ZP.Group,{size:"small",optionType:"button",value:m,buttonStyle:"solid",onChange:function(e){return w(e.target.value)},options:[{label:(0,j.jsx)(X.Z,{}),value:"left"},{label:(0,j.jsx)(G.Z,{}),value:"center"},{label:(0,j.jsx)(_.Z,{}),value:"right"}]});return(0,j.jsxs)($.Z,{visible:t,title:"Insert text",onCancel:function(){var e;return null===(e=n.current)||void 0===e?void 0:e.cancelText()},onOk:function(){var e,t,r=o.trim();if(!r)return null===(e=n.current)||void 0===e?void 0:e.cancelText();null===(t=n.current)||void 0===t||t.submitText(r,f,m)},bodyStyle:{paddingTop:0},destroyOnClose:!0,children:[(0,j.jsxs)("div",{className:"insert-option","data-force-light":x,children:[C,Z]}),(0,j.jsx)(ae.Z,{size:"large",rows:3,autoFocus:!0,value:o,onChange:function(e){return c(e.target.value)}})]})},fe=n(85168),ve=n(58826),he=n(19348),pe=n(24124),me=function(e){var t=e.thumbnail,a=e.drawState,c=e.teamStateMap,l=e.updateState,d=e.pdfIndex,f=e.noteID,v=void 0===f?"":f,h=e.preview,p=void 0!==h&&h,m=e.onViewChange,w=e.preload,g=void 0!==w&&w,x=e.ignores,C=void 0===x?(0,pe.l4)():x,Z=e.skipInView,S=void 0!==Z&&Z,b=m&&(0,fe.Z)(0,1.2,.2),y=(0,he.YD)({threshold:b,skip:S}),A=(0,i.Z)(y,3),k=A[0],E=A[1],D=A[2];(0,u.useEffect)((function(){if(m)return D&&E?void m(D.intersectionRatio):m(0)}),[E,D,m]);var R=(0,u.useState)(),T=(0,i.Z)(R,2),N=T[0],P=T[1],M=(0,u.useCallback)((0,ve.Z)((0,r.Z)(o().mark((function e(){var t,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d&&v){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,Promise.all([n.e(643),n.e(138)]).then(n.bind(n,21176));case 4:return t=e.sent,r=t.getNotePageImage,e.t0=P,e.next=9,r(v,d);case 9:e.t1=e.sent,(0,e.t0)(e.t1);case 11:case"end":return e.stop()}}),e)})))),[d,v]),W=E||g;(0,u.useEffect)((function(){!p&&W&&M()}),[W,p,M]);var L=(0,u.useMemo)((function(){return null===c||void 0===c?void 0:c.deleteAll(C).toList().toArray()}),[c,C]),V=Boolean(N||!d),O=W&&V,z=a.height/a.width,J=(0,s.iX)(),F=(0,i.Z)(J,1)[0];return(0,j.jsxs)("div",{ref:k,className:"page-wrapper","data-force-light":F,children:[(0,j.jsx)("svg",{viewBox:"0 0 100 ".concat(100*z)}),O&&(0,j.jsx)(ge,{drawState:a,otherStates:L,updateState:l,imgSrc:N||t,preview:p})]})};me.displayName="PageWrapper";var we=u.memo(me),ge=function(e){var t=e.drawState,n=e.updateState,r=e.otherStates,a=e.preview,o=void 0!==a&&a,s=e.imgSrc,d=(0,c.gX)(),f=(0,u.useState)(""),v=(0,i.Z)(f,2),h=v[0],p=v[1],m=(0,u.useRef)(null),g=(0,l.Z)((function(e){if(n){var r=e instanceof w.Dw?e:e(t);r!==t&&n(r)}}));return o?(0,j.jsx)(T,{drawState:t,otherStates:r,imgSrc:s,readonly:!0}):(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(T,{drawState:t,otherStates:r,onChange:g,imgSrc:s,drawCtrl:d,ref:m,setActiveTool:p}),(0,j.jsx)(se,{drawRef:m,visible:"select"===h}),(0,j.jsx)(de,{drawRef:m,visible:"text"===h})]})};ge.displayName="DrawWrapper";var xe=we},11886:function(e,t,n){"use strict";n.d(t,{Eq:function(){return f},F7:function(){return g},Hq:function(){return v},gX:function(){return w},w3:function(){return x}});var r=n(1413),i=n(29439),a=n(15861),o=n(87757),u=n.n(o),c=n(61842),s=n.n(c),l=n(72791),d=n(80184),f=[10,20,30,50],v={mode:"draw",finger:!0,lineWidth:10,eraserWidth:10,color:"#000000",highlight:!1,lasso:!0,pixelEraser:!1,widthList:f};function h(){return(h=(0,a.Z)(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s().getItem("DRAW_CTRL");case 2:if(t=e.sent){e.next=7;break}return t=v,e.next=7,s().setItem("DRAW_CTRL",t);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(){return(p=(0,a.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s().setItem("DRAW_CTRL",t);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var m=l.createContext({drawCtrl:v,updateDrawCtrl:function(){}});function w(){var e=(0,l.useContext)(m).drawCtrl;return(0,l.useDebugValue)(e),e}function g(){return(0,l.useContext)(m).updateDrawCtrl}var x=function(e){var t=e.children,n=(0,l.useState)(v),a=(0,i.Z)(n,2),o=a[0],u=a[1];(0,l.useEffect)((function(){(function(){return h.apply(this,arguments)})().then(u)}),[]);return(0,d.jsx)(m.Provider,{value:{drawCtrl:o,updateDrawCtrl:function(e){u((function(t){var n=(0,r.Z)((0,r.Z)({},t),e);return function(e){p.apply(this,arguments)}(n),n}))}},children:t})}},96153:function(e,t,n){"use strict";function r(e,t){var n=document.createElement("canvas"),r=n.getContext("2d");if(!r)throw new Error("can't get virtual canvas context");return n.width=e,n.height=t,{canvas:n,context:r}}function i(e){e.width=1,e.height=1;var t=e.getContext("2d");null===t||void 0===t||t.clearRect(0,0,1,1)}n.d(t,{j:function(){return i},v:function(){return r}})},48:function(e,t,n){"use strict";n.d(t,{Q5:function(){return Z},Uk:function(){return g},Db:function(){return x}});var r=n(4942),i=n(93433),a=n(29439),o=n(72791),u=n(11886),c=n(35873),s=n(82670),l=n(69228),d=n(96272),f=n(53163),v=n(74115),h=n(22568),p=n(24124),m=n(81832),w=n(80184),g=function(e){var t=e.updateDrawCtrl,n=e.drawCtrl,r=n.highlight,i=n.color,u=(0,o.useState)(!1),c=(0,a.Z)(u,2),s=c[0],l=c[1];return(0,w.jsxs)("div",{className:"pen-panel","data-blur":s,"data-hi":r,children:[(0,w.jsxs)("div",{className:"pen-status",children:[(0,w.jsx)(x,{updateDrawCtrl:t,drawCtrl:n,setPanelBlur:l}),(0,w.jsx)(C,{checked:r,updateDrawCtrl:t})]}),(0,w.jsx)(Z,{color:i||"",setColor:function(e){return t({color:e})}})]})},x=function(e){var t,n,v=e.updateDrawCtrl,h=e.drawCtrl,g=e.setPanelBlur,x=void 0===g?function(){}:g,C=e.field,Z=void 0===C?"lineWidth":C,j=h[Z],S=null!==(t=h.widthList)&&void 0!==t?t:u.Eq,b="lineWidth"===Z&&null!==(n=h.color)&&void 0!==n?n:"#aaa",y=(0,o.useMemo)((function(){return S.indexOf(null!==j&&void 0!==j?j:-1)}),[j,S]),A=(0,o.useState)((0,p.aV)([!1,!1,!1,!1])),k=(0,a.Z)(A,2),E=k[0],D=k[1];(0,o.useEffect)((function(){E.includes(!0)?x(!0):x(!1)}),[E,x]);var R=function(e){return{"--real-size":"calc(".concat(100/s.mF,"vw * ").concat(e,")")}},T=(0,m.iX)(),N=(0,a.Z)(T,1)[0],P=[{value:-1,label:null}].concat((0,i.Z)(S.map((function(e,t){return{value:t,label:(0,w.jsx)(l.Z,{visible:E.get(t),onVisibleChange:function(e){return D((function(n){return n.set(t,e)}))},trigger:y===t?["click"]:[],placement:"bottom",destroyTooltipOnHide:!0,content:(0,w.jsx)(d.Z,{min:5,max:100,className:"ctrl-slider",defaultValue:e,onAfterChange:function(e){if(S.includes(e))return D((function(e){return e.set(t,!1)})),v((0,r.Z)({},Z,e));var n=S.slice();n[t]=e,v((0,r.Z)({widthList:n},Z,e))}}),children:(0,w.jsx)("div",{className:"circle-wrapper","data-force-light":N,style:R(e),children:(0,w.jsx)(c.W,{className:"width-circle "+Z,color:b})})})}}))));return(0,w.jsx)(f.Z,{className:"width-seg",value:y,options:P,onChange:function(e){var t;return v((0,r.Z)({},Z,null!==(t=S[+e])&&void 0!==t?t:10))}})},C=function(e){var t=e.checked,n=void 0!==t&&t,r=e.updateDrawCtrl;return(0,w.jsxs)("label",{className:"hi-wrapper",children:[(0,w.jsx)("input",{type:"checkbox",name:"highlight",checked:n,onChange:function(e){return r({highlight:e.target.checked})}}),(0,w.jsx)("div",{className:"hi-switch",children:(0,w.jsx)(h.Z,{type:"icon-Highlight"})})]})},Z=function(e){var t=e.setColor,n=e.color,r=(0,m.iX)(),i=(0,a.Z)(r,1)[0];return(0,w.jsx)("div",{className:"color-select","data-force-light":i,children:v.Qk.map((function(e){return(0,w.jsxs)("label",{children:[(0,w.jsx)("input",{checked:n===e,type:"radio",name:"color",onChange:function(n){return n.target.checked&&t(e)}}),(0,w.jsx)("div",{"data-color":e,className:"circle",style:{backgroundColor:e,borderColor:e}})]},e)}))})}},90858:function(){},64158:function(){}}]);
//# sourceMappingURL=25.326e2ce5.chunk.js.map