(this.webpackJsonpmultibility=this.webpackJsonpmultibility||[]).push([[0],{186:function(e,t){},262:function(e,t,n){},263:function(e,t,n){},269:function(e,t){},270:function(e,t){},271:function(e,t){},272:function(e,t){},273:function(e,t){},292:function(e,t,n){},294:function(e,t,n){},479:function(e,t,n){},480:function(e,t,n){},481:function(e,t,n){},507:function(e,t,n){},508:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(35),i=n.n(c),s=(n(262),n(80)),u=n(24),o=n(11),l=n.n(o),d=n(22),j=n(13),b=(n(263),n(62)),f=n(94),p=n(95),h=n(30),O=n(51),v={state:"drawing",strokes:Object(h.a)(),uidStack:Object(h.a)(),undoStack:Object(h.c)(),eraseStack:Object(h.a)(),deleted:Object(h.e)(),position:Object(h.a)()},m=Object(h.d)(v),x={strokes:[],position:[]},g=function(){function e(t,n,r,a){Object(f.a)(this,e),this.immutable=t,this.width=n,this.height=r,this.lastOp=a}return Object(p.a)(e,[{key:"getImmutable",value:function(){return this.immutable}},{key:"getUidStack",value:function(){return this.getImmutable().get("uidStack")}},{key:"getUndoStack",value:function(){return this.getImmutable().get("undoStack")}},{key:"getEraseStack",value:function(){return this.getImmutable().get("eraseStack")}},{key:"getValidEraseStack",value:function(){var e=this.getDeleted(),t=this.getUndoStack();return this.getEraseStack().filter((function(n){var r=n.uid;return!e.has(r)&&!t.has(r)}))}},{key:"getStrokes",value:function(){return this.getImmutable().get("strokes")}},{key:"getValidStrokes",value:function(){var e=this.getDeleted(),t=this.getUndoStack(),n=this.getValidEraseStack();return this.getStrokes().filter((function(r){var a=r.uid;return!e.has(a)&&!t.has(a)&&!n.some((function(e){return e.erased.has(a)}))}))}},{key:"getDeleted",value:function(){return this.getImmutable().get("deleted")}},{key:"getState",value:function(){return this.getImmutable().get("state")}},{key:"getPosition",value:function(){return this.getImmutable().get("position")}},{key:"getLastStroke",value:function(){return this.getImmutable().get("strokes").last()}}],[{key:"createEmpty",value:function(t,n){return new e(m(),t,n)}},{key:"undo",value:function(t){var n=t.getUidStack().last();if(!n)return t;var r={type:"undo",undoUid:n};return new e(t.getImmutable().set("state","revoking").update("undoStack",(function(e){return e.add(n)})).update("uidStack",(function(e){return e.pop()})),t.width,t.height,r)}},{key:"redo",value:function(t){var n=t.getUndoStack().last();if(!n)return t;var r={type:"redo",redoUid:n};return new e(t.getImmutable().update("undoStack",(function(e){return e.butLast()})).update("uidStack",(function(e){return e.push(n)})),t.width,t.height,r)}},{key:"addStroke",value:function(t,n,r){var a=Object(O.v4)(),c={uid:a,points:r},i=t.getUndoStack(),s=k(t.getImmutable().set("state","drawing").update("deleted",(function(e){return e.concat(i)})).set("undoStack",Object(h.c)()).update("strokes",(function(e){return e.push(c)})).update("uidStack",(function(e){return e.push(a)}))),u=t.getPosition();u=function(e,t,n){for(var r=t.data,a=r.length,c=0;c<a;c+=4)r[c+3]&&(e=e.update(c/4,Object(h.e)(),(function(e){return(null!==e&&void 0!==e?e:Object(h.e)()).add(n)})));return e}(u,n,a);var o={type:"add",stroke:c};return new e(s.set("position",u),t.width,t.height,o)}},{key:"eraseStrokes",value:function(t,n){var r=t.getPosition();if(!r)return t;var a=t.getValidStrokes(),c=Object(h.e)(a.map((function(e){return e.uid}))),i=function(e,t){for(var n=t.data,r=Object(h.e)(),a=n.length,c=0;c<a;c+=4){var i;if(n[c+3])r=r.concat(null!==(i=e.get(c/4))&&void 0!==i?i:Object(h.e)())}return r}(r,n).filter((function(e){return c.has(e)}));if(0===i.size)return new e(t.getImmutable(),t.width,t.height);var s=Object(O.v4)(),u={type:"erase",erase:{uid:s,erased:i.toArray()}};return new e(k(t.getImmutable().update("eraseStack",(function(e){return e.push({uid:s,erased:i})})).update("uidStack",(function(e){return e.push(s)}))),t.width,t.height,u)}},{key:"pushStroke",value:function(t,n){return new e(t.getImmutable().update("strokes",(function(e){return e.push(n)})),t.width,t.height)}},{key:"pushErase",value:function(t,n){var r=n.uid,a=n.erased,c={uid:r,erased:Object(h.e)(a)};return new e(t.getImmutable().update("eraseStack",(function(e){return e.push(c)})),t.width,t.height)}},{key:"pushUndo",value:function(t,n){return new e(t.getImmutable().update("undoStack",(function(e){return e.add(n)})),t.width,t.height)}},{key:"pushRedo",value:function(t,n){return new e(t.getImmutable().update("undoStack",(function(e){return e.delete(n)})),t.width,t.height)}},{key:"flaten",value:function(e){var t=k(e.getImmutable()),n=t.get("deleted"),r=e.getValidEraseStack().reduce((function(e,t){return e.concat(t.erased)}),Object(h.e)()),a=n.concat(r);return{strokes:t.get("strokes").filter((function(e){return!a.has(e.uid)})).toArray(),position:t.get("position").map((function(e){return e?e.toArray():e})).toArray()}}},{key:"loadFromFlat",value:function(t,n,r){var a=t.strokes,c=t.position;return new e(m().set("strokes",Object(h.a)(a)).set("position",Object(h.a)(null===c||void 0===c?void 0:c.map((function(e){return e?Object(h.e)(e):e})))),n,r)}}]),e}();function k(e){var t=e.get("undoStack");return e.update("deleted",(function(e){return e.concat(t)})).set("undoStack",Object(h.c)()).update("uidStack",(function(e){return e.filter((function(e){return!t.has(e)}))}))}function y(){return{uid:Object(O.v4)(),name:"New note ".concat(Date.now()),tagId:"DEFAULT",team:!1,withImg:!1,pages:Object(b.a)({},Object(O.v4)(),{ratio:1.5,state:x})}}var w=n(155),S=n(25),I=n(40),C=n.n(I),E=function(){var e;return function(){if(e)return e;var t=localStorage.getItem("user_id");return t||(t=Object(O.v4)(),localStorage.setItem("user_id",t)),e=t,t}}(),N=function(){var e=localStorage.getItem("USER_NAME");return e||(e="User_"+Object(O.v4)().slice(0,8),localStorage.setItem("USER_NAME",e)),e},L=["#64748b","#78716c","#ef4444","#f97316","#eab308","#84cc16","#22c55e","#10b981","#14b8a6","#06b6d4","#0ea5e9","#3b82f6","#6366f1","#8b5cf6","#a855f7","#d946ef","#ec4899","#f43f5e"],T=function(){var e=Math.floor(Math.random()*L.length);return L[e]};function A(){return U.apply(this,arguments)}function U(){return(U=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.a.getItem("ALL_NOTES");case 2:if(!(t=e.sent)){e.next=7;break}return e.abrupt("return",t);case 7:return C.a.setItem("ALL_NOTES",{}),e.abrupt("return",{});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(){return R.apply(this,arguments)}function R(){return(R=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.a.getItem("ALL_TAGS");case 2:if(!(t=e.sent)){e.next=7;break}return e.abrupt("return",t);case 7:return C.a.setItem("ALL_TAGS",{}),e.abrupt("return",{});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e){return M.apply(this,arguments)}function M(){return(M=Object(d.a)(l.a.mark((function e(t){var n,r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(O.v4)(),r={uid:n,name:t,color:T(),notes:[]},e.t0=S.a,e.t1=S.a,e.t2={},e.next=7,D();case 7:return e.t3=e.sent,e.t4=(0,e.t1)(e.t2,e.t3),e.t5={},e.t6=Object(b.a)({},n,r),a=(0,e.t0)(e.t4,e.t5,e.t6),e.next=14,C.a.setItem("ALL_TAGS",a);case 14:return e.abrupt("return",a);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e){return W.apply(this,arguments)}function W(){return(W=Object(d.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D();case 2:return delete(n=e.sent)[t],e.next=6,C.a.setItem("ALL_TAGS",n);case 6:return e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e){return B.apply(this,arguments)}function B(){return(B=Object(d.a)(l.a.mark((function e(t){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D();case 2:return n=e.sent,(r=n[t.uid]).name=t.name,r.color=t.color,r.notes=t.notes,e.next=9,C.a.setItem("ALL_TAGS",n);case 9:return e.abrupt("return",n);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function G(e){return z.apply(this,arguments)}function z(){return(z=Object(d.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.a.getItem(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e,t){return K.apply(this,arguments)}function K(){return(K=Object(d.a)(l.a.mark((function e(t,n){var r,a,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A();case 2:return r=e.sent,n.pages,n.pdf,a=Object(w.a)(n,["pages","pdf"]),r[t]=Object(S.a)(Object(S.a)({},r[t]),a),e.next=7,C.a.setItem("ALL_NOTES",r);case 7:return e.next=9,G(t);case 9:if(c=e.sent){e.next=12;break}return e.abrupt("return");case 12:return e.next=14,C.a.setItem(t,Object(S.a)(Object(S.a)({},c),n));case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e){return H.apply(this,arguments)}function H(){return(H=Object(d.a)(l.a.mark((function e(t){var n,r,a,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.uid,r=t.tagId,e.next=3,A();case 3:return(a=e.sent)[n]=t,e.next=7,C.a.setItem("ALL_NOTES",a);case 7:return e.next=9,D();case 9:if(c=e.sent,"DEFAULT"===r){e.next=14;break}return c[r].notes.push(t.uid),e.next=14,C.a.setItem("ALL_TAGS",c);case 14:return e.abrupt("return",{tags:c,allNotes:a});case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(e){return Y.apply(this,arguments)}function Y(){return(Y=Object(d.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.a.setItem(t.uid,t);case 2:return t.pdf,t.pages,n=Object(w.a)(t,["pdf","pages"]),e.next=5,q(n);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function X(e){return $.apply(this,arguments)}function $(){return($=Object(d.a)(l.a.mark((function e(t){var n,r,a,c,i,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G(t);case 2:return n=e.sent,e.next=5,A();case 5:return r=e.sent,e.next=8,D();case 8:if(a=e.sent,n){e.next=11;break}return e.abrupt("return",{tags:a,allNotes:r});case 11:return e.next=13,C.a.removeItem(t);case 13:return n.pdf,n.pages,c=Object(w.a)(n,["pdf","pages"]),delete r[t],e.next=17,C.a.setItem("ALL_NOTES",r);case 17:if("DEFAULT"===(i=c.tagId)){e.next=23;break}return s=a[i].notes,a[i].notes=s.filter((function(e){return e!==t})),e.next=23,C.a.setItem("ALL_TAGS",a);case 23:return e.abrupt("return",{tags:a,allNotes:r});case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(e,t){return Z.apply(this,arguments)}function Z(){return(Z=Object(d.a)(l.a.mark((function e(t,n){var r,a,c,i,s,u;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G(t);case 2:return c=e.sent,e.next=5,A();case 5:return i=e.sent,e.next=8,D();case 8:if(s=e.sent,c){e.next=11;break}return e.abrupt("return",{tags:s,allNotes:i});case 11:return u=c.tagId,c.tagId=n,e.next=15,C.a.setItem(t,c);case 15:return i[t].tagId=n,e.next=18,C.a.setItem("ALL_NOTES",i);case 18:return u in s&&(s[u].notes=s[u].notes.filter((function(e){return e!==t}))),null===(r=s[n])||void 0===r||null===(a=r.notes)||void 0===a||a.push(t),e.next=22,C.a.setItem("ALL_TAGS",s);case 22:return e.abrupt("return",{tags:s,allNotes:i});case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ee(e){return te.apply(this,arguments)}function te(){return(te=Object(d.a)(l.a.mark((function e(t){var n,r,a,c,i,s,u,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n={},r=0,a=Object.entries(t);r<a.length;r++)c=Object(j.a)(a[r],2),i=c[0],s=c[1],u=s.ratio,delete(o=s.states)[E()],n[i]={ratio:u,state:{strokes:Object.values(o).flat(1)}};return e.abrupt("return",n);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ne(e,t,n){return re.apply(this,arguments)}function re(){return(re=Object(d.a)(l.a.mark((function e(t,n,r){var a,c,i,s,u,o,d;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G(t);case 2:if(!(a=e.sent)){for(c={},i=0,s=Object.entries(r);i<s.length;i++)u=Object(j.a)(s[i],2),o=u[0],d=u[1],c[o]=Object(S.a)(Object(S.a)({},d),{},{state:x});a=Object(S.a)(Object(S.a)({},n),{},{tagId:"DEFAULT",team:!0,pages:c}),console.log(a),J(a)}case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ae=n(514),ce=n(65),ie=n(253),se=n(516),ue=n(513),oe=n(248),le=n(181),de=n(244),je=n.n(de);function be(e){return new Promise((function(t){e.toBlob(t)}))}function fe(e,t,n){return pe.apply(this,arguments)}function pe(){return(pe=Object(d.a)(l.a.mark((function e(t,n,r){var a,c,i,s,u,o,d,j;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getPage(n);case 2:if(a=e.sent,c=a.getViewport({scale:r}),console.log(c),i=document.createElement("canvas"),s=i.getContext("2d")){e.next=9;break}throw new Error("can't get virtual canvas context");case 9:return u=c.height,o=c.width,d=u/o,i.width=Math.floor(o*r),i.height=Math.floor(u*r),console.time("render"),e.next=16,a.render({canvasContext:s,viewport:c,transform:[r,0,0,r,0,0]}).promise;case 16:return console.timeEnd("render"),console.time("img"),e.next=20,be(i);case 20:if(j=e.sent){e.next=23;break}throw new Error("can't get canvas image blob");case 23:return console.timeEnd("img"),e.abrupt("return",[j,d]);case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function he(e){return Oe.apply(this,arguments)}function Oe(){return(Oe=Object(d.a)(l.a.mark((function e(t){var n,r,a,c,i,s,u,o,d,b,f,p,h,O,v=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=v.length>1&&void 0!==v[1]?v[1]:2,r=v.length>2?v[2]:void 0,e.next=4,le.getDocument(t).promise;case 4:a=e.sent,c=a.numPages,i=[],s=[],u=1;case 9:if(!(u<=c)){e.next=22;break}return e.next=12,fe(a,u,n);case 12:o=e.sent,d=Object(j.a)(o,2),b=d[0],f=d[1],i.push(b),s.push(f),r&&r(Math.floor(u/c*100));case 19:u+=1,e.next=9;break;case 22:return e.next=24,fe(a,1,.5);case 24:return p=e.sent,h=Object(j.a)(p,1),O=h[0],e.abrupt("return",{images:i,ratios:s,thumbnail:O});case 28:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ve(e,t){return me.apply(this,arguments)}function me(){return(me=Object(d.a)(l.a.mark((function e(t,n){var r,a,c,i,s,u,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=URL.createObjectURL(t),e.next=3,he(r,2,n);case 3:return a=e.sent,c=a.images,i=a.ratios,s=a.thumbnail,u={},c.forEach((function(e,t){u[Object(O.v4)()]={image:e,ratio:i[t],state:{strokes:[],position:[]}}})),o=t.name.replace(".pdf",""),e.abrupt("return",{uid:Object(O.v4)(),name:o,tagId:"DEFAULT",team:!1,withImg:!0,pdf:t,thumbnail:s,pages:u});case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}le.GlobalWorkerOptions.workerSrc=je.a;var xe=n(523),ge=n(524),ke=n(525),ye=n(526),we=n(527),Se=n(528),Ie=n(77),Ce=n.n(Ie),Ee=n(135),Ne="https://api.slotdumpling.top/paint";function Le(e){return Te.apply(this,arguments)}function Te(){return(Te=Object(d.a)(l.a.mark((function e(t){var n,r,a,c,i,s,u,o,d,b,f,p,h;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Ce.a.get("code/".concat(t));case 3:if(n=e.sent,200!==(r=n.data).statusCode){e.next=24;break}if(c=(a=r).noteId,i=a.pageInfos,!(s=a.noteInfo).withImg){e.next=19;break}u=0,o=Object.entries(i);case 9:if(!(u<o.length)){e.next=19;break}return d=Object(j.a)(o[u],2),b=d[0],f=d[1],e.next=13,Ce()({method:"GET",url:b,responseType:"blob"});case 13:p=e.sent,h=p.data,f.image=h;case 16:u++,e.next=9;break;case 19:return e.next=21,ne(c,s,i);case 21:return e.abrupt("return",c);case 24:return e.abrupt("return",null);case 25:e.next=31;break;case 27:return e.prev=27,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 31:case"end":return e.stop()}}),e,null,[[0,27]])})))).apply(this,arguments)}Ce.a.defaults.baseURL=Ne,Ce.a.interceptors.request.use((function(e){return console.log(e.method,e.url),e}));var Ae=function(e){for(var t=Object(Ee.cloneDeep)(e),n=0,r=Object.keys(t);n<r.length;n++){delete t[r[n]].state.position}return t};function Ue(e,t,n){return De.apply(this,arguments)}function De(){return(De=Object(d.a)(l.a.mark((function e(t,n,r){var a,c,i,s,u,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Ae(r),a=n.uid,c=n.name,i=n.withImg,s=n.pages,e.prev=2,e.next=5,Ce.a.put("create/".concat(t),{userId:E(),pageRecord:r,noteInfo:{uid:a,name:c,withImg:i}});case 5:if(u=e.sent,o=u.data,i&&Object.entries(s).forEach((function(e){var t=Object(j.a)(e,2),n=t[0],r=t[1].image;if(r){var a=new FormData;a.append("pageId",n),a.append("file",r),Ce()({method:"POST",url:"upload",data:a,headers:{"Content-Type":"multipart/form-data"}})}})),201!==o.statusCode){e.next=12;break}return e.abrupt("return",o.code);case 12:return e.abrupt("return",null);case 13:e.next=19;break;case 15:return e.prev=15,e.t0=e.catch(2),console.error(e.t0),e.abrupt("return",null);case 19:case"end":return e.stop()}}),e,null,[[2,15]])})))).apply(this,arguments)}function Re(e,t){return Fe.apply(this,arguments)}function Fe(){return(Fe=Object(d.a)(l.a.mark((function e(t,n){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Ce.a.put("pages/".concat(t),{userId:E(),pageRecord:n});case 3:if(r=e.sent,201!==r.data.statusCode){e.next=9;break}return e.abrupt("return",!0);case 9:return e.abrupt("return",!1);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,null,[[0,12]])})))).apply(this,arguments)}function Me(e){return Pe.apply(this,arguments)}function Pe(){return(Pe=Object(d.a)(l.a.mark((function e(t){var n,r,a,c,i,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Ce.a.get("room/".concat(t));case 3:if(n=e.sent,200!==(r=n.data).statusCode){e.next=13;break}return a=r.teamPages,c=r.code,i=r.noteInfo,e.next=9,ee(a);case 9:return s=e.sent,e.abrupt("return",{code:c,pages:s,info:i});case 13:return e.abrupt("return",null);case 14:e.next=20;break;case 16:return e.prev=16,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 20:case"end":return e.stop()}}),e,null,[[0,16]])})))).apply(this,arguments)}n(292);var We=n(4);function _e(e){var t=e.value,n=void 0===t?0:t,a=e.digitNum,c=void 0===a?4:a,i=e.onChange,s=void 0===i?function(){}:i,u=e.onSubmit;function o(e){return 0===e?new Array(c).fill(""):String(e).slice(0,c).padEnd(c,"x").split("").map((function(e){return"x"===e?"":e}))}var l=Object(r.useState)(0),d=Object(j.a)(l,2),b=d[0],f=d[1],p=Object(r.useState)(o(n)),h=Object(j.a)(p,2),O=h[0],v=h[1];function m(){-1===b?x.current.forEach((function(e){return e.blur()})):x.current[b].focus()}Object(r.useEffect)((function(){var e=o(n);v(e)}),[n]),Object(r.useEffect)((function(){var e=O.findIndex((function(e){return""===e}));f(e);var t=Number(O.join(""));t!==n&&(s(t),-1===e&&u(t))}),[O]),Object(r.useEffect)((function(){m()}),[b]);var x=Object(r.useRef)([]);function g(e){if("Backspace"===e.key){var t=Math.max(0,b-1);f(t),v((function(e){var n=e.slice();return n[t]="",n}))}}return Object(r.useEffect)((function(){x.current=x.current.slice(0,c)}),[c]),Object(We.jsxs)("div",{className:"digit-input",children:[O.map((function(e,t){return Object(We.jsx)("input",{ref:function(e){e&&(x.current[t]=e)},value:e,pattern:"\\d*",onChange:function(e){return function(e,t){/^[0-9]$/.test(e)&&v((function(n){var r=n.slice();return r[t]=e,r}))}(e.target.value,t)},onKeyUp:g},t)})),Object(We.jsx)("div",{className:"click-area",onClick:m})]})}var Be=n(515),Ge=(n(294),n(144)),ze=n.n(Ge),Ve=n(177),Ke=n.n(Ve),qe=Object(r.createContext)({setActive:function(){}});function He(){return Object(We.jsxs)("div",{id:"right-tools",children:[Object(We.jsx)(et,{}),Object(We.jsx)(Ze,{})]})}var Je=function(){var e=Object(r.useContext)(qe).setActive,t=ae.a.Item;return Object(We.jsxs)(ae.a,{onClick:function(t){var n=t.key;return e(n)},children:[Object(We.jsxs)(t,{children:[Object(We.jsx)(xe.a,{}),Object(We.jsx)("span",{children:"Load PDF"})]},"pdf"),Object(We.jsxs)(t,{children:[Object(We.jsx)(ge.a,{}),Object(We.jsx)("span",{children:"My profile"})]},"profile")]})},Ye=function(e){var t=e.children,n=e.title,a=Object(r.useContext)(qe).setActive;return Object(We.jsxs)("div",{className:"secondary",children:[Object(We.jsxs)("div",{className:"title",children:[Object(We.jsx)(ce.a,{type:"text",shape:"circle",onClick:function(){return a("menu")},icon:Object(We.jsx)(ke.a,{})}),Object(We.jsx)(ze.a,{level:5,children:n})]}),t]})};function Xe(){var e=Object(r.useState)(!1),t=Object(j.a)(e,2),n=t[0],a=t[1],c=Object(r.useContext)(Ct).tagUid,i=Object(r.useContext)(Et),s=i.setAllTags,u=i.setAllNotes,o=Object(r.useState)(0),b=Object(j.a)(o,2),f=b[0],p=b[1];function h(){return(h=Object(d.a)(l.a.mark((function e(t){var n,r,i,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("application/pdf"===t.type){e.next=2;break}return e.abrupt("return");case 2:return a(!0),e.next=5,ve(t,p);case 5:return(n=e.sent).tagId=c,e.next=9,J(n);case 9:return r=e.sent,i=r.tags,o=r.allNotes,s(i),u(o),a(!1),ie.b.success("PDF Loaded"),e.abrupt("return",!1);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(We.jsx)(Ye,{title:"Load PDF",children:Object(We.jsxs)(Ke.a,{disabled:n,multiple:!1,action:"#",accept:"application/pdf",beforeUpload:function(e){return h.apply(this,arguments)},children:[Object(We.jsx)("p",{className:"ant-upload-drag-icon",children:n?Object(We.jsx)(se.a,{width:48,type:"circle",percent:f}):Object(We.jsx)(ye.a,{})}),Object(We.jsx)("p",{className:"ant-upload-hint",children:"Click or drag a pdf file here."})]})})}var $e=function(){var e=N(),t=Object(r.useState)(e),n=Object(j.a)(t,2),a=n[0],c=n[1];return Object(We.jsx)(Ye,{title:"My profile",children:Object(We.jsxs)("div",{className:"profile-page",children:[Object(We.jsx)(ue.a,{prefix:Object(We.jsx)(ge.a,{}),value:a,onChange:function(e){return c(e.target.value)}}),Object(We.jsx)(ce.a,{onClick:function(){!function(e){!!(e=e.trim())&&localStorage.setItem("USER_NAME",e)}(a)},type:"primary",block:!0,children:"Enter"})]})})},Qe=function(){var e=Object(r.useState)(100),t=Object(j.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)("menu"),i=Object(j.a)(c,2),s=i[0],u=i[1],o={timeout:300,onEnter:function(e){a(e.clientHeight)},unmountOnExit:!0},l=Object(S.a)(Object(S.a)({},o),{},{classNames:"secondary"});return Object(We.jsx)(qe.Provider,{value:{setActive:u},children:Object(We.jsxs)("section",{className:"others-menu",style:{height:n},children:[Object(We.jsx)(Be.a,Object(S.a)(Object(S.a)({classNames:"primary",in:"menu"===s},o),{},{children:Object(We.jsx)(Je,{})})),Object(We.jsx)(Be.a,Object(S.a)(Object(S.a)({in:"pdf"===s},l),{},{children:Object(We.jsx)(Xe,{})})),Object(We.jsx)(Be.a,Object(S.a)(Object(S.a)({in:"profile"===s},l),{},{children:Object(We.jsx)($e,{})}))]})})},Ze=function(){return Object(We.jsx)(oe.a,{placement:"bottomRight",trigger:"click",content:Object(We.jsx)(Qe,{}),children:Object(We.jsx)(ce.a,{shape:"circle",icon:Object(We.jsx)(we.a,{})})})};function et(){var e=Object(r.useState)(0),t=Object(j.a)(e,2),n=t[0],a=t[1],c=Object(u.f)();function i(){return(i=Object(d.a)(l.a.mark((function e(t){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=ie.b.loading("Loading team note...",0),e.next=3,Le(t);case 3:r=e.sent,n(),r?c("/team/".concat(r)):(a(0),ie.b.error("Room doesn't exist."));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(We.jsx)(oe.a,{placement:"bottomRight",trigger:"click",title:"Join a team note",destroyTooltipOnHide:!0,content:Object(We.jsx)(_e,{value:n,onChange:a,onSubmit:function(e){return i.apply(this,arguments)}}),children:Object(We.jsx)(ce.a,{shape:"round",icon:Object(We.jsx)(Se.a,{}),children:"Team"})})}function tt(){var e=Object(r.useContext)(Ct).editing,t=Object(r.useContext)(Et).setEditing;return Object(We.jsx)("div",{id:"left-tools",children:Object(We.jsx)(ce.a,{onClick:function(){t((function(e){return!e}))},type:e?"primary":"text",children:e?"Done":"Edit"})})}var nt=n(518),rt=n(519),at=n(529),ct=n(152),it=n(86),st=n(530),ut=n(531),ot=n(532),lt=n(533),dt=n(534),jt=n(250),bt=n.n(jt),ft=function(e){var t={backgroundColor:e.color};return Object(We.jsx)("div",{className:"tag-circle",style:t})};function pt(e){var t=e.noteTag,n=t.uid,a=t.color,c=t.name,i=t.notes,s=Object(r.useContext)(Ct).editing,u=Object(r.useContext)(Et),o=u.setTagUid,b=u.setAllTags,f=Object(r.useState)(!1),p=Object(j.a)(f,2),h=p[0],O=p[1],v=Object(r.useState)(c),m=Object(j.a)(v,2),x=m[0],g=m[1],k=Object(r.useState)(a),y=Object(j.a)(k,2),w=y[0],S=y[1];function I(){return(I=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P(n);case 2:t=e.sent,o("DEFAULT"),b(t);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(){return(C=Object(d.a)(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={uid:n,name:x,color:w,notes:i},e.next=3,_(t);case 3:r=e.sent,b(r),O(!1);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var E=Object(We.jsx)(nt.a,{value:w,onSelect:S,children:L.map((function(e){return Object(We.jsx)(nt.a.Option,{value:e,children:Object(We.jsx)(ft,{color:e})},e)}))}),N=function(){return Object(We.jsx)(ue.a,{className:"tag-name-input",addonBefore:E,value:x,onChange:function(e){return g(e.target.value)}})};return Object(We.jsxs)("div",{className:"menu-item",children:[s&&h?Object(We.jsxs)(We.Fragment,{children:[Object(We.jsx)(rt.a,{title:"Delete this tag?",onConfirm:function(){return I.apply(this,arguments)},placement:"left",okText:"Yes",cancelText:"No",children:Object(We.jsx)(ce.a,{type:"text",danger:!0,size:"small",icon:Object(We.jsx)(at.a,{})})}),Object(We.jsx)(N,{})]}):Object(We.jsxs)(We.Fragment,{children:[Object(We.jsx)(ft,{color:w}),Object(We.jsx)("span",{className:"tag-name",children:x})]}),s&&h&&Object(We.jsxs)(We.Fragment,{children:[Object(We.jsx)(ce.a,{disabled:""===x,size:"small",type:"link",onClick:function(){return C.apply(this,arguments)},icon:Object(We.jsx)(ct.a,{})}),Object(We.jsx)(ce.a,{size:"small",type:"text",onClick:function(){g(c),S(a),O(!1)},icon:Object(We.jsx)(it.a,{})})]}),s&&!h&&Object(We.jsx)(ce.a,{size:"small",type:"text",onClick:function(){return O(!0)},icon:Object(We.jsx)(st.a,{})})]})}var ht=function(){var e=Object(r.useContext)(Et).setAllTags;function t(){return(t=Object(d.a)(l.a.mark((function t(n){var r,a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.trim()){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,F(r);case 7:a=t.sent,e(a);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var n=Object(We.jsx)(bt.a,{placeholder:"Tag name...",onSearch:function(e){return t.apply(this,arguments)},allowClear:!0,enterButton:Object(We.jsx)(ut.a,{})});return Object(We.jsx)("div",{id:"add-tag",children:Object(We.jsx)(oe.a,{content:n,trigger:"click",placement:"topLeft",destroyTooltipOnHide:!0,children:Object(We.jsx)(ce.a,{shape:"circle",type:"text",icon:Object(We.jsx)(ot.a,{})})})})};function Ot(){var e=Object(r.useContext)(Ct).allTags,t=Object(r.useContext)(Et).setTagUid;var n=ae.a.Item;return Object(We.jsxs)("aside",{children:[Object(We.jsx)("label",{htmlFor:"aside-checkbox",id:"aside-label",children:Object(We.jsx)(lt.a,{})}),Object(We.jsx)("input",{type:"checkbox",id:"aside-checkbox"}),Object(We.jsxs)("div",{id:"side-wrapper",children:[Object(We.jsxs)(ae.a,{onClick:function(e){var n=e.key;t(n)},id:"side-menu",defaultSelectedKeys:["DEFAULT"],defaultOpenKeys:["sub1"],mode:"inline",children:[Object(We.jsx)(n,{children:Object(We.jsxs)("div",{className:"menu-item",children:[Object(We.jsx)(dt.a,{id:"all-note-icon"}),Object(We.jsx)("span",{className:"tag-name",children:"All Notes"})]})},"DEFAULT"),Object.values(e).map((function(e){return Object(We.jsx)(n,{children:Object(We.jsx)(pt,{noteTag:e})},e.uid)}))]}),Object(We.jsx)("footer",{children:Object(We.jsx)(ht,{})})]})]})}var vt=n(520),mt=n(521),xt=n(535),gt=n(536),kt=n(537),yt=n.p+"static/media/default.dd551273.png";function wt(e){var t=e.noteList;return Object(We.jsx)("div",{id:"note-list",children:t.map((function(e){return Object(We.jsx)(St,{noteInfo:e},e.uid)}))})}var St=function(e){var t=e.noteInfo,n=Object(r.useContext)(Ct),a=n.editing,c=n.allTags,i=t.team,u=t.uid,o=t.name,f=t.thumbnail,p=a?"#":"".concat(i?"team":"reader","/").concat(u),h=Object(r.useContext)(Et),O=h.setAllTags,v=h.setAllNotes,m=Object(r.useState)(o),x=Object(j.a)(m,2),g=x[0],k=x[1];function y(){return w.apply(this,arguments)}function w(){return(w=Object(d.a)(l.a.mark((function e(){var t,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X(u);case 2:t=e.sent,n=t.tags,r=t.allNotes,O(n),v(r);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var I=Object(r.useMemo)((function(){return f?URL.createObjectURL(f):null}),[f]);Object(r.useEffect)((function(){var e=I||"";return function(){return URL.revokeObjectURL(e)}}),[I]);var C=function(){var e=Object(d.a)(l.a.mark((function e(t){var n,r,a,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.key,e.next=3,Q(u,n);case 3:r=e.sent,a=r.tags,c=r.allNotes,O(a),v(c);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),E=function(){var e=ae.a.Item,t=Object(We.jsxs)(ae.a,{onClick:C,children:[Object(We.jsx)(e,{children:Object(We.jsxs)("div",{className:"tag-select",children:[Object(We.jsx)(it.a,{className:"none-tag-icon"}),Object(We.jsx)("span",{children:"None Tag"})]})},"DEFAULT"),Object.values(c).map((function(t){return Object(We.jsx)(e,{children:Object(We.jsxs)("div",{className:"tag-select",children:[Object(We.jsx)(ft,{color:t.color}),Object(We.jsx)("span",{children:t.name})]})},t.uid)}))]});return Object(We.jsx)(vt.a,{overlay:t,trigger:["click"],children:Object(We.jsx)(ce.a,{className:"note-delete",type:"text",icon:Object(We.jsx)(xt.a,{})})})},N=function(){return Object(We.jsx)(rt.a,{title:"Delete this note?",onConfirm:y,okText:"Yes",cancelText:"No",children:Object(We.jsx)(ce.a,{className:"note-delete",type:"text",danger:!0,icon:Object(We.jsx)(gt.a,{})})})};return Object(We.jsx)(s.b,{to:p,children:Object(We.jsxs)("div",{className:"list-item",children:[Object(We.jsxs)("div",{className:"thumbnail-wrapper",children:[Object(We.jsx)("img",{src:I||yt,alt:o,className:"thumbnail"}),i&&Object(We.jsx)(mt.a,{color:"blue",className:"cloud-icon",children:Object(We.jsx)(kt.a,{})})]}),a||Object(We.jsx)("p",{className:"note-name",children:o}),a&&Object(We.jsxs)(We.Fragment,{children:[Object(We.jsx)(ue.a,{className:"note-name-input",value:g,onChange:function(e){return k(e.target.value)},onBlur:function(){V(u,{name:g}),v((function(e){return Object(S.a)(Object(S.a)({},e),{},Object(b.a)({},u,Object(S.a)(Object(S.a)({},e[u]),{},{name:g})))}))}}),Object(We.jsx)(E,{}),Object(We.jsx)(N,{})]})]})})},It=n(538),Ct=Object(r.createContext)({tagUid:"DEFAULT",editing:!1,allNotes:{},allTags:{}}),Et=Object(r.createContext)({setAllNotes:function(){},setAllTags:function(){},setTagUid:function(){},setEditing:function(){}});function Nt(){var e=Object(r.useState)({}),t=Object(j.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)({}),i=Object(j.a)(c,2),s=i[0],u=i[1],o=Object(r.useState)("DEFAULT"),l=Object(j.a)(o,2),d=l[0],b=l[1],f=Object(r.useState)(!1),p=Object(j.a)(f,2),h=p[0],O=p[1],v=Object(r.useMemo)((function(){return"DEFAULT"===d?{uid:"",name:"All Notes",color:"#000",notes:Object.keys(n)}:s[d]}),[d,s,n]),m=Object(r.useMemo)((function(){return v.notes.filter((function(e){return e in n})).map((function(e){return n[e]}))}),[v,n]);return Object(r.useEffect)((function(){A().then(a),D().then(u),document.title="Multibility"}),[]),Object(We.jsx)(Ct.Provider,{value:{tagUid:d,editing:h,allNotes:n,allTags:s},children:Object(We.jsx)(Et.Provider,{value:{setAllNotes:a,setAllTags:u,setEditing:O,setTagUid:b},children:Object(We.jsxs)("div",{id:"menu-container",children:[Object(We.jsxs)("header",{children:[Object(We.jsx)(tt,{}),Object(We.jsx)(ze.a,{level:4,children:v.name}),Object(We.jsx)(He,{})]}),Object(We.jsxs)("main",{children:[Object(We.jsx)(Ot,{}),Object(We.jsx)(wt,{noteList:m}),Object(We.jsx)(Lt,{})]})]})})})}var Lt=function(){var e=Object(r.useContext)(Ct).tagUid,t=Object(r.useContext)(Et),n=t.setAllTags,a=t.setAllNotes;function c(){return(c=Object(d.a)(l.a.mark((function t(){var r,c,i,s;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(r=y()).tagId=e,t.next=4,J(r);case 4:c=t.sent,i=c.tags,s=c.allNotes,n(i),a(s);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return Object(We.jsx)(ce.a,{id:"new-note",size:"large",type:"primary",shape:"circle",onClick:function(){return c.apply(this,arguments)},icon:Object(We.jsx)(It.a,{})})},Tt=function(){function e(t,n,r){Object(f.a)(this,e),this.context=t,this.width=n,this.height=r,this.points=[]}return Object(p.a)(e,[{key:"drawBegin",value:function(e){this.points.push(e);var t=e.x,n=e.y,r=e.lineWidth;this.context.lineWidth=r,this.context.beginPath(),this.context.moveTo(t,n),this.context.stroke()}},{key:"drawCurve",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"black",n=this.points.slice(-1)[0];if(this.points.push(e),!(this.points.length<3)){var r=(e.x+n.x)/2,a=(e.y+n.y)/2;this.context.strokeStyle=t,this.context.lineCap="round",this.context.lineJoin="round",this.context.lineWidth=n.lineWidth,this.context.quadraticCurveTo(n.x,n.y,r,a),this.context.stroke(),this.context.beginPath(),this.context.moveTo(r,a)}}},{key:"getImageData",value:function(){return this.context.getImageData(0,0,this.width,this.height)}}],[{key:"createRaw",value:function(t,n){var r=document.createElement("canvas");r.width=t,r.height=n;var a=r.getContext("2d");if(!a)throw Error("can't get canvas context");return new e(a,t,n)}}]),e}(),At=100,Ut=function(){function e(t,n,r){Object(f.a)(this,e),this.context=t,this.width=n,this.height=r,this.points=[],this.mainDrawer=void 0,this.mirrorDrawer=void 0,this.ratio=void 0,this.mainDrawer=new Tt(t,n,r),n<=At&&r<=At?(this.ratio=1,this.mirrorDrawer=Tt.createRaw(n,r)):n>r?(this.ratio=n/At,this.mirrorDrawer=Tt.createRaw(At,r/this.ratio)):(this.ratio=r/At,this.mirrorDrawer=Tt.createRaw(n/this.ratio,At))}return Object(p.a)(e,[{key:"drawBegin",value:function(e){this.points.push(e),this.mainDrawer.drawBegin(e),this.mirrorDrawer.drawBegin(this.computeMirrorPoint(e))}},{key:"drawCurve",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"black";this.points.push(e),this.mainDrawer.drawCurve(e,t),this.mirrorDrawer.drawCurve(this.computeMirrorPoint(e),"black")}},{key:"computeLineWidth",value:function(e){var t,n;return 5*Math.log(e+1)+.8*(null!==(t=null===(n=this.points.slice(-1)[0])||void 0===n?void 0:n.lineWidth)&&void 0!==t?t:0)}},{key:"getMirrorImageData",value:function(){return this.mirrorDrawer.getImageData()}},{key:"computeMirrorPoint",value:function(e){return{x:e.x/this.ratio,y:e.y/this.ratio,lineWidth:e.lineWidth/this.ratio}}}]),e}();var Dt=a.a.memo((function(e){var t=e.drawState,n=Object(r.useRef)(null),a=Object(r.useRef)(),c=t.width,i=t.height;return Object(r.useEffect)((function(){if(n.current){n.current.addEventListener("touchstart",(function(e){e.preventDefault()}),{passive:!1});var e=n.current.getContext("2d");e&&(a.current=e)}}),[]),Object(r.useEffect)((function(){var e;console.log("display rerender"),null===(e=a.current)||void 0===e||e.clearRect(0,0,c,i),t.getValidStrokes().forEach((function(e){a.current&&function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"black",r=new Tt(e,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0),a=t.slice(),c=a.shift();c&&(r.drawBegin(c),a.forEach((function(e){r.drawCurve(e,n)})))}(a.current,e.points,"black",c,i)}))})),Object(We.jsx)("canvas",{width:c,height:i,ref:n})}));function Rt(e){var t=e.drawState,n=e.setDrawState,a=e.method,c=e.finger,i=e.even,s=e.lineWidth,u=t.width,o=t.height,l=Object(r.useRef)(null),d=Object(r.useRef)(u),b=Object(r.useRef)(o),f=Object(r.useRef)(!1),p=Object(r.useRef)();function h(){if(!l.current)throw Error("can't get canvas element");return l.current}function O(){var e=h().getContext("2d");if(!e)throw Error("can't get canvas context");return e}function v(e){var t=h().getBoundingClientRect(),n=e.clientX-t.left,r=e.clientY-t.top;return[n/d.current*u,r/b.current*o]}function m(){d.current=h().clientWidth,b.current=h().clientHeight}function x(e){return"direct"===e.touches[0].touchType}function g(){var e=p.current;if(f.current&&e){f.current=!1;var t=e.points;if(!(t.length<2)){var r=function(){n((function(n){return a(n,e.getMirrorImageData(),t)}))};requestAnimationFrame((function(){requestAnimationFrame(r)}))}}}return Object(r.useEffect)(m,[]),Object(r.useEffect)((function(){var e=h(),t=function(e){!c&&x(e)||e.preventDefault()};return e.addEventListener("touchstart",t,{passive:!1}),function(){e.removeEventListener("touchstart",t)}}),[c]),Object(r.useEffect)((function(){O().clearRect(0,0,u,o)}),[t,u,o]),Object(We.jsx)("canvas",{width:u,height:o,ref:l,onTouchStart:function(e){var t;f.current=!0,m(),p.current=new Ut(O(),u,o);var n=e.touches[0];if(c||!x(e)){var r=(null!==(t=n.force)&&void 0!==t?t:0)*s,a=v(n),l=Object(j.a)(a,2),d={x:l[0],y:l[1],lineWidth:i?s:p.current.computeLineWidth(r)};p.current.drawBegin(d)}},onMouseDown:function(e){f.current=!0,m();var t=v(e),n=Object(j.a)(t,2),r=n[0],a=n[1];p.current=new Ut(O(),u,o);var c={x:r,y:a,lineWidth:s};p.current.drawBegin(c)},onTouchMove:function(e){var t;if(f.current&&p.current){var n=e.touches[0];if(c||"direct"!==n.touchType){var r=(null!==(t=n.force)&&void 0!==t?t:0)*s,a=v(n),u=Object(j.a)(a,2),o={x:u[0],y:u[1],lineWidth:i?s:p.current.computeLineWidth(r)};p.current.drawCurve(o)}}},onMouseMove:function(e){if(f.current&&p.current){var t=v(e),n=Object(j.a)(t,2),r={x:n[0],y:n[1],lineWidth:s};p.current.drawCurve(r)}},onTouchEnd:g,onMouseUp:g,onMouseLeave:g})}n(479);function Ft(e){var t=e.drawState,n=e.onChange,r=e.erasing,a=void 0!==r&&r,c=e.finger,i=void 0!==c&&c,s=e.even,u=void 0===s||s,o=e.lineWidth,l=void 0===o?10:o,d=a?g.eraseStrokes:g.addStroke;return Object(We.jsxs)("div",{className:"draw-wrapper",children:[Object(We.jsx)(Dt,{drawState:t}),Object(We.jsx)(Rt,{drawState:t,method:d,finger:i,even:u,lineWidth:l,setDrawState:n})]})}n(480);var Mt={states:Object(h.b)(),keys:Object(h.a)(),editStack:Object(h.a)(),undoStack:Object(h.a)()},Pt=Object(h.d)(Mt),Wt=function(){function e(t,n){Object(f.a)(this,e),this.immutable=t,this.lastOp=n}return Object(p.a)(e,[{key:"getImmutable",value:function(){return this.immutable}},{key:"getStates",value:function(){return this.getImmutable().get("states")}},{key:"getKeys",value:function(){return this.getImmutable().get("keys")}},{key:"getEditStack",value:function(){return this.getImmutable().get("editStack")}},{key:"getUndoStack",value:function(){return this.getImmutable().get("undoStack")}},{key:"setState",value:function(t,n){var r,a=this.getImmutable().update("states",(function(e){return e.set(t,n)}));return this.getStates().has(t)&&(a=a.update("editStack",(function(e){return e.push(t)}))),n.lastOp&&(r=Object(S.a)(Object(S.a)({},n.lastOp),{},{pageId:t})),new e(a,r)}},{key:"getOneState",value:function(e){return this.getImmutable().get("states").get(e)}},{key:"isUndoable",value:function(){return this.getEditStack().size>0}},{key:"isRedoable",value:function(){return this.getUndoStack().size>0}},{key:"undo",value:function(){if(!this.isUndoable())return this;var t=this.getImmutable().get("editStack").last();if(!t)return this;var n=this.getImmutable().get("states").get(t);if(!n)return this;var r,a=g.undo(n),c=a.lastOp;return c&&(r=Object(S.a)({pageId:t},c)),new e(this.getImmutable().update("editStack",(function(e){return e.pop()})).update("undoStack",(function(e){return e.push(t)})).update("states",(function(e){return e.set(t,a)})),r)}},{key:"redo",value:function(){if(this.isRedoable()){var t=this.getImmutable().get("undoStack").last();if(!t)return this;var n=this.getImmutable().get("states").get(t);if(!n)return this;var r,a=g.redo(n),c=a.lastOp;return c&&(r=Object(S.a)({pageId:t},c)),new e(this.getImmutable().update("undoStack",(function(e){return e.pop()})).update("editStack",(function(e){return e.push(t)})).update("states",(function(e){return e.set(t,a)})),r)}return this}},{key:"pushStroke",value:function(e,t){var n=this.getImmutable().get("states").get(e);if(!n)return this;var r=g.pushStroke(n,t);return this.setState(e,r)}},{key:"pushOperation",value:function(e){var t,n=e.type,r=e.pageId,a=this.getImmutable().get("states").get(r);if(!a)return this;switch(n){case"add":t=g.pushStroke(a,e.stroke);break;case"erase":t=g.pushErase(a,e.erase);break;case"undo":t=g.pushUndo(a,e.undoUid);break;case"redo":t=g.pushRedo(a,e.redoUid)}return this.setState(r,t)}}],[{key:"createEmpty",value:function(){return new e(Pt())}},{key:"createKeyed",value:function(t){return new e(Pt().set("keys",Object(h.a)(t)))}},{key:"createFromList",value:function(t){return new e(Pt().set("keys",Object(h.a)(t.map((function(e){return e[0]})))).set("states",Object(h.b)(t)))}},{key:"createFromPages",value:function(t,n){var r=Object.entries(t);return e.createFromList(r.map((function(e){var t=Object(j.a)(e,2),r=t[0],a=t[1],c=a.state,i=a.ratio;return[r,g.loadFromFlat(c,n,n*i)]})))}}]),e}(),_t=n(512),Bt=n(517),Gt=n(511),zt=n(522),Vt=n(541),Kt=n(182),qt=n(542),Ht=n(543),Jt=n(544),Yt=(n(481),n(251)),Xt=n(539),$t=n(540),Qt=Object(r.createContext)({code:-2,userList:[]});function Zt(){var e,t=null!==(e=Object(u.g)().noteId)&&void 0!==e?e:"",n=Object(r.useState)(),a=Object(j.a)(n,2),c=a[0],i=a[1],s=Object(r.useState)(-2),o=Object(j.a)(s,2),b=o[0],f=o[1],p=Object(r.useState)([]),h=Object(j.a)(p,2),O=h[0],v=h[1],m=Object(r.useState)(function(e){return function(){return Object(Yt.io)(Ne,{autoConnect:!1,query:{userId:E(),userName:N(),noteId:e}})}}(t)),x=Object(j.a)(m,1)[0],g=Object(u.f)();function k(){return y.apply(this,arguments)}function y(){return(y=Object(d.a)(l.a.mark((function e(){var n,r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Me(t);case 2:if(n=e.sent){e.next=6;break}return ie.b.error("Failed loading the team note"),e.abrupt("return",g("/"));case 6:r=n.code,a=n.pages,f(r),i(Wt.createFromPages(a,on));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var w=function(){var e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k();case 2:x.on("push",(function(e){var t=e.operation;i((function(e){return null===e||void 0===e?void 0:e.pushOperation(t)}))})),x.on("joined",(function(e){var t=e.joined,n=e.members,r=t.userId,a=t.userName;v(n),r!==E()&&ie.b.success({icon:Object(We.jsx)(Xt.a,{}),content:a+" joined room"})})),x.on("leaved",(function(e){var t=e.leaved,n=e.members,r=t.userId,a=t.userName;v(n),r!==E()&&ie.b.warning({icon:Object(We.jsx)($t.a,{}),content:a+" leaved room"})})),x.connect();case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),S=function(){x.off("connect"),x.off("push"),x.off("joined"),x.off("leaved"),x.disconnect()};Object(r.useEffect)((function(){return w(),S}),[t]);return Object(We.jsx)(Qt.Provider,{value:{code:b,userList:O},children:Object(We.jsx)(fn,{teamOn:!0,teamStateSet:c,pushOperation:function(e){x.emit("push",{operation:e})}})})}n(507);function en(e){var t=e.value,n=Object(r.useState)(9999),a=Object(j.a)(n,2),c=a[0],i=a[1],s=String(t>=0?t:c).padStart(4,"0").split("").map((function(e){return Number(e)}));function u(){i(Math.floor(1e4*Math.random()))}return Object(r.useEffect)((function(){if(-1!==t)return i(9999);var e=setTimeout(u,100);return function(){return clearTimeout(e)}}),[t]),Object(We.jsx)("div",{className:"digit-display ".concat(-2===t?"disabled":""),children:s.map((function(e,t){return Object(We.jsx)(tn,{digit:e},t)}))})}function tn(e){var t=e.digit;return t<=9&&t>=0?Object(We.jsx)("div",{className:"digit",children:t}):Object(We.jsx)("div",{className:"digit",children:"*"})}var nn=Object(zt.a)({scriptUrl:"//at.alicdn.com/t/font_3181679_ofhwjwfs5hb.js"});function rn(e){var t=e.setDrawCtrl,n=e.handleUndo,a=e.handleRedo,c=e.instantSave,i=Object(r.useContext)(dn),s=Object(r.useContext)(jn),o=s.saved,l=s.stateSet,d=s.teamOn,j=Object(u.f)(),b=function(e){t((function(t){return Object(S.a)(Object(S.a)({},t),e)}))},f=Object(We.jsx)("div",{className:"pen-panel",children:Object(We.jsx)(_t.a,{min:1,max:20,value:i.lineWidth,onChange:function(e){return b({lineWidth:e})}})}),p=function(){return i.erasing?Object(We.jsx)(ce.a,{type:"text",shape:"circle",onClick:function(){return b({erasing:!1})},icon:Object(We.jsx)(Vt.a,{})}):Object(We.jsx)(oe.a,{content:f,trigger:"click",placement:"bottom",getPopupContainer:function(e){var t;return(null===(t=e.parentElement)||void 0===t?void 0:t.parentElement)||e},children:Object(We.jsx)(ce.a,{type:"default",shape:"circle",icon:Object(We.jsx)(Vt.a,{})})})};return Object(We.jsxs)("div",{className:"tool-bar",children:[Object(We.jsxs)("div",{className:"left-buttons",children:[Object(We.jsx)(ce.a,{type:"text",onClick:function(){return j("/")},icon:Object(We.jsx)(Kt.a,{}),children:"Back"}),Object(We.jsx)(ce.a,{type:"text",onClick:c,disabled:o,icon:Object(We.jsx)(qt.a,{})})]}),Object(We.jsxs)("div",{className:"middle-buttons",children:[Object(We.jsx)(ce.a,{type:"text",icon:Object(We.jsx)(Ht.a,{}),onClick:n,disabled:!(null===l||void 0===l?void 0:l.isUndoable())}),Object(We.jsx)(ce.a,{className:"redo-button",type:"text",icon:Object(We.jsx)(Jt.a,{}),onClick:a,disabled:!(null===l||void 0===l?void 0:l.isRedoable())}),Object(We.jsx)(p,{}),Object(We.jsx)(ce.a,{type:i.erasing?"default":"text",shape:"circle",onClick:function(){return b({erasing:!0})},icon:Object(We.jsx)(nn,{type:"icon-eraser"})})]}),Object(We.jsxs)("div",{className:"right-buttons",children:[d&&Object(We.jsx)(cn,{}),d||Object(We.jsx)(sn,{})]})]})}var an=function(e){var t=e.userInfo.userName;return Object(We.jsxs)("div",{className:"user-card",children:[Object(We.jsx)(Bt.a,{className:"avatar",size:"small",style:{backgroundColor:T()},children:t.slice(0,4)}),Object(We.jsx)("span",{children:t})]})};function cn(){var e=Object(r.useContext)(Qt),t=e.code,n=e.userList,a=Object(We.jsxs)("div",{className:"team-popover",children:[Object(We.jsx)(en,{value:t}),Object(We.jsx)(Gt.a,{}),Object(We.jsx)("div",{className:"user-list",children:n.map((function(e){return Object(We.jsx)(an,{userInfo:e},e.userId)}))})]});return Object(We.jsx)(oe.a,{content:a,trigger:"click",placement:"bottomRight",title:"Team info",defaultVisible:!0,getPopupContainer:function(e){var t;return(null===(t=e.parentElement)||void 0===t?void 0:t.parentElement)||e},children:Object(We.jsx)(ce.a,{shape:"round",icon:Object(We.jsx)(Se.a,{}),children:"Team"})})}var sn=function(){var e=Object(r.useContext)(bn).createRoom;return Object(We.jsx)(rt.a,{placement:"bottomRight",title:"Enable team editing?",onConfirm:e,okText:"Yes",cancelText:"No",children:Object(We.jsx)(ce.a,{shape:"round",icon:Object(We.jsx)(Se.a,{}),children:"Team"})})},un=n(255),on=2e3,ln={erasing:!1,finger:!1,even:!0,lineWidth:5,color:"#000"},dn=Object(r.createContext)(ln),jn=Object(r.createContext)({noteId:"",stateSet:void 0,saved:!0,teamOn:!1}),bn=Object(r.createContext)({setSaved:function(){},createRoom:function(){}});function fn(e){var t,n=e.teamOn,a=e.teamStateSet,c=e.pushOperation,i=null!==(t=Object(u.g)().noteId)&&void 0!==t?t:"",s=Object(u.f)(),o=Object(r.useState)(),f=Object(j.a)(o,2),p=f[0],h=f[1],O=Object(r.useState)(),v=Object(j.a)(O,2),m=v[0],x=v[1],k=Object(r.useState)(),y=Object(j.a)(k,2),w=y[0],I=y[1],C=Object(r.useState)(ln),E=Object(j.a)(C,2),N=E[0],L=E[1],T=Object(r.useState)(!0),A=Object(j.a)(T,2),U=A[0],D=A[1],R=function(){var e=Object(d.a)(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G(i);case 2:if(t=e.sent){e.next=6;break}return ie.b.error("Note not found"),e.abrupt("return",s("/"));case 6:r=t.pages,h(r),x(t),I(Wt.createFromPages(r,on)),n&&Re(i,r);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),F=Object(r.useCallback)(Object(Ee.debounce)(function(){var e=Object(d.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V(i,{pages:t});case 2:D(!0);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),2e3),[]),M=F.flush,P=function(){var e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(m&&p){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,Ue(i,m,p);case 4:if(e.sent){e.next=8;break}return ie.b.error("Can't create room."),e.abrupt("return");case 8:return e.next=10,V(i,{team:!0});case 10:s("/team/"+i);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),W=function(){M()};Object(r.useEffect)((function(){return R(),W}),[i,n]),Object(r.useEffect)((function(){m&&(document.title=m.name)}),[m]),Object(un.a)(W),Object(r.useEffect)((function(){(null===w||void 0===w?void 0:w.lastOp)&&c&&c(w.lastOp)}),[w]),Object(r.useEffect)((function(){p&&(F(p),D(!1))}),[p]);var _=Object(r.useCallback)((function(e,t){I((function(n){return null===n||void 0===n?void 0:n.setState(e,t)})),h((function(n){if(n)return Object(S.a)(Object(S.a)({},n),{},Object(b.a)({},e,Object(S.a)(Object(S.a)({},n[e]),{},{state:g.flaten(t)})))}))}),[]);return Object(We.jsx)(dn.Provider,{value:N,children:Object(We.jsx)(jn.Provider,{value:{noteId:i,stateSet:w,saved:U,teamOn:n},children:Object(We.jsx)(bn.Provider,{value:{setSaved:D,createRoom:P},children:Object(We.jsxs)("div",{className:"reader-container",children:[Object(We.jsx)(rn,{setDrawCtrl:L,instantSave:M,handleUndo:function(){I((function(e){return null===e||void 0===e?void 0:e.undo()}))},handleRedo:function(){I((function(e){return null===e||void 0===e?void 0:e.redo()}))}}),null===w||void 0===w?void 0:w.getKeys().map((function(e){if(!p)return Object(We.jsx)(We.Fragment,{});var t=p[e],n=w.getOneState(e),r=null===a||void 0===a?void 0:a.getOneState(e);return t&&n?Object(We.jsx)(pn,{drawState:n,teamState:r,updateState:_,imageBlob:t.image,uid:e},e):Object(We.jsx)(We.Fragment,{})}))]})})})})}var pn=a.a.memo((function(e){var t=e.imageBlob,n=e.drawState,a=e.teamState,c=e.uid,i=e.updateState,s=Object(r.useState)(!1),u=Object(j.a)(s,2),o=u[0],l=u[1],d=Object(r.useMemo)((function(){return t?URL.createObjectURL(t):null}),[t]);return Object(r.useEffect)((function(){var e=d||"";return function(){return URL.revokeObjectURL(e)}}),[d]),Object(We.jsxs)("div",{className:"pdf-page ".concat(o?"loaded":""),children:[Object(We.jsx)("img",{src:d||yt,alt:"pdf-page",onLoad:function(){return l(!0)}}),Object(We.jsxs)("div",{className:"page-draw",children:[a&&Object(We.jsx)(Dt,{drawState:a}),Object(We.jsx)(hn,{updateState:i,drawState:n,uid:c})]})]})})),hn=function(e){var t=e.drawState,n=e.uid,a=e.updateState,c=Object(r.useContext)(dn);return Object(We.jsx)(Ft,{drawState:t,onChange:function(e){var r=e instanceof g?e:e(t);a(n,r)},erasing:c.erasing,lineWidth:c.lineWidth})};function On(){return Object(We.jsx)(We.Fragment,{children:Object(We.jsx)("div",{style:{backgroundColor:"red",height:"fit-content",width:100,transition:"all 3s"},children:Object(We.jsx)("div",{children:"apple"})})})}var vn=Object(We.jsx)("main",{style:{padding:"1rem"},children:Object(We.jsx)("p",{children:"There's nothing here!"})});i.a.render(Object(We.jsx)(s.a,{children:Object(We.jsxs)(u.c,{children:[Object(We.jsx)(u.a,{path:"/",element:Object(We.jsx)(Nt,{})}),Object(We.jsx)(u.a,{path:"/reader",children:Object(We.jsx)(u.a,{path:":noteId",element:Object(We.jsx)(fn,{teamOn:!1})})}),Object(We.jsx)(u.a,{path:"/team",children:Object(We.jsx)(u.a,{path:":noteId",element:Object(We.jsx)(Zt,{})})}),Object(We.jsx)(u.a,{path:"/test",element:Object(We.jsx)(On,{})}),Object(We.jsx)(u.a,{path:"*",element:vn})]})}),document.getElementById("root"))}},[[508,1,2]]]);
//# sourceMappingURL=main.bc675d05.chunk.js.map