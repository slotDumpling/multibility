(self.webpackChunkmultibility=self.webpackChunkmultibility||[]).push([[271],{52972:function(e,t,n){"use strict";n.r(t),n.d(t,{PageWrapper:function(){return nn},ReaderMethodCtx:function(){return $t},ReaderStateCtx:function(){return qt},default:function(){return en}});var r=n(93433),a=n(1413),u=n(45987),i=n(29439),o=n(15861),s=n(87757),c=n.n(s),l=n(72791),d=n(92198),f=n(61842),p=n.n(f),v=n(80184),h=[10,20,30,50],m={mode:"draw",finger:!0,lineWidth:10,eraserWidth:10,color:"#000000",highlight:!1,lasso:!0,pixelEraser:!1,widthList:h};function g(){return(g=(0,o.Z)(c().mark((function e(){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p().getItem("DRAW_CTRL");case 2:if(t=e.sent){e.next=7;break}return t=m,e.next=7,p().setItem("DRAW_CTRL",t);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(){return(x=(0,o.Z)(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p().setItem("DRAW_CTRL",t);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Z=l.createContext({drawCtrl:m,updateDrawCtrl:function(){}});function k(){var e=(0,l.useContext)(Z).drawCtrl;return(0,l.useDebugValue)(e),e}function b(){return(0,l.useContext)(Z).updateDrawCtrl}var w=function(e){var t=e.children,n=(0,l.useState)(m),r=(0,i.Z)(n,2),u=r[0],o=r[1];(0,l.useEffect)((function(){(function(){return g.apply(this,arguments)})().then(o)}),[]);return(0,v.jsx)(Z.Provider,{value:{drawCtrl:u,updateDrawCtrl:function(e){o((function(t){var n=(0,a.Z)((0,a.Z)({},t),e);return function(e){x.apply(this,arguments)}(n),n}))}},children:t})},S=n(81832),y=n(76807),j=n(95099),I=n(15671),C=n(43144),D=n(82670),N=n(24124),R={states:(0,N.D5)(),editStack:(0,N.aV)(),undoStack:(0,N.aV)()},P=(0,N.WV)(R),T=function(){function e(t,n){(0,I.Z)(this,e),this.immutable=t,this.lastOp=n}return(0,C.Z)(e,[{key:"getImmutable",value:function(){return this.immutable}},{key:"getStates",value:function(){return this.getImmutable().get("states")}},{key:"getOneState",value:function(e){return this.getStates().get(e)}},{key:"getEditStack",value:function(){return this.getImmutable().get("editStack")}},{key:"getUndoStack",value:function(){return this.getImmutable().get("undoStack")}},{key:"setState",value:function(t,n){var r=this.getOneState(t);if(!r||r===n)return this;var u=this.getImmutable().update("states",(function(e){return e.set(t,n)})).update("editStack",(function(e){return e.push(t)})).delete("undoStack"),i=n.lastOp;return new e(u,i&&(0,a.Z)((0,a.Z)({},i),{},{pageID:t}))}},{key:"syncStrokeTime",value:function(e,t){var n=this.getOneState(e);return n&&D.Dw.syncStrokeTime(n,t),this}},{key:"addState",value:function(t,n){var r=n.state,a=n.ratio,u=D.Dw.loadFromFlat(r,a);return new e(this.getImmutable().update("states",(function(e){return e.set(t,u)})))}},{key:"deleteState",value:function(t){return new e(this.getImmutable().update("states",(function(e){return e.delete(t)})))}},{key:"isUndoable",value:function(){return this.getEditStack().size>0}},{key:"isRedoable",value:function(){return this.getUndoStack().size>0}},{key:"undo",value:function(){if(!this.isUndoable())return this;var t=this.getEditStack().last(),n=t&&this.getOneState(t);if(!n)return this;var r=D.Dw.undo(n),u=r.lastOp,i=u&&(0,a.Z)({pageID:t},u);return new e(this.getImmutable().update("editStack",(function(e){return e.pop()})).update("undoStack",(function(e){return e.push(t)})).update("states",(function(e){return e.set(t,r)})),i)}},{key:"redo",value:function(){if(!this.isRedoable())return this;var t=this.getUndoStack().last(),n=t&&this.getOneState(t);if(!n)return this;var r=D.Dw.redo(n),u=r.lastOp,i=u&&(0,a.Z)({pageID:t},u);return new e(this.getImmutable().update("undoStack",(function(e){return e.pop()})).update("editStack",(function(e){return e.push(t)})).update("states",(function(e){return e.set(t,r)})),i)}},{key:"getLastDS",value:function(){var e,t=null===(e=this.lastOp)||void 0===e?void 0:e.pageID,n=t&&this.getOneState(t);if(n)return[t,n]}}],[{key:"createFromPages",value:function(t){return new e(P().set("states",(0,N.D5)(t).map((function(e){var t=e.state,n=e.ratio;return D.Dw.loadFromFlat(t,n)}))))}}]),e}();function E(e){var t=(0,l.useRef)(!1),n=function(e){return e.isPrimary&&(t.current="touch"===e.pointerType)},r=function(n){return function(n){return!t.current||function(e){var t=e.touches[0];return"stylus"===(null===t||void 0===t?void 0:t.touchType)}(n)||e&&1===n.touches.length}(n)||n.stopPropagation()};return{onPointerDownCapture:n,onPointerMoveCapture:n,onTouchStartCapture:r,onTouchMoveCapture:r}}var U=n(96153),O=n(53557),F=n(1488),L=n(12262),V=n.n(L),M=V().Path,W=V().Size,B=V().Point,A=V().Group,G=V().Color,Q=V().Raster,z=V().Layer,J=l.forwardRef((function(e,t){var n=e.drawState,u=e.otherStates,o=e.onChange,s=void 0===o?function(){}:o,c=e.drawCtrl,d=void 0===c?m:c,f=e.readonly,p=void 0!==f&&f,h=e.imgSrc,g=e.setActiveTool,x=void 0===g?function(){}:g,Z=n.width,k=n.height,b=d.mode,w=d.finger,S=d.lasso,y=d.eraserWidth,j=(0,l.useRef)(null),I=(0,l.useRef)(new(V().PaperScope)),C=(0,l.useState)([]),N=(0,i.Z)(C,2),R=N[0],P=N[1],T=H(),L=(0,i.Z)(T,2),J=L[0],Y=L[1],ue=H(),ie=(0,i.Z)(ue,2),oe=ie[0],se=ie[1],ce=H(),le=(0,i.Z)(ce,2),de=le[0],fe=le[1];(0,l.useEffect)((function(){var e=j.current,t=I.current;if(e)return t.setup(e),t.settings.handleSize=10,t.settings.hitTolerance=20,t.project.addLayer(new z),t.project.addLayer(new z),t.project.addLayer(new z),t.project.layers[2].activate(),new t.Tool,function(){t.remove(),(0,U.j)(e)}}),[]),(0,l.useEffect)((function(){var e=_(I.current,Z,k);return function(){e.remove()}}),[Z,k]);var pe=(0,F.Z)(j),ve=(0,i.Z)(pe,1)[0]/Z;(0,l.useEffect)((function(){if(ve){var e=I.current;return e.view.viewSize=new W(Z,k).multiply(ve),e.view.scale(ve,new B(0,0)),e.view.update(),function(){var t;null===(t=e.view)||void 0===t||t.scale(1/ve,new B(0,0))}}}),[Z,k,ve]),(0,l.useEffect)((function(){if(h){I.current.activate();var e=new Q(h);return e.project.layers[0].addChild(e),e.sendToBack(),e.onLoad=function(){e.view.update(),e.fitBounds(new(V().Rectangle)(0,0,Z,k)),e.bringToFront()},function(){null===e||void 0===e||e.remove()}}}),[h,Z,k]);var he=(0,l.useMemo)((function(){return u?D.Dw.mergeStates.apply(D.Dw,[n].concat((0,r.Z)(u))):n.getStrokeList()}),[n,u]);(0,l.useEffect)((function(){var e=[],t=I.current.project.layers[1];return I.current.activate(),he.forEach((function(r){var a=n.hasStroke(r.uid),u=X(r,t,!a);u&&a&&e.push(u)})),P(e),function(){t.removeChildren()}}),[he,n]);var me=(0,l.useRef)(),ge=(0,l.useState)(!1),xe=(0,i.Z)(ge,2),Ze=xe[0],ke=xe[1],be="select"===b&&Ze?"selected":b,we=(0,l.useState)([]),Se=(0,i.Z)(we,2),ye=Se[0],je=Se[1],Ie=(0,l.useMemo)((function(){var e=new Set(ye);return R.filter((function(t){return e.has(t.name)}))}),[R,ye]),Ce=(0,l.useCallback)((function(){ke(!1),Y(void 0),se(void 0),fe(void 0)}),[Y,se,fe]);(0,l.useEffect)((function(){if("select"===b)return Ce}),[b,Ce]),(0,l.useEffect)((function(){return Ce}),[S,Ce]),(0,l.useEffect)((function(){if(Ze)return function(){je([]),x("")}}),[Ze,x]);var De=function(){return Y(q(d))},Ne=function(e){return se(K(e.point))},Re={draw:De,erase:De,select:S?De:Ne,selected:function(e){if(S){if(null!==J&&void 0!==J&&J.contains(e.point))return;De(),ke(!1)}else{var t,n=null!==(t=null===oe||void 0===oe?void 0:oe.hitTest(e.point,{segments:!0}))&&void 0!==t?t:null===de||void 0===de?void 0:de.hitTest(e.point,{segments:!0,selected:!0});if(me.current=n,n)return;if(null!==oe&&void 0!==oe&&oe.contains(e.point))return;Ne(e),fe(void 0),ke(!1)}},text:function(e){var t,n=I.current.project.layers[1],r=null!==(t=re(n,e.point))&&void 0!==t?t:new(V().PointText)({point:e.point.add(new B(0,50)),content:"Insert text...",fontSize:50,justification:"center",fillColor:"#1890ff55"});_e(r)}}[be],Pe=function(e){null===J||void 0===J||J.add(e.point),null===J||void 0===J||J.smooth()},Te={draw:Pe,erase:Pe,select:S?Pe:function(e){if(oe){var t=e.point,n=t.x,r=t.y,a=(0,i.Z)(oe.segments,4),u=a[1],o=a[2],s=a[3];u.point.x=n,o.point=e.point,s.point.y=r}},selected:function(e){var t=me.current;if(null!==t&&void 0!==t&&t.segment&&oe){var n=t.segment;if(n.selected){var r=oe.bounds.center,a=n.point.subtract(r),u=e.point.subtract(r).angle-a.angle;oe.rotate(u,r),null===de||void 0===de||de.rotate(u,r),Ie.forEach((function(e){return null===e||void 0===e?void 0:e.rotate(u,r)}))}else{var i=n.point,o=n.next.next.point,s=i.subtract(o),c=e.point.subtract(o).project(s).x/s.x;if(c<0)return;oe.scale(c,o),null===de||void 0===de||de.scale(c,o),Ie.forEach((function(e){e.scale(c,o),e.strokeWidth*=c}))}}else Ie.forEach((function(t){return t.translate(e.delta)})),null===J||void 0===J||J.translate(e.delta),null===oe||void 0===oe||oe.translate(e.delta),null===de||void 0===de||de.translate(e.delta)},text:function(e){if(Xe&&!Xe.name){var t=Xe.bounds,n=t.topCenter,r=t.bottomRight.subtract(n),a=e.point.subtract(n).project(r).x/r.x;a<0||Xe.scale(a,n)}}}[be];(0,l.useEffect)((function(){I.current.tool.maxDistance=y}),[y]);var Ee=(0,l.useRef)(new Set),Ue=(0,l.useRef)(new Map),Oe="erase"===be?function(e){var t=I.current.project.layers[1];t.hitTestAll(e.point,{class:V().Path,stroke:!0,tolerance:y/2}).forEach((function(n){var r=n.item;if(r instanceof V().Path){for(var a=r;a.parent!==t&&a.parent instanceof V().PathItem;)a=a.parent;var u=a.name;if(d.pixelEraser){var i=(y+r.strokeWidth)/2,o=new M.Circle(e.point,i);o.remove();var s=r.subtract(o,{trace:!1});r.replaceWith(s),a===r&&(a=s),Ue.current.set(u,a)}else a.opacity=.5,a.guide=!0,Ee.current.add(u)}}))}:null,Fe={draw:function(){if(J&&!J.isEmpty()){J.simplify();var e=J.exportJSON();Y(void 0),s((function(t){return D.Dw.addStroke(t,e)}))}},erase:function(){if(Y(void 0),d.pixelEraser){var e=Array.from(Ue.current);Ue.current.clear();var t=e.map((function(e){var t=(0,i.Z)(e,2),n=t[0],r=t[1];return[n,ae(r).map((function(e){return e.exportJSON()}))]}));if(!t.length)return;s((function(e){return D.Dw.splitStrokes(e,t)}))}else{var n=Array.from(Ee.current);if(Ee.current.clear(),!n.length)return;s((function(e){return D.Dw.eraseStrokes(e,n)}))}},select:function(){var e;if(S){if(!J||Math.abs(J.area)<1e3)return Y(void 0);J.closePath(),J.simplify(),$(J),e=te(R,J)}else{if(!oe||Math.abs(oe.area)<1e3)return se(void 0);e=te(R,oe);var t=new M,n=oe.bounds.topCenter;t.add(n,n.subtract(new B(0,50))),t.lastSegment.selected=!0,fe(t)}ke(!0),je(e),x("select")},selected:function(){Ae()},text:function(){x("text")}}[be],Le=(0,l.useState)("auto"),Ve=(0,i.Z)(Le,2),Me=Ve[0],We=Ve[1];(0,l.useEffect)((function(){"text"===be||"select"===be?We("crosshair"):"selected"===be?We(S?"crosshair":"nwse-resize"):"draw"!==be&&"erase"!==be||We(function(e,t){var n=e.lineWidth,r=e.eraserWidth,a=t*("erase"===e.mode?r:n);if(a<5)return"crosshair";var u=a/2;return'url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" fill="%23FFF7" width="'.concat(a,'" height="').concat(a,'" viewBox="0 0 10 10"><circle cx="5" cy="5" r="5"/></svg>\') ').concat(u," ").concat(u,", auto")}(d,ve))}),[be,S,d,ve]);var Be={selected:function(e){var t,n=null!==(t=null===oe||void 0===oe?void 0:oe.hitTest(e.point,{segments:!0}))&&void 0!==t?t:null===de||void 0===de?void 0:de.hitTest(e.point,{segments:!0,selected:!0});if(null!==n&&void 0!==n&&n.segment){if(n.segment.selected)return We("url('data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgIHdpZHRoPSIxMjgiICBoZWlnaHQ9IjEyOCI+IDxkZWZzPiAJPGZpbHRlciBpZD0ic29mR2xvdyIgaGVpZ2h0PSIzMDAlIiB3aWR0aD0iMzAwJSIgeD0iLTc1JSIgeT0iLTc1JSI+IAkJPCEtLSBUaGlja2VuIG91dCB0aGUgb3JpZ2luYWwgc2hhcGUgLS0+IAk8ZmVNb3JwaG9sb2d5IG9wZXJhdG9yPSJkaWxhdGUiIHJhZGl1cz0iMyIgaW49IlNvdXJjZUFscGhhIiByZXN1bHQ9InRoaWNrZW4iIC8+IAkJPCEtLSBVc2UgYSBnYXVzc2lhbiBibHVyIHRvIGNyZWF0ZSB0aGUgc29mdCBibHVycmluZXNzIG9mIHRoZSBnbG93IC0tPgkJPGZlR2F1c3NpYW5CbHVyIGluPSJ0aGlja2VuIiBzdGREZXZpYXRpb249IjQiIHJlc3VsdD0iYmx1cnJlZCIgLz4JCTwhLS0gQ2hhbmdlIHRoZSBjb2xvdXIgLS0+CQk8ZmVGbG9vZCBmbG9vZC1jb2xvcj0icmdiKDI1NSwyNTUsMjU1KSIgcmVzdWx0PSJnbG93Q29sb3IiIC8+CQk8IS0tIENvbG9yIGluIHRoZSBnbG93cyAtLT4JCTxmZUNvbXBvc2l0ZSBpbj0iZ2xvd0NvbG9yIiBpbjI9ImJsdXJyZWQiIG9wZXJhdG9yPSJpbiIgcmVzdWx0PSJzb2Z0R2xvd19jb2xvcmVkIiAvPgkJPCEtLQlMYXllciB0aGUgZWZmZWN0cyB0b2dldGhlciAtLT4JCTxmZU1lcmdlPgkJCTxmZU1lcmdlTm9kZSBpbj0ic29mdEdsb3dfY29sb3JlZCIvPgkJCTxmZU1lcmdlTm9kZSBpbj0iU291cmNlR3JhcGhpYyIvPgkJPC9mZU1lcmdlPgk8L2ZpbHRlcj48L2RlZnM+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNjQgNjQpIHNjYWxlKDAuMjUpIj48ZyBmaWx0ZXI9InVybCgjc29mR2xvdykiPjxpbWFnZSB0cmFuc2Zvcm09InJvdGF0ZSgtMzYwKSIgeGxpbms6aHJlZj0iZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFLQUFBQUNnQkFNQUFBQjU0WG9lQUFBQUVsQk1WRVVBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQURnS3htaUFBQUFCblJTVGxNQS80Qk4yYWNwa1NDb0FBQUNvRWxFUVZSNG5PMlp6MDdETUF5SHl6cnVGTFo3TEhnQS90NkgyTzVNc1BkL0ZicHVTZE8waWUza3B3bEVmYlgyNlhQaXRLbFhWWFBNTWNjY2M4UmlnUVlTbUxkb3dFQUNBeGNOR0VoZ1lDdUlCUklZZUJTRUFna003QVNSUUFJRFQ0SkFJSUdCWjBFY2tNQkFLd2dERWhqb0JGRkFBZ043UVJDUXdFQlBFQU1rTU5BWGhBQUpEQndJSW9BRUJnNEZBVUFDQXdQQmNpQ0Z3UHFsRFp5Z2pkWDJrRWNOQlFleDB6TmpnazcwSGlsNHNueEVDbmJ4QlJYc0pMR0NiYXlsWmNzRTIxZ0ppV0pnczhhV0xDZktGWnNQdEdMemlWWmN3UlZsUlNzVUcxSHZqQlMzdTBNYjM5c0o0RzJXb2tzOGY0K0lKa2ZSUzlVUFFlNHVSM0dRcTkvTFZ6SEl2ZzZTbXd6Rk1Qdm1KM042Y1pRZUVET095emp0VnkzYkZ1NDZ0OWZXekYwNC9iMlcxY3hkaWErMU5iT1g5cjVvWWMzY1o0V25xSDY3Y1BtTlZuRTYzeXNLRjVIOWVIU3JLRnhFOXZOMnFWMUU3Z084Vm5ZaVB5SndOZDhJZ2R3UXc5VXNleEZVN0pqRjFTemRGWFlRNUE2MCtBYktqS3FlTE5Eb0ZLTlp0NGdiTVRBOTduT0xLTjVtYmlCcEYxRjYrQ3B1WkdwYlgzaFZ0TCtKSjYvVWZjT01uZDJ1S0lESndiamJGYzJuVUhKMHIyL0VLdjNuZ3QxbTZmT21pOVRmSC9hQnM5RUFVMkVQbjZLejAySDdSdEhaNlZpaWdmYlZwemtxbHdYYXp0YWN2Y3NDM1ZINVIwQjdtRldUbDc4TjNNL0FHYWlQMzkvWUZvamlsVDl0aEdNbjhYZUJkREptd0lweVFhR2lRbENrcUJFVUthb0VCWW82UVlHaVVwQlYxQXF5aW1wQlJsRXZ5Q2htQ0NZVmN3U1RpbG1DQ2NVOHdZUmlwbUJVTVZjd3FwZ3RHRkhNRjR3b0ZnaE9LcFlJVGlvV0NVNG9sZ2xPS0JZS2poUkxCVWVLeFlLQllybGdvR2dBUUY4UklUaFFOQkJncjRnUjlCUU5DR2dWVVlKTzBjQ0FKMFdjNEZuUkFJRkhSYVJncDJpZ3dJcXdncTJpU1NSL0FGRXZ2ZHRhSFRxZEFBQUFBRWxGVGtTdVFtQ0MiIHg9Ii00MCIgeT0iLTQwIiBoZWlnaHQ9IjgwIiB3aWR0aD0iODAiLz48L2c+PC9nPjwvc3ZnPg==') 64 64, auto");var r=n.segment.point,a=n.segment.next.next.point,u=r.subtract(a),i=u.x,o=u.y;We(i*o<0?"nesw-resize":"nwse-resize")}else null!==oe&&void 0!==oe&&oe.contains(e.point)||null!==J&&void 0!==J&&J.contains(e.point)?We("move"):We("crosshair")},text:function(e){var t=I.current.project.layers[1];re(t,e.point)?We("text"):We("crosshair")},select:null,draw:null,erase:null}[be];(0,l.useEffect)((function(){if(!p){var e=function(e){return function(t){if(I.current.activate(),e)return e(t)}},t=I.current,n=t.view,r=t.tool;n.onMouseDown=e(Re),n.onMouseDrag=e(Te),n.onMouseUp=e(Fe),n.onMouseMove=e(Be),r&&(r.onMouseDrag=e(Oe))}}));var Ae=function(){if(null!==Ie&&void 0!==Ie&&Ie.length){var e=Ie.map((function(e){return[e.name,e.exportJSON()]}));s((function(t){return D.Dw.mutateStrokes(t,e)}))}},Ge=function(){je([]),Ce(),ye.length&&s((function(e){return D.Dw.eraseStrokes(e,ye)}))},Qe=function(e){I.current.activate(),ne(Ie,e),Ae()},ze=function(){var e;I.current.activate();var t=null===(e=oe||J)||void 0===e?void 0:e.bounds.size;if(t&&Ie.length){var n=t.width,r=t.height,a=new B(n,r).divide(10),u=Ie.map((function(e){return e.clone()}));u.forEach((function(e){return e.translate(a)})),null===oe||void 0===oe||oe.translate(a),null===J||void 0===J||J.translate(a);var o=u.map((function(e){return[D.Dw.getUid(),e.exportJSON()]}));s((function(e){return D.Dw.mutateStrokes(e,o)})),je(o.map((function(e){return(0,i.Z)(e,1)[0]})))}},Je=function(){var e=new A(Ie);return e.addTo(I.current.project.layers[1]),e.rasterize({insert:!1}).toDataURL()},Ye=H(),He=(0,i.Z)(Ye,2),Xe=He[0],_e=He[1],Ke=(0,l.useCallback)((function(){_e(void 0),x("")}),[_e,x]);(0,l.useEffect)((function(){if("text"===b)return Ke}),[b,Ke]);var qe=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#000",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"center";if(Xe){Xe.content=e,Xe.fillColor=new G(t),Xe.justification=n;var r=Xe.exportJSON(),a=Xe.name;if(Ke(),!a)return s((function(e){return D.Dw.addStroke(e,r)}));s((function(e){return D.Dw.mutateStrokes(e,[[a,r]])}))}};(0,l.useImperativeHandle)(t,(function(){return{deleteSelected:Ge,duplicateSelected:ze,cancelText:Ke,submitText:qe,mutateStyle:Qe,rasterize:Je,pointText:Xe}})),(0,l.useEffect)((function(){var e=function(e){return e.preventDefault()};return document.addEventListener("gesturestart",e),document.addEventListener("gesturechange",e),document.addEventListener("gestureend",e),function(){document.removeEventListener("gesturestart",e),document.removeEventListener("gesturechange",e),document.removeEventListener("gestureend",e)}}),[]),(0,O.usePinch)((function(e){var t=e.memo,n=(0,i.Z)(e.offset,1)[0],r=e.first,a=e.last,u=e.origin;I.current.activate();var o,s,c,l=I.current.view,d=new B(u);if(r||!t){var f=j.current.getBoundingClientRect(),p=f.x,v=f.y;o=1,c=new B(p,v),s=d.subtract(c)}else{var h=(0,i.Z)(t,3);o=h[0],s=h[1],c=h[2]}var m=d.subtract(c),g=l.viewToProject(m);Math.abs(1-n)<.05&&(n=1);var x=r?1:n/o,b=a?10:1;x=Math.pow(x,1/b);!function e(){l.scale(x,g),--b>0?requestAnimationFrame(e):a&&ee(l,new W(Z,k))}();var w=m.subtract(s).divide(l.zoom);if(l.translate(w),!a)return[n,m,c]}),{scaleBounds:{max:10,min:.3},rubberband:.5,target:j});var $e=E(w);return(0,v.jsx)("div",(0,a.Z)((0,a.Z)({className:"draw-wrapper",style:{cursor:Me},"data-readonly":p},$e),{},{children:(0,v.jsx)("canvas",{ref:j,className:"draw-canvas"})}))}));J.displayName="Draw";var Y=l.memo(J);function H(){var e=(0,l.useState)(),t=(0,i.Z)(e,1)[0];return(0,l.useDebugValue)(t),(0,l.useEffect)((function(){return function(){null!==t&&void 0!==t&&t.name||null===t||void 0===t||t.remove()}}),[t]),e}var X=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.pathData,a=e.uid;try{var u=t.importJSON(r);if(!u)return;return u.name=a,u.guide=n,u}catch(i){console.error(i)}},_=function(e,t,n){e.activate();var r=new M.Rectangle(new B(0,0),new B(t,n));return r.fillColor=new G("#fff"),e.project.layers[0].addChild(r),r},K=function(e){var t=new M.Rectangle(e,new W(0,0));return t.onFrame=function(){},t.selected=!0,t},q=function(e){var t=e.mode,n=e.lineWidth,r=e.eraserWidth,a=e.color,u=e.highlight,i=new M;"erase"===t&&(a="#ccc",n=r),"select"===t&&(a="#1890ff",n=5);var o=new G(a);return(u||"erase"===t)&&(o.alpha=.5,i.blendMode="multiply"),i.strokeColor=o,i.strokeWidth=n,i.strokeJoin="round",i.strokeCap="round",i.guide=!0,i},$=function(e){e.dashOffset=0,e.dashArray=[30,20],e.onFrame=function(){return e.dashOffset+=3}},ee=function(e,t){var n=function(e,t){var n=e.center,r=n.x,a=n.y,u=e.size,i=u.width,o=u.height,s=t.width,c=t.height,l=Math.min(i,s)/2,d=Math.min(o,c)/2,f=s-l,p=c-d;return[r<l?l-r:r>f?f-r:0,a<d?d-a:a>p?p-a:0]}(e,t),r=(0,i.Z)(n,2),a=r[0],u=r[1],o=10,s=new B(a,u).divide(-o);!function t(){e.translate(s),--o>0&&requestAnimationFrame(t)}()},te=function(e,t){var n=function(e){var n=e.subtract(t,{insert:!1,trace:!1});return n.remove(),!n.compare(e)};return e.filter((function(e){if(!e.name)return!1;if(!e.bounds.intersects(t.bounds))return!1;if(e instanceof V().Path)return n(e);var r=new M.Rectangle(e.bounds);return r.remove(),n(r)||t.isInside(e.bounds)})).map((function(e){return e.name}))},ne=function(e,t){var n=t.lineWidth,r=t.color,a=t.highlight;e.forEach((function(e){if(e instanceof V().PointText&&r){var t=new G(r);e.fillColor=t}if(e instanceof V().Path){if(r){var u=new G(r);"multiply"===e.blendMode&&(u.alpha=.5),e.strokeColor=u}n&&(e.strokeWidth=n),e.strokeColor&&void 0!==a&&(e.strokeColor.alpha=a?.5:1,e.blendMode=a?"multiply":"normal")}}))},re=function(e,t){var n=e.hitTest(t,{class:V().PointText,fill:!0});return null===n||void 0===n?void 0:n.item},ae=function e(t){return t instanceof V().Path?t.isEmpty()?[]:[t]:t instanceof V().CompoundPath?t.children.map(e).flat():[]},ue=n(75783),ie=n(87309),oe=n(50419),se=n(79286),ce=function(){var e=(0,l.useContext)($t).addFinalPage;return(0,v.jsx)("div",{className:"add-btn-wrapper",children:(0,v.jsx)(ie.Z,{type:"dashed",icon:(0,v.jsx)(se.Z,{}),block:!0,onClick:e,children:"New page"})})},le=n(16871),de=n(64239),fe=n(61507),pe=n(23414),ve=n(82622),he=n(72785),me=n(22925),ge=n(4720),xe=n(41275),Ze=n(89267),ke=n(69228),be=n(87501),we=n(89295),Se=n(4942),ye=n(80202),je=n(96272),Ie=n(78985),Ce=n(74115),De=(0,n(92721).Z)({scriptUrl:"//at.alicdn.com/t/font_3181679_yo844n7qgns.js"}),Ne=function(e){var t=e.updateDrawCtrl,n=e.drawCtrl,r=n.highlight,a=n.color,u=(0,l.useState)(!1),o=(0,i.Z)(u,2),s=o[0],c=o[1];return(0,v.jsxs)("div",{className:"pen-panel","data-blur":s,"data-hi":r,children:[(0,v.jsxs)("div",{className:"pen-status",children:[(0,v.jsx)(Re,{updateDrawCtrl:t,drawCtrl:n,setPanelBlur:c}),(0,v.jsx)(Pe,{checked:r,updateDrawCtrl:t})]}),(0,v.jsx)(Te,{color:a||"",setColor:function(e){return t({color:e})}})]})},Re=function(e){var t,n,a=e.updateDrawCtrl,u=e.drawCtrl,o=e.setPanelBlur,s=void 0===o?function(){}:o,c=e.field,d=void 0===c?"lineWidth":c,f=u[d],p=null!==(t=u.widthList)&&void 0!==t?t:h,m="lineWidth"===d&&null!==(n=u.color)&&void 0!==n?n:"#aaa",g=(0,l.useMemo)((function(){return p.indexOf(null!==f&&void 0!==f?f:-1)}),[f,p]),x=(0,l.useState)((0,N.aV)([!1,!1,!1,!1])),Z=(0,i.Z)(x,2),k=Z[0],b=Z[1];(0,l.useEffect)((function(){k.includes(!0)?s(!0):s(!1)}),[k,s]);var w=function(e){return{"--real-size":"calc(".concat(100/D.mF,"vw * ").concat(e,")")}},S=[{value:-1,label:null}].concat((0,r.Z)(p.map((function(e,t){return{value:t,label:(0,v.jsx)(ke.Z,{visible:k.get(t),onVisibleChange:function(e){return b((function(n){return n.set(t,e)}))},trigger:g===t?["click"]:[],placement:"bottom",destroyTooltipOnHide:!0,content:(0,v.jsx)(je.Z,{min:5,max:100,className:"ctrl-slider",defaultValue:e,onAfterChange:function(e){if(p.includes(e))return b((function(e){return e.set(t,!1)})),a((0,Se.Z)({},d,e));var n=p.slice();n[t]=e,a((0,Se.Z)({widthList:n},d,e))}}),children:(0,v.jsx)("div",{className:"circle-wrapper",style:w(e),children:(0,v.jsx)(ye.W,{className:"width-circle "+d,color:m})})})}}))));return(0,v.jsx)(Ie.Z,{className:"width-seg",value:g,options:S,onChange:function(e){var t;return a((0,Se.Z)({},d,null!==(t=p[+e])&&void 0!==t?t:10))}})},Pe=function(e){var t=e.checked,n=void 0!==t&&t,r=e.updateDrawCtrl;return(0,v.jsxs)("label",{className:"hi-wrapper",children:[(0,v.jsx)("input",{type:"checkbox",name:"highlight",checked:n,onChange:function(e){return r({highlight:e.target.checked})}}),(0,v.jsx)("div",{className:"hi-switch",children:(0,v.jsx)(De,{type:"icon-Highlight"})})]})},Te=function(e){var t=e.setColor,n=e.color,r=(0,S.iX)(),a=(0,i.Z)(r,1)[0];return(0,v.jsx)("div",{className:"color-select","data-force-light":a,children:Ce.Qk.map((function(e){return(0,v.jsxs)("label",{children:[(0,v.jsx)("input",{checked:n===e,type:"radio",name:"color",onChange:function(n){return n.target.checked&&t(e)}}),(0,v.jsx)("div",{"data-color":e,className:"circle",style:{backgroundColor:e,borderColor:e}})]},e)}))})},Ee=n(66023),Ue=n(54164),Oe=n(64802),Fe=function(e){var t=e.drawRef,n=e.visible;return(0,v.jsx)(we.Z,{timeout:300,in:n,unmountOnExit:!0,children:(0,v.jsx)(Le,{drawRef:t})})},Le=function(e){var t=e.drawRef,n={type:"text",shape:"round",size:"small"},r=(0,l.useState)({}),u=(0,i.Z)(r,2),o=u[0],s=u[1];return(0,Ue.createPortal)((0,v.jsxs)("div",{className:"select-tool",children:[(0,v.jsx)(ke.Z,{trigger:"click",placement:"bottom",getPopupContainer:function(e){return e.parentElement},destroyTooltipOnHide:!0,content:(0,v.jsx)(Ne,{updateDrawCtrl:function(e){var n;s((function(t){return(0,a.Z)((0,a.Z)({},t),e)})),null===(n=t.current)||void 0===n||n.mutateStyle(e)},drawCtrl:o}),children:(0,v.jsx)(ie.Z,(0,a.Z)({icon:(0,v.jsx)(fe.Z,{})},n))}),(0,v.jsx)(ie.Z,(0,a.Z)({icon:(0,v.jsx)(pe.Z,{}),onClick:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.duplicateSelected()}},n)),(0,v.jsx)(ie.Z,(0,a.Z)({icon:(0,v.jsx)(de.Z,{}),onClick:function(){if(t.current){var e=t.current.rasterize();Ze.Z.confirm({title:"Screenshot",content:(0,v.jsx)("img",{className:"raster",src:e,alt:"raster"}),className:"raster-modal",icon:(0,v.jsx)(de.Z,{}),okText:"Save",onOk:function(){return(0,Oe.saveAs)(e,"screenshot")}})}}},n)),(0,v.jsx)(ie.Z,(0,a.Z)({danger:!0,icon:(0,v.jsx)(ve.Z,{}),onClick:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.deleteSelected()}},n))]}),document.querySelector(".reader.container > header"))},Ve=function(e){var t=e.visible,n=e.drawRef,r=(0,l.useState)(""),a=(0,i.Z)(r,2),u=a[0],o=a[1],s=(0,l.useState)(Ce.Qk[0]),c=(0,i.Z)(s,2),d=c[0],f=c[1],p=(0,l.useState)("center"),h=(0,i.Z)(p,2),m=h[0],g=h[1],x=(0,S.iX)(),Z=(0,i.Z)(x,1)[0];(0,l.useEffect)((function(){var e,r=null===(e=n.current)||void 0===e?void 0:e.pointText;if(r&&t){var a,u=r.name,i=r.content,s=r.justification,c=r.fillColor;if(g(s),u)o(i),f(null!==(a=null===c||void 0===c?void 0:c.toCSS(!0))&&void 0!==a?a:Ce.Qk[0]);else o(""),f(Ce.Qk[0])}}),[t,n]);var k=(0,v.jsx)(ke.Z,{content:(0,v.jsx)(Te,{color:d,setColor:f}),overlayStyle:{width:200},placement:"bottom",getPopupContainer:function(e){return e.parentElement},children:(0,v.jsx)(ie.Z,{size:"small",icon:(0,v.jsx)(he.Z,{className:"font-icon",style:{color:d}})})}),b=(0,v.jsx)(be.ZP.Group,{size:"small",optionType:"button",value:m,buttonStyle:"solid",onChange:function(e){return g(e.target.value)},options:[{label:(0,v.jsx)(me.Z,{}),value:"left"},{label:(0,v.jsx)(ge.Z,{}),value:"center"},{label:(0,v.jsx)(xe.Z,{}),value:"right"}]});return(0,v.jsxs)(Ze.Z,{visible:t,title:"Insert text",onCancel:function(){var e;return null===(e=n.current)||void 0===e?void 0:e.cancelText()},onOk:function(){var e,t,r=u.trim();if(!r)return null===(e=n.current)||void 0===e?void 0:e.cancelText();null===(t=n.current)||void 0===t||t.submitText(r,d,m)},bodyStyle:{paddingTop:0},destroyOnClose:!0,children:[(0,v.jsxs)("div",{className:"insert-option","data-force-light":Z,children:[k,b]}),(0,v.jsx)(Ee.Z,{size:"large",rows:3,autoFocus:!0,value:u,onChange:function(e){return o(e.target.value)}})]})},Me=n(79930),We=n(82898),Be=n(85168),Ae=n(58826),Ge=n(58105),Qe=n(37762);var ze=function(e,t){var n,r="",a=0,u=(0,Qe.Z)(t);try{for(u.s();!(n=u.n()).done;){var i=n.value,o=e.get(i);if(o){if(1===o)return i;o>a&&(r=i,a=o)}}}catch(s){u.e(s)}finally{u.f()}return r};function Je(e,t,n){var r=e.indexOf(t),a=e.slice();return-1===r||a.splice(r+1,0,n),a}var Ye=n(52242),He=n(65323),Xe=function(e){var t=e.saved,n=e.instantSave,r=(0,le.s0)();return(0,v.jsxs)("div",{className:"left",children:[(0,v.jsx)(ie.Z,{type:"text",onClick:(0,o.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n();case 2:r("/");case 3:case"end":return e.stop()}}),e)}))),icon:(0,v.jsx)(Ye.Z,{style:{opacity:.8}})}),(0,v.jsx)(ie.Z,{type:"text",className:"save",onClick:n,disabled:t,icon:(0,v.jsx)(He.Z,{})})]})},_e=n(78030),Ke=n(50446),qe=n(74006),$e=n(52542),et=n(62),tt=n(14965),nt=function(e){var t=e.handleUndo,n=e.handleRedo,r=(0,l.useContext)(qt).stateSet,a=k(),u=a.mode,o=a.finger,s=b(),c=(0,S.iX)(),d=(0,i.Z)(c,2),f=d[0],p=d[1];return(0,v.jsxs)("div",{className:"middle",children:[(0,v.jsx)(ie.Z,{type:"text",shape:"circle",icon:(0,v.jsx)(_e.Z,{}),onClick:t,disabled:!(null!==r&&void 0!==r&&r.isUndoable())}),(0,v.jsx)(ie.Z,{type:"text",shape:"circle",icon:(0,v.jsx)(Ke.Z,{}),onClick:n,disabled:!(null!==r&&void 0!==r&&r.isRedoable())}),(0,v.jsx)(ie.Z,{type:o?"default":"text",shape:"circle",onClick:function(){s({finger:!o}),oe.ZP.destroy("FINGER"),oe.ZP.open({content:o?"Pencil only":"Draw with finger",key:"FINGER"})},icon:(0,v.jsx)(De,{type:"icon-finger"})}),(0,v.jsx)(ie.Z,{className:"force-light-btn",type:"text",shape:"circle",icon:f?(0,v.jsx)(qe.Z,{}):(0,v.jsx)($e.Z,{}),onClick:function(){return p((function(e){return!e}))}}),(0,v.jsx)(rt,{}),(0,v.jsx)(at,{}),(0,v.jsx)(ie.Z,{type:"text"===u?"default":"text",shape:"circle",onClick:function(){return s({mode:"text"})},icon:(0,v.jsx)(De,{type:"icon-text1"})}),(0,v.jsx)(ut,{})]})},rt=function(){var e=k(),t=b(),n={shape:"circle",icon:(0,v.jsx)(et.Z,{})};return"draw"===e.mode?(0,v.jsx)(ke.Z,{content:(0,v.jsx)(Ne,{updateDrawCtrl:t,drawCtrl:e}),trigger:"click",placement:"bottom",getPopupContainer:function(e){return e.parentElement},destroyTooltipOnHide:!0,children:(0,v.jsx)(ie.Z,(0,a.Z)({type:"default"},n))}):(0,v.jsx)(ie.Z,(0,a.Z)({type:"text",onClick:function(){return t({mode:"draw"})}},n))},at=function(){var e=k(),t=e.mode,n=e.pixelEraser,r=b(),u={shape:"circle",icon:(0,v.jsx)(De,{type:"icon-eraser"})};return"erase"===t?(0,v.jsx)(ke.Z,{content:(0,v.jsxs)("div",{className:"width-seg-wrapper",children:[(0,v.jsx)(Ie.Z,{block:!0,size:"small",className:"pixel-seg",options:["Pixel","Object"],value:n?"Pixel":"Object",onChange:function(e){r("Pixel"===e?{pixelEraser:!0}:{pixelEraser:!1})}}),(0,v.jsx)(Re,{drawCtrl:e,updateDrawCtrl:r,field:"eraserWidth"})]}),trigger:"click",placement:"bottom",getPopupContainer:function(e){return e.parentElement},destroyTooltipOnHide:!0,children:(0,v.jsx)(ie.Z,(0,a.Z)({type:"default"},u))}):(0,v.jsx)(ie.Z,(0,a.Z)({type:"text",onClick:function(){return r({mode:"erase"})}},u))},ut=function(){var e=k(),t=e.lasso,n=e.mode,r=b(),a=t?(0,v.jsx)(De,{type:"icon-lasso1"}):(0,v.jsx)(tt.Z,{});return"select"===n?(0,v.jsx)(ie.Z,{type:"default",shape:"circle",icon:a,onClick:function(){return r({lasso:!t})}}):(0,v.jsx)(ie.Z,{type:"text",shape:"circle",icon:a,onClick:function(){return r({mode:"select"})}})},it=n(49142),ot=n(90785),st=n(91333),ct=n(75594),lt=n(95055),dt=n(67415),ft=n(91511),pt=n(69951),vt=n(10711),ht=n(53621),mt=n(75797),gt=n(18780),xt=n(52365),Zt=n(76586),kt=n(70140),bt=n(87661),wt=n(88894),St=function(e){var t=e.userID,n=e.size,r=void 0===n?"default":n,a=e.onClick,u=void 0===a?function(){}:a,i=e.chosen,o=void 0!==i&&i,s=e.className,c=(0,l.useContext)(ft.TeamCtx).userRec,d=(0,l.useMemo)((function(){return(0,Ce.bM)(t)}),[t]),f=c[t];if(!f)return null;var p=f.userName;return(0,v.jsx)(Zt.C,{className:s,"data-chosen":o,size:r,style:{backgroundColor:d},children:(0,v.jsx)("div",{className:"avatar-wrapper",onClick:u,children:null===p||void 0===p?void 0:p.slice(0,3)})})},yt=n(81694),jt=n.n(yt),It=function(){var e=(0,l.useContext)(qt),t=e.pageOrder,n=e.currPageID,r=(0,l.useContext)($t),u=r.scrollPage,o=r.saveReorder,s=(0,S.iX)(),c=(0,i.Z)(s,1)[0],d=(0,xt.zI)(),f=(0,i.Z)(d,1)[0],p=(0,l.useRef)({}),h={ALL:"All Pages",MARKED:"Bookmarks",WRITTEN:"Notes"}[f];return(0,l.useEffect)((function(){var e;return null===(e=p.current[n])||void 0===e?void 0:e.scrollIntoView()}),[]),(0,v.jsxs)("div",{className:"preview-container","data-force-light":c,children:[(0,v.jsx)(Pt,{}),(0,v.jsx)("h3",{children:h}),(0,v.jsx)(gt.Z5,{onDragEnd:function(e){var n=e.source,r=e.destination;if(r&&t){var a=n.index,s=r.index;if(a!==s){var c=t[a],l=function(e,t,n){var r=e.slice(),a=r.splice(t,1),u=(0,i.Z)(a,1)[0];return r.splice(n,0,u),r}(t,a,s);o(l,!0),requestAnimationFrame((function(){return u(c)}))}}},children:(0,v.jsx)(gt.bK,{droppableId:"preview-list",children:function(e){var n=e.droppableProps,r=e.innerRef,u=e.placeholder;return(0,v.jsxs)("div",(0,a.Z)((0,a.Z)({className:"page-list",ref:r},n),{},{children:[null===t||void 0===t?void 0:t.map((function(e,t){return(0,v.jsx)(Ct,{uid:e,pageIndex:t,refRec:p.current},e)})),u,"ALL"===f&&(0,v.jsx)(ce,{})]}))}})})]})},Ct=function(e){var t=e.uid,n=e.pageIndex,r=e.refRec,u=(0,l.useContext)(qt),o=u.stateSet,s=u.pageRec,c=u.currPageID,d=(0,l.useContext)(ft.TeamCtx).teamState,f=(0,l.useContext)($t).scrollPage,p=(0,xt.zI)(),h=(0,i.Z)(p,1)[0],m=(0,l.useState)(""),g=(0,i.Z)(m,2),x=g[0],Z=g[1],k=null===s||void 0===s?void 0:s.get(t),b=null===o||void 0===o?void 0:o.getOneState(t),w=null===d||void 0===d?void 0:d.getOnePageStateMap(t);if(!k||!b)return null;var S=k.image,y=k.marked;if("WRITTEN"===h&&b.isEmpty()&&(!w||w.every((function(e){return e.isEmpty()}))))return null;if("MARKED"===h&&!y)return null;var j=c===t;return(0,v.jsx)(gt._l,{draggableId:t,index:n,isDragDisabled:"ALL"!==h,children:function(e,u){var i=e.innerRef,o=e.draggableProps,s=e.dragHandleProps,c=u.isDragging;return(0,v.jsxs)("div",(0,a.Z)((0,a.Z)((0,a.Z)({ref:function(e){i(e),e&&(r[t]=e)},className:"page","data-curr":j,"data-dragged":c,onClick:function(){return f(t)}},o),s),{},{children:[(0,v.jsx)(nn,{drawState:(null===w||void 0===w?void 0:w.get(x))||b,teamStateMap:x?void 0:w,thumbnail:S,preview:!0}),(0,v.jsx)(Dt,{uid:t,index:n,chosen:x,setChosen:Z})]}))}})},Dt=function(e){var t=e.uid,n=e.index,r=e.chosen,a=e.setChosen,u=(0,l.useContext)($t).switchPageMarked,i=(0,l.useContext)(qt).pageRec,o=(0,l.useContext)(ft.TeamCtx),s=o.ignores,c=o.teamState,d=(0,l.useMemo)((function(){return(null===c||void 0===c?void 0:c.getPageValidUsers(t).filter((function(e){return!s.has(e)})))||[]}),[c,s,t]),f=null===i||void 0===i?void 0:i.get(t);if(!f)return null;var p=f.marked;return(0,v.jsxs)("div",{className:"tools",onClick:function(e){return e.stopPropagation()},children:[(0,v.jsx)("span",{className:"bookmark","data-marked":p,onClick:function(){return u(t)}}),(0,v.jsx)("span",{className:"index",children:n+1}),(0,v.jsx)(Rt,{uid:t}),(0,v.jsx)(Nt,{userIDs:d,chosen:r,setChosen:a})]})},Nt=function(e){var t=e.userIDs,n=e.chosen,r=e.setChosen;return(0,v.jsx)(Zt.C.Group,{maxCount:2,size:"default",className:jt()("team-group",{chosen:n}),maxPopoverPlacement:"bottom",children:t.map((function(e){return(0,v.jsx)(St,{size:"default",userID:e,className:"preview-avatar",chosen:n===e,onClick:function(){return r((function(t){return t===e?"":e}))}},e)}))})},Rt=function(e){var t=e.uid,n=(0,l.useContext)($t),r=n.addPage,a=n.deletePage,u=(0,v.jsx)(kt.Z,{onClick:function(e){var n=e.key;"ADD"===n?r(t):"COPY"===n?r(t,!0):"DELETE"===n&&a(t)},items:[{key:"ADD",icon:(0,v.jsx)(se.Z,{}),label:"Add page"},{key:"COPY",icon:(0,v.jsx)(pe.Z,{}),label:"Duplicate"},{key:"DELETE",icon:(0,v.jsx)(ve.Z,{}),label:"Delete",danger:!0}]});return(0,v.jsx)(ke.Z,{content:u,trigger:"click",placement:"left",destroyTooltipOnHide:!0,children:(0,v.jsx)("span",{className:"option",children:(0,v.jsx)(vt.Z,{})})})},Pt=function(){var e=(0,xt.zI)(),t=(0,i.Z)(e,2),n=t[0],r=t[1],a=bt.Z.TabPane;return(0,v.jsxs)(bt.Z,{className:"tabs",activeKey:n,onChange:r,tabBarGutter:10,size:"small",centered:!0,children:[(0,v.jsx)(a,{tab:(0,v.jsx)(De,{type:"icon-uf_paper"})},"ALL"),(0,v.jsx)(a,{tab:(0,v.jsx)(De,{type:"icon-bookmark2"})},"MARKED"),(0,v.jsx)(a,{tab:(0,v.jsx)(De,{type:"icon-write"})},"WRITTEN")]})};function Tt(){var e=(0,l.useState)(!1),t=(0,i.Z)(e,2),n=t[0],r=t[1];return(0,v.jsxs)(xt.s2,{initKey:"ALL",children:[(0,v.jsx)(ie.Z,{type:"text",icon:n?(0,v.jsx)(ht.Z,{}):(0,v.jsx)(mt.Z,{}),onClick:function(){return r((function(e){return!e}))}}),(0,v.jsx)(wt.Z,{visible:n,onClose:function(){return r(!1)},width:200,closable:!1,zIndex:800,className:"preview-drawer",bodyStyle:{padding:0,overflow:"hidden"},headerStyle:{textAlign:"center"},destroyOnClose:!0,children:(0,v.jsx)(It,{})})]})}var Et=n(67575),Ut=n(30501),Ot=n(98272),Ft=n(24215),Lt=n(17973),Vt=n(19951),Mt=n(23605),Wt=n(56200),Bt=n(18301),At=n(51570),Gt=n(1829),Qt=n.n(Gt),zt=function(e){var t=e.instantSave,n=(0,l.useContext)(ft.TeamCtx).teamOn;return(0,v.jsxs)("div",{className:"right",children:[n?(0,v.jsx)(Yt,{}):(0,v.jsx)(Ht,{instantSave:t}),(0,v.jsx)(Tt,{})]})},Jt=function(e){var t=e.userID,n=(0,l.useState)(!1),r=(0,i.Z)(n,2),a=r[0],u=r[1],o=(0,l.useContext)(ft.TeamCtx),s=o.ignores,c=o.setIgnores,d=o.resetIO,f=o.userRec[t];if((0,l.useEffect)((function(){return u(!1)}),[f]),!f)return null;var p=f.userName,h=f.online,m=t===(0,pt.VN)(),g=s.has(t)&&!m;return(0,v.jsxs)("div",{className:"user-item","data-online":h,children:[(0,v.jsx)(St,{userID:t,size:"small",className:"room-avatar"}),a||(0,v.jsx)("span",{className:"user-name",children:p}),a&&(0,v.jsx)(lt.Z,{autoFocus:!0,className:"rename-input",defaultValue:p,onSearch:function(e){var t=e.trim();if(!t||t===p)return u(!1);(0,pt.lu)(t),d()},enterButton:(0,v.jsx)(ie.Z,{icon:(0,v.jsx)(Et.Z,{})})}),m?a||(0,v.jsx)(ie.Z,{type:"text",icon:(0,v.jsx)(Ut.Z,{}),onClick:function(){return u(!0)}}):(0,v.jsx)(ie.Z,{type:"text",icon:g?(0,v.jsx)(Ot.Z,{}):(0,v.jsx)(Ft.Z,{}),onClick:function(){c((function(e){return e.has(t)?e.delete(t):e.add(t)}))}})]})},Yt=function(){var e=(0,l.useContext)(ft.TeamCtx),t=e.code,n=e.userRec,a=e.connected,s=e.loadInfo,d=e.loadState,f=e.resetIO,p=(0,l.useContext)(qt).noteInfo,h=window.location.href,m=function(){var e=(0,o.Z)(c().mark((function e(){var t,r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null===(t=n[(0,pt.VN)()])||void 0===t?void 0:t.userName,e.prev=1,p){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,Qt()("".concat(p.name," - ").concat(r," - Multibility\n").concat(h));case 6:oe.ZP.destroy("copy"),oe.ZP.success({content:"Link copied!",icon:(0,v.jsx)(pe.Z,{}),key:"copy"}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),console.log(e.t0);case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(){return e.apply(this,arguments)}}(),g=(0,l.useMemo)((function(){var e=(0,pt.VN)(),t=n[e],a=(0,u.Z)(n,[e].map(it.Z)),i=t?[t]:[],o=Object.values(a);return i.push.apply(i,(0,r.Z)(o.filter((function(e){return e.online}))).concat((0,r.Z)(o.filter((function(e){return!e.online}))))),i}),[n]),x=(0,l.useMemo)((function(){return g.filter((function(e){return e.online})).length}),[g]),Z=(0,v.jsxs)("div",{className:"team-popover",children:[a||(0,v.jsx)(ot.Z,{className:"disconn-alert",message:"Network failed.",icon:(0,v.jsx)(Lt.Z,{}),type:"error",showIcon:!0,banner:!0}),(0,v.jsx)(dt.GD,{className:"code-display",value:String(t),length:4,plain:!0}),(0,v.jsx)(ie.Z,{icon:(0,v.jsx)(Vt.Z,{}),className:"share-btn",onClick:m,block:!0,children:"Share"}),(0,v.jsx)(st.Z,{}),(0,v.jsx)("div",{className:"user-list",children:g.map((function(e){return(0,v.jsx)(Jt,{userID:e.userID},e.userID)}))})]}),k=(0,l.useState)(!1),b=(0,i.Z)(k,2),w=b[0],S=b[1],y=(0,v.jsxs)("div",{className:"team-title",children:[(0,v.jsx)("span",{children:"Team info"}),(0,v.jsx)(ie.Z,{shape:"circle",type:"text",size:"small",loading:w,icon:(0,v.jsx)(Mt.Z,{}),onClick:(0,o.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S(!0),e.next=3,s();case 3:return e.next=5,d();case 5:S(!1),f();case 7:case"end":return e.stop()}}),e)})))})]});return(0,v.jsx)(ke.Z,{content:Z,trigger:"click",placement:"bottomRight",title:y,getPopupContainer:function(e){return e.parentElement},children:(0,v.jsx)(ie.Z,{type:"text",icon:(0,v.jsx)(ct.Z,{status:a?"success":"error",count:a?x:"!",size:"small",children:(0,v.jsx)(Wt.Z,{})})})})},Ht=function(e){var t=e.instantSave,n=(0,l.useContext)(qt).noteID,r=(0,le.s0)(),a=function(){var e=(0,o.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t();case 2:return e.next=4,(0,At.r8)(n);case 4:if(e.sent){e.next=7;break}return e.abrupt("return",oe.ZP.error("Can't create room."));case 7:return e.next=9,(0,ue.SP)(n,{team:!0});case 9:r("/team/"+n);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,v.jsx)(ie.Z,{type:"text",icon:(0,v.jsx)(Bt.Z,{}),onClick:function(){Ze.Z.confirm({title:"Enable team editing",content:"This will make your note public.",icon:(0,v.jsx)(Wt.Z,{style:{color:"#555"}}),onOk:a})}})};function Xt(e){var t=e.saved,n=e.handleUndo,r=e.handleRedo,a=e.instantSave;return(0,v.jsxs)("header",{children:[(0,v.jsx)(Xe,{saved:t,instantSave:a}),(0,v.jsx)(nt,{handleUndo:n,handleRedo:r}),(0,v.jsx)(zt,{instantSave:a})]})}var _t=["pageRec","pdf","pageOrder"],Kt=["image","marked"],qt=l.createContext({noteID:"",currPageID:""}),$t=l.createContext({scrollPage:function(e){},switchPageMarked:function(e){},addPage:function(e,t){},addFinalPage:function(){},deletePage:function(e){},saveReorder:function(){var e=(0,o.Z)(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()});function en(){var e,t=null!==(e=(0,le.UO)().noteID)&&void 0!==e?e:"",n=(0,le.s0)(),s=(0,l.useState)(),f=(0,i.Z)(s,2),h=f[0],m=f[1],g=(0,l.useState)(),x=(0,i.Z)(g,2),Z=x[0],k=x[1],b=(0,l.useState)(),I=(0,i.Z)(b,2),C=I[0],R=I[1],P=(0,l.useState)(),E=(0,i.Z)(P,2),U=E[0],O=E[1],F=(0,y.Z)(!0),L=(0,i.Z)(F,2),V=L[0],M=L[1],W=(0,l.useContext)(ft.TeamCtx),B=W.io,A=W.teamOn,G=W.addTeamStatePage,Q=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=(0,l.useState)((0,N.D5)()),r=(0,i.Z)(n,2),a=r[0],u=r[1],s=(0,l.useRef)(!1),d=(0,l.useState)(""),f=(0,i.Z)(d,2),v=f[0],h=f[1],m=(0,l.useState)((0,N.D5)()),g=(0,i.Z)(m,2),x=g[0],Z=g[1],k=(0,l.useMemo)((function(){return ze(x,t)}),[x,t]);return(0,l.useDebugValue)(k),(0,l.useEffect)((function(){(0,o.Z)(c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p().getItem("SCROLL_".concat(e));case 2:if(n=t.sent){t.next=5;break}return t.abrupt("return",s.current=!0);case 5:h(n);case 6:case"end":return t.stop()}}),t)})))()}),[e]),(0,l.useEffect)((function(){!s.current&&a.has(v)&&requestAnimationFrame((function(){var e;null===(e=a.get(v))||void 0===e||e.scrollIntoView(),s.current=!0}))}),[v,a]),(0,l.useEffect)((function(){s.current&&p().setItem("SCROLL_".concat(e),k)}),[e,k]),{scrollPage:function(e){var t;null===(t=a.get(e))||void 0===t||t.scrollIntoView()},setInviewRatios:Z,sectionRef:function(e){return function(t){t&&u((function(n){return n.set(e,t)}))}},currPageID:k}}(t,U),z=Q.setInviewRatios,J=Q.scrollPage,Y=Q.sectionRef,H=Q.currPageID;(0,l.useEffect)((function(){(0,o.Z)(c().mark((function e(){var r,a,i,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,ue.U9)(t);case 2:if(r=e.sent){e.next=6;break}return oe.ZP.error("Note not found"),e.abrupt("return",n("/"));case 6:a=r.pageRec,r.pdf,i=r.pageOrder,o=(0,u.Z)(r,_t),m((0,N.D5)(a)),O(i),k(o),R(T.createFromPages(a));case 11:case"end":return e.stop()}}),e)})))()}),[n,t,A]),(0,l.useEffect)((function(){Z&&(document.title=Z.name+" - Multibility")}),[Z]);var X=(0,j.Z)((0,o.Z)(c().mark((function e(){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null===h||void 0===h?void 0:h.toObject(),e.next=3,(0,ue.SP)(t,{pageRec:n});case 3:M(!0);case 4:case"end":return e.stop()}}),e)})))),_=(0,l.useCallback)((0,Me.Z)(X,2e3),[X]),K=_.flush,q=function(e,t){m((function(n){return null===n||void 0===n?void 0:n.update(e,d.BJ,t)})),M(!1),_()},$=function(){var e=(0,o.Z)(c().mark((function e(n){var r,a=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]&&a[1],O(n),e.next=4,(0,ue.SP)(t,{pageOrder:n});case 4:return e.next=6,K();case 6:r&&ee(n);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ee=function(e){return null===B||void 0===B?void 0:B.emit("reorder",{pageOrder:e})},te=(0,j.Z)((function(e){var t,n=e.deleted,r=e.pageOrder,a=e.prevOrder;($(r),n)&&(t=function(){return $(a,!0)},oe.ZP.warning({content:(0,v.jsxs)(v.Fragment,{children:["One page was deleted.",(0,v.jsx)(ie.Z,{size:"small",type:"link",onClick:function(){oe.ZP.destroy("DELETE"),t()},children:"Undo"})]}),key:"DELETE",duration:10}))})),ne=(0,j.Z)((function(e){var t=e.pageOrder,n=e.pageID,r=e.newPage;$(t),q(n,(function(){return r})),R((function(e){return null===e||void 0===e?void 0:e.addState(n,r)}))}));(0,l.useEffect)((function(){return null===B||void 0===B||B.on("reorder",te),null===B||void 0===B||B.on("newPage",ne),function(){null===B||void 0===B||B.removeAllListeners()}}),[B,te,ne]);var re=function(e,t,n){n.image,n.marked;var r=(0,u.Z)(n,Kt);null===B||void 0===B||B.emit("newPage",{pageOrder:e,pageID:t,newPage:r}),G(t,n)},ae=function(e,t){var n=D.Dw.flaten(t);q(e,(function(e){return(0,a.Z)((0,a.Z)({},e),{},{state:n})}))},se=function(e){if(C){var t=e(C);R(t);var n,a=t.getLastDS(),u=t.lastOp;if(a&&u)ae.apply(void 0,(0,r.Z)(a)),n=u,null===B||void 0===B||B.emit("push",{operation:n},(function(e){var t=e.pageID,n=e.stroke;return R((function(e){return null===e||void 0===e?void 0:e.syncStrokeTime(t,n)}))}))}},de=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(U){var n=t?null===h||void 0===h?void 0:h.get(e):void 0,r=(0,d.D4)(n),a=(0,i.Z)(r,2),u=a[0],o=a[1],s=Je(U,e,u);re(s,u,o),$(s),q(u,(function(){return o})),R((function(e){return null===e||void 0===e?void 0:e.addState(u,o)}))}},fe=(0,v.jsxs)("div",{className:"reader container",children:[(0,v.jsx)(Xt,{saved:V,instantSave:K,handleUndo:function(){return se((function(e){return e.undo()}))},handleRedo:function(){return se((function(e){return e.redo()}))}}),(0,v.jsxs)("main",{children:[null===U||void 0===U?void 0:U.map((function(e){return(0,v.jsx)("section",{className:"note-page",ref:Y(e),children:(0,v.jsx)(tn,{uid:e,updateStateSet:se,setInviewRatios:z})},e)})),(0,v.jsx)(ce,{})]})]});return(0,v.jsx)(S.Wk,{children:(0,v.jsx)(qt.Provider,{value:{noteID:t,pageRec:h,noteInfo:Z,stateSet:C,pageOrder:U,currPageID:H},children:(0,v.jsx)($t.Provider,{value:{addPage:de,scrollPage:J,deletePage:function(e){var t=null===U||void 0===U?void 0:U.filter((function(t){return t!==e}));(null===t||void 0===t?void 0:t.length)&&$(t,!0)},saveReorder:$,addFinalPage:function(){var e=(0,We.Z)(U);e&&de(e)},switchPageMarked:function(e){return q(e,(function(e){return(0,a.Z)((0,a.Z)({},e),{},{marked:!e.marked})}))}},children:(0,v.jsx)(w,{children:fe})})})})}var tn=function(e){var t=e.uid,n=e.updateStateSet,r=e.setInviewRatios,a=(0,l.useContext)(qt),u=a.pageRec,i=a.stateSet,o=a.currPageID,s=a.pageOrder,c=(0,l.useContext)(ft.TeamCtx).teamState,d=null===u||void 0===u?void 0:u.get(t),f=null===i||void 0===i?void 0:i.getOneState(t),p=null===c||void 0===c?void 0:c.getOnePageStateMap(t),h=(0,l.useMemo)((function(){if(!s)return!1;var e=s.indexOf(o),n=s.indexOf(t);return Math.abs(n-e)<=1}),[o,t,s]);return d&&f?(0,v.jsx)(nn,{drawState:f,teamStateMap:p,updateState:function(e){n((function(n){return n.setState(t,e)}))},pdfIndex:d.pdfIndex,onViewChange:function(e,n){if(!e)return r((function(e){return e.delete(t)}));r((function(e){return e.set(t,n)}))},preload:h}):null},nn=function(e){var t=e.thumbnail,r=e.drawState,a=e.teamStateMap,u=e.updateState,s=e.pdfIndex,d=e.preview,f=void 0!==d&&d,p=e.onViewChange,h=void 0===p?function(){}:p,m=e.preload,g=void 0!==m&&m,x=(0,Ge.YD)({threshold:(0,Be.Z)(0,1.1,.1)}),Z=(0,i.Z)(x,3),k=Z[0],b=Z[1],w=Z[2];(0,l.useEffect)((function(){if(!w||!b)return h(!1,0);h(!0,w.intersectionRatio)}),[b,w,h]);var y=(0,l.useContext)(qt).noteID,j=(0,l.useState)(),I=(0,i.Z)(j,2),C=I[0],D=I[1],N=(0,l.useCallback)((0,Ae.Z)((0,o.Z)(c().mark((function e(){var t,r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,Promise.all([n.e(643),n.e(138)]).then(n.bind(n,21176));case 4:return t=e.sent,r=t.getNotePageImage,e.t0=D,e.next=9,r(y,s);case 9:e.t1=e.sent,(0,e.t0)(e.t1);case 11:case"end":return e.stop()}}),e)})))),[s,y]),R=b||g;(0,l.useEffect)((function(){!f&&R&&N()}),[R,f,N]);var P=(0,l.useContext)(ft.TeamCtx).ignores,T=(0,l.useMemo)((function(){return null===a||void 0===a?void 0:a.deleteAll(P).toList().toArray()}),[a,P]),E=Boolean(C||!s),U=R&&E,O=r.height/r.width,F=(0,S.iX)(),L=(0,i.Z)(F,1)[0];return(0,v.jsxs)("div",{ref:k,className:"page-wrapper","data-force-light":L,children:[(0,v.jsx)("svg",{viewBox:"0 0 100 ".concat(100*O)}),U&&(0,v.jsx)(rn,{drawState:r,otherStates:T,updateState:u,imgSrc:C||t,preview:f})]})},rn=function(e){var t=e.drawState,n=e.updateState,r=e.otherStates,a=e.preview,u=void 0!==a&&a,o=e.imgSrc,s=k(),c=(0,l.useState)(""),d=(0,i.Z)(c,2),f=d[0],p=d[1],h=(0,l.useRef)(null),m=(0,j.Z)((function(e){if(n){var r=e instanceof D.Dw?e:e(t);n(r)}}));return u?(0,v.jsx)(Y,{drawState:t,otherStates:r,imgSrc:o,readonly:!0}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(Y,{drawState:t,otherStates:r,onChange:m,imgSrc:o,drawCtrl:s,ref:h,setActiveTool:p}),(0,v.jsx)(Fe,{drawRef:h,visible:"select"===f}),(0,v.jsx)(Ve,{drawRef:h,visible:"text"===f})]})};rn.displayName="DrawWrapper"},91511:function(e,t,n){"use strict";n.r(t),n.d(t,{TeamCtx:function(){return D},default:function(){return N}});var r=n(29439),a=n(15861),u=n(87757),i=n.n(u),o=n(72791),s=n(51570),c=n(56058),l=n(87962),d=n(78577),f=n(69951),p=function(e){return function(){return(0,d.io)(s._n,{query:{userID:(0,f.VN)(),userName:(0,f.vW)(),noteID:e}})}},v=n(16871),h=n(45987),m=n(15671),g=n(43144),x=n(82670),Z=n(24124),k=["pageID"],b={pageStates:(0,Z.D5)(),pageInfos:(0,Z.D5)()},w=(0,Z.WV)(b),S=function(){function e(t){(0,m.Z)(this,e),this.immutable=t}return(0,g.Z)(e,[{key:"getImmutable",value:function(){return this.immutable}},{key:"getPageStates",value:function(){return this.getImmutable().get("pageStates")}},{key:"getPageInfos",value:function(){return this.getImmutable().get("pageInfos")}},{key:"getOneState",value:function(e,t){var n;return null===(n=this.getPageStates().get(e))||void 0===n?void 0:n.get(t)}},{key:"getOnePageStateMap",value:function(e){return this.getPageStates().get(e)}},{key:"getPageValidUsers",value:function(e){var t=this.getOnePageStateMap(e);return t?Array.from(null===t||void 0===t?void 0:t.filter((function(e){return!e.isEmpty()})).keys()):[]}},{key:"getPageRatio",value:function(e){var t;return null===(t=this.getPageInfos().get(e))||void 0===t?void 0:t.ratio}},{key:"includesPage",value:function(e){return this.getPageStates().has(e)}},{key:"setState",value:function(t,n,r){var a=this.getPageStates().get(t);return a?new e(this.getImmutable().update("pageStates",(function(e){return e.set(t,a.set(n,r))}))):this}},{key:"addPage",value:function(t,n){var r=n.ratio;return new e(this.getImmutable().update("pageStates",(function(e){return e.set(t,(0,Z.D5)())})).update("pageInfos",(function(e){return e.set(t,{ratio:r})})))}},{key:"pushOperation",value:function(e,t){var n=e.pageID,r=(0,h.Z)(e,k),a=this.getPageRatio(n);if(!this.includesPage(n)||!a)return this;var u=this.getOneState(n,t)||x.Dw.createEmpty(a),i=x.Dw.pushOperation(u,r);return this.setState(n,t,i)}},{key:"resetUser",value:function(e,t){for(var n=this,a=0,u=Object.entries(t);a<u.length;a++){var i=(0,r.Z)(u[a],2),o=i[0],s=i[1],c=s.state,l=s.ratio;n.getOneState(o,e)&&(n=n.setState(o,e,x.Dw.loadFromFlat(c,l)))}return n}}],[{key:"createFromTeamPages",value:function(t){var n=w();return Object.entries(t).forEach((function(e){var t=(0,r.Z)(e,2),a=t[0],u=t[1],i=u.states,o=u.ratio,s=(0,Z.D5)(Object.entries(i).map((function(e){var t=(0,r.Z)(e,2),n=t[0],a=t[1];return[n,x.Dw.loadFromFlat(a,o)]})));n=n.update("pageStates",(function(e){return e.set(a,s)})).update("pageInfos",(function(e){return e.set(a,{ratio:o})}))})),new e(n)}}]),e}(),y=n(65099),j=n(50419),I=n(52972),C=n(80184),D=o.createContext({io:void 0,code:0,teamOn:!1,connected:!1,ignores:(0,Z.l4)(),userRec:{},teamState:void 0,resetIO:function(){},loadInfo:function(){var e=(0,a.Z)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!1);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),loadState:function(){var e=(0,a.Z)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!1);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),setIgnores:function(){},addTeamStatePage:function(e,t){}});function N(){var e,t=null!==(e=(0,v.UO)().noteID)&&void 0!==e?e:"",n=(0,o.useState)(),u=(0,r.Z)(n,2),c=u[0],l=u[1],d=(0,o.useState)(-2),h=(0,r.Z)(d,2),m=h[0],g=h[1],x=(0,o.useState)({}),k=(0,r.Z)(x,2),b=k[0],w=k[1],N=(0,o.useState)((0,Z.l4)()),T=(0,r.Z)(N,2),E=T[0],U=T[1],O=(0,o.useState)(p(t)),F=(0,r.Z)(O,2),L=F[0],V=F[1],M=(0,o.useState)(!1),W=(0,r.Z)(M,2),B=W[0],A=W[1],G=(0,o.useState)(!1),Q=(0,r.Z)(G,2),z=Q[0],J=Q[1],Y=(0,v.s0)(),H=(0,o.useCallback)((0,a.Z)(i().mark((function e(){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,s.dn)(t);case 2:if(n=e.sent){e.next=6;break}return j.ZP.error("Failed loading the team note info"),e.abrupt("return",!1);case 6:return g(n.code),e.abrupt("return",!0);case 8:case"end":return e.stop()}}),e)}))),[t]),X=(0,o.useCallback)((0,a.Z)(i().mark((function e(){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,s.CD)(t);case 2:if(n=e.sent){e.next=6;break}return j.ZP.error("Failed loading the team note state"),e.abrupt("return",!1);case 6:return l(S.createFromTeamPages(n)),e.abrupt("return",!0);case 8:case"end":return e.stop()}}),e)}))),[t]),_=(0,o.useCallback)((function(){(0,s.f1)(t)}),[t]);(0,o.useEffect)((function(){var e=function(){var e=(0,a.Z)(i().mark((function e(){var t,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,H();case 2:return t=e.sent,e.next=5,X();case 5:if(n=e.sent,t&&n){e.next=8;break}return e.abrupt("return",Y("/"));case 8:A(!0),_();case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return e(),_}),[H,X,Y,_]),(0,o.useEffect)((function(){return L.on("push",(function(e){var t=e.operation,n=e.userID;l((function(e){return null===e||void 0===e?void 0:e.pushOperation(t,n)}))})),L.on("join",(function(e){var t=e.joined,n=e.members,r=t.userID,a=t.userName;w(n),r!==(0,f.VN)()&&R(r,a)})),L.on("leave",(function(e){var t=e.leaved,n=e.members,r=t.userID,a=t.userName;if(w(n),r===(0,f.VN)())return L.emit("join");P(r,a)})),L.on("newPage",(function(e){var t=e.pageID,n=e.newPage;l((function(e){return null===e||void 0===e?void 0:e.addPage(t,n)}))})),L.on("reset",(function(e){var t=e.userID,n=e.pageRec;t!==(0,f.VN)()&&l((function(e){return null===e||void 0===e?void 0:e.resetUser(t,n)}))})),L.on("connect_error",console.error),L.on("connect",(function(){return J(!0)})),L.on("disconnect",(function(){return J(!1)})),function(){L.removeAllListeners(),L.close()}}),[L]);return(0,C.jsx)(y.g,{loading:!B,children:(0,C.jsx)(D.Provider,{value:{io:L,code:m,teamOn:!0,ignores:E,userRec:b,connected:z,teamState:c,resetIO:function(){return V(p(t))},loadInfo:H,loadState:X,setIgnores:U,addTeamStatePage:function(e,t){l((function(n){return null===n||void 0===n?void 0:n.addPage(e,t)}))}},children:(0,C.jsx)(I.default,{})})})}var R=function(e,t){j.ZP.destroy(e),j.ZP.success({content:"".concat(t," joined room"),icon:(0,C.jsx)(c.Z,{}),key:e})},P=function(e,t){j.ZP.destroy(e),j.ZP.warning({content:"".concat(t," leaved room"),icon:(0,C.jsx)(l.Z,{}),key:e})}},80202:function(e,t,n){"use strict";n.d(t,{W:function(){return i}});var r=n(81694),a=n.n(r),u=n(80184),i=function(e){var t=e.color,n=e.className,r={backgroundColor:t};return(0,u.jsx)("div",{className:a()("color-circle",n),style:r})}},74115:function(e,t,n){"use strict";n.d(t,{O9:function(){return u},Qk:function(){return i},bM:function(){return s},mr:function(){return o}});var r=n(45917),a=n.n(r),u=["#f97316","#eab308","#84cc16","#22c55e","#10b981","#14b8a6","#06b6d4","#0ea5e9","#3b82f6","#6366f1","#8b5cf6","#a855f7","#d946ef","#ec4899","#f43f5e","#ef4444"],i=[].concat(["#000000","#9ca3af","#64748b","#78716c"],u),o=function(){var e=Math.floor(Math.random()*u.length);return u[e]},s=function(e){var t=a()(e)%u.length;return u[t]}},82670:function(e,t,n){"use strict";n.d(t,{Dw:function(){return h},F:function(){return v},mF:function(){return d}});var r=n(1413),a=n(29439),u=n(15671),i=n(43144),o=n(24124),s=n(24610),c=n(25641),l=n.n(c),d=2e3,f={strokes:(0,o.zN)(),undoStack:(0,o.aV)(),historyStack:(0,o.aV)()},p=(0,o.WV)(f),v=function(){return{strokes:{}}},h=function(){function e(t,n,r,a){(0,u.Z)(this,e),this.immutable=t,this.width=n,this.height=r,this.lastOp=a}return(0,i.Z)(e,[{key:"getImmutable",value:function(){return this.immutable}},{key:"getUndoStack",value:function(){return this.getImmutable().get("undoStack")}},{key:"getHistoryStack",value:function(){return this.getImmutable().get("historyStack")}},{key:"getStrokeMap",value:function(){return this.getImmutable().get("strokes")}},{key:"getStrokeList",value:function(){return this.getStrokeMap().toArray().map((function(e){var t=(0,a.Z)(e,2);t[0];return t[1]}))}},{key:"getLastStroke",value:function(){return this.getStrokeMap().last()}},{key:"isEmpty",value:function(){return 0===this.getStrokeMap().size}},{key:"hasStroke",value:function(e){return this.getStrokeMap().has(e)}}],[{key:"createEmpty",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d;return new e(p(),n,n*t)}},{key:"undo",value:function(t){var n=t.getHistoryStack().last();if(!n)return t;var r=t.getUndoStack().unshift(t.getImmutable());return new e(n.set("undoStack",r),t.width,t.height,{type:"undo"})}},{key:"redo",value:function(t){var n=t.getUndoStack().first();return n?new e(n,t.width,t.height,{type:"redo"}):t}},{key:"addStroke",value:function(t,n){var r={pathData:n,uid:e.getUid(),timestamp:Date.now()};return e.pushStroke(t,r)}},{key:"pushStroke",value:function(t,n){var r=n.uid,a=t.getImmutable(),u=a.update("strokes",(function(e){return e.set(r,n)})).update("historyStack",(function(e){return e.push(a)})).delete("undoStack"),i={type:"add",stroke:n};return new e(u,t.width,t.height,i)}},{key:"eraseStrokes",value:function(t,n){if(0===n.length)return t;var r=t.getImmutable(),a=r.update("strokes",(function(e){return e.deleteAll(n)})).update("historyStack",(function(e){return e.push(r)})).delete("undoStack"),u={type:"erase",erased:n};return new e(a,t.width,t.height,u)}},{key:"mutateStrokes",value:function(t,n){if(0===n.length)return t;var u=t.getImmutable(),i=t.getStrokeMap();n.forEach((function(e){var t=(0,a.Z)(e,2),n=t[0],u=t[1];return i=i.update(n,{uid:n,pathData:u,timestamp:Date.now()},(function(e){return(0,r.Z)((0,r.Z)({},e),{},{pathData:u})}))}));var o={type:"mutate",mutations:n};return new e(u.set("strokes",i).update("historyStack",(function(e){return e.push(u)})).delete("undoStack"),t.width,t.height,o)}},{key:"splitStrokes",value:function(t,n){if(0===n.length)return t;var r=(0,o.D5)(n),a=(0,o.zN)();t.getStrokeMap().forEach((function(e,t){var n=r.get(t);n?n.forEach((function(n,r){var u=t+"-"+r,i=e.timestamp;a=a.set(u,{pathData:n,timestamp:i,uid:u})})):a=a.set(t,e)}));var u=t.getImmutable(),i={type:"split",splitters:n};return new e(u.set("strokes",a).update("historyStack",(function(e){return e.push(u)})),t.width,t.height,i)}},{key:"syncStrokeTime",value:function(e,t){var n=t.uid,r=t.timestamp,a=e.getStrokeMap().get(n);a&&(a.timestamp=r)}},{key:"pushOperation",value:function(t,n){switch(n.type){case"add":return e.pushStroke(t,n.stroke);case"erase":return e.eraseStrokes(t,n.erased);case"mutate":return e.mutateStrokes(t,n.mutations);case"undo":return e.undo(t);case"redo":return e.redo(t);case"split":return e.splitStrokes(t,n.splitters)}}},{key:"flaten",value:function(e){return{strokes:e.getImmutable().get("strokes").toObject()}}},{key:"loadFromFlat",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d,a=t.strokes,u=t.operations,i=new e(p().set("strokes",(0,o.zN)(a)),r,r*n);return null===u||void 0===u||u.forEach((function(t){return i=e.pushOperation(i,t)})),i}},{key:"mergeStates",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.map((function(e){return e.getStrokeMap().values()})),u=[],i=new(l())((function(e,t){var n=(0,a.Z)(e,1)[0],r=(0,a.Z)(t,1)[0];return n.timestamp-r.timestamp}));for(r.forEach((function(e,t){var n=e.next(),r=n.value;n.done||i.push([r,t])}));i.size()>0;){var o=i.pop();if(!o)break;var s=(0,a.Z)(o,2),c=s[0],d=s[1];u.push(c);var f=r[d].next(),p=f.value,v=f.done;v||i.push([p,d])}return u}},{key:"getUid",value:function(){return(0,s.v4)()}}]),e}()},96153:function(e,t,n){"use strict";function r(e,t){var n=document.createElement("canvas"),r=n.getContext("2d");if(!r)throw new Error("can't get virtual canvas context");return n.width=e,n.height=t,{canvas:n,context:r}}function a(e){e.width=1,e.height=1;var t=e.getContext("2d");null===t||void 0===t||t.clearRect(0,0,1,1)}n.d(t,{j:function(){return a},v:function(){return r}})},52365:function(e,t,n){"use strict";n.d(t,{s2:function(){return c},wC:function(){return i},zI:function(){return s}});var r=n(29439),a=n(72791),u=n(80184);function i(){var e=(0,a.useRef)((function(){})),t=(0,a.useState)((function(){return new Promise((function(t){return e.current=t}))}));return[(0,r.Z)(t,1)[0],function(){return e.current()}]}var o=(0,a.createContext)(["",function(){}]);function s(){var e=(0,a.useContext)(o);return(0,a.useDebugValue)(e[0]),e}var c=function(e){var t=e.children,n=e.initKey,r=(0,a.useState)(n);return(0,u.jsx)(o.Provider,{value:r,children:t})}},51570:function(e,t,n){"use strict";n.d(t,{CD:function(){return y},_n:function(){return p},dn:function(){return x},f1:function(){return w},fI:function(){return v},r8:function(){return k}});var r=n(45987),a=n(15861),u=n(87757),i=n.n(u),o=n(74569),s=n.n(o),c=n(92198),l=n(75783),d=n(69951),f=["statusCode"],p="https://api.slotdumpling.top/paint";function v(e){return h.apply(this,arguments)}function h(){return(h=(0,a.Z)(i().mark((function e(t){var n,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s().get("code/".concat(t));case 3:if(n=e.sent,r=n.data,console.log({data:r}),200===r.statusCode){e.next=8;break}return e.abrupt("return",null);case 8:return e.abrupt("return",r.noteID);case 11:return e.prev=11,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 15:case"end":return e.stop()}}),e,null,[[0,11]])})))).apply(this,arguments)}function m(e){return g.apply(this,arguments)}function g(){return(g=(0,a.Z)(i().mark((function e(t){var n,a,u,o,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s().get("info/".concat(t));case 3:if(n=e.sent,a=n.data,o=(u=a).statusCode,c=(0,r.Z)(u,f),200===o){e.next=8;break}return e.abrupt("return",null);case 8:return e.abrupt("return",c);case 11:return e.prev=11,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 15:case"end":return e.stop()}}),e,null,[[0,11]])})))).apply(this,arguments)}function x(e){return Z.apply(this,arguments)}function Z(){return(Z=(0,a.Z)(i().mark((function e(t){var n,r,a,u,o,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,m(t);case 3:if(n=e.sent){e.next=6;break}return e.abrupt("return",null);case 6:return r=n.noteInfo,a=n.pageInfos,e.next=9,(0,l.Rb)(t,r,a);case 9:if(!e.sent){e.next=11;break}return e.abrupt("return",n);case 11:if(!r.withImg){e.next=21;break}return e.next=14,s()({method:"GET",url:t,responseType:"blob"});case 14:return u=e.sent,o=u.data,c=new Blob([o],{type:"application/pdf"}),e.next=19,(0,l.Vk)(t,r,a,c);case 19:e.next=23;break;case 21:return e.next=23,(0,l.Vk)(t,r,a);case 23:return e.abrupt("return",n);case 26:return e.prev=26,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 30:case"end":return e.stop()}}),e,null,[[0,26]])})))).apply(this,arguments)}function k(e){return b.apply(this,arguments)}function b(){return(b=(0,a.Z)(i().mark((function e(t){var n,r,a,u,o,f,p,v,h,m,g,x;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.U9)(t);case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return",!1);case 5:return r=n.uid,a=n.name,u=n.withImg,o=n.pdf,f=n.pageOrder,p=n.pageRec,(0,c.Yl)(p),e.prev=7,e.next=10,s().put("create/".concat(t),{userID:(0,d.VN)(),pageRec:p,noteInfo:{uid:r,name:a,withImg:u,pageOrder:f}});case 10:if(v=e.sent,h=v.data,!o){e.next=21;break}return m=new FormData,e.next=16,o.arrayBuffer();case 16:return g=e.sent,x=new Blob([g]),m.append("file",x,t),e.next=21,s()({method:"POST",url:"upload",data:m,headers:{"Content-Type":"multipart/form-data"}});case 21:if(201===h.statusCode){e.next=23;break}return e.abrupt("return",!1);case 23:return e.abrupt("return",!0);case 26:return e.prev=26,e.t0=e.catch(7),console.error(e.t0),e.abrupt("return",!1);case 30:case"end":return e.stop()}}),e,null,[[7,26]])})))).apply(this,arguments)}function w(e){return S.apply(this,arguments)}function S(){return(S=(0,a.Z)(i().mark((function e(t){var n,r,a,u,o,f,p;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.U9)(t);case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return",null);case 5:return r=n.uid,a=n.name,u=n.withImg,o=n.pageOrder,f=n.pageRec,(0,c.Yl)(f),e.prev=7,e.next=10,s().put("update/".concat(t),{userID:(0,d.VN)(),pageRec:f,noteInfo:{uid:r,name:a,withImg:u,pageOrder:o}});case 10:if(p=e.sent,201!==p.data.statusCode){e.next=16;break}return e.abrupt("return",!0);case 16:return e.abrupt("return",!1);case 17:e.next=23;break;case 19:return e.prev=19,e.t0=e.catch(7),console.error(e.t0),e.abrupt("return",!1);case 23:case"end":return e.stop()}}),e,null,[[7,19]])})))).apply(this,arguments)}function y(e){return j.apply(this,arguments)}function j(){return(j=(0,a.Z)(i().mark((function e(t){var n,r,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s().get("state/".concat(t),{params:{userID:(0,d.VN)()}});case 3:if(n=e.sent,200===(r=n.data).statusCode){e.next=7;break}return e.abrupt("return",null);case 7:return a=r.teamPages,e.abrupt("return",a);case 11:return e.prev=11,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 15:case"end":return e.stop()}}),e,null,[[0,11]])})))).apply(this,arguments)}s().defaults.baseURL=p},75783:function(e,t,n){"use strict";n.d(t,{HO:function(){return S},Pn:function(){return j},Rb:function(){return G},SP:function(){return P},U9:function(){return N},Vk:function(){return B},Ys:function(){return b},au:function(){return O},f_:function(){return L},hY:function(){return Z},tk:function(){return C},tw:function(){return M}});var r=n(29439),a=n(45987),u=n(49142),i=n(4942),o=n(1413),s=n(15861),c=n(87757),l=n.n(c),d=n(82670),f=n(61842),p=n.n(f),v=n(24610),h=n(46097),m=["pageRec","pageOrder"],g=["pdf"],x=["pageRec","pageOrder"];function Z(){return k.apply(this,arguments)}function k(){return(k=(0,s.Z)(l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p().getItem("ALL_NOTES");case 2:if(!(t=e.sent)){e.next=5;break}return e.abrupt("return",t);case 5:return p().setItem("ALL_NOTES",{}),e.abrupt("return",{});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(){return w.apply(this,arguments)}function w(){return(w=(0,s.Z)(l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p().getItem("ALL_TAGS");case 2:if(!(t=e.sent)){e.next=5;break}return e.abrupt("return",t);case 5:return p().setItem("ALL_TAGS",{}),e.abrupt("return",{});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e,t){return y.apply(this,arguments)}function y(){return(y=(0,s.Z)(l().mark((function e(t,n){var r,a,u,s;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,v.v4)(),a={uid:r,name:t,color:n,notes:[]},e.next=4,b();case 4:return u=e.sent,s=(0,o.Z)((0,o.Z)({},u),{},(0,i.Z)({},r,a)),e.next=8,p().setItem("ALL_TAGS",s);case 8:return e.abrupt("return",s);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return I.apply(this,arguments)}function I(){return(I=(0,s.Z)(l().mark((function e(t){var n,r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b();case 2:return n=e.sent,n[t],r=(0,a.Z)(n,[t].map(u.Z)),e.next=6,p().setItem("ALL_TAGS",r);case 6:return e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e){return D.apply(this,arguments)}function D(){return(D=(0,s.Z)(l().mark((function e(t){var n,r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b();case 2:return n=e.sent,r=(0,o.Z)((0,o.Z)({},n),{},(0,i.Z)({},t.uid,t)),e.next=6,p().setItem("ALL_TAGS",r);case 6:return e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e){return R.apply(this,arguments)}function R(){return(R=(0,s.Z)(l().mark((function e(t){var n,r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p().getItem(t);case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,p().getItem("PDF_".concat(t));case 7:if(!(r=e.sent)){e.next=12;break}return e.abrupt("return",(0,o.Z)((0,o.Z)({},n),{},{pdf:r}));case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e,t){return T.apply(this,arguments)}function T(){return(T=(0,s.Z)(l().mark((function e(t,n){var r,u,i,s;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"pageRec"in(n=(0,h.Z)(n,(function(e){return void 0!==e})))&&(n.lastTime=Date.now()),e.next=4,Z();case 4:return r=e.sent,(u=n).pageRec,u.pageOrder,i=(0,a.Z)(u,m),r[t]=(0,o.Z)((0,o.Z)({},r[t]),i),e.next=9,p().setItem("ALL_NOTES",r);case 9:return e.next=11,N(t);case 11:if(s=e.sent){e.next=14;break}return e.abrupt("return");case 14:return e.next=16,p().setItem(t,(0,o.Z)((0,o.Z)({},s),n));case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e){return U.apply(this,arguments)}function U(){return(U=(0,s.Z)(l().mark((function e(t){var n,r,a,u;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.uid,r=t.tagID,e.next=3,Z();case 3:return(a=e.sent)[n]=t,e.next=7,p().setItem("ALL_NOTES",a);case 7:return e.next=9,b();case 9:if(u=e.sent,!(r in u)){e.next=14;break}return u[r].notes.push(t.uid),e.next=14,p().setItem("ALL_TAGS",u);case 14:return e.abrupt("return",{tags:u,allNotes:a});case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e){return F.apply(this,arguments)}function F(){return(F=(0,s.Z)(l().mark((function e(t){var n,r,u;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.pdf,r=(0,a.Z)(t,g),e.next=3,p().setItem(r.uid,r);case 3:if(!n){e.next=6;break}return e.next=6,p().setItem("PDF_".concat(r.uid),n);case 6:return r.pageRec,r.pageOrder,u=(0,a.Z)(r,x),e.next=9,E(u);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(e){return V.apply(this,arguments)}function V(){return(V=(0,s.Z)(l().mark((function e(t){var n,r,a,u,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N(t);case 2:return n=e.sent,e.next=5,Z();case 5:return r=e.sent,e.next=8,b();case 8:if(a=e.sent,n){e.next=11;break}return e.abrupt("return",{tags:a,allNotes:r});case 11:return e.next=13,p().removeItem(t);case 13:return e.next=15,p().removeItem("PDF_".concat(t));case 15:return delete r[t],e.next=18,p().setItem("ALL_NOTES",r);case 18:if(!((u=n.tagID)in a)){e.next=24;break}return(i=a[u]).notes=i.notes.filter((function(e){return e!==t})),e.next=24,p().setItem("ALL_TAGS",a);case 24:return e.abrupt("return",{tags:a,allNotes:r});case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e,t){return W.apply(this,arguments)}function W(){return(W=(0,s.Z)(l().mark((function e(t,n){var r,a,u,i,o,s;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N(t);case 2:return a=e.sent,e.next=5,Z();case 5:return u=e.sent,e.next=8,b();case 8:if(i=e.sent,a){e.next=11;break}return e.abrupt("return",{tags:i,allNotes:u});case 11:return o=a.tagID,a.tagID=n,e.next=15,p().setItem(t,a);case 15:return u[t].tagID=n,e.next=18,p().setItem("ALL_NOTES",u);case 18:return o in i&&((s=i[o]).notes=s.notes.filter((function(e){return e!==t}))),null===(r=i[n])||void 0===r||r.notes.push(t),e.next=22,p().setItem("ALL_TAGS",i);case 22:return e.abrupt("return",{tags:i,allNotes:u});case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(e,t,n,r){return A.apply(this,arguments)}function A(){return(A=(0,s.Z)(l().mark((function e(t,a,u,i){var s,c,f,p,v,h,m;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N(t);case 2:if(!(s=e.sent)){e.next=5;break}return e.abrupt("return");case 5:if(c=Date.now(),f={},s=(0,o.Z)((0,o.Z)({},a),{},{tagID:"DEFAULT",team:!0,pageRec:f,pdf:i,createTime:c,lastTime:c}),Object.entries(u).forEach((function(e){var t=(0,r.Z)(e,2),n=t[0],a=t[1];f[n]=(0,o.Z)((0,o.Z)({},a),{},{state:(0,d.F)()})})),!i){e.next=19;break}return e.next=12,Promise.all([n.e(643),n.e(138)]).then(n.bind(n,21176));case 12:return p=e.sent,v=p.getPDFImages,e.next=16,v(i,.5);case 16:h=e.sent,m=h.images,Object.values(f).forEach((function(e){var t=e.pdfIndex;t&&(e.image=m[t-1])}));case 19:return e.next=21,O(s);case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function G(e,t,n){return Q.apply(this,arguments)}function Q(){return(Q=(0,s.Z)(l().mark((function e(t,a,u){var i,s,c,f,p,v,h,m,g,x,Z,k,b;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N(t);case 2:if(i=e.sent){e.next=5;break}return e.abrupt("return",!1);case 5:if(!((s=a.pageOrder).length<i.pageOrder.length)){e.next=8;break}return e.abrupt("return",!0);case 8:return c=i.pageRec,f=i.pdf,e.next=11,Promise.all([n.e(643),n.e(138)]).then(n.bind(n,21176));case 11:p=e.sent,v=p.getOneImage,h=0,m=Object.entries(u);case 14:if(!(h<m.length)){e.next=29;break}if(g=(0,r.Z)(m[h],2),x=g[0],Z=g[1],!(x in c)){e.next=18;break}return e.abrupt("continue",26);case 18:if(k=Z.pdfIndex,b=(0,d.F)(),c[x]=(0,o.Z)((0,o.Z)({},Z),{},{state:b}),f&&k){e.next=23;break}return e.abrupt("continue",26);case 23:return e.next=25,v(f,k,.5);case 25:c[x].image=e.sent;case 26:h++,e.next=14;break;case 29:return e.next=31,P(t,{pageOrder:s,pageRec:c});case 31:return e.abrupt("return",!0);case 32:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},92198:function(e,t,n){"use strict";n.d(t,{BJ:function(){return s},D4:function(){return l},Xn:function(){return c},Yl:function(){return d}});var r=n(4942),a=n(82670),u=n(24610),i=n(97892),o=n.n(i),s={ratio:1.5,state:{strokes:{}}};function c(){var e=(0,u.v4)(),t=Date.now();return{uid:(0,u.v4)(),name:"Note ".concat(o()(t).format("HH:mm, ddd MMM D")),tagID:"DEFAULT",team:!1,withImg:!1,createTime:t,lastTime:t,pageRec:(0,r.Z)({},e,{ratio:1.5,state:(0,a.F)()}),pageOrder:[e]}}function l(e){return[(0,u.v4)(),null!==e&&void 0!==e?e:{ratio:1.5,state:(0,a.F)()}]}function d(e){Object.values(e).forEach((function(e){delete e.image,delete e.marked}))}},69951:function(e,t,n){"use strict";n.d(t,{VN:function(){return a},lu:function(){return i},vW:function(){return u}});var r=n(24610),a=function(){var e;return function(){if(e)return e;var t=localStorage.getItem("USER_ID");return t||(t=(0,r.v4)(),localStorage.setItem("USER_ID",t)),e=t,t}}(),u=function(){var e=localStorage.getItem("USER_NAME");return e||(e=(0,r.v4)().slice(0,8),localStorage.setItem("USER_NAME",e)),e},i=function(e){return!!(e=e.trim())&&(localStorage.setItem("USER_NAME",e),!0)}},90858:function(){},64158:function(){}}]);
//# sourceMappingURL=271.ad5ff4ec.chunk.js.map