(self.webpackChunkmultibility=self.webpackChunkmultibility||[]).push([[478],{22568:function(e,t,n){"use strict";var r=n(92721);t.Z=(0,r.Z)({scriptUrl:"//at.alicdn.com/t/font_3181679_yo844n7qgns.js"})},50060:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return fe}});var r=n(15861),i=n(29439),o=n(87757),a=n.n(o),u=n(72791),c=n(70587),s=n(95099),l=n(1413),f=n(93433),d=n(46668),v=n.n(d),p=n(41446),h=n(1488),m=n(82670),w=n(96153),g=function(){var e=new Map,t=(0,w.v)(44,44),n=t.canvas,r=t.context,i=new Image;return i.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAAAXNSR0IArs4c6QAABWlJREFUWEftmF1IW2cYx580iaaNSTSmdWUtRVBBnENbSG40YVtRRpZM4ydqLEpJnd5sVzpxU7TipoMy8EYd6kwC6pakiDeCih/oyBGibS/qTZWaoE63RONXqiYZj5xIKtvFzhvRQl84nHPzvud3nvO8//f5Pyx4xwbrHeOF98Dn/cfeR/h9hM9EgDQlcP4VgJPNi/ezww8AeHnpO/EPIAXm2O32+3w+/xOv13vF5/O9tR6Hw/FxuVyvUChsAIDDUECTAOPca1NTU5+np6f/Zjab7X6//631cnJybjkcjp9v375dDwB7AHBMGmISYEwBocViUWVlZfVJpVLP3NwcLxjI7/fD4uJiR2Ji4vcA4AKAo4sEZgNApF6vzy4pKelCYK/Xy3K73dympqa/EaywsPD6/Px89927d78DgL/otCBiJokwAkf19vZqHjx40CGVSt8gyfLycrhMJvMMDw+fRHthYaEnNTUVgTcvJXBZWdlhZWWlID8/3z0wMCC02Wy99+7dCwCffBTJCHmEKYoKr66udra2torLy8v/7Orqik5JSUl+8eLFCgDsk8DiXFLgSKPRmFVUVPTLWZDc3NzdsbExVJFdgUDwNDY29msA2AYAHwk0CTCqhMBisahfv34tcbvdgsPDw7Dj42NOTU3Nw6mpqSO1Wv1BYWGhU6/Xc2tra+VtbW2LAOC5KGD82KsobQAgop/DASDCYDBoiouLKzUajdtisQiXlpYOfD7fr3Fxcd8CgJskyiQRxkBxACAMALj0M96FkZGRH9rt9gGj0ciuqKgQt7e3b2i1WqdIJPoUAFDy8NRjNEiBA/sA1wnUExEAcHNmZqYuNTVVJZFIIjIzM7cHBwe5XC73IwBYB4ADRrSEm+6/3on6e2N4eLhSqVRWKxSKY5fL5Xv+/HlYY2Pj/fr6egoAdi4TMKaJpL29XV1VVdWhVqv3bTZbuMPhYJtMJl1ubu7vALDFtBAKRUqcDRaqh1ilUn08NDQ0VlpaumUymSL39vaAoqgfZTLZTwDgZLrxzgMY14zKzs5ONpvNE1qt1mU2m6MQeGZmpi0tLS0AzKhyOzfg7u5uVVlZWa9ard6z2Ww8TImenp7K8vJyEx3hSwN8khKTk5NVcrm8QaFQHLlcLj9uukePHn3R2dlpvWwpcbLpnj179jghISE/OjpakJGRsd3f3w88Hi8dAOz0EY3W6X+P80gJ3p07d26+fPly1mAwcHQ6HSrGZl5e3mZMTEw2AKxdtKwFDo3Tg8NqtX4llUqbNRrNtsViEb169cqztrZmSEtLewwAGxd5cHBWV1c/293d5RwcHLA9Hg97fX2dn5GR0To+Pu5VKpW3CgoKtoxGY4RSqVSNjIws0EczY6tEkhInxY/Vas2USqXms8mYl5e3Mzo6yp+YmNjn8/m2+Pj4KgBwXGTxc1pe0iYU6wMWRVG85ubmjbq6uhs6nc7Z0dEhrq2tfdjS0jJKmg4hLeDRhCJwQ0PDQUFBgTA5OfnN7Ozs1enp6QG5XP4DrQ54JGNThfEgSYl/NaFbW1vs1dXVKysrK06xWCyhKEovk8kaaXXA3gTRCCkwwu7s7LCePHmCPQi0+RLahGJfAtXhcpnQubk5dBynAxspl87m9/X1ZWu12s7+/n7sOwT/MX9QIwUjfOF9CVQJ0eDg4JcKheKbo6MjbnBvjcVi+dls9rHT6fwjKSkJgbGkZKy/gd9GksM4l4+FDgBcRwdNe7vA2mjncZOhh8M2FboMRhVacJqRAOM6aDrROV+jzWhwjxiLG4woyh02UHDDMSp4QgmMH4zyhlegsR1YP7iZjdpL1EAJRUoQ6SnTyaQpwfS9jOe9c8D/AEaRMEuceu4YAAAAAElFTkSuQmCC",function(t){t=10*Math.round(t/10);var o=e.get(t);if(o)return o;r.translate(22,22),r.rotate(t*Math.PI/180),r.drawImage(i,-22,-22);var a=n.toDataURL();return r.clearRect(-22,-22,44,44),r.resetTransform(),e.set(t,a),a}}(),x=function(e){return"url(".concat(g(e),") 22 22, auto")};function Z(e){var t=(0,u.useRef)(!1),n=function(e){return e.isPrimary&&(t.current="touch"===e.pointerType)},r=function(n){return function(n){return!t.current||function(e){var t=e.touches[0];return"stylus"===(null===t||void 0===t?void 0:t.touchType)}(n)||e&&1===n.touches.length}(n)||n.stopPropagation()};return{onPointerDownCapture:n,onPointerMoveCapture:n,onTouchStartCapture:r,onTouchMoveCapture:r}}var y=function(e){var t=e.topLeft,n=e.bottomRight;return[Math.floor(t.x/100),Math.ceil(n.x/100),Math.floor(t.y/100),Math.ceil(n.y/100)]},C=function(e,t,n){for(var r=(null!==n&&void 0!==n?n:t).strokeBounds,o=y(r),a=(0,i.Z)(o,4),u=a[0],c=a[1],s=a[2],l=a[3],f=u;f<=c;f+=1)for(var d=s;d<=l;d+=1){var v,p,h,m;n&&(null===(v=e[f])||void 0===v||null===(p=v[d])||void 0===p||p.delete(n)),null===(h=e[f])||void 0===h||null===(m=h[d])||void 0===m||m.add(t)}},S=function(e,t){for(var n=new Set,r=y(t),o=(0,i.Z)(r,4),a=o[0],u=o[1],c=o[2],s=o[3],l=a;l<=u;l+=1)for(var f=c;f<=s;f+=1){var d,v;null===(d=e[l])||void 0===d||null===(v=d[f])||void 0===v||v.forEach((function(e){return n.add(e)}))}return Array.from(n)},b=n(80184),j=new d.Point(0,0),k=u.forwardRef((function(e,t){var n=e.drawState,r=e.otherStates,o=e.onChange,a=void 0===o?function(){}:o,g=e.drawCtrl,y=void 0===g?c.Hq:g,k=e.readonly,E=void 0!==k&&k,F=e.imgSrc,J=e.toggleSelectTool,B=void 0===J?function(){}:J,K=e.toggleTextTool,q=void 0===K?function(){}:K,U=n.width,Y=n.height,H=(0,u.useMemo)((function(){return new d.Size(U,Y)}),[U,Y]),Q=y.mode,X=y.finger,G=y.lasso,_=y.eraserWidth,$=(0,u.useRef)(null),ee=(0,u.useRef)(new(v().PaperScope)),te=(0,u.useState)([]),ne=(0,i.Z)(te,2),re=ne[0],ie=ne[1],oe=P(),ae=(0,i.Z)(oe,2),ue=ae[0],ce=ae[1],se=P(),le=(0,i.Z)(se,2),fe=le[0],de=le[1];B=(0,s.Z)(B),q=(0,s.Z)(q),(0,u.useEffect)((function(){var e,t=$.current,n=ee.current;if(t)return n.setup(t),n.settings.handleSize=10,n.settings.hitTolerance=20,[0,1,2].forEach((function(){return(new d.Layer).visible=!1})),null===(e=n.project.layers[2])||void 0===e||e.activate(),new n.Tool,function(){var e;null===(e=n.view)||void 0===e||e.remove(),(0,w.j)(t)}}),[]),(0,u.useEffect)((function(){ee.current.activate();var e=ee.current.project.layers,t=T(e,H);return function(){return t.forEach((function(e){return e.remove()}))}}),[H]);var ve=(0,h.Z)($),pe=(0,i.Z)(ve,1)[0],he=pe/U;(0,u.useEffect)((function(){if(he){var e=ee.current;return e.view.viewSize=H.multiply(he),e.view.scale(he,j),e.project.layers.forEach((function(e){return e.visible=!0})),e.view.update(),function(){var t;return null===(t=e.view)||void 0===t?void 0:t.scale(1/he,j)}}}),[he,H]);var me=P(),we=(0,i.Z)(me,2),ge=we[0],xe=we[1];(0,u.useEffect)((function(){var e;if(F){ee.current.activate();var t=new d.Raster(F);null===(e=t.project.layers[0])||void 0===e||e.addChild(t),t.sendToBack(),t.onLoad=function(){t.view.update(),t.fitBounds(new d.Rectangle(H)),t.bringToFront()},xe(t)}}),[F,H,xe]);var Ze=(0,u.useMemo)((function(){return r?m.Dw.mergeStates.apply(m.Dw,[n].concat((0,f.Z)(r))):n.getStrokeList()}),[n,r]),ye=(0,u.useRef)(!1),Ce=(0,u.useRef)(0),Se=(0,u.useRef)(!1),be=function(){return Se.current=ye.current};E&&be(),(0,u.useEffect)((function(){var e=(0,i.Z)(ee.current.project.layers,2)[1];if(e){var t=function(){var t=[],r=performance.now();ee.current.activate(),e.removeChildren(1),Ze.forEach((function(r){var i=n.hasStroke(r.uid),o=A(r,e,!i);i&&t.push(o)})),ie(t),Je(),Se.current=!1,et.current.forEach((function(e){return e.remove()})),et.current=[],ee.current.view.update();var i=performance.now()-r;ye.current=i>16};return Se.current?Ce.current=window.setTimeout(t,1e3):t(),function(){return window.clearTimeout(Ce.current)}}}),[Ze,n]);var je=(0,u.useRef)(),ke=(0,u.useState)(!1),Ee=(0,i.Z)(ke,2),Pe=Ee[0],Ae=Ee[1],Te="select"===Q&&Pe?"selected":Q,De=(0,u.useState)([]),Re=(0,i.Z)(De,2),Ne=Re[0],Me=Re[1],Le=(0,u.useMemo)((function(){var e=new Set(Ne);return re.filter((function(t){return e.has(t.name)}))}),[re,Ne]),We=(0,s.Z)((function(){Ae(!1),ce(void 0),de(void 0),Me([]),B(!1)}));(0,u.useEffect)((function(){if("select"===Q)return We}),[Q,We]),(0,u.useEffect)((function(){return We}),[G,We]),(0,u.useEffect)((function(){var e,t,r=null!==(e=null===(t=n.lastOp)||void 0===t?void 0:t.type)&&void 0!==e?e:"";/^redo|undo$/.test(r)&&We()}),[n,We]),(0,u.useEffect)((function(){if(B(!1),mt.current){var e=new Proxy(mt.current,{});q(e,ye.current)}}),[pe,B,q]);var Ve=(0,u.useRef)(),ze=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(ye.current||t){var n=(0,i.Z)(ee.current.project.layers,2),r=n[0],o=n[1];if(r&&o){o.visible=!0,e.clipMask=!0;var a=o.firstChild;a.replaceWith(e),null===ge||void 0===ge||ge.insertAbove(e);var u=72*devicePixelRatio,c=pe/e.bounds.width*u,s=Ve.current;(s=Ve.current=o.rasterize({raster:s,resolution:c})).visible=!0,o.visible=!1,e.replaceWith(a),null===ge||void 0===ge||ge.addTo(r)}}},Ie=function(){ee.current.activate();var e=(0,i.Z)(ee.current.project.layers,2)[1],t=Ve.current;e&&t&&(e.visible=!0,t.visible=!1)},Oe=(0,u.useRef)();(0,u.useEffect)((function(){return function(){var e;null===(e=Oe.current)||void 0===e||e.remove(),Oe.current=void 0}}),[pe]);var Fe=function(){var e,t;if(ye.current&&!0!==(null===(e=Oe.current)||void 0===e?void 0:e.visible)){ee.current.activate();var n=ee.current.view,r=null!==(t=Oe.current)&&void 0!==t?t:Oe.current=new d.Raster(n.viewSize.multiply(devicePixelRatio));r.drawImage(n.element,j),r.fitBounds(n.bounds),r.visible=!0,r.opacity=1;var o=(0,i.Z)(ee.current.project.layers,2)[1];o&&(o.visible=!1)}},Je=function(){ee.current.activate();var e=(0,i.Z)(ee.current.project.layers,2)[1],t=Oe.current,n=Ve.current;e&&t&&(t.visible=!1,!0!==(null===n||void 0===n?void 0:n.visible)&&(e.visible=!0))},Be=function(e){Fe(),ce(R(y,e.point,ye.current))},Ke=function(e){Fe(),ce(D(e.point))},qe=(0,u.useRef)(j),Ue={draw:function(e){be(),Be(e)},erase:Be,select:G?Be:Ke,selected:function(e){if(B(!1),qe.current=e.point,ue){if(!G){var t,n=null!==(t=ue.hitTest(e.point,{segments:!0}))&&void 0!==t?t:null===fe||void 0===fe?void 0:fe.hitTest(e.point,{segments:!0,selected:!0});if(je.current=n,n)return}ue.contains(e.point)||(We(),de(void 0),G?Be(e):Ke(e))}},text:null}[Te],Ye=function(e){window.clearTimeout(Ce.current),null===ue||void 0===ue||ue.add(e.point),null===ue||void 0===ue||ue.smooth()},He=function(e){Le.forEach((function(t){return t.translate(e)})),null===ue||void 0===ue||ue.translate(e),null===fe||void 0===fe||fe.translate(e)},Qe={draw:Ye,erase:Ye,select:G?Ye:function(e){if(ue){var t=e.point,n=t.x,r=t.y,o=(0,i.Z)(ue.segments,4),a=o[1],u=o[2],c=o[3];a&&u&&c&&(a.point.x=n,u.point=e.point,c.point.y=r,ue.selected=!0)}},selected:function(e){var t=je.current;if(ue)if(null!==t&&void 0!==t&&t.segment){var n=t.segment;if(n.selected){var r=ue.bounds.center,i=n.point.subtract(r),o=e.point.subtract(r);ot(x(o.angle));var a=o.angle-i.angle;ue.rotate(a,r),null===fe||void 0===fe||fe.rotate(a,r),Le.forEach((function(e){return null===e||void 0===e?void 0:e.rotate(a,r)}))}else{var u,c=n.point,s=n.next.next.point,l=c.subtract(s),f=e.point.subtract(s).project(l).x/l.x;if(f<0)return;if(ue.scale(f,s),Le.forEach((function(e){e.scale(f,s),e.strokeWidth*=f})),!fe)return;fe.scale(f,s);var d=null===(u=fe.segments[0])||void 0===u?void 0:u.point;if(!d)return;fe.scale(100/fe.length,d)}}else He(e.delta)},text:null}[Te];(0,u.useEffect)((function(){ee.current.tool.maxDistance=_}),[_]);var Xe=(0,u.useRef)(new Set),Ge=(0,u.useRef)(new Map),_e=(0,u.useMemo)((function(){return/^(erase|select)$/.test(Q)?function(e,t,n){var r=Math.ceil(t/100),i=Math.ceil(n/100),o=Array.from({length:r},(function(){return Array.from({length:i},(function(){return new Set}))}));return e.forEach((function(e){return C(o,e)})),o}(re,U,Y):[]}),[re,U,Y,Q]),$e=function(e){var t=ee.current.project.layers[1];if("erase"===Te&&t){var n=_,r={class:v().Path,stroke:!0,tolerance:n/2},i=new d.Rectangle(e.point.subtract(n),new d.Size(n,n));S(_e,i).forEach((function(i){var o;Xe.current.has(i.name)||null===(o=i.hitTestAll(e.point,r))||void 0===o||o.forEach((function(r){var i=r.item;if(i instanceof v().Path){for(var o=i;o.parent!==t&&o.parent instanceof v().PathItem;)o=o.parent;var a=o.name;if(y.pixelEraser){var u=(n+i.strokeWidth)/2,c=new d.Path.Circle({center:e.point,radius:u,insert:!1}),s=i.subtract(c,{trace:!1});i.replaceWith(s),o===i&&(C(_e,s,i),o=s),Ge.current.set(a,o)}else o.opacity=.5,o.guide=!0,Xe.current.add(a)}}))}))}},et=(0,u.useRef)([]),tt={draw:function(){if(!ue||ue.segments.length<=1)et.current.length||Je();else{ue.simplify(),ye.current&&et.current.push(ue.clone());var e=ue.exportJSON();a((function(t){return m.Dw.addStroke(t,e)})),ce(void 0)}},erase:function(){if(Je(),ce(void 0),y.pixelEraser){var e=Array.from(Ge.current);Ge.current.clear();var t=e.map((function(e){var t=(0,i.Z)(e,2),n=t[0],r=t[1],o=O(r);return o.forEach((function(e){return e.name=""})),[n,o.map((function(e){return e.exportJSON()}))]}));if(!t.length)return;a((function(e){return m.Dw.splitStrokes(e,t)}))}else{var n=Array.from(Xe.current);if(Xe.current.clear(),!n.length)return;a((function(e){return m.Dw.eraseStrokes(e,n)}))}},select:function(){if(Je(),ue){if(Math.abs(ue.area)<1e3)return ce(void 0);var e,t=ee.current.view;if(G){ue.closePath(),ue.simplify(),ye.current||N(ue);var n=S(_e,ue.bounds);e=W(n,ue)}else{var r=S(_e,ue.bounds);e=W(r,ue);var i=new d.Path,o=ue.bounds.topCenter;i.add(o,o.subtract(new d.Point(0,100))),i.lastSegment.selected=!0,de(i)}Ae(!0),Me(e);var a=ue.bounds.bottomCenter;a&&B(!0,t.projectToView(a))}},selected:function(e){var t;if(at(e),"selected"===Te){var n=ee.current.view.projectToView(e.point);(null===(t=je.current)||void 0===t?void 0:t.segment.selected)||B(!0,n),qe.current.equals(e.point)||ft()}},text:function(e){var t;if(mt.current)return xt(),ut(e);var n=(0,i.Z)(ee.current.project.layers,2)[1];if(n){var r=null!==(t=z(n,e.point))&&void 0!==t?t:I(e.point);r.justification="left",mt.current=r,wt.current=r.exportJSON(),Fe(),q(r,ye.current)}}}[Te],nt=(0,u.useState)("auto"),rt=(0,i.Z)(nt,2),it=rt[0],ot=rt[1];(0,u.useEffect)((function(){"text"===Te||"select"===Te?ot("crosshair"):"selected"===Te?ot(G?"crosshair":"nwse-resize"):"draw"!==Te&&"erase"!==Te||ot(function(e,t){var n=e.lineWidth,r=e.eraserWidth,i=t*("erase"===e.mode?r:n);if(i<5)return"crosshair";var o=i/2;return'url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" fill="%23FFF7" width="'.concat(i,'" height="').concat(i,'" viewBox="0 0 10 10"><circle cx="5" cy="5" r="5"/></svg>\') ').concat(o," ").concat(o,", auto")}(y,he))}),[Te,G,y,he]);var at=function(e){var t;if(ue){var n=null!==(t=ue.hitTest(e.point,{segments:!0}))&&void 0!==t?t:null===fe||void 0===fe?void 0:fe.hitTest(e.point,{segments:!0,selected:!0});if(null!==n&&void 0!==n&&n.segment){if(n.segment.selected){var r=ue.bounds.center;if(!r)return;var i=n.segment.point.subtract(r);return ot(x(i.angle))}var o=n.segment.point,a=n.segment.next.next.point,u=o.subtract(a),c=u.x,s=u.y;return ot(c*s<0?"nesw-resize":"nwse-resize")}if(ue.contains(e.point))return ot("pointer");ot("crosshair")}},ut=function(e){if(mt.current)return ot("auto");var t=ee.current.project.layers[1];t&&(z(t,e.point)?ot("text"):ot("crosshair"))},ct=(0,l.Z)({selected:at,text:ut},{select:null,draw:null,erase:null})[Te],st=function(e){if("selected"===Te){var t={up:new d.Point(0,-10),down:new d.Point(0,10),left:new d.Point(-10,0),right:new d.Point(10,0)}[e.key];t&&(e.preventDefault(),t&&He(t),B(!1))}},lt=(0,l.Z)({selected:function(e){/^(delete|backspace)$/.test(e.key)&&dt(),/^(up|down|left|right)$/.test(e.key)&&ft(),/escape/.test(e.key)&&We()},text:function(e){/escape/.test(e.key)&&xt()}},{select:null,draw:null,erase:null})[Te];(0,u.useEffect)((function(){if(!E){var e=function(e){return function(t){if(ee.current.activate(),e)return e(t)}},t=ee.current,n=t.view,r=t.tool;n.onMouseDown=e(Ue),n.onMouseDrag=e(Qe),n.onMouseUp=e(tt),n.onMouseMove=e(ct),r.onMouseDrag=e($e),r.onKeyDown=e(st),r.onKeyUp=e(lt)}}));var ft=function(){if(null!==Le&&void 0!==Le&&Le.length){var e=Le.map((function(e){var t=e.name;return e.name="",[t,e.exportJSON()]}));a((function(t){return m.Dw.mutateStrokes(t,e)}))}},dt=function(){We(),Ne.length&&a((function(e){return m.Dw.eraseStrokes(e,Ne)}))},vt=function(e){ee.current.activate(),V(Le,e),ft()},pt=function(){if(ee.current.activate(),ue&&Le.length){var e=ue.bounds.size,t=e.width,n=e.height,r=new d.Point(t,n).divide(10),i=Le.map((function(e){return e.clone()}));i.forEach((function(e){return e.translate(r)})),ue.translate(r),null===fe||void 0===fe||fe.translate(r),i.forEach((function(e){return e.name=""}));var o=i.map((function(e){return e.exportJSON()})),u=[];a((function(e){return m.Dw.addStrokes(e,o,u)})),Me(u),B(!1)}},ht=function(){var e,t;ee.current.activate();var n=null===ue||void 0===ue?void 0:ue.clone();return n&&ze(n,!0),Ie(),null!==(e=null===(t=Ve.current)||void 0===t?void 0:t.toDataURL())&&void 0!==e?e:""},mt=(0,u.useRef)(),wt=(0,u.useRef)(""),gt=(0,s.Z)((function(){var e,t;(Je(),null!==(e=mt.current)&&void 0!==e&&e.name)||(null===(t=mt.current)||void 0===t||t.remove());mt.current=void 0,q(void 0,ye.current)})),xt=(0,s.Z)((function(){var e=mt.current;if(e&&(gt(),e.exportJSON()!==wt.current)){var t=e.content,n=e.name;if(e.name="",t){var r=e.exportJSON();a(n?function(e){return m.Dw.mutateStrokes(e,[[n,r]])}:function(e){return m.Dw.addStroke(e,r)})}else n&&a((function(e){return m.Dw.eraseStrokes(e,[n])}))}})),Zt=function(e){var t=mt.current;t&&(ee.current.activate(),e(t),q(new Proxy(t,{}),ye.current))};(0,u.useEffect)((function(){if("text"===Q)return xt}),[Q,xt]),(0,u.useImperativeHandle)(t,(function(){return{deleteSelected:dt,duplicateSelected:pt,rasterizeSelected:ht,mutateStyle:vt,mutatePointText:Zt}})),(0,u.useEffect)((function(){var e=function(e){return e.preventDefault()};return document.addEventListener("gesturestart",e),document.addEventListener("gesturechange",e),document.addEventListener("gestureend",e),function(){document.removeEventListener("gesturestart",e),document.removeEventListener("gesturechange",e),document.removeEventListener("gestureend",e)}}),[]),(0,p.usePinch)((function(e){var t=e.memo,n=(0,i.Z)(e.offset,1)[0],r=e.first,o=e.last,a=e.origin;ee.current.activate();var u,c,s,l=ee.current.view,f=new(v().Point)(a);if(r||!t){var p=l.element.getBoundingClientRect(),h=p.x,m=p.y;u=1,s=new d.Point(h,m),c=f.subtract(s),B(!1),gt(),ze(new d.Path.Rectangle(j,H)),Je()}else{var w=(0,i.Z)(t,3);u=w[0],c=w[1],s=w[2]}var g=f.subtract(s),x=l.viewToProject(g),Z=g.subtract(c).divide(l.zoom);l.translate(Z);var y=r?1:n/u;if(ee.current.settings.hitTolerance/=y,l.scale(y,x),!o)return[n,g,s];Promise.all([L(l,H),M(l,x,y)]).then(Ie),l.scale(1/y,x)}),{scaleBounds:{max:5,min:1},rubberband:.5,target:$});var yt=Z(X);return(0,b.jsx)("div",(0,l.Z)((0,l.Z)({className:"draw-wrapper",style:{cursor:it},"data-readonly":E},yt),{},{children:(0,b.jsx)("canvas",{ref:$,className:"draw-canvas"})}))}));k.displayName="Draw";var E=u.memo(k);function P(){var e=(0,u.useState)(),t=(0,i.Z)(e,1)[0];return(0,u.useDebugValue)(t),(0,u.useEffect)((function(){return function(){null===t||void 0===t||t.remove()}}),[t]),e}var A=function(){var e=new WeakMap;return function(t,n){var r,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=t.pathData,a=t.uid,u=null!==(r=e.get(n))&&void 0!==r?r:new Map;e.set(n,u);var c,s=u.get(a);if((null===s||void 0===s?void 0:s.stroke)===t)n.addChild(s.item),c=s.item;else{var l;try{c=n.importJSON(o)}catch(f){console.error(f)}null!==(l=c)&&void 0!==l||(c=new(v().Item)),c.name=a,u.set(a,{item:c,stroke:t})}return c.opacity=1,c.guide=i,c}}(),T=function(e,t){var n=(0,i.Z)(e,3),r=n[0],o=n[1],a=n[2];if(!r||!o||!a)return[];var u=new d.Path.Rectangle(j,t),c=u.clone(),s=u.clone();return u.fillColor=new d.Color("#fff"),r.addChild(u),o.addChild(c),a.addChild(s),o.clipped=!0,a.clipped=!0,[u,c,s]},D=function(e){var t=new d.Path.Rectangle(e,new d.Size(0,0));return t.onFrame=function(){},t},R=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.mode,i=e.lineWidth,o=e.eraserWidth,a=e.color,u=e.highlight,c=new d.Path;c.add(t),"erase"===r&&(a="#ccc",i=o),"select"===r&&(a="#009dec",i=5);var s=new d.Color(a);return("draw"===r&&u||"erase"===r&&!n)&&(s.alpha=.5,c.blendMode="multiply"),c.strokeColor=s,c.strokeWidth=i,c.strokeJoin="round",c.strokeCap="round",c.guide=!0,c},N=function(e){e.dashOffset=0,e.dashArray=[30,20],e.onFrame=function(){return e.dashOffset+=3}},M=function(e,t,n){return new Promise((function(r){if(Math.abs(n-1)<.05)return e.scale(n,t),r();var i=10;n=Math.pow(n,1/i);!function o(){e.scale(n,t),--i>0?requestAnimationFrame(o):requestAnimationFrame((function(){return r()}))}()}))},L=function(e,t){return new Promise((function(n){var r=function(e,t){var n=e.center,r=n.x,i=n.y,o=d.Size.min(e.size,t).divide(2),a=o.width,u=o.height,c=t.subtract(o),s=c.width,l=c.height,f=r<a?a:r>s?s:r,v=i<u?u:i>l?l:i;return new d.Point(f,v)}(e,t);if(e.center.equals(r))return n();var i=10;requestAnimationFrame((function t(){var o=e.center.subtract(r);e.translate(o.divide(i)),--i>0?requestAnimationFrame(t):requestAnimationFrame((function(){return n()}))}))}))},W=function(e,t){var n=function(e){return!(4!==t.segments.length||!e.isInside(t.bounds))||!e.subtract(t,{insert:!1,trace:!1}).compare(e)};return e.filter((function(e){if(!e.name)return!1;if(!e.bounds.intersects(t.bounds))return!1;if(e instanceof v().Path)return n(e);var r=new d.Path.Rectangle(e.bounds);return r.remove(),n(r)||t.isInside(e.bounds)})).map((function(e){return e.name}))},V=function(e,t){var n=t.lineWidth,r=t.color,i=t.highlight;e.forEach((function(e){if(e instanceof v().PointText&&r){var t=new d.Color(r);e.fillColor=t}if(e instanceof v().Path){if(r){var o=new d.Color(r);"multiply"===e.blendMode&&(o.alpha=.5),e.strokeColor=o}n&&(e.strokeWidth=n),e.strokeColor&&void 0!==i&&(e.strokeColor.alpha=i?.5:1,e.blendMode=i?"multiply":"normal")}}))},z=function(e,t){var n=e.hitTest(t,{class:v().PointText,fill:!0});if((null===n||void 0===n?void 0:n.item)instanceof v().PointText)return null===n||void 0===n?void 0:n.item},I=function(e){return new(v().PointText)({point:e.add(new d.Point(0,50)),content:"",fontSize:50})},O=function e(t){return t instanceof v().Path?t.isEmpty()?[]:[t]:t instanceof v().CompoundPath?t.children.map(e).flat():[]},F=n(36485),J=n(61507),B=n(23414),K=n(64239),q=n(82622),U=n(97804),Y=n(94895),H=n(64187),Q=n(27190),X=n(69228),G=n(87309),_=n(2721),$=n(74115),ee=n(64802),te={type:"text",shape:"round",size:"small"},ne=function(e,t){return{"--pos-x":e+"px","--pos-y":t+"px"}},re=function(e,t){var n={};return Object.entries(e).forEach((function(e){var r=(0,i.Z)(e,2),o=r[0],a=r[1];t&&(a+=t),n["--"+o]=a})),n},ie=function(e){var t=e.drawRef,n=e.visible,r=e.clickPoint,o=(0,u.useState)({}),a=(0,i.Z)(o,2),c=a[0],s=a[1],f=r.x,d=r.y;return(0,b.jsxs)("div",{className:"select-tool tool-options","data-visible":n,style:ne(f,d),children:[(0,b.jsx)(X.Z,{trigger:"click",placement:"bottom",overlayClassName:"style-pop",getPopupContainer:function(e){return e.parentElement},destroyTooltipOnHide:!0,content:(0,b.jsx)(_.Uk,{updateDrawCtrl:function(e){var n;s((function(t){return(0,l.Z)((0,l.Z)({},t),e)})),null===(n=t.current)||void 0===n||n.mutateStyle(e)},drawCtrl:c}),children:(0,b.jsx)(G.Z,(0,l.Z)({icon:(0,b.jsx)(J.Z,{})},te))}),(0,b.jsx)(G.Z,(0,l.Z)({icon:(0,b.jsx)(B.Z,{}),onClick:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.duplicateSelected()}},te)),(0,b.jsx)(G.Z,(0,l.Z)({icon:(0,b.jsx)(K.Z,{}),onClick:function(){if(t.current){var e=t.current.rasterizeSelected();Q.Z.confirm({title:"Screenshot",content:(0,b.jsx)("img",{className:"raster",src:e,alt:"raster"}),className:"raster-modal",icon:(0,b.jsx)(F.Z,{}),okText:"Save",onOk:function(){return(0,ee.saveAs)(e,document.title.split(" - ")[0]+".png")}})}}},te)),(0,b.jsx)(G.Z,(0,l.Z)({danger:!0,icon:(0,b.jsx)(q.Z,{}),onClick:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.deleteSelected()}},te))]})},oe=function(e){var t,n,r,i=e.pointText,o=e.drawRef,a=e.renderSlow,u=i.view,c=i.position,s=i.fontSize,f=i.fontWeight,v=i.leading,p=i.content,h=i.rotation,m=u.projectToView(c),w=m.x,g=m.y,x=i.bounds,Z=x.topLeft,y=x.bottomLeft,C=u.projectToView(Z),S=C.x,j=C.y,k=u.projectToView(y),E=k.x,P=k.y,A=j<60,T=i.viewMatrix.scaling.x,D=i.internalBounds,R=D.width,N=D.height,M=null!==(t=+v/+s)&&void 0!==t?t:1.2,L=null!==(n=null===(r=i.fillColor)||void 0===r?void 0:r.toCSS(!0))&&void 0!==n?n:$.Qk[0],W=(0,b.jsx)(X.Z,{content:(0,b.jsx)(_.Q5,{color:L,setColor:function(e){var t;return null===(t=o.current)||void 0===t?void 0:t.mutatePointText((function(t){t.fillColor=new d.Color(e)}))}}),trigger:"click",overlayStyle:{width:200},placement:"bottom",getPopupContainer:function(e){return e.parentElement},children:(0,b.jsx)(G.Z,(0,l.Z)((0,l.Z)({},te),{},{icon:(0,b.jsx)(J.Z,{})}))});return(0,b.jsxs)("div",{className:"text-tool",style:(0,l.Z)((0,l.Z)((0,l.Z)((0,l.Z)({},re({scale:T,color:L})),re({rotation:h},"deg")),re({width:R,height:N},"px")),ne(w,g)),children:[(0,b.jsx)("div",{className:"textarea-wrapper","data-slow":a,style:{fontSize:s,fontWeight:f,lineHeight:M},children:(0,b.jsx)("textarea",{autoFocus:!p,placeholder:"Text...",value:p,onChange:function(e){var t;null===(t=o.current)||void 0===t||t.mutatePointText((function(t){t.content=e.target.value}))}})}),(0,b.jsxs)("div",{className:"tool-options text-options","data-bottom":A,style:(0,l.Z)({},A?ne(E,P):ne(S,j)),children:[W,(0,b.jsx)(G.Z,(0,l.Z)((0,l.Z)({onClick:function(){var e;null===(e=o.current)||void 0===e||e.mutatePointText((function(e){var t="bold"===e.fontWeight;e.fontWeight=t?"normal":"bold"}))}},te),{},{type:"bold"===f?"link":"text",icon:(0,b.jsx)(U.Z,{})})),(0,b.jsx)(G.Z,(0,l.Z)((0,l.Z)({},te),{},{icon:(0,b.jsx)(Y.Z,{}),onClick:function(){var e;null===(e=o.current)||void 0===e||e.mutatePointText((function(e){var t=e.bounds.topLeft;e.scale(.9,t)}))}})),(0,b.jsx)(G.Z,(0,l.Z)((0,l.Z)({},te),{},{icon:(0,b.jsx)(H.Z,{}),onClick:function(){var e;null===(e=o.current)||void 0===e||e.mutatePointText((function(e){var t=e.bounds.topLeft;e.scale(1.1,t)}))}}))]})]})},ae=n(763),ue=n(19348),ce=n(24124),se=function(e){var t=e.thumbnail,o=e.drawState,c=e.teamStateMap,s=e.updateState,l=e.pdfIndex,f=e.noteID,d=void 0===f?"":f,v=e.preview,p=void 0!==v&&v,h=e.onViewChange,m=e.preload,w=void 0!==m&&m,g=e.ignores,x=void 0===g?(0,ce.l4)():g,Z=e.skipInView,y=void 0!==Z&&Z,C=h&&(0,ae.range)(0,1.2,.2),S=(0,ue.YD)({threshold:C,skip:y}),j=(0,i.Z)(S,3),k=j[0],E=j[1],P=j[2];(0,u.useEffect)((function(){if(h)return P&&E?void h(P.intersectionRatio):h(0)}),[E,P,h]);var A=(0,u.useState)(),T=(0,i.Z)(A,2),D=T[0],R=T[1],N=(0,u.useCallback)((0,ae.once)((0,r.Z)(a().mark((function e(){var t,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l&&d){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,Promise.all([n.e(643),n.e(138)]).then(n.bind(n,21176));case 4:return t=e.sent,r=t.getNotePageImage,e.t0=R,e.next=9,r(d,l);case 9:e.t1=e.sent,(0,e.t0)(e.t1);case 11:case"end":return e.stop()}}),e)})))),[l,d]),M=E||w;(0,u.useEffect)((function(){!p&&M&&N()}),[M,p,N]);var L=(0,u.useMemo)((function(){return null===c||void 0===c?void 0:c.deleteAll(x).toList().toArray()}),[c,x]),W=Boolean(D||!l),V=M&&W,z=o.height/o.width;return(0,b.jsxs)("div",{ref:k,className:"page-wrapper",children:[(0,b.jsx)("svg",{className:"size-holder",viewBox:"0 0 100 ".concat(100*z)}),V&&(0,b.jsx)(le,{drawState:o,otherStates:L,updateState:s,imgSrc:D||t,preview:p})]})};se.displayName="PageWrapper";var le=function(e){var t=e.drawState,n=e.updateState,r=e.otherStates,o=e.preview,a=void 0!==o&&o,l=e.imgSrc,f=(0,c.gX)(),d=(0,u.useRef)(null),v=(0,u.useState)(!1),p=(0,i.Z)(v,2),h=p[0],w=p[1],g=(0,u.useState)(j),x=(0,i.Z)(g,2),Z=x[0],y=x[1],C=(0,u.useState)(),S=(0,i.Z)(C,2),k=S[0],P=S[1],A=(0,u.useState)(!1),T=(0,i.Z)(A,2),D=T[0],R=T[1],N=(0,s.Z)((function(e){if(n){var r=e instanceof m.Dw?e:e(t);r!==t&&n(r)}}));return a?(0,b.jsx)(E,{drawState:t,otherStates:r,imgSrc:l,readonly:!0}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(E,{drawState:t,otherStates:r,onChange:N,imgSrc:l,drawCtrl:f,ref:d,toggleTextTool:function(e,t){P(e),R(t)},toggleSelectTool:function(e,t){y((function(e){return null!==t&&void 0!==t?t:e})),w(e)}}),(0,b.jsx)(ie,{drawRef:d,visible:h,clickPoint:Z}),k&&(0,b.jsx)(oe,{drawRef:d,pointText:k,renderSlow:D})]})},fe=u.memo(se)},70587:function(e,t,n){"use strict";n.d(t,{w3:function(){return b},Hq:function(){return g},Eq:function(){return w},gX:function(){return C},F7:function(){return S}});var r=n(1413),i=n(29439),o=n(15861),a=n(87757),u=n.n(a),c=n(72791),s=n(50419),l=n(87309),f=n(31752),d=n(98272),v=n(61842),p=n.n(v),h=n(763),m=n(80184),w=[10,20,30,50],g={mode:"draw",finger:!0,lineWidth:10,eraserWidth:10,color:"#000000",highlight:!1,lasso:!0,pixelEraser:!1,widthList:w};function x(){return(x=(0,o.Z)(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p().getItem("DRAW_CTRL");case 2:if(t=e.sent){e.next=7;break}return t=g,e.next=7,p().setItem("DRAW_CTRL",t);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(){return(Z=(0,o.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p().setItem("DRAW_CTRL",t);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var y=c.createContext({drawCtrl:g,updateDrawCtrl:function(){}});function C(){var e=(0,c.useContext)(y).drawCtrl;return(0,c.useDebugValue)(e),e}function S(){return(0,c.useContext)(y).updateDrawCtrl}var b=function(e){var t=e.children,n=(0,c.useState)(g),o=(0,i.Z)(n,2),a=o[0],u=o[1];(0,c.useEffect)((function(){(function(){return x.apply(this,arguments)})().then(u)}),[]);var s=function(e){u((function(t){var n=(0,r.Z)((0,r.Z)({},t),e);return function(e){Z.apply(this,arguments)}(n),n}))};return(0,c.useEffect)((function(){var e=function(e){e.isPrimary&&"pen"===e.pointerType&&a.finger&&j((function(){return s({finger:!1})}))};return document.addEventListener("pointerup",e),function(){return document.removeEventListener("pointerup",e)}}),[a.finger]),(0,m.jsx)(y.Provider,{value:{drawCtrl:a,updateDrawCtrl:s},children:t})},j=(0,h.once)(function(){var e=(0,o.Z)(u().mark((function e(t){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=function(){s.ZP.destroy("DETECT_PENCIL"),p().setItem("SKIP_PENCIL_MSG",!0)},e.next=3,p().getItem("SKIP_PENCIL_MSG");case 3:if(!e.sent){e.next=5;break}return e.abrupt("return");case 5:s.ZP.info({content:(0,m.jsxs)(m.Fragment,{children:["Your device supports",(0,m.jsx)(l.Z,{shape:"round",size:"small",icon:(0,m.jsx)(f.Z,{}),onClick:function(){t(),n()},children:"Pencil only"}),(0,m.jsx)(l.Z,{size:"small",type:"text",shape:"circle",icon:(0,m.jsx)(d.Z,{style:{color:"#999"}}),onClick:n})]}),key:"DETECT_PENCIL",className:"pencil-msg"});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},96153:function(e,t,n){"use strict";function r(e,t){var n=document.createElement("canvas"),r=n.getContext("2d");if(!r)throw new Error("can't get virtual canvas context");return n.width=e,n.height=t,{canvas:n,context:r}}function i(e){e.width=1,e.height=1;var t=e.getContext("2d");null===t||void 0===t||t.clearRect(0,0,1,1)}n.d(t,{j:function(){return i},v:function(){return r}})},2721:function(e,t,n){"use strict";n.d(t,{Q5:function(){return Z},Uk:function(){return w},Db:function(){return g}});var r=n(4942),i=n(93433),o=n(29439),a=n(72791),u=n(70587),c=n(35873),s=n(82670),l=n(69228),f=n(96272),d=n(53163),v=n(74115),p=n(22568),h=n(24124),m=n(80184),w=function(e){var t=e.updateDrawCtrl,n=e.drawCtrl,r=n.highlight,i=n.color,u=(0,a.useState)(!1),c=(0,o.Z)(u,2),s=c[0],l=c[1];return(0,m.jsxs)("div",{className:"pen-panel","data-blur":s,"data-hi":r,children:[(0,m.jsxs)("div",{className:"pen-status",children:[(0,m.jsx)(g,{updateDrawCtrl:t,drawCtrl:n,setPanelBlur:l}),(0,m.jsx)(x,{checked:r,updateDrawCtrl:t})]}),(0,m.jsx)(Z,{color:i||"",setColor:function(e){return t({color:e})}})]})},g=function(e){var t,n,v=e.updateDrawCtrl,p=e.drawCtrl,w=e.setPanelBlur,g=void 0===w?function(){}:w,x=e.field,Z=void 0===x?"lineWidth":x,y=p[Z],C=null!==(t=p.widthList)&&void 0!==t?t:u.Eq,S="lineWidth"===Z&&null!==(n=p.color)&&void 0!==n?n:"#aaa",b=(0,a.useMemo)((function(){return C.indexOf(null!==y&&void 0!==y?y:-1)}),[y,C]),j=(0,a.useState)((0,h.aV)([!1,!1,!1,!1])),k=(0,o.Z)(j,2),E=k[0],P=k[1];(0,a.useEffect)((function(){E.includes(!0)?g(!0):g(!1)}),[E,g]);var A=function(e){return{"--real-size":"calc(".concat(100/s.mF,"vw * ").concat(e,")")}},T=[{value:-1,label:null}].concat((0,i.Z)(C.map((function(e,t){return{value:t,label:(0,m.jsx)(l.Z,{visible:E.get(t),onVisibleChange:function(e){return P((function(n){return n.set(t,e)}))},trigger:b===t?["click"]:[],placement:"bottom",destroyTooltipOnHide:!0,content:(0,m.jsx)(f.Z,{min:5,max:100,className:"ctrl-slider",defaultValue:e,onAfterChange:function(e){if(C.includes(e))return P((function(e){return e.set(t,!1)})),v((0,r.Z)({},Z,e));var n=C.slice();n[t]=e,v((0,r.Z)({widthList:n},Z,e))}}),children:(0,m.jsx)("div",{className:"circle-wrapper",style:A(e),children:(0,m.jsx)(c.W,{className:"width-circle "+Z,color:S})})})}}))));return(0,m.jsx)(d.Z,{className:"width-seg",value:b,options:T,onChange:function(e){var t;return v((0,r.Z)({},Z,null!==(t=C[+e])&&void 0!==t?t:10))}})},x=function(e){var t=e.checked,n=void 0!==t&&t,r=e.updateDrawCtrl;return(0,m.jsxs)("label",{className:"hi-wrapper",children:[(0,m.jsx)("input",{type:"checkbox",name:"highlight",checked:n,onChange:function(e){return r({highlight:e.target.checked})}}),(0,m.jsx)("div",{className:"hi-switch",children:(0,m.jsx)(p.Z,{type:"icon-Highlight"})})]})},Z=function(e){var t=e.setColor,n=e.color;return(0,m.jsx)("div",{className:"color-select",children:v.Qk.map((function(e){return(0,m.jsxs)("label",{children:[(0,m.jsx)("input",{checked:n===e,type:"radio",name:"color",onChange:function(n){return n.target.checked&&t(e)}}),(0,m.jsx)("div",{"data-color":e,className:"circle",style:{backgroundColor:e,borderColor:e}})]},e)}))})}},90858:function(){},64158:function(){}}]);
//# sourceMappingURL=478.fc488351.chunk.js.map