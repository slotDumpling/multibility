{"version":3,"file":"static/js/274.f8f2430a.chunk.js","mappings":"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","sources":["lib/draw/drawCtrl.ts","component/reader/ReaderTools.tsx","lib/draw/StateSet.ts","lib/array.ts","component/ui/DigitDisplay.tsx","component/ui/IconFont.tsx","component/reader/PageNav.tsx","component/reader/DrawTools.tsx","component/draw/SelectTool.tsx","component/draw/Draw.tsx","lib/touch/touch.ts","lib/hooks.ts","component/reader/Reader.tsx","lib/draw/TeamState.ts","lib/network/io.ts","component/reader/Team.tsx","lib/draw/drawer.ts"],"sourcesContent":["import localforage from \"localforage\";\r\n\r\nexport interface DrawCtrl {\r\n  mode: \"draw\" | \"erase\" | \"select\"\r\n  finger: boolean;\r\n  lineWidth: number;\r\n  eraserWidth: number;\r\n  color: string;\r\n  highlight: boolean;\r\n}\r\n\r\nexport const defaultDrawCtrl: Readonly<DrawCtrl> = {\r\n  mode: 'draw',\r\n  finger: true,\r\n  lineWidth: 10,\r\n  eraserWidth: 10,\r\n  color: \"#000000\",\r\n  highlight: false,\r\n};\r\n\r\nexport async function getDrawCtrl() {\r\n  let drawCtrl = (await localforage.getItem(\"DRAW_CTRL\")) as DrawCtrl | null;\r\n  if (!drawCtrl) {\r\n    drawCtrl = defaultDrawCtrl;\r\n    await localforage.setItem(\"DRAW_CTRL\", drawCtrl);\r\n  }\r\n  return drawCtrl;\r\n}\r\n\r\nexport async function saveDrawCtrl(drawCtrl: DrawCtrl) {\r\n  await localforage.setItem(\"DRAW_CTRL\", drawCtrl);\r\n}\r\n","import { Button, Input, message } from \"antd\";\r\nimport React, { useContext, useEffect, useState } from \"react\";\r\nimport { ReaderMethodCtx, ReaderStateCtx } from \"./Reader\";\r\nimport { PlusOutlined } from \"@ant-design/icons\";\r\n\r\nexport const AddPageButton = () => {\r\n  const { addFinalPage } = useContext(ReaderMethodCtx);\r\n  return (\r\n    <div className=\"add-btn-wrapper\">\r\n      <Button\r\n        type=\"dashed\"\r\n        icon={<PlusOutlined />}\r\n        block\r\n        onClick={addFinalPage}\r\n      >\r\n        New page\r\n      </Button>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport const NoteHeader = () => {\r\n  const { noteInfo } = useContext(ReaderStateCtx);\r\n  const [noteName, setNoteName] = useState(\"\");\r\n  useEffect(() => {\r\n    if (!noteInfo) return;\r\n    setNoteName(noteInfo?.name);\r\n  }, [noteInfo]);\r\n\r\n  if (!noteInfo) return null;\r\n\r\n  return (\r\n    <div className=\"note-header\">\r\n      <Input value={noteName} bordered={false} />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport const showPageDelMsg = (onUndo: () => void) => {\r\n  message.warning({\r\n    content: (\r\n      <>\r\n        One page was deleted.\r\n        <Button\r\n          size=\"small\"\r\n          type=\"link\"\r\n          onClick={() => {\r\n            message.destroy(\"DELETE\");\r\n            onUndo();\r\n          }}\r\n        >\r\n          Undo\r\n        </Button>\r\n      </>\r\n    ),\r\n    key: \"DELETE\",\r\n    duration: 10,\r\n  });\r\n};\r\n","import { List, Map, Record } from \"immutable\";\r\nimport { DrawState, Operation, WIDTH } from \"./DrawState\";\r\nimport { NotePage } from \"../note/note\";\r\n\r\ninterface StateSetRecordType {\r\n  states: Map<string, DrawState>;\r\n  editStack: List<string>;\r\n  undoStack: List<string>;\r\n}\r\n\r\nconst defaultRecord: Readonly<StateSetRecordType> = {\r\n  states: Map(),\r\n  editStack: List(),\r\n  undoStack: List(),\r\n};\r\n\r\ntype StateSetRecord = Record<StateSetRecordType>;\r\nconst defaultFactory = Record(defaultRecord);\r\n\r\nexport type SetOperation = Operation & { pageID: string };\r\n\r\nexport class StateSet {\r\n  constructor(\r\n    private immutable: StateSetRecord,\r\n    public lastOp?: SetOperation\r\n  ) {}\r\n\r\n  static createFromList(list: [string, DrawState][]) {\r\n    return new StateSet(defaultFactory().set(\"states\", Map(list)));\r\n  }\r\n\r\n  static createFromPages(\r\n    pageRec: globalThis.Record<string, NotePage>,\r\n    width = WIDTH\r\n  ) {\r\n    const entries = Object.entries(pageRec);\r\n    return StateSet.createFromList(\r\n      entries.map(([key, { state, ratio }]) => [\r\n        key,\r\n        DrawState.loadFromFlat(state, width, width * ratio),\r\n      ])\r\n    );\r\n  }\r\n\r\n  getImmutable() {\r\n    return this.immutable;\r\n  }\r\n\r\n  getStates() {\r\n    return this.getImmutable().get(\"states\");\r\n  }\r\n\r\n  getOneState(pageID: string) {\r\n    return this.getStates().get(pageID);\r\n  }\r\n\r\n  getEditStack() {\r\n    return this.getImmutable().get(\"editStack\");\r\n  }\r\n\r\n  getUndoStack() {\r\n    return this.getImmutable().get(\"undoStack\");\r\n  }\r\n\r\n  setState(pageID: string, drawState: DrawState) {\r\n    const prevDS = this.getOneState(pageID);\r\n    if (!prevDS || prevDS === drawState) return this;\r\n    let currRecord = this.getImmutable()\r\n      .update(\"states\", (s) => s.set(pageID, drawState))\r\n      .update(\"editStack\", (l) => l.push(pageID))\r\n      .delete(\"undoStack\");\r\n\r\n    const { lastOp } = drawState;\r\n    const lastSetOp = lastOp && { ...lastOp, pageID };\r\n\r\n    return new StateSet(currRecord, lastSetOp);\r\n  }\r\n\r\n  updateState(pageID: string, cb: (prevDS: DrawState) => DrawState) {\r\n    const prevDS = this.getOneState(pageID);\r\n    if (!prevDS) return this;\r\n    const currDS = cb(prevDS);\r\n    return new StateSet(\r\n      this.getImmutable().update(\"states\", (s) => s.set(pageID, currDS))\r\n    );\r\n  }\r\n\r\n  addState(pageID: string, notePage: NotePage, width = WIDTH) {\r\n    const { state, ratio } = notePage;\r\n    const newDS = DrawState.loadFromFlat(state, width, width * ratio);\r\n    const currRecord = this.getImmutable().update(\"states\", (s) =>\r\n      s.set(pageID, newDS)\r\n    );\r\n    return new StateSet(currRecord);\r\n  }\r\n\r\n  deleteState(pageID: string) {\r\n    return new StateSet(\r\n      this.getImmutable().update(\"states\", (s) => s.delete(pageID))\r\n    );\r\n  }\r\n\r\n  isUndoable() {\r\n    return this.getEditStack().size > 0;\r\n  }\r\n\r\n  isRedoable() {\r\n    return this.getUndoStack().size > 0;\r\n  }\r\n\r\n  undo() {\r\n    if (!this.isUndoable()) return this;\r\n    const lastUid = this.getEditStack().last();\r\n    const prevDS = lastUid && this.getOneState(lastUid);\r\n    if (!prevDS) return this;\r\n\r\n    const newDS = DrawState.undo(prevDS);\r\n    const { lastOp } = newDS;\r\n    const lastSetOp = lastOp && { pageID: lastUid, ...lastOp };\r\n\r\n    return new StateSet(\r\n      this.getImmutable()\r\n        .update(\"editStack\", (s) => s.pop())\r\n        .update(\"undoStack\", (s) => s.push(lastUid))\r\n        .update(\"states\", (s) => s.set(lastUid, newDS)),\r\n      lastSetOp\r\n    );\r\n  }\r\n\r\n  redo() {\r\n    if (!this.isRedoable()) return this;\r\n    const lastUid = this.getUndoStack().last();\r\n    const prevDS = lastUid && this.getOneState(lastUid);\r\n    if (!prevDS) return this;\r\n\r\n    const newDS = DrawState.redo(prevDS);\r\n    const { lastOp } = newDS;\r\n    const lastSetOp = lastOp && { pageID: lastUid, ...lastOp };\r\n\r\n    return new StateSet(\r\n      this.getImmutable()\r\n        .update(\"undoStack\", (s) => s.pop())\r\n        .update(\"editStack\", (s) => s.push(lastUid))\r\n        .update(\"states\", (s) => s.set(lastUid, newDS)),\r\n      lastSetOp\r\n    );\r\n  }\r\n\r\n  getLastDS(): [string, DrawState] | undefined {\r\n    const pageID = this.lastOp?.pageID;\r\n    const ds = pageID && this.getOneState(pageID);\r\n    return ds ? [pageID, ds] : undefined;\r\n  }\r\n}\r\n","export function exchange<T>(list: T[], fromIndex: number, toIndex: number) {\r\n  const result = list.slice();\r\n  const [removed] = result.splice(fromIndex, 1);\r\n  result.splice(toIndex, 0, removed);\r\n  return result;\r\n}\r\n\r\nexport function insertAfter<T>(list: T[], prevItem: T, newItem: T) {\r\n  const prevIndex = list.indexOf(prevItem);\r\n  const curr = list.slice();\r\n  if (prevIndex === -1) return curr;\r\n  curr.splice(prevIndex + 1, 0, newItem);\r\n  return curr;\r\n}\r\n","import classNames from \"classnames\";\r\nimport React, { useEffect, useState } from \"react\";\r\nimport \"./digitDisplay.sass\";\r\n\r\nfunction num2digits(num: number): number[] {\r\n  return String(num)\r\n    .padStart(4, \"0\")\r\n    .split(\"\")\r\n    .map((s) => Number(s));\r\n}\r\n\r\nexport default function DigitDisplay({ value }: { value: number }) {\r\n  const [randomNum, setRandomNum] = useState(9999);\r\n  const displayNum = value >= 0 ? value : randomNum;\r\n  const digits = num2digits(displayNum);\r\n\r\n  function resetRandom() {\r\n    setRandomNum(Math.floor(Math.random() * 10000));\r\n  }\r\n  useEffect(() => {\r\n    if (value !== -1) return setRandomNum(9999);\r\n    const timer = setTimeout(resetRandom, 100);\r\n    return () => clearTimeout(timer);\r\n  }, [value]);\r\n\r\n  return (\r\n    <div className={classNames(\"digit-display\", { disabled: value === -2 })}>\r\n      {digits.map((d, idx) => (\r\n        <Digit key={idx} digit={d} />\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction Digit({ digit }: { digit: number }) {\r\n  if (!(digit <= 9 && digit >= 0)) {\r\n    return <div className=\"digit\">*</div>;\r\n  }\r\n  return <div className=\"digit\">{digit}</div>;\r\n}\r\n","import { createFromIconfontCN } from \"@ant-design/icons\";\r\n\r\nexport default createFromIconfontCN({\r\n  scriptUrl: \"//at.alicdn.com/t/font_3181679_eb02zt96p4p.js\",\r\n});\r\n","import { Avatar, Button, Drawer, Menu, Popover, Tabs } from \"antd\";\r\nimport React, {\r\n  FC,\r\n  useRef,\r\n  useMemo,\r\n  useState,\r\n  useEffect,\r\n  useContext,\r\n  MouseEvent,\r\n} from \"react\";\r\nimport { PageWrapper, ReaderMethodCtx, ReaderStateCtx } from \"./Reader\";\r\nimport {\r\n  MoreOutlined,\r\n  PlusOutlined,\r\n  CopyOutlined,\r\n  DeleteOutlined,\r\n  MenuFoldOutlined,\r\n  MenuUnfoldOutlined,\r\n} from \"@ant-design/icons\";\r\nimport IconFont from \"../ui/IconFont\";\r\nimport {\r\n  Draggable,\r\n  Droppable,\r\n  DropResult,\r\n  DragDropContext,\r\n} from \"react-beautiful-dnd\";\r\nimport { AddPageButton } from \"./ReaderTools\";\r\nimport { exchange } from \"../../lib/array\";\r\nimport { Setter } from \"../../lib/hooks\";\r\nimport classNames from \"classnames\";\r\nimport \"./preview.sass\";\r\nimport { UserAvatar } from \"./DrawTools\";\r\nimport { TeamCtx } from \"./Team\";\r\n\r\nconst PageNavContent = ({\r\n  activeKey,\r\n  setActiveKey,\r\n}: {\r\n  activeKey: string;\r\n  setActiveKey: Setter<string>;\r\n}) => {\r\n  const { pageOrder, inviewPages } = useContext(ReaderStateCtx);\r\n  const { scrollPage, saveReorder } = useContext(ReaderMethodCtx);\r\n  const refRec = useRef<Record<string, HTMLElement>>({});\r\n  const listEl = useRef<HTMLDivElement>();\r\n\r\n  const onDragEnd = ({ source, destination }: DropResult) => {\r\n    if (!destination || !pageOrder) return;\r\n    const { index: fromIndex } = source;\r\n    const { index: toIndex } = destination;\r\n    if (fromIndex === toIndex) return; \r\n    const pageID = pageOrder[fromIndex];\r\n    const newOrder = exchange(pageOrder, fromIndex, toIndex);\r\n    saveReorder(newOrder, true);\r\n    requestAnimationFrame(() => scrollPage(pageID));\r\n  };\r\n\r\n  const currpageID = useMemo(\r\n    () => pageOrder?.find((pageID) => inviewPages.has(pageID)) || \"\",\r\n    [pageOrder, inviewPages]\r\n  );\r\n\r\n  useEffect(() => {\r\n    refRec.current[currpageID]?.scrollIntoView();\r\n    const itemHeight = refRec.current[currpageID]?.clientHeight || 0;\r\n    const listHeight = listEl.current?.clientHeight || 0;\r\n    listEl.current?.scrollBy(0, -listHeight / 2 + itemHeight / 2);\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"preview-container\">\r\n      <PreviewTabs activeKey={activeKey} setActiveKey={setActiveKey} />\r\n      <DragDropContext onDragEnd={onDragEnd}>\r\n        <Droppable droppableId=\"droppable\">\r\n          {({ droppableProps, innerRef, placeholder }) => (\r\n            <div\r\n              className=\"page-list\"\r\n              ref={(e) => {\r\n                innerRef(e);\r\n                if (e) listEl.current = e;\r\n              }}\r\n              {...droppableProps}\r\n            >\r\n              {pageOrder?.map((uid, index) => (\r\n                <PagePreview\r\n                  key={uid}\r\n                  uid={uid}\r\n                  mode={activeKey}\r\n                  pageIndex={index}\r\n                  currpageID={currpageID}\r\n                  refRec={refRec.current}\r\n                />\r\n              ))}\r\n              {placeholder}\r\n              {activeKey === \"ALL\" && <AddPageButton />}\r\n            </div>\r\n          )}\r\n        </Droppable>\r\n      </DragDropContext>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst PagePreview: FC<{\r\n  uid: string;\r\n  mode: string;\r\n  pageIndex: number;\r\n  currpageID: string;\r\n  refRec: Record<string, HTMLElement>;\r\n}> = ({ uid, pageIndex, mode, currpageID, refRec }) => {\r\n  const { stateSet, teamState, pageRec } = useContext(ReaderStateCtx);\r\n  const { scrollPage, switchPageMarked } = useContext(ReaderMethodCtx);\r\n  const { ignores } = useContext(TeamCtx);\r\n  const [chosen, setChosen] = useState(\"\");\r\n\r\n  const page = pageRec && pageRec[uid];\r\n  const drawState = stateSet?.getOneState(uid);\r\n  const teamStateMap = teamState?.getOnePageState(uid);\r\n  const userIDs = useMemo(\r\n    () =>\r\n      teamState\r\n        ?.getOnePageValidUser(uid)\r\n        .filter((userID) => !ignores.has(userID)),\r\n    [teamState, ignores, uid]\r\n  );\r\n  if (!page || !drawState) return null;\r\n\r\n  if (\r\n    mode === \"WRITTEN\" &&\r\n    drawState.isEmpty() &&\r\n    (!teamStateMap || teamStateMap.every((ds) => ds.isEmpty()))\r\n  ) {\r\n    return null;\r\n  } else if (mode === \"MARKED\" && !page.marked) {\r\n    return null;\r\n  }\r\n\r\n  const switchMarked = (e: MouseEvent<HTMLSpanElement>) => {\r\n    switchPageMarked(uid);\r\n    e.stopPropagation();\r\n  };\r\n  const curr = currpageID === uid;\r\n  const dragDisabled = mode !== \"ALL\";\r\n\r\n  return (\r\n    <Draggable\r\n      draggableId={uid}\r\n      index={pageIndex}\r\n      isDragDisabled={dragDisabled}\r\n    >\r\n      {(\r\n        { innerRef, draggableProps, dragHandleProps },\r\n        { isDragging: drag }\r\n      ) => {\r\n        const { image, marked } = page;\r\n        return (\r\n          <div\r\n            ref={(e) => {\r\n              innerRef(e);\r\n              if (e) refRec[uid] = e;\r\n            }}\r\n            className={classNames(\"page\", { curr, drag })}\r\n            onClick={() => scrollPage(uid)}\r\n            {...draggableProps}\r\n            {...dragHandleProps}\r\n          >\r\n            <PageWrapper\r\n              uid={uid}\r\n              drawState={teamStateMap?.get(chosen) || drawState}\r\n              teamStateMap={chosen ? undefined : teamStateMap}\r\n              thumbnail={image}\r\n              preview\r\n            />\r\n            <span\r\n              className={classNames(\"bookmark\", { marked })}\r\n              onClickCapture={switchMarked}\r\n            />\r\n            <span className=\"index\">{pageIndex + 1}</span>\r\n            <TeamAvatars\r\n              userIDs={userIDs}\r\n              chosen={chosen}\r\n              setChosen={setChosen}\r\n            />\r\n            <PreviewOption uid={uid} />\r\n          </div>\r\n        );\r\n      }}\r\n    </Draggable>\r\n  );\r\n};\r\n\r\nconst TeamAvatars: FC<{\r\n  userIDs?: string[];\r\n  chosen: string;\r\n  setChosen: Setter<string>;\r\n}> = ({ userIDs, chosen, setChosen }) => {\r\n  return (\r\n    <Avatar.Group\r\n      maxCount={2}\r\n      size=\"default\"\r\n      className={classNames(\"team-group\", { chosen })}\r\n    >\r\n      {userIDs?.map((userID) => (\r\n        <UserAvatar\r\n          key={userID}\r\n          size=\"default\"\r\n          userID={userID}\r\n          className=\"preview-avatar\"\r\n          chosen={chosen === userID}\r\n          onClick={() => setChosen((prev) => (prev === userID ? \"\" : userID))}\r\n        />\r\n      ))}\r\n    </Avatar.Group>\r\n  );\r\n};\r\n\r\nconst PreviewOption = ({ uid }: { uid: string }) => {\r\n  const [popShow, setPopShow] = useState(false);\r\n  const { addPage, deletePage } = useContext(ReaderMethodCtx);\r\n\r\n  const menu = (\r\n    <Menu\r\n      onClick={({ key, domEvent }) => {\r\n        if (key === \"ADD\") {\r\n          addPage(uid);\r\n        } else if (key === \"COPY\") {\r\n          addPage(uid, true);\r\n        } else if (key === \"DELETE\") {\r\n          deletePage(uid);\r\n        }\r\n        domEvent.stopPropagation();\r\n        setPopShow(false);\r\n      }}\r\n      items={[\r\n        { key: \"ADD\", icon: <PlusOutlined />, label: \"Add page\" },\r\n        { key: \"COPY\", icon: <CopyOutlined />, label: \"Duplicate\" },\r\n        {\r\n          key: \"DELETE\",\r\n          icon: <DeleteOutlined />,\r\n          label: \"Delete\",\r\n          danger: true,\r\n        },\r\n      ]}\r\n    ></Menu>\r\n  );\r\n  return (\r\n    <Popover\r\n      content={menu}\r\n      trigger=\"click\"\r\n      placement=\"left\"\r\n      visible={popShow}\r\n      onVisibleChange={setPopShow}\r\n      destroyTooltipOnHide\r\n    >\r\n      <span\r\n        className=\"option\"\r\n        onClickCapture={(e) => {\r\n          setPopShow((prev) => !prev);\r\n          e.stopPropagation();\r\n        }}\r\n      >\r\n        <MoreOutlined />\r\n      </span>\r\n    </Popover>\r\n  );\r\n};\r\n\r\nconst PreviewTabs = ({\r\n  activeKey,\r\n  setActiveKey,\r\n}: {\r\n  activeKey: string;\r\n  setActiveKey: (key: string) => void;\r\n}) => {\r\n  const { TabPane } = Tabs;\r\n  return (\r\n    <Tabs\r\n      className=\"tabs\"\r\n      activeKey={activeKey}\r\n      onChange={setActiveKey}\r\n      tabBarGutter={10}\r\n      size=\"small\"\r\n      centered\r\n    >\r\n      <TabPane tab={<IconFont type=\"icon-uf_paper\" />} key=\"ALL\" />\r\n      <TabPane tab={<IconFont type=\"icon-bookmark2\" />} key=\"MARKED\" />\r\n      <TabPane tab={<IconFont type=\"icon-write\" />} key=\"WRITTEN\" />\r\n    </Tabs>\r\n  );\r\n};\r\n\r\nexport default function PageNav() {\r\n  const [navOn, setNavOn] = useState(false);\r\n  const [activeKey, setActiveKey] = useState<string>(\"ALL\");\r\n  const title = {\r\n    ALL: \"All Pages\",\r\n    MARKED: \"Bookmarks\",\r\n    WRITTEN: \"Notes\",\r\n  }[activeKey];\r\n\r\n  return (\r\n    <>\r\n      <Button\r\n        type=\"text\"\r\n        icon={navOn ? <MenuUnfoldOutlined /> : <MenuFoldOutlined />}\r\n        onClick={() => setNavOn((prev) => !prev)}\r\n      />\r\n      <Drawer\r\n        visible={navOn}\r\n        onClose={() => setNavOn(false)}\r\n        width={200}\r\n        title={title}\r\n        closable={false}\r\n        className=\"preview-drawer\"\r\n        contentWrapperStyle={{ boxShadow: \"none\" }}\r\n        bodyStyle={{ padding: 0, overflow: \"hidden\" }}\r\n        headerStyle={{ textAlign: \"center\", borderTop: \"1px solid #eee\" }}\r\n        destroyOnClose\r\n      >\r\n        <PageNavContent activeKey={activeKey} setActiveKey={setActiveKey} />\r\n      </Drawer>\r\n    </>\r\n  );\r\n}\r\n","import React, {\r\n  FC,\r\n  useMemo,\r\n  useState,\r\n  useEffect,\r\n  useContext,\r\n  CSSProperties,\r\n} from \"react\";\r\nimport {\r\n  Badge,\r\n  Alert,\r\n  Avatar,\r\n  Button,\r\n  Slider,\r\n  Divider,\r\n  message,\r\n  Popover,\r\n  Popconfirm,\r\n} from \"antd\";\r\nimport Search from \"antd/lib/input/Search\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { ReaderMethodCtx, ReaderStateCtx } from \"./Reader\";\r\nimport { TeamCtx } from \"./Team\";\r\nimport DigitDisplay from \"../ui/DigitDisplay\";\r\nimport { colors, getHashedColor } from \"../../lib/color\";\r\nimport { getUserID, saveUserName } from \"../../lib/user\";\r\nimport { DrawCtrl, saveDrawCtrl } from \"../../lib/draw/drawCtrl\";\r\nimport PageNav from \"./PageNav\";\r\nimport {\r\n  HomeFilled,\r\n  EyeOutlined,\r\n  FormOutlined,\r\n  UndoOutlined,\r\n  RedoOutlined,\r\n  SaveOutlined,\r\n  TeamOutlined,\r\n  CopyOutlined,\r\n  CheckOutlined,\r\n  ExpandOutlined,\r\n  ReloadOutlined,\r\n  ShareAltOutlined,\r\n  HighlightOutlined,\r\n  DisconnectOutlined,\r\n  EyeInvisibleOutlined,\r\n  UsergroupAddOutlined,\r\n} from \"@ant-design/icons\";\r\nimport IconFont from \"../ui/IconFont\";\r\nimport \"./drawTools.sass\";\r\nimport { putNote } from \"../../lib/network/http\";\r\nimport { editNoteData } from \"../../lib/note/archive\";\r\nimport classNames from \"classnames\";\r\nimport { AvatarSize } from \"antd/lib/avatar/SizeContext\";\r\nimport copy from \"clipboard-copy\";\r\n\r\nexport default function DrawTools({\r\n  handleUndo,\r\n  handleRedo,\r\n  instantSave,\r\n}: {\r\n  handleUndo: () => void;\r\n  handleRedo: () => void;\r\n  instantSave: () => Promise<void> | undefined;\r\n}) {\r\n  const { saved, stateSet, teamOn, drawCtrl } = useContext(ReaderStateCtx);\r\n  const { mode } = drawCtrl;\r\n  const { setDrawCtrl } = useContext(ReaderMethodCtx);\r\n  const { finger } = drawCtrl;\r\n\r\n  const nav = useNavigate();\r\n\r\n  const updateDrawCtrl = (updated: Partial<DrawCtrl>) => {\r\n    setDrawCtrl((prev) => {\r\n      const newCtrl = { ...prev, ...updated };\r\n      saveDrawCtrl(newCtrl);\r\n      return newCtrl;\r\n    });\r\n  };\r\n\r\n  return (\r\n    <header>\r\n      <div className=\"left\">\r\n        <Button\r\n          type=\"text\"\r\n          onClick={async () => {\r\n            await instantSave();\r\n            nav(\"/\");\r\n          }}\r\n          icon={<HomeFilled style={{ opacity: 0.8 }} />}\r\n        />\r\n        <br />\r\n        <Button\r\n          type=\"text\"\r\n          className=\"save\"\r\n          onClick={instantSave}\r\n          disabled={saved}\r\n          icon={<SaveOutlined />}\r\n        />\r\n      </div>\r\n      <div className=\"middle\">\r\n        <Button\r\n          type=\"text\"\r\n          shape=\"circle\"\r\n          icon={<UndoOutlined />}\r\n          onClick={handleUndo}\r\n          disabled={!stateSet?.isUndoable()}\r\n        />\r\n        <Button\r\n          className=\"redo\"\r\n          type=\"text\"\r\n          shape=\"circle\"\r\n          icon={<RedoOutlined />}\r\n          onClick={handleRedo}\r\n          disabled={!stateSet?.isRedoable()}\r\n        />\r\n        <br />\r\n        <PenButton updateDrawCtrl={updateDrawCtrl} />\r\n        <EraserButton updateDrawCtrl={updateDrawCtrl} />\r\n        <Button\r\n          type={[\"select\", \"selected\"].includes(mode) ? \"default\" : \"text\"}\r\n          shape=\"circle\"\r\n          onClick={() => updateDrawCtrl({ mode: \"select\" })}\r\n          icon={<ExpandOutlined />}\r\n        />\r\n        <Button\r\n          className=\"finger\"\r\n          type={finger ? \"primary\" : \"text\"}\r\n          ghost={finger}\r\n          shape=\"circle\"\r\n          onClick={() => updateDrawCtrl({ finger: !finger })}\r\n          icon={<IconFont type=\"icon-finger\" />}\r\n        />\r\n      </div>\r\n      <div className=\"right\">\r\n        {teamOn && <RoomInfo />}\r\n        {teamOn || <JoinRoom instantSave={instantSave} />}\r\n        <br />\r\n        <PageNav />\r\n      </div>\r\n    </header>\r\n  );\r\n}\r\n\r\nconst PenButton: FC<{\r\n  updateDrawCtrl: (updated: Partial<DrawCtrl>) => void;\r\n}> = ({ updateDrawCtrl }) => {\r\n  const { drawCtrl } = useContext(ReaderStateCtx);\r\n  const { mode } = drawCtrl;\r\n  return mode === \"draw\" ? (\r\n    <Popover\r\n      content={<PenPanel updateDrawCtrl={updateDrawCtrl} drawCtrl={drawCtrl} />}\r\n      trigger=\"click\"\r\n      placement=\"bottom\"\r\n      getPopupContainer={(e) => e}\r\n      destroyTooltipOnHide\r\n    >\r\n      <Button type=\"default\" shape=\"circle\" icon={<HighlightOutlined />} />\r\n    </Popover>\r\n  ) : (\r\n    <Button\r\n      type=\"text\"\r\n      shape=\"circle\"\r\n      onClick={() => updateDrawCtrl({ mode: \"draw\" })}\r\n      icon={<HighlightOutlined />}\r\n    />\r\n  );\r\n};\r\n\r\nexport const PenPanel: FC<{\r\n  updateDrawCtrl: (updated: Partial<DrawCtrl>) => void;\r\n  drawCtrl: DrawCtrl;\r\n}> = ({ updateDrawCtrl, drawCtrl }) => {\r\n  const { lineWidth, highlight, color } = drawCtrl;\r\n  const [tempLineWidth, setTempLineWidth] = useState(lineWidth);\r\n\r\n  return (\r\n    <div className=\"pen-panel\">\r\n      <div className=\"pen-status\">\r\n        <Slider\r\n          min={5}\r\n          max={100}\r\n          defaultValue={tempLineWidth}\r\n          onChange={setTempLineWidth}\r\n          onAfterChange={(lineWidth) => updateDrawCtrl({ lineWidth })}\r\n        />\r\n        <Button\r\n          type={highlight ? \"primary\" : \"text\"}\r\n          ghost={highlight}\r\n          shape=\"circle\"\r\n          icon={<IconFont type=\"icon-Highlight\" />}\r\n          onClick={() => updateDrawCtrl({ highlight: !highlight })}\r\n        />\r\n      </div>\r\n      <ColorSelect updateDrawCtrl={updateDrawCtrl} color={color} />\r\n    </div>\r\n  );\r\n};\r\n\r\nconst ColorSelect: FC<{\r\n  updateDrawCtrl: (updated: Partial<DrawCtrl>) => void;\r\n  color: string;\r\n}> = ({ updateDrawCtrl, color }) => {\r\n  return (\r\n    <div className=\"color-select\">\r\n      {colors.map((c) => (\r\n        <label key={c}>\r\n          <input\r\n            checked={color === c}\r\n            type=\"radio\"\r\n            name=\"color\"\r\n            onChange={() => updateDrawCtrl({ color: c })}\r\n          />\r\n          <div\r\n            className=\"circle\"\r\n            style={{ \"--circle-color\": c } as CSSProperties}\r\n          ></div>\r\n        </label>\r\n      ))}\r\n    </div>\r\n  );\r\n};\r\n\r\nconst EraserButton: FC<{\r\n  updateDrawCtrl: (updated: Partial<DrawCtrl>) => void;\r\n}> = ({ updateDrawCtrl }) => {\r\n  const {\r\n    drawCtrl: { eraserWidth, mode },\r\n  } = useContext(ReaderStateCtx);\r\n  const [tempEraserWidth, setTempEraserWidth] = useState(eraserWidth);\r\n\r\n  const content = (\r\n    <div className=\"pen-panel\">\r\n      <Slider\r\n        min={5}\r\n        max={100}\r\n        defaultValue={tempEraserWidth}\r\n        onChange={setTempEraserWidth}\r\n        onAfterChange={(eraserWidth) => updateDrawCtrl({ eraserWidth })}\r\n      />\r\n    </div>\r\n  );\r\n  return mode === \"erase\" ? (\r\n    <Popover\r\n      content={content}\r\n      trigger=\"click\"\r\n      placement=\"bottom\"\r\n      getPopupContainer={(e) => e}\r\n      destroyTooltipOnHide\r\n    >\r\n      <Button\r\n        type=\"default\"\r\n        shape=\"circle\"\r\n        icon={<IconFont type=\"icon-eraser\" />}\r\n      />\r\n    </Popover>\r\n  ) : (\r\n    <Button\r\n      type=\"text\"\r\n      shape=\"circle\"\r\n      onClick={() => updateDrawCtrl({ mode: \"erase\" })}\r\n      icon={<IconFont type=\"icon-eraser\" />}\r\n    />\r\n  );\r\n};\r\n\r\nconst UserCard: FC<{ userID: string }> = ({ userID }) => {\r\n  const [renaming, setRenaming] = useState(false);\r\n  const { ignores, setIgnores, resetIO, userRec } = useContext(TeamCtx);\r\n  const userInfo = userRec[userID];\r\n  useEffect(() => setRenaming(false), [userInfo]);\r\n  if (!userInfo) return null;\r\n\r\n  const { userName, online } = userInfo;\r\n  const self = userID === getUserID();\r\n  const ignored = ignores.has(userID) && !self;\r\n\r\n  const switchIgnore = () => {\r\n    setIgnores((prev) => {\r\n      if (prev.has(userID)) return prev.delete(userID);\r\n      return prev.add(userID);\r\n    });\r\n  };\r\n\r\n  const submitRename = (value: string) => {\r\n    const name = value.trim();\r\n    if (!name || name === userName) return setRenaming(false);\r\n    saveUserName(name);\r\n    resetIO();\r\n  };\r\n\r\n  return (\r\n    <div className={classNames(\"user-item\", { online })}>\r\n      <UserAvatar userID={userID} size=\"small\" className=\"room-avatar\" />\r\n      {renaming || <span className=\"user-name\">{userName}</span>}\r\n      {renaming && (\r\n        <Search\r\n          autoFocus\r\n          className=\"rename-input\"\r\n          defaultValue={userName}\r\n          onSearch={submitRename}\r\n          enterButton={<Button icon={<CheckOutlined />} />}\r\n        />\r\n      )}\r\n      {self ? (\r\n        renaming || (\r\n          <Button\r\n            type=\"text\"\r\n            icon={<FormOutlined />}\r\n            onClick={() => setRenaming(true)}\r\n          />\r\n        )\r\n      ) : (\r\n        <Button\r\n          type=\"text\"\r\n          icon={ignored ? <EyeInvisibleOutlined /> : <EyeOutlined />}\r\n          onClick={switchIgnore}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport const UserAvatar: FC<{\r\n  userID: string;\r\n  size?: AvatarSize;\r\n  onClick?: () => void;\r\n  chosen?: boolean;\r\n  className?: string;\r\n}> = ({\r\n  userID,\r\n  size = \"default\",\r\n  onClick = () => {},\r\n  chosen = false,\r\n  className,\r\n}) => {\r\n  const { userRec } = useContext(TeamCtx);\r\n  const color = useMemo(() => getHashedColor(userID), [userID]);\r\n  const userInfo = userRec[userID];\r\n  if (!userInfo) return null;\r\n  const { userName } = userInfo;\r\n\r\n  return (\r\n    <Avatar\r\n      className={classNames(className, { chosen })}\r\n      size={size}\r\n      style={{ backgroundColor: color }}\r\n    >\r\n      <div\r\n        className=\"avatar-wrapper\"\r\n        onClickCapture={(e) => {\r\n          e.stopPropagation();\r\n          onClick();\r\n        }}\r\n      >\r\n        {userName?.slice(0, 3)}\r\n      </div>\r\n    </Avatar>\r\n  );\r\n};\r\n\r\nconst RoomInfo: FC = () => {\r\n  const { code, userRec, connected, loadInfo, resetIO } = useContext(TeamCtx);\r\n  const link = window.location.href;\r\n  const share = async () => {\r\n    const selfName = userRec[getUserID()]?.userName;\r\n    try {\r\n      await copy(`${selfName} shared a note with you at 𝐌𝐮𝐥𝐭𝐢𝐛𝐢𝐥𝐢𝐭𝐲.\\n${link}`);\r\n      message.destroy(\"copy\");\r\n      message.success({\r\n        content: \"Share link copied!\",\r\n        icon: <CopyOutlined />,\r\n        key: \"copy\",\r\n      });\r\n    } catch (e) {\r\n      console.log(e);\r\n    }\r\n  };\r\n\r\n  const userList = useMemo(() => {\r\n    const values = Object.values(userRec);\r\n    const selfID = getUserID();\r\n    const selfInfo = userRec[selfID];\r\n    const list = selfInfo ? [selfInfo] : [];\r\n    list.push(\r\n      ...values.filter(({ online, userID }) => online && userID !== selfID),\r\n      ...values.filter(({ online, userID }) => !online && userID !== selfID)\r\n    );\r\n    return list;\r\n  }, [userRec]);\r\n  const onlineNum = userList.filter((u) => u.online).length;\r\n\r\n  const content = (\r\n    <div className=\"team-popover\">\r\n      {connected || (\r\n        <Alert\r\n          className=\"disconn-alert\"\r\n          message=\"Network failed.\"\r\n          icon={<DisconnectOutlined />}\r\n          type=\"error\"\r\n          showIcon\r\n          banner\r\n        />\r\n      )}\r\n      <DigitDisplay value={code} />\r\n      <Button\r\n        icon={<ShareAltOutlined />}\r\n        className=\"share-btn\"\r\n        onClick={share}\r\n        block\r\n      >\r\n        Share\r\n      </Button>\r\n      <Divider />\r\n      <div className=\"user-list\">\r\n        {userList.map((u) => (\r\n          <UserCard key={u.userID} userID={u.userID} />\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  const title = (\r\n    <div className=\"team-title\">\r\n      <span>Team info</span>\r\n      <Button\r\n        shape=\"circle\"\r\n        type=\"text\"\r\n        size=\"small\"\r\n        icon={<ReloadOutlined />}\r\n        onClick={() => {\r\n          loadInfo();\r\n          resetIO();\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <Popover\r\n      content={content}\r\n      trigger=\"click\"\r\n      placement=\"bottomRight\"\r\n      title={title}\r\n      defaultVisible\r\n      getPopupContainer={(e) => e}\r\n    >\r\n      <Button\r\n        type=\"text\"\r\n        icon={\r\n          <Badge\r\n            status={connected ? \"success\" : \"error\"}\r\n            count={connected ? onlineNum : \"!\"}\r\n            size=\"small\"\r\n          >\r\n            <TeamOutlined />\r\n          </Badge>\r\n        }\r\n      />\r\n    </Popover>\r\n  );\r\n};\r\n\r\nconst JoinRoom: FC<{ instantSave: () => Promise<void> | undefined }> = ({\r\n  instantSave,\r\n}) => {\r\n  const { noteID } = useContext(ReaderStateCtx);\r\n  const nav = useNavigate();\r\n  const createRoom = async () => {\r\n    await instantSave();\r\n    const resCode = await putNote(noteID);\r\n    if (!resCode) {\r\n      message.error(\"Can't create room.\");\r\n      return;\r\n    }\r\n    await editNoteData(noteID, { team: true });\r\n    nav(\"/team/\" + noteID);\r\n  };\r\n  return (\r\n    <Popconfirm\r\n      placement=\"bottomRight\"\r\n      title=\"Enable team editing?\"\r\n      onConfirm={createRoom}\r\n      okText=\"Yes\"\r\n      cancelText=\"No\"\r\n    >\r\n      <Button type=\"text\" icon={<UsergroupAddOutlined />} />\r\n    </Popconfirm>\r\n  );\r\n};\r\n","import React, { useRef, useState } from \"react\";\nimport {\n  CopyOutlined,\n  DeleteOutlined,\n  BgColorsOutlined,\n  RotateRightOutlined,\n} from \"@ant-design/icons\";\nimport { Button, ButtonProps, Popover } from \"antd\";\nimport { PenPanel } from \"../reader/DrawTools\";\nimport { useDrag } from \"@use-gesture/react\";\nimport { SelectToolType } from \"./Draw\";\nimport classNames from \"classnames\";\nimport \"./tools.sass\";\nimport \"animate.css\";\n\nconst SelectTool: SelectToolType = ({\n  onDelete,\n  onRotate,\n  onDuplicate,\n  mutateStyle,\n  currDrawCtrl,\n}) => {\n  const btnProps: ButtonProps = {\n    type: \"text\",\n    shape: \"round\",\n    size: \"small\",\n  };\n\n  const rotateEl = useRef<HTMLDivElement>(null);\n  const [dragged, setDragged] = useState(false);\n  const [transX, setTransX] = useState(0);\n  const gearStyle = dragged\n    ? { transform: `translateX(${transX}px)` }\n    : undefined;\n\n  const [rotateCount, setRotateCount] = useState(0);\n  const shakeShow = rotateCount % 4 === 1;\n  const btnClass = shakeShow\n    ? \"animate__animated animate__headShake\"\n    : undefined;\n\n  useDrag(\n    ({ first, last, offset, delta }) => {\n      setTransX(offset[0]);\n      onRotate(delta[0] / 2, last);\n      first && setDragged(true);\n      last && setDragged(false);\n    },\n    {\n      target: rotateEl,\n      filterTaps: true,\n      rubberband: true,\n      bounds: { left: -90, right: 90 },\n    }\n  );\n\n  return (\n    <div className=\"select-tool\">\n      <Popover\n        trigger=\"click\"\n        placement=\"bottom\"\n        getPopupContainer={(e) => e}\n        destroyTooltipOnHide\n        content={\n          <PenPanel updateDrawCtrl={mutateStyle} drawCtrl={currDrawCtrl} />\n        }\n      >\n        <Button icon={<BgColorsOutlined />} {...btnProps} />\n      </Popover>\n      <div className={classNames(\"rotate-wrapper\", { dragged })} ref={rotateEl}>\n        <Button\n          className={btnClass}\n          icon={<RotateRightOutlined />}\n          onClick={() => {\n            setRotateCount((prev) => prev + 1);\n            onRotate(90, true);\n          }}\n          {...btnProps}\n        />\n        <div className=\"gear\" style={gearStyle} />\n      </div>\n      <Button icon={<CopyOutlined />} onClick={onDuplicate} {...btnProps} />\n      <Button\n        danger\n        icon={<DeleteOutlined />}\n        onClick={onDelete}\n        {...btnProps}\n      />\n    </div>\n  );\n};\n\nexport default SelectTool;\n","import React, {\r\n  FC,\r\n  useRef,\r\n  useMemo,\r\n  useState,\r\n  useEffect,\r\n  TouchEvent,\r\n} from \"react\";\r\nimport { DrawState, Mutation, Stroke } from \"../../lib/draw/DrawState\";\r\nimport { defaultDrawCtrl, DrawCtrl } from \"../../lib/draw/drawCtrl\";\r\nimport { Setter, usePreventGesture } from \"../../lib/hooks\";\r\nimport { releaseCanvas } from \"../../lib/draw/drawer\";\r\nimport { isStylus } from \"../../lib/touch/touch\";\r\nimport { usePinch } from \"@use-gesture/react\";\r\nimport { v4 as getUid } from \"uuid\";\r\nimport { Set } from \"immutable\";\r\nimport paper from \"paper\";\r\nimport \"./draw.sass\";\r\n\r\nexport type SelectToolType = FC<{\r\n  onDelete: () => void;\r\n  onRotate: (angle: number, smooth?: boolean) => void;\r\n  onDuplicate: () => void;\r\n  mutateStyle: (updated: Partial<DrawCtrl>) => void;\r\n  currDrawCtrl: DrawCtrl;\r\n}>;\r\n\r\nconst PREVIEW_WIDTH = 200;\r\nconst {\r\n  Point,\r\n  Path,\r\n  Group,\r\n  Shape: { Rectangle },\r\n  Color,\r\n  Size,\r\n  Raster,\r\n} = paper;\r\n\r\nconst Draw: FC<{\r\n  drawState: DrawState;\r\n  otherStates?: DrawState[];\r\n  onChange?: Setter<DrawState>;\r\n  drawCtrl?: DrawCtrl;\r\n  readonly?: boolean;\r\n  preview?: boolean;\r\n  imgSrc?: string;\r\n  SelectTool?: SelectToolType;\r\n}> = ({\r\n  drawState,\r\n  onChange = () => {},\r\n  otherStates,\r\n  drawCtrl = defaultDrawCtrl,\r\n  readonly = false,\r\n  preview = false,\r\n  imgSrc,\r\n  SelectTool,\r\n}) => {\r\n  const { width, height } = drawState;\r\n  let { mode, color, finger, lineWidth, highlight, eraserWidth } = drawCtrl;\r\n\r\n  const canvasEl = useRef<HTMLCanvasElement>(null);\r\n  const scope = useRef(new paper.PaperScope());\r\n  const group = useRef<paper.Path[]>();\r\n  const path = useRef<paper.Path>();\r\n  const [erased, setErased] = useState(Set<string>());\r\n  const ratio = useRef(1);\r\n  const [currDrawCtrl, setCurrDrawCtrl] = useState(defaultDrawCtrl);\r\n\r\n  const [rect, setRect] = useState<paper.Shape.Rectangle>();\r\n  useEffect(() => {\r\n    if (!rect) return;\r\n    let id = 0;\r\n    const moveDash = () => {\r\n      rect.dashOffset += 3;\r\n      id = requestAnimationFrame(moveDash);\r\n    };\r\n    moveDash();\r\n    return () => {\r\n      rect.remove();\r\n      cancelAnimationFrame(id);\r\n    };\r\n  }, [rect]);\r\n\r\n  const [selectedGroup, setSelectedGroup] = useState<paper.Group>();\r\n  useEffect(() => {\r\n    const prevSG = selectedGroup;\r\n    return () => void prevSG?.removeChildren();\r\n  }, [selectedGroup]);\r\n\r\n  const [selected, setSelected] = useState(false);\r\n  const paperMode = mode === \"select\" && selected ? \"selected\" : mode;\r\n  useEffect(() => {\r\n    if (mode !== \"select\") {\r\n      setSelected(false);\r\n      setRect(undefined);\r\n    }\r\n  }, [mode]);\r\n  useEffect(() => {\r\n    if (selected) {\r\n      if (!rect?.strokeColor) return;\r\n      rect.strokeColor.alpha /= 2;\r\n    } else {\r\n      updateMutation();\r\n      setSelectedGroup(undefined);\r\n      setCurrDrawCtrl(defaultDrawCtrl);\r\n    }\r\n  }, [selected]);\r\n\r\n  const isEventValid = (e: TouchEvent) =>\r\n    isStylus(e) || (finger && e.touches.length === 1);\r\n  const preventTouch = (e: TouchEvent) =>\r\n    isEventValid(e) || e.stopPropagation();\r\n\r\n  const updateRatio = () => {\r\n    const clientWidth = canvasEl.current?.clientWidth;\r\n    if (clientWidth) ratio.current = width / clientWidth;\r\n  };\r\n\r\n  const transformPoint = (projP: paper.Point) => {\r\n    scope.current.activate();\r\n    const { center, zoom } = scope.current.view;\r\n    const viewP = scope.current.view.projectToView(projP);\r\n    const absoluteP = viewP.multiply(ratio.current);\r\n    const offsetP = new Point(width, height)\r\n      .divide(2)\r\n      .subtract(center.multiply(zoom));\r\n    return absoluteP.subtract(offsetP).divide(zoom);\r\n  };\r\n\r\n  const setupPaper = () => {\r\n    if (!canvasEl.current) return;\r\n    scope.current.setup(canvasEl.current);\r\n\r\n    const r = preview ? PREVIEW_WIDTH / width : 1;\r\n    scope.current.view.viewSize = new Size(width, height).multiply(r);\r\n    scope.current.view.scale(r, new Point(0, 0));\r\n    paintBackground(width, height);\r\n  };\r\n\r\n  const setNewRect = (e: paper.MouseEvent) => {\r\n    updateRatio();\r\n    scope.current.activate();\r\n    const point = transformPoint(e.point);\r\n    const rectangle = startSelectRect(point);\r\n    setRect(rectangle);\r\n  };\r\n\r\n  const handleDown = {\r\n    draw() {\r\n      updateRatio();\r\n      scope.current.activate();\r\n      path.current = startStroke(color, lineWidth, highlight);\r\n    },\r\n    erase() {\r\n      updateRatio();\r\n      scope.current.activate();\r\n      path.current = startStroke(\"#0003\", eraserWidth);\r\n    },\r\n    select(e: paper.MouseEvent) {\r\n      setNewRect(e);\r\n    },\r\n    selected(e: paper.MouseEvent) {\r\n      const point = transformPoint(e.point);\r\n      if (!rect || point.isInside(rect.strokeBounds)) return;\r\n      setNewRect(e);\r\n      setSelected(false);\r\n    },\r\n  }[paperMode];\r\n\r\n  const handleDrag = {\r\n    draw(e: paper.MouseEvent) {\r\n      if (!path.current) return;\r\n      scope.current.activate();\r\n      const point = transformPoint(e.point);\r\n      path.current.add(point);\r\n      path.current.smooth();\r\n    },\r\n    erase(e: paper.MouseEvent) {\r\n      const eraserPath = path.current;\r\n      if (!eraserPath) return;\r\n      scope.current.activate();\r\n      const point = transformPoint(e.point);\r\n      eraserPath.add(point);\r\n      eraserPath.smooth();\r\n\r\n      const newErased = group.current\r\n        ?.filter((p) => !erased.has(p.name))\r\n        .filter((p) => checkErase(p, eraserPath))\r\n        .map((p) => p.name);\r\n      newErased && setErased((prev) => prev.concat(newErased));\r\n    },\r\n    select(e: paper.MouseEvent) {\r\n      if (!rect) return;\r\n      scope.current.activate();\r\n      const delta = e.delta.multiply(ratio.current);\r\n      rect.size = rect.size.add(new Size(delta.x, delta.y));\r\n      rect.translate(delta.divide(2));\r\n    },\r\n    selected(e: paper.MouseEvent) {\r\n      if (!rect || !selectedGroup) return;\r\n      scope.current.activate();\r\n      const delta = e.delta.multiply(ratio.current);\r\n      rect.translate(delta);\r\n      selectedGroup.translate(delta);\r\n    },\r\n  }[paperMode];\r\n\r\n  const handleUp = {\r\n    erase() {\r\n      if (!path.current) return;\r\n      scope.current.activate();\r\n      path.current.remove();\r\n      onChange((prev) => DrawState.eraseStrokes(prev, erased.toArray()));\r\n      setErased(Set());\r\n    },\r\n    draw() {\r\n      if (!path.current || path.current.segments.length === 0) return;\r\n      scope.current.activate();\r\n      path.current.simplify();\r\n      const pathData = path.current.exportJSON();\r\n      path.current.remove();\r\n      onChange((prev) => DrawState.addStroke(prev, pathData));\r\n    },\r\n    select() {\r\n      if (!rect) return;\r\n      const { width, height } = rect.size.abs();\r\n      if (width < 10 || height < 10) return setRect(undefined);\r\n\r\n      scope.current.activate();\r\n      const paths = group.current;\r\n      if (!paths) return;\r\n      const newSG = new Group(checkSelection(rect, paths));\r\n      setSelectedGroup(newSG);\r\n      const tempStyle = parseGroupStyle(newSG);\r\n      setCurrDrawCtrl((prev) => ({ ...prev, ...tempStyle }));\r\n      setSelected(true);\r\n    },\r\n    selected() {},\r\n  }[paperMode];\r\n\r\n  useEffect(() => {\r\n    setupPaper();\r\n    scope.current.activate();\r\n    const cvs = canvasEl.current;\r\n    return () => void (cvs && releaseCanvas(cvs));\r\n  }, []);\r\n\r\n  const handlePaper = () => {\r\n    if (readonly) return;\r\n    scope.current.view.onMouseDown = handleDown;\r\n    scope.current.view.onMouseDrag = handleDrag;\r\n    scope.current.view.onMouseUp = handleUp;\r\n  };\r\n  useEffect(handlePaper);\r\n\r\n  useEffect(() => {\r\n    if (!imgSrc) return;\r\n    const img = new Image();\r\n    img.src = imgSrc;\r\n    let raster: paper.Raster;\r\n\r\n    img.onload = () => {\r\n      scope.current.activate();\r\n      raster = new Raster(img);\r\n      raster.position = scope.current.view.center;\r\n      let r = width / img.width;\r\n      raster.scale(r);\r\n      raster.sendToBack();\r\n      raster.parent.getItem({ name: \"BGRECT\" })?.sendToBack();\r\n    };\r\n\r\n    return () => void raster?.remove();\r\n  }, [imgSrc]);\r\n\r\n  const mergedStrokes = useMemo(() => {\r\n    if (!otherStates) return drawState.getStrokeList();\r\n    else return DrawState.mergeStates([drawState, ...otherStates]);\r\n  }, [drawState, otherStates]);\r\n\r\n  useEffect(() => {\r\n    scope.current.activate();\r\n    group.current = [];\r\n    const otherGroup: paper.Path[] = [];\r\n\r\n    mergedStrokes.forEach((stroke) => {\r\n      const passedGroup = drawState.hasStroke(stroke.uid)\r\n        ? group.current\r\n        : otherGroup;\r\n      paintStroke(stroke, passedGroup, erased);\r\n    });\r\n\r\n    return () => {\r\n      group.current?.forEach((item) => item.remove());\r\n      otherGroup.forEach((item) => item.remove());\r\n    };\r\n  }, [mergedStrokes, erased]);\r\n\r\n  const updateMutation = () => {\r\n    const list = selectedGroup?.children;\r\n    if (!list?.length) return;\r\n    const mutations: Mutation[] = list.map((p) => [p.name, p.exportJSON()]);\r\n    onChange((prev) => DrawState.mutateStrokes(prev, mutations));\r\n  };\r\n\r\n  const deleteSelected = () => {\r\n    const list = selectedGroup?.children;\r\n    console.log(selectedGroup);\r\n    if (!list?.length) return;\r\n\r\n    const deleted = list.map((item) => item.name);\r\n    onChange((prev) => DrawState.eraseStrokes(prev, deleted));\r\n    setRect(undefined);\r\n    setSelectedGroup(undefined);\r\n    setSelected(false);\r\n  };\r\n\r\n  const rotateSelected = (angle: number, smooth = false) => {\r\n    if (!selectedGroup) return;\r\n    let count = smooth ? 10 : 1;\r\n    const dAngle = angle / count;\r\n    const rotate = () => {\r\n      selectedGroup.rotate(dAngle, rect?.position);\r\n      rect?.rotate(dAngle, rect.position);\r\n      if (--count > 0) requestAnimationFrame(rotate);\r\n    };\r\n    rotate();\r\n  };\r\n\r\n  const mutateStyle = (updated: Partial<DrawCtrl>) => {\r\n    if (!selectedGroup) return;\r\n    scope.current.activate();\r\n    updateGroupStyle(selectedGroup, updated, currDrawCtrl.highlight);\r\n    setCurrDrawCtrl((prev) => ({ ...prev, ...updated }));\r\n  };\r\n\r\n  const duplicateSelected = () => {\r\n    scope.current.activate();\r\n    if (!rect || !selectedGroup) return;\r\n    const newSG = selectedGroup.clone();\r\n    updateMutation();\r\n    setSelectedGroup(newSG);\r\n    \r\n    const { width, height } = rect.size;\r\n    const transP = new Point(width, height).divide(10);\r\n    newSG.translate(transP);\r\n    rect.translate(transP);\r\n    newSG?.children.forEach((p) => (p.name = getUid()));\r\n  };\r\n\r\n  usePreventGesture();\r\n  usePinch(\r\n    ({ memo, offset, last, first, origin }) => {\r\n      if (!canvasEl.current) return;\r\n\r\n      let lastScale, lastOX, lastOY, osX, osY: number;\r\n      if (first || !memo) {\r\n        updateRatio();\r\n        scope.current.activate();\r\n        const { x, y } = canvasEl.current.getBoundingClientRect();\r\n        [lastScale, [lastOX, lastOY], [osX, osY]] = [\r\n          1,\r\n          [origin[0] - x, origin[1] - y],\r\n          [x, y],\r\n        ];\r\n      } else [lastScale, [lastOX, lastOY], [osX, osY]] = memo;\r\n\r\n      const { view } = scope.current;\r\n\r\n      const scale = first ? 1 : offset[0] / lastScale;\r\n      const r = ratio.current;\r\n      const [oX, oY] = [origin[0] - osX, origin[1] - osY];\r\n      const originViewP = new Point(oX, oY).multiply(r);\r\n      const originProjP = view.viewToProject(originViewP);\r\n      view.scale(scale, originProjP);\r\n\r\n      const [dX, dY] = [oX - lastOX, oY - lastOY];\r\n      const transP = new Point(dX, dY).multiply(r / offset[0]);\r\n      view.translate(transP);\r\n\r\n      if (!last) return [offset[0], [oX, oY], [osX, osY]];\r\n      putCenterBack(view);\r\n    },\r\n    {\r\n      scaleBounds: { max: 5, min: 0.3 },\r\n      target: canvasEl,\r\n    }\r\n  );\r\n\r\n  return (\r\n    <div className=\"draw-wrapper\">\r\n      <canvas\r\n        ref={canvasEl}\r\n        className=\"draw-canvas\"\r\n        data-paper-hidpi={false}\r\n        onTouchStartCapture={preventTouch}\r\n        onTouchMoveCapture={preventTouch}\r\n      />\r\n      {SelectTool && paperMode === \"selected\" && (\r\n        <SelectTool\r\n          onDelete={deleteSelected}\r\n          onRotate={rotateSelected}\r\n          onDuplicate={duplicateSelected}\r\n          mutateStyle={mutateStyle}\r\n          currDrawCtrl={currDrawCtrl}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default React.memo(Draw);\r\n\r\nconst paintStroke = (\r\n  stroke: Stroke,\r\n  group?: paper.Path[],\r\n  erased?: Set<string>\r\n) => {\r\n  let { pathData, uid } = stroke;\r\n  try {\r\n    const path = new Path();\r\n    path.importJSON(pathData);\r\n    path.name = uid;\r\n    if (erased?.has(uid)) path.opacity /= 2;\r\n    group?.push(path);\r\n  } catch (e) {\r\n    console.error(e);\r\n  }\r\n};\r\n\r\nconst getCheckPoints = (() => {\r\n  const cache = new WeakMap<paper.Segment, paper.Point[]>();\r\n  return (segment: paper.Segment, width: number) => {\r\n    const cached = cache.get(segment);\r\n    if (cached) return cached;\r\n\r\n    const { point } = segment;\r\n    const prevPoint = segment.previous?.point;\r\n    if (!prevPoint) return [];\r\n    const delta = point.subtract(prevPoint);\r\n    const times = (delta.length / width) * 2;\r\n    const checkPoints: paper.Point[] = [];\r\n    for (let i = 0; i < times; i += 1) {\r\n      checkPoints.push(point.subtract(delta.multiply(i / times)));\r\n    }\r\n    cache.set(segment, checkPoints);\r\n    return checkPoints;\r\n  };\r\n})();\r\n\r\nconst checkErase = (checkedPath: paper.Path, eraserPath: paper.Path) => {\r\n  const curveBound = eraserPath.lastSegment.curve?.strokeBounds;\r\n  if (\r\n    !(checkedPath instanceof paper.Path) ||\r\n    !curveBound?.intersects(checkedPath.strokeBounds)\r\n  ) {\r\n    return false;\r\n  }\r\n\r\n  if (eraserPath.intersects(checkedPath)) return true;\r\n\r\n  const { strokeWidth, lastSegment } = eraserPath;\r\n  const checkPoints = getCheckPoints(lastSegment, strokeWidth);\r\n  return checkPoints.some((cPoint) => {\r\n    const d = checkedPath.getNearestPoint(cPoint)?.getDistance(cPoint);\r\n    return d && d < (checkedPath.strokeWidth + strokeWidth) / 2;\r\n  });\r\n};\r\n\r\nconst paintBackground = (width: number, height: number) => {\r\n  const bgRect = new Rectangle(new Point(0, 0), new Point(width, height));\r\n  bgRect.fillColor = new Color(\"#fff\");\r\n  bgRect.name = \"BGRECT\";\r\n  bgRect.sendToBack();\r\n  return bgRect;\r\n};\r\n\r\nconst startSelectRect = (point: paper.Point) => {\r\n  const rect = new Rectangle(point, new Size(0, 0));\r\n  rect.strokeColor = new Color(\"#1890ff\");\r\n  rect.strokeWidth = 3;\r\n  rect.dashOffset = 0;\r\n  rect.dashArray = [30, 20];\r\n  return rect;\r\n};\r\n\r\nconst startStroke = (color: string, lineWidth: number, highlight = false) => {\r\n  const path = new Path();\r\n  const strokeColor = new Color(color);\r\n  if (highlight) {\r\n    strokeColor.alpha /= 2;\r\n    path.blendMode = \"multiply\";\r\n  }\r\n  path.strokeColor = strokeColor;\r\n  path.strokeWidth = lineWidth;\r\n  path.strokeJoin = \"round\";\r\n  path.strokeCap = \"round\";\r\n  return path;\r\n};\r\n\r\nconst getCenterTranslate = (view: paper.View) => {\r\n  const { center, zoom } = view;\r\n  const { height, width } = view.viewSize;\r\n  const { x, y } = center;\r\n  if (zoom <= 1) return [width / 2 - x, height / 2 - y];\r\n\r\n  const dX = (width * (zoom - 1)) / zoom / 2;\r\n  const dY = (height * (zoom - 1)) / zoom / 2;\r\n  const [minX, maxX, minY, maxY] = [\r\n    width / 2 - dX,\r\n    width / 2 + dX,\r\n    height / 2 - dY,\r\n    height / 2 + dY,\r\n  ];\r\n\r\n  const deltaX = x < minX ? minX - x : x > maxX ? maxX - x : 0;\r\n  const deltaY = y < minY ? minY - y : y > maxY ? maxY - y : 0;\r\n  return [deltaX, deltaY];\r\n};\r\n\r\nconst putCenterBack = (view: paper.View) => {\r\n  const [deltaX, deltaY] = getCenterTranslate(view);\r\n  let count = 10;\r\n  const dP = new Point(deltaX, deltaY).divide(-count);\r\n  const move = () => {\r\n    view.translate(dP);\r\n    if (--count > 0) requestAnimationFrame(move);\r\n  };\r\n  move();\r\n};\r\n\r\nconst parseGroupStyle = (group: paper.Group) => {\r\n  const tempStyle: Partial<DrawCtrl> = {};\r\n  if (group.strokeColor) tempStyle.color = group.strokeColor.toCSS(true);\r\n  if (group.strokeWidth) tempStyle.lineWidth = group.strokeWidth;\r\n  if (group.children.every((p) => p.strokeColor?.alpha === 0.5))\r\n    tempStyle.highlight = true;\r\n  return tempStyle;\r\n};\r\n\r\nconst checkSelection = (rect: paper.Shape.Rectangle, paths: paper.Path[]) => {\r\n  const bounds = rect.strokeBounds;\r\n  return paths.filter((p) => p.isInside(bounds) || p.intersects(rect));\r\n};\r\n\r\nconst updateGroupStyle = (\r\n  group: paper.Group,\r\n  updated: Partial<DrawCtrl>,\r\n  prevHighLighted: boolean\r\n) => {\r\n  const { lineWidth, color, highlight } = updated;\r\n  if (color) group.strokeColor = new Color(color);\r\n  if (lineWidth) group.strokeWidth = lineWidth;\r\n  if (highlight === true || prevHighLighted === true) {\r\n    group.children.forEach((p) => {\r\n      const { strokeColor } = p;\r\n      if (!strokeColor) return;\r\n      if (strokeColor.alpha === 1) strokeColor.alpha /= 2;\r\n      p.blendMode = \"multiply\";\r\n    });\r\n  }\r\n  if (highlight === false) {\r\n    group.children.forEach((p) => {\r\n      const { strokeColor } = p;\r\n      if (!strokeColor) return;\r\n      strokeColor.alpha = 1;\r\n      p.blendMode = \"normal\";\r\n    });\r\n  }\r\n};\r\n","import { TouchEvent } from \"react\";\r\n\r\nexport type iOSTouch = Touch & {\r\n  force?: number;\r\n  touchType?: \"stylus\" | \"direct\";\r\n};\r\n\r\nexport function isStylus(e: TouchEvent) {\r\n  const touch = e.touches[0] as iOSTouch;\r\n  return touch?.touchType === \"stylus\";\r\n}\r\n","import { Dispatch, SetStateAction, useEffect, useMemo, useRef } from \"react\";\r\n\r\nexport function useObjectUrl(obj: Blob | MediaSource | undefined) {\r\n  const url = useMemo(\r\n    () => (obj ? URL.createObjectURL(obj) : undefined),\r\n    [obj]\r\n  );\r\n\r\n  useEffect(() => {\r\n    const prevUrl = url || \"\";\r\n    return () => URL.revokeObjectURL(prevUrl);\r\n  }, [url]);\r\n\r\n  return url;\r\n}\r\n\r\nexport function useMounted() {\r\n  const _mounted = useRef(false);\r\n\r\n  useEffect(() => {\r\n    _mounted.current = true;\r\n    return () => {\r\n      _mounted.current = false;\r\n    };\r\n  }, []);\r\n\r\n  return _mounted;\r\n}\r\n\r\nexport function usePreventGesture() {\r\n  useEffect(() => {\r\n    const handler = (e: Event) => e.preventDefault();\r\n    document.addEventListener(\"gesturestart\", handler);\r\n    document.addEventListener(\"gesturechange\", handler);\r\n    document.addEventListener(\"gestureend\", handler);\r\n    return () => {\r\n      document.removeEventListener(\"gesturestart\", handler);\r\n      document.removeEventListener(\"gesturechange\", handler);\r\n      document.removeEventListener(\"gestureend\", handler);\r\n    };\r\n  }, []);\r\n}\r\n\r\nexport type Setter<T> = Dispatch<SetStateAction<T>>;\r\n","import React, {\r\n  FC,\r\n  useRef,\r\n  useMemo,\r\n  useState,\r\n  useEffect,\r\n  useContext,\r\n  useCallback,\r\n  createContext,\r\n  useLayoutEffect,\r\n} from \"react\";\r\nimport {\r\n  DrawCtrl,\r\n  getDrawCtrl,\r\n  defaultDrawCtrl,\r\n} from \"../../lib/draw/drawCtrl\";\r\nimport { createPage, NoteInfo, NotePage } from \"../../lib/note/note\";\r\nimport { loadNote, editNoteData } from \"../../lib/note/archive\";\r\nimport { AddPageButton, showPageDelMsg } from \"./ReaderTools\";\r\nimport { useParams, useNavigate } from \"react-router-dom\";\r\nimport { useInView } from \"react-intersection-observer\";\r\nimport { updatePages } from \"../../lib/network/http\";\r\nimport { useBeforeunload } from \"react-beforeunload\";\r\nimport { TeamState } from \"../../lib/draw/TeamState\";\r\nimport { DrawState } from \"../../lib/draw/DrawState\";\r\nimport { Setter, useMounted } from \"../../lib/hooks\";\r\nimport { StateSet } from \"../../lib/draw/StateSet\";\r\nimport { insertAfter } from \"../../lib/array\";\r\nimport SelectTool from \"../draw/SelectTool\";\r\nimport { debounce, last } from \"lodash\";\r\nimport { Map, Set } from \"immutable\";\r\nimport DrawTools from \"./DrawTools\";\r\nimport { TeamCtx } from \"./Team\";\r\nimport Draw from \"../draw/Draw\";\r\nimport { message } from \"antd\";\r\nimport \"./reader.sass\";\r\n\r\nexport const ReaderStateCtx = createContext({\r\n  noteID: \"\",\r\n  noteInfo: undefined as NoteInfo | undefined,\r\n  stateSet: undefined as StateSet | undefined,\r\n  teamState: undefined as TeamState | undefined,\r\n  pageRec: undefined as Record<string, NotePage> | undefined,\r\n  pageOrder: undefined as string[] | undefined,\r\n  saved: true,\r\n  teamOn: false,\r\n  inviewPages: Set<string>(),\r\n  refRec: {} as Record<string, HTMLElement>,\r\n  drawCtrl: defaultDrawCtrl,\r\n});\r\n\r\nexport const ReaderMethodCtx = createContext({\r\n  scrollPage: (pageID: string) => {},\r\n  switchPageMarked: (pageID: string) => {},\r\n  setPageState: (uid: string, cb: (ds: DrawState) => DrawState) => {},\r\n  addPage: (prevPageID: string, copy?: boolean) => {},\r\n  addFinalPage: () => {},\r\n  deletePage: (pageID: string) => {},\r\n  saveReorder: async (order: string[], push: boolean) => {},\r\n  setInviewPages: (() => {}) as Setter<Set<string>>,\r\n  setDrawCtrl: (() => {}) as Setter<DrawCtrl>,\r\n});\r\n\r\nexport default function Reader({ teamOn }: { teamOn: boolean }) {\r\n  const noteID = useParams().noteID ?? \"\";\r\n  const nav = useNavigate();\r\n\r\n  const [pageRec, setPageRec] = useState<Record<string, NotePage>>();\r\n  const [noteInfo, setNoteInfo] = useState<NoteInfo>();\r\n  const [stateSet, setStateSet] = useState<StateSet>();\r\n  const [drawCtrl, setDrawCtrl] = useState(defaultDrawCtrl);\r\n  const [saved, setSaved] = useState(true);\r\n  const [inviewPages, setInviewPages] = useState(Set<string>());\r\n  const [pageOrder, setPageOrder] = useState<string[]>();\r\n\r\n  const refRec = useRef<Record<string, HTMLElement>>({});\r\n  const mounted = useMounted();\r\n\r\n  const { teamState, teamUpdate, pushOperation, pushNewPage, pushReorder } =\r\n    useContext(TeamCtx);\r\n\r\n  const loadNotePages = async () => {\r\n    const storedNote = await loadNote(noteID);\r\n    if (!storedNote) {\r\n      message.error(\"Note not found\");\r\n      return nav(\"/\");\r\n    }\r\n    const { pageRec, pdf, pageOrder, ...noteInfo } = storedNote;\r\n    setPageRec(pageRec);\r\n    setPageOrder(pageOrder);\r\n    setNoteInfo(noteInfo);\r\n    setStateSet(StateSet.createFromPages(pageRec));\r\n    setDrawCtrl(await getDrawCtrl());\r\n    if (teamOn) updatePages(noteID);\r\n  };\r\n  useEffect(() => void loadNotePages(), [noteID, teamOn]);\r\n\r\n  const debouncedSave = useCallback(\r\n    debounce(async (pr: Record<string, NotePage>) => {\r\n      const canvas = document.querySelector(\"canvas\");\r\n      const data = canvas?.toDataURL();\r\n      await editNoteData(noteID, { pageRec: pr, thumbnail: data });\r\n      mounted.current && setSaved(true);\r\n    }, 2000),\r\n    []\r\n  );\r\n  const instantSave = debouncedSave.flush;\r\n\r\n  useLayoutEffect(() => () => void instantSave(), []);\r\n  useBeforeunload(instantSave);\r\n\r\n  useEffect(() => {\r\n    if (!noteInfo) return;\r\n    document.title = noteInfo.name + \" - Multibility\";\r\n  }, [noteInfo]);\r\n\r\n  useEffect(() => {\r\n    if (!teamUpdate) return;\r\n    const { type } = teamUpdate;\r\n    if (type === \"reorder\") {\r\n      const { pageOrder, deleted, prevOrder } = teamUpdate;\r\n      saveReorder(pageOrder);\r\n      if (!deleted) return;\r\n      showPageDelMsg(() => {\r\n        saveReorder(prevOrder, true);\r\n      });\r\n    } else if (type === \"newPage\") {\r\n      const { pageOrder, pageID, newPage } = teamUpdate;\r\n      saveReorder(pageOrder);\r\n      savePageRec(pageID, () => newPage);\r\n      setStateSet((prev) => prev?.addState(pageID, newPage));\r\n    } else if (type === \"sync\") {\r\n      const { pageID, stroke } = teamUpdate;\r\n      setStateSet((prevSS) =>\r\n        prevSS?.updateState(pageID, (prevDS) =>\r\n          DrawState.updateStroke(prevDS, stroke)\r\n        )\r\n      );\r\n    }\r\n  }, [teamUpdate]);\r\n\r\n  const savePageRec = (\r\n    pageID: string,\r\n    cb: (prev?: NotePage) => NotePage | undefined\r\n  ) => {\r\n    setPageRec((prevRec) => {\r\n      if (!prevRec) return;\r\n      const prevPage = prevRec[pageID];\r\n      const newPage = cb(prevPage);\r\n      if (!newPage) return;\r\n      const newRec = { ...prevRec, [pageID]: newPage };\r\n      debouncedSave(newRec);\r\n      return newRec;\r\n    });\r\n    setSaved(false);\r\n  };\r\n\r\n  const updatePageRec = (pageID: string, ds: DrawState) => {\r\n    const state = DrawState.flaten(ds);\r\n    savePageRec(pageID, (prev) => prev && { ...prev, state });\r\n  };\r\n\r\n  const setPageState = useCallback(\r\n    (pageID: string, cb: (ds: DrawState) => DrawState) => {\r\n      setStateSet((prev) => {\r\n        if (!prev) return;\r\n        const prevDS = prev.getOneState(pageID);\r\n        if (!prevDS) return prev;\r\n        const newDS = cb(prevDS);\r\n        const newSS = prev.setState(pageID, newDS);\r\n        newSS.lastOp && pushOperation(newSS.lastOp);\r\n        updatePageRec(pageID, newDS);\r\n        return newSS;\r\n      });\r\n    },\r\n    []\r\n  );\r\n\r\n  const switchPageMarked = (pageID: string) => {\r\n    savePageRec(pageID, (prev) => prev && { ...prev, marked: !prev.marked });\r\n  };\r\n\r\n  const handleUndo = () => {\r\n    setStateSet((prev) => {\r\n      if (!prev) return;\r\n      const newSS = prev.undo();\r\n      const lastDS = newSS.getLastDS();\r\n      lastDS && updatePageRec(...lastDS);\r\n      newSS.lastOp && pushOperation(newSS.lastOp);\r\n      return newSS;\r\n    });\r\n  };\r\n\r\n  const handleRedo = () => {\r\n    setStateSet((prev) => {\r\n      if (!prev) return;\r\n      const newSS = prev.redo();\r\n      const lastDS = newSS.getLastDS();\r\n      lastDS && updatePageRec(...lastDS);\r\n      newSS.lastOp && pushOperation(newSS.lastOp);\r\n      return newSS;\r\n    });\r\n  };\r\n\r\n  const scrollPage = (pageID: string) => {\r\n    refRec.current[pageID]?.scrollIntoView();\r\n  };\r\n\r\n  const saveReorder = async (newOrder: string[], push = false) => {\r\n    setPageOrder(newOrder);\r\n    await editNoteData(noteID, { pageOrder: newOrder });\r\n    await instantSave();\r\n    push && pushReorder(newOrder);\r\n  };\r\n\r\n  const addPage = (prevPageID: string, copy = false) => {\r\n    if (!pageOrder) return;\r\n    const prevPage = copy ? pageRec && pageRec[prevPageID] : undefined;\r\n    const [pageID, newPage] = createPage(prevPage);\r\n    const newOrder = insertAfter(pageOrder, prevPageID, pageID);\r\n    pushNewPage(newOrder, pageID, newPage);\r\n    saveReorder(newOrder);\r\n    savePageRec(pageID, () => newPage);\r\n    setStateSet((prev) => prev?.addState(pageID, newPage));\r\n  };\r\n\r\n  const addFinalPage = () => {\r\n    const lastPageID = last(pageOrder);\r\n    lastPageID && addPage(lastPageID);\r\n  };\r\n\r\n  const deletePage = (pageID: string) => {\r\n    const newOrder = pageOrder?.filter((id) => id !== pageID);\r\n    newOrder?.length && saveReorder(newOrder, true);\r\n  };\r\n\r\n  const renderResult = (\r\n    <div className=\"reader container\">\r\n      <DrawTools\r\n        handleUndo={handleUndo}\r\n        handleRedo={handleRedo}\r\n        instantSave={instantSave}\r\n      />\r\n      <main>\r\n        {pageOrder?.map((uid) => (\r\n          <PageContainer uid={uid} key={uid} />\r\n        ))}\r\n        <AddPageButton />\r\n      </main>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <ReaderStateCtx.Provider\r\n      value={{\r\n        noteID,\r\n        noteInfo,\r\n        stateSet,\r\n        teamState,\r\n        saved,\r\n        teamOn,\r\n        pageRec,\r\n        pageOrder,\r\n        inviewPages,\r\n        refRec: refRec.current,\r\n        drawCtrl,\r\n      }}\r\n    >\r\n      <ReaderMethodCtx.Provider\r\n        value={{\r\n          scrollPage,\r\n          setInviewPages,\r\n          switchPageMarked,\r\n          setPageState,\r\n          addPage,\r\n          addFinalPage,\r\n          deletePage,\r\n          setDrawCtrl,\r\n          saveReorder,\r\n        }}\r\n      >\r\n        {renderResult}\r\n      </ReaderMethodCtx.Provider>\r\n    </ReaderStateCtx.Provider>\r\n  );\r\n}\r\n\r\nconst PageContainer: FC<{ uid: string }> = ({ uid }) => {\r\n  const { pageRec, stateSet, teamState } = useContext(ReaderStateCtx);\r\n  const { setPageState } = useContext(ReaderMethodCtx);\r\n\r\n  const page = pageRec && pageRec[uid];\r\n  const drawState = stateSet?.getOneState(uid);\r\n  const teamStateMap = teamState?.getOnePageState(uid);\r\n  const updateState = useCallback(\r\n    (cb: (ds: DrawState) => DrawState) => setPageState(uid, cb),\r\n    [uid, setPageState]\r\n  );\r\n  if (!page || !drawState) return null;\r\n\r\n  return (\r\n    <PageWrapper\r\n      drawState={drawState}\r\n      teamStateMap={teamStateMap}\r\n      updateState={updateState}\r\n      pdfIndex={page.pdfIndex}\r\n      uid={uid}\r\n    />\r\n  );\r\n};\r\n\r\nexport const PageWrapper = ({\r\n  thumbnail,\r\n  drawState,\r\n  teamStateMap,\r\n  updateState,\r\n  pdfIndex,\r\n  preview = false,\r\n  uid,\r\n}: {\r\n  uid: string;\r\n  drawState: DrawState;\r\n  teamStateMap?: Map<string, DrawState>;\r\n  thumbnail?: string;\r\n  pdfIndex?: number;\r\n  updateState?: (cb: (ds: DrawState) => DrawState) => void;\r\n  preview?: boolean;\r\n}) => {\r\n  const { setInviewPages } = useContext(ReaderMethodCtx);\r\n  const { refRec, noteID } = useContext(ReaderStateCtx);\r\n  const [fullImg, setFullImg] = useState<string>();\r\n  const [visibleRef, visible] = useInView({ delay: 100 });\r\n\r\n  const { height, width } = drawState;\r\n  const ratio = height / width;\r\n\r\n  const handleRef = useCallback(\r\n    (e: HTMLDivElement | null) => {\r\n      if (!e) return;\r\n      visibleRef(e);\r\n      if (!preview && refRec) refRec[uid] = e;\r\n    },\r\n    [refRec]\r\n  );\r\n\r\n  const loadImage = useCallback(\r\n    (() => {\r\n      let called = false;\r\n      return async () => {\r\n        if (preview || !pdfIndex || called) return;\r\n        called = true;\r\n        const { getOnePageImage } = await import(\"../../lib/note/pdfImage\");\r\n        setFullImg(await getOnePageImage(noteID, pdfIndex));\r\n      };\r\n    })(),\r\n    [preview, pdfIndex]\r\n  );\r\n\r\n  useEffect(() => {\r\n    if (preview) return;\r\n    if (visible) {\r\n      loadImage();\r\n      setInviewPages((prev) => prev.add(uid));\r\n    } else {\r\n      setInviewPages((prev) => prev.delete(uid));\r\n    }\r\n  }, [visible, loadImage, preview]);\r\n\r\n  const { ignores } = useContext(TeamCtx);\r\n  const otherStates = useMemo(\r\n    () => teamStateMap && Array.from(teamStateMap.deleteAll(ignores).values()),\r\n    [teamStateMap, ignores]\r\n  );\r\n\r\n  const imageLoaded = fullImg || !pdfIndex;\r\n  const drawShow = visible && imageLoaded;\r\n  const maskShow = Boolean(preview || !imageLoaded);\r\n\r\n  return (\r\n    <section\r\n      ref={handleRef}\r\n      className=\"note-page\"\r\n      style={{ paddingTop: `${ratio * 100}%` }}\r\n    >\r\n      {drawShow && (\r\n        <DrawWrapper\r\n          drawState={drawState}\r\n          otherStates={otherStates}\r\n          updateState={updateState}\r\n          imgSrc={fullImg || thumbnail}\r\n          preview={preview}\r\n        />\r\n      )}\r\n      {maskShow && <div className=\"mask\" />}\r\n    </section>\r\n  );\r\n};\r\nPageWrapper.displayName = \"PageWrapper\";\r\n\r\nconst DrawWrapper = ({\r\n  drawState,\r\n  updateState,\r\n  otherStates,\r\n  preview = false,\r\n  imgSrc,\r\n}: {\r\n  drawState: DrawState;\r\n  otherStates?: DrawState[];\r\n  updateState?: (cb: (ds: DrawState) => DrawState) => void;\r\n  preview?: boolean;\r\n  imgSrc?: string;\r\n}) => {\r\n  const { drawCtrl } = useContext(ReaderStateCtx);\r\n\r\n  const handleChange = useCallback(\r\n    (arg: ((s: DrawState) => DrawState) | DrawState) => {\r\n      if (!updateState) return;\r\n      const cb = arg instanceof DrawState ? () => arg : arg;\r\n      updateState(cb);\r\n    },\r\n    [updateState]\r\n  );\r\n\r\n  return preview ? (\r\n    <Draw\r\n      drawState={drawState}\r\n      otherStates={otherStates}\r\n      imgSrc={imgSrc}\r\n      readonly\r\n      preview\r\n    />\r\n  ) : (\r\n    <Draw\r\n      drawState={drawState}\r\n      otherStates={otherStates}\r\n      onChange={handleChange}\r\n      imgSrc={imgSrc}\r\n      drawCtrl={drawCtrl}\r\n      SelectTool={SelectTool}\r\n    />\r\n  );\r\n};\r\nDrawWrapper.displayName = \"DrawWrapper\";\r\n","import { Map, Record } from \"immutable\";\nimport { NotePage, TeamPage, TeamPageInfo } from \"../note/note\";\nimport { DrawState, WIDTH } from \"./DrawState\";\nimport { SetOperation } from \"./StateSet\";\n\ninterface TeamStateRecordType {\n  pageStates: Map<string, Map<string, DrawState>>;\n  pageInfos: Map<string, TeamPageInfo>;\n}\n\nconst defaultRecord: Readonly<TeamStateRecordType> = {\n  pageStates: Map(),\n  pageInfos: Map(),\n};\n\ntype TeamStateRecord = Record<TeamStateRecordType>;\nconst defaultFactory = Record(defaultRecord);\n\nexport class TeamState {\n  constructor(private immutable: TeamStateRecord) {}\n\n  getImmutable() {\n    return this.immutable;\n  }\n\n  getPageStates() {\n    return this.getImmutable().get(\"pageStates\");\n  }\n\n  getPageInfos() {\n    return this.getImmutable().get(\"pageInfos\");\n  }\n\n  getOneState(pageID: string, userID: string) {\n    return this.getPageStates().get(pageID)?.get(userID);\n  }\n\n  getOnePageState(pageID: string) {\n    return this.getPageStates().get(pageID);\n  }\n\n  getOnePageValidUser(pageID: string) {\n    const map = this.getOnePageState(pageID);\n    if (!map) return [];\n    return Array.from(map?.filter((ds) => !ds.isEmpty()).keys());\n  }\n\n  getPageRatio(pageID: string) {\n    return this.getPageInfos().get(pageID)?.ratio;\n  }\n\n  includesPage(pageID: string) {\n    return this.getPageStates().has(pageID);\n  }\n\n  setState(pageID: string, userID: string, drawState: DrawState) {\n    const pageMap = this.getPageStates().get(pageID);\n    if (!pageMap) return this;\n    return new TeamState(\n      this.getImmutable().update(\"pageStates\", (m) =>\n        m.set(pageID, pageMap.set(userID, drawState))\n      )\n    );\n  }\n\n  static createFromTeamPages(\n    teamPages: globalThis.Record<string, TeamPage>,\n    width = WIDTH\n  ) {\n    let record = defaultFactory();\n    Object.entries(teamPages).forEach(([pageID, teamPage]) => {\n      const { states, ratio } = teamPage;\n      const pageMap = Map(\n        Object.entries(states).map(([userID, flatState]) => [\n          userID,\n          DrawState.loadFromFlat(flatState, width, width * ratio),\n        ])\n      );\n      record = record\n        .update(\"pageStates\", (m) => m.set(pageID, pageMap))\n        .update(\"pageInfos\", (m) => m.set(pageID, { ratio }));\n    });\n    return new TeamState(record);\n  }\n\n  addPage(pageID: string, notePage: NotePage) {\n    const { ratio } = notePage;\n    return new TeamState(\n      this.getImmutable()\n        .update(\"pageStates\", (m) => m.set(pageID, Map()))\n        .update(\"pageInfos\", (m) => m.set(pageID, { ratio }))\n    );\n  }\n\n  pushOperation(setOp: SetOperation, userID: string, width = WIDTH) {\n    const { pageID, ...op } = setOp;\n    const ratio = this.getPageRatio(pageID);\n    if (!this.includesPage(pageID) || !ratio) return this;\n    const prevDs =\n      this.getOneState(pageID, userID) ||\n      DrawState.createEmpty(width, width * ratio);\n\n    const ds = DrawState.pushOperation(prevDs, op);\n    return this.setState(pageID, userID, ds);\n  }\n\n  resetUser(userID: string, pageRec: globalThis.Record<string, NotePage>) {\n    let newTS: TeamState = this;\n    for (let [pageID, { state, ratio }] of Object.entries(pageRec)) {\n      const prevDS = newTS.getOneState(pageID, userID);\n      if (!prevDS) continue;\n      const { width } = prevDS;\n      newTS = newTS.setState(\n        pageID,\n        userID,\n        DrawState.loadFromFlat(state, width, width * ratio)\n      );\n    }\n    return newTS;\n  }\n}\n","import { io } from \"socket.io-client\";\r\nimport { getUserID, getUserName } from \"../user\";\r\nimport { BASE_URL } from \"./http\";\r\n\r\nexport const IoFactory = (noteID: string) => {\r\n  return () =>\r\n    io(BASE_URL, {\r\n      query: {\r\n        userID: getUserID(),\r\n        userName: getUserName(),\r\n        noteID,\r\n      },\r\n    });\r\n};\r\n","import { message } from \"antd\";\r\nimport React, { useState, useEffect, createContext } from \"react\";\r\nimport { getTeamNoteState, loadTeamNoteInfo } from \"../../lib/network/http\";\r\nimport { LoginOutlined, LogoutOutlined } from \"@ant-design/icons\";\r\nimport { useNavigate, useParams } from \"react-router-dom\";\r\nimport { SetOperation } from \"../../lib/draw/StateSet\";\r\nimport { TeamState } from \"../../lib/draw/TeamState\";\r\nimport { getUserID, UserInfo } from \"../../lib/user\";\r\nimport { Stroke } from \"../../lib/draw/DrawState\";\r\nimport { IoFactory } from \"../../lib/network/io\";\r\nimport { NotePage } from \"../../lib/note/note\";\r\nimport { Setter } from \"../../lib/hooks\";\r\nimport { Set } from \"immutable\";\r\nimport Reader from \"./Reader\";\r\n\r\nexport const TeamCtx = createContext({\r\n  code: -2,\r\n  connected: false,\r\n  ignores: Set<string>(),\r\n  userRec: {} as Record<string, UserInfo>,\r\n  teamState: undefined as TeamState | undefined,\r\n  teamUpdate: undefined as undefined | TeamUpdate,\r\n  resetIO: () => {},\r\n  loadInfo: async () => false,\r\n  setIgnores: (() => {}) as Setter<Set<string>>,\r\n  pushReorder: (pageOrder: string[]) => {},\r\n  pushNewPage: (pageOrder: string[], pageID: string, newPage: NotePage) => {},\r\n  pushOperation: (op: SetOperation) => {},\r\n});\r\n\r\ninterface ReorderInfo {\r\n  pageOrder: string[];\r\n  prevOrder: string[];\r\n  deleted: boolean;\r\n}\r\n\r\ninterface NewPageInfo {\r\n  pageOrder: string[];\r\n  pageID: string;\r\n  newPage: NotePage;\r\n}\r\n\r\ntype TeamUpdate =\r\n  | ({\r\n      type: \"reorder\";\r\n    } & ReorderInfo)\r\n  | ({\r\n      type: \"newPage\";\r\n    } & NewPageInfo)\r\n  | {\r\n      type: \"sync\";\r\n      stroke: Stroke;\r\n      pageID: string;\r\n    };\r\n\r\nexport default function Team() {\r\n  const noteID = useParams().noteID ?? \"\";\r\n  const [teamState, setTeamState] = useState<TeamState>();\r\n  const [code, setCode] = useState(-2);\r\n  const [userRec, setUserRec] = useState<Record<string, UserInfo>>({});\r\n  const [ignores, setIgnores] = useState(Set<string>());\r\n  const [io, setIO] = useState(IoFactory(noteID));\r\n  const [teamUpdate, setTeamUpdate] = useState<TeamUpdate>();\r\n  const [loaded, setLoaded] = useState(false);\r\n  const [connected, setConnected] = useState(false);\r\n  const nav = useNavigate();\r\n\r\n  const loadState = async () => {\r\n    const teamNote = await getTeamNoteState(noteID);\r\n    if (!teamNote) {\r\n      message.error(\"Failed loading the team note state\");\r\n      return false;\r\n    }\r\n    setTeamState(TeamState.createFromTeamPages(teamNote));\r\n    return true;\r\n  };\r\n\r\n  const loadInfo = async () => {\r\n    const info = await loadTeamNoteInfo(noteID);\r\n    if (!info) {\r\n      message.error(\"Failed loading the team note info\");\r\n      return false;\r\n    }\r\n    setCode(info.code);\r\n    return true;\r\n  };\r\n\r\n  const roomInit = async () => {\r\n    message.loading({\r\n      content: \"Loading team note...\",\r\n      key: \"TEAM_LOADING\",\r\n      duration: 0,\r\n    });\r\n    if (!((await loadInfo()) && (await loadState()))) {\r\n      message.destroy(\"TEAM_LOADING\");\r\n      return nav(\"/\");\r\n    }\r\n    message.destroy(\"TEAM_LOADING\");\r\n    setLoaded(true);\r\n  };\r\n\r\n  useEffect(() => {\r\n    io.on(\"push\", ({ operation, userID }) => {\r\n      setTeamState((prev) => prev?.pushOperation(operation, userID));\r\n    });\r\n\r\n    io.on(\"join\", ({ joined, members }) => {\r\n      const { userID, userName } = joined;\r\n      setUserRec(members);\r\n      if (userID === getUserID()) return;\r\n      message.destroy(userID);\r\n      message.success({\r\n        content: `${userName} joined room`,\r\n        icon: <LoginOutlined />,\r\n        key: userID,\r\n      });\r\n    });\r\n\r\n    io.on(\"leave\", ({ leaved, members }) => {\r\n      const { userID, userName } = leaved;\r\n      setUserRec(members);\r\n      if (userID === getUserID()) return io.emit(\"join\");\r\n      message.destroy(userID);\r\n      message.warning({\r\n        content: `${userName} leaved room`,\r\n        icon: <LogoutOutlined />,\r\n        key: userID,\r\n      });\r\n    });\r\n\r\n    io.on(\"reorder\", (info: ReorderInfo) => {\r\n      setTeamUpdate({ type: \"reorder\", ...info });\r\n    });\r\n\r\n    io.on(\"newPage\", (info: NewPageInfo) => {\r\n      const { pageID, newPage } = info;\r\n      setTeamState((prev) => prev?.addPage(pageID, newPage));\r\n      setTeamUpdate({ type: \"newPage\", ...info });\r\n    });\r\n\r\n    io.on(\"reset\", ({ userID, pageRec }) => {\r\n      if (userID === getUserID()) return;\r\n      setTeamState((prev) => prev?.resetUser(userID, pageRec));\r\n    });\r\n\r\n    io.on(\"connect_error\", console.error);\r\n    io.on(\"connect\", () => setConnected(true));\r\n    io.on(\"disconnect\", () => setConnected(false));\r\n\r\n    return () => {\r\n      io.removeAllListeners();\r\n      io.close();\r\n    };\r\n  }, [io]);\r\n\r\n  const roomDestroy = () => {\r\n    message.destroy(\"TEAM_LOADING\");\r\n  };\r\n\r\n  useEffect(() => {\r\n    roomInit();\r\n    return roomDestroy;\r\n  }, [noteID]);\r\n\r\n  const pushOperation = (operation: SetOperation) => {\r\n    io.emit(\r\n      \"push\",\r\n      { operation },\r\n      ({ stroke, pageID }: { stroke: Stroke; pageID: string }) => {\r\n        setTeamUpdate({ type: \"sync\", stroke, pageID });\r\n      }\r\n    );\r\n  };\r\n\r\n  const pushReorder = (pageOrder: string[]) => {\r\n    io.emit(\"reorder\", { pageOrder });\r\n  };\r\n\r\n  const pushNewPage = (\r\n    pageOrder: string[],\r\n    pageID: string,\r\n    newPage: NotePage\r\n  ) => {\r\n    setTeamState((prev) => prev?.addPage(pageID, newPage));\r\n    const { image, marked, ...newTeamPage } = newPage;\r\n    io.emit(\"newPage\", { pageOrder, pageID, newPage: newTeamPage });\r\n  };\r\n\r\n  const resetIO = () => setIO(IoFactory(noteID));\r\n\r\n  if (!loaded) return null;\r\n  return (\r\n    <TeamCtx.Provider\r\n      value={{\r\n        code,\r\n        ignores,\r\n        userRec,\r\n        connected,\r\n        teamState,\r\n        teamUpdate,\r\n        resetIO,\r\n        loadInfo,\r\n        setIgnores,\r\n        pushReorder,\r\n        pushNewPage,\r\n        pushOperation,\r\n      }}\r\n    >\r\n      <Reader teamOn />\r\n    </TeamCtx.Provider>\r\n  );\r\n}\r\n","export function createVirtualCanvas(width: number, height: number) {\r\n  const canvas = document.createElement(\"canvas\");\r\n  const context = canvas.getContext(\"2d\");\r\n  if (!context) {\r\n    throw new Error(\"can't get virtual canvas context\");\r\n  }\r\n  canvas.width = width;\r\n  canvas.height = height;\r\n  return { canvas, context };\r\n}\r\n\r\nexport function releaseCanvas(canvas: HTMLCanvasElement) {\r\n  canvas.width = 1;\r\n  canvas.height = 1;\r\n  const ctx = canvas.getContext('2d');\r\n  ctx?.clearRect(0, 0, 1, 1);\r\n}\r\n"],"names":["defaultDrawCtrl","mode","finger","lineWidth","eraserWidth","color","highlight","getDrawCtrl","localforage","drawCtrl","AddPageButton","addFinalPage","useContext","ReaderMethodCtx","className","type","icon","PlusOutlined","block","onClick","defaultRecord","states","Map","editStack","List","undoStack","defaultFactory","Record","StateSet","immutable","lastOp","this","getImmutable","get","pageID","getStates","drawState","prevDS","getOneState","currRecord","update","s","set","l","push","delete","cb","currDS","notePage","width","WIDTH","state","ratio","newDS","DrawState","getEditStack","size","getUndoStack","isUndoable","lastUid","last","lastSetOp","pop","isRedoable","ds","undefined","list","pageRec","entries","Object","createFromList","map","key","insertAfter","prevItem","newItem","prevIndex","indexOf","curr","slice","splice","DigitDisplay","value","useState","randomNum","setRandomNum","digits","String","padStart","split","Number","resetRandom","Math","floor","random","useEffect","timer","setTimeout","clearTimeout","classNames","disabled","d","idx","Digit","digit","createFromIconfontCN","scriptUrl","PageNavContent","activeKey","setActiveKey","ReaderStateCtx","pageOrder","inviewPages","scrollPage","saveReorder","refRec","useRef","listEl","currpageID","useMemo","find","has","current","scrollIntoView","itemHeight","clientHeight","listHeight","scrollBy","PreviewTabs","onDragEnd","source","destination","fromIndex","index","toIndex","newOrder","result","removed","exchange","requestAnimationFrame","droppableId","droppableProps","innerRef","placeholder","ref","e","uid","PagePreview","pageIndex","stateSet","teamState","switchPageMarked","ignores","TeamCtx","chosen","setChosen","page","teamStateMap","getOnePageState","userIDs","getOnePageValidUser","filter","userID","isEmpty","every","marked","switchMarked","stopPropagation","dragDisabled","draggableId","isDragDisabled","draggableProps","dragHandleProps","drag","isDragging","image","PageWrapper","thumbnail","preview","onClickCapture","TeamAvatars","PreviewOption","maxCount","UserAvatar","prev","popShow","setPopShow","addPage","deletePage","menu","domEvent","items","label","CopyOutlined","DeleteOutlined","danger","content","trigger","placement","visible","onVisibleChange","destroyTooltipOnHide","MoreOutlined","TabPane","Tabs","onChange","tabBarGutter","centered","tab","PageNav","navOn","setNavOn","title","ALL","MARKED","WRITTEN","MenuUnfoldOutlined","MenuFoldOutlined","onClose","closable","contentWrapperStyle","boxShadow","bodyStyle","padding","overflow","headerStyle","textAlign","borderTop","destroyOnClose","DrawTools","handleUndo","handleRedo","instantSave","saved","teamOn","setDrawCtrl","nav","useNavigate","updateDrawCtrl","updated","newCtrl","saveDrawCtrl","HomeFilled","style","opacity","SaveOutlined","shape","UndoOutlined","RedoOutlined","PenButton","EraserButton","includes","ExpandOutlined","ghost","RoomInfo","JoinRoom","PenPanel","getPopupContainer","HighlightOutlined","tempLineWidth","setTempLineWidth","min","max","defaultValue","onAfterChange","ColorSelect","colors","c","checked","name","tempEraserWidth","setTempEraserWidth","UserCard","renaming","setRenaming","setIgnores","resetIO","userInfo","userRec","userName","online","self","getUserID","ignored","Search","autoFocus","onSearch","trim","saveUserName","enterButton","CheckOutlined","FormOutlined","EyeInvisibleOutlined","EyeOutlined","add","getHashedColor","backgroundColor","code","connected","loadInfo","link","window","location","href","share","selfName","copy","message","console","log","userList","values","selfID","selfInfo","onlineNum","u","length","DisconnectOutlined","showIcon","banner","ShareAltOutlined","ReloadOutlined","defaultVisible","status","count","TeamOutlined","noteID","createRoom","putNote","editNoteData","team","onConfirm","okText","cancelText","UsergroupAddOutlined","onDelete","onRotate","onDuplicate","mutateStyle","currDrawCtrl","btnProps","rotateEl","dragged","setDragged","transX","setTransX","gearStyle","transform","rotateCount","setRotateCount","btnClass","useDrag","first","offset","delta","target","filterTaps","rubberband","bounds","left","right","BgColorsOutlined","RotateRightOutlined","Point","paper","Path","Group","Rectangle","Color","Size","Raster","Draw","otherStates","readonly","imgSrc","SelectTool","height","canvasEl","scope","group","path","Set","erased","setErased","setCurrDrawCtrl","rect","setRect","id","moveDash","dashOffset","remove","cancelAnimationFrame","selectedGroup","setSelectedGroup","prevSG","removeChildren","selected","setSelected","paperMode","strokeColor","alpha","updateMutation","preventTouch","touch","touches","touchType","isStylus","isEventValid","updateRatio","clientWidth","transformPoint","projP","activate","view","center","zoom","absoluteP","projectToView","multiply","offsetP","divide","subtract","setNewRect","point","rectangle","startSelectRect","handleDown","draw","startStroke","erase","select","isInside","strokeBounds","handleDrag","smooth","eraserPath","newErased","p","checkErase","concat","x","y","translate","handleUp","toArray","segments","simplify","pathData","exportJSON","abs","paths","newSG","checkSelection","tempStyle","parseGroupStyle","setup","r","viewSize","scale","paintBackground","setupPaper","cvs","releaseCanvas","onMouseDown","onMouseDrag","onMouseUp","raster","img","Image","src","onload","position","sendToBack","parent","getItem","mergedStrokes","getStrokeList","otherGroup","forEach","stroke","passedGroup","hasStroke","paintStroke","item","children","mutations","handler","preventDefault","document","addEventListener","removeEventListener","usePinch","memo","origin","lastScale","lastOX","lastOY","osX","osY","getBoundingClientRect","oX","oY","originViewP","originProjP","viewToProject","transP","putCenterBack","scaleBounds","onTouchStartCapture","onTouchMoveCapture","deleted","angle","dAngle","rotate","clone","getUid","updateGroupStyle","React","importJSON","error","getCheckPoints","cache","WeakMap","segment","cached","prevPoint","previous","times","checkPoints","i","checkedPath","curveBound","lastSegment","curve","intersects","strokeWidth","some","cPoint","getNearestPoint","getDistance","bgRect","fillColor","dashArray","blendMode","strokeJoin","strokeCap","dX","dY","minX","maxX","minY","maxY","getCenterTranslate","deltaX","deltaY","dP","move","toCSS","prevHighLighted","createContext","noteInfo","setPageState","prevPageID","order","setInviewPages","Reader","useParams","setPageRec","setNoteInfo","setStateSet","setSaved","setPageOrder","mounted","_mounted","useMounted","teamUpdate","pushOperation","pushNewPage","pushReorder","loadNotePages","loadNote","storedNote","pdf","createFromPages","updatePages","debouncedSave","useCallback","debounce","pr","canvas","querySelector","data","toDataURL","flush","useLayoutEffect","useBeforeunload","onUndo","prevOrder","duration","newPage","savePageRec","addState","prevSS","updateState","prevRec","prevPage","newRec","updatePageRec","newSS","setState","createPage","renderResult","undo","lastDS","getLastDS","redo","PageContainer","Provider","lastPageID","pdfIndex","fullImg","setFullImg","useInView","delay","visibleRef","handleRef","loadImage","called","getOnePageImage","Array","from","deleteAll","imageLoaded","drawShow","maskShow","Boolean","paddingTop","DrawWrapper","displayName","handleChange","arg","pageStates","pageInfos","TeamState","getPageStates","keys","getPageInfos","pageMap","m","setOp","op","getPageRatio","includesPage","prevDs","newTS","teamPages","record","teamPage","flatState","IoFactory","io","BASE_URL","query","getUserName","Team","setTeamState","setCode","setUserRec","setIO","setTeamUpdate","loaded","setLoaded","setConnected","loadState","getTeamNoteState","teamNote","createFromTeamPages","loadTeamNoteInfo","info","roomInit","on","operation","joined","members","LoginOutlined","leaved","emit","LogoutOutlined","resetUser","removeAllListeners","close","roomDestroy","newTeamPage","createVirtualCanvas","createElement","context","getContext","Error","ctx","clearRect"],"sourceRoot":""}