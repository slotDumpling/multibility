(this.webpackJsonpmultibility=this.webpackJsonpmultibility||[]).push([[0],{193:function(e,t){},256:function(e,t,n){},258:function(e,t,n){},264:function(e,t){},265:function(e,t){},266:function(e,t){},267:function(e,t){},268:function(e,t){},287:function(e,t,n){},289:function(e,t,n){},478:function(e,t){},480:function(e,t){},481:function(e,t,n){},482:function(e,t,n){},483:function(e,t,n){},484:function(e,t,n){},488:function(e,t,n){},489:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(32),u=n.n(c),s=(n(256),n(94)),i=n(23),o=n(16),l=n(5),d=n(7),j=n.n(d),b=(n(258),n(1)),p=n(4),f=n(13),O=n(14),x=n(34),h=n(56),v={state:"drawing",strokes:Object(x.a)(),uidStack:Object(x.a)(),undoStack:Object(x.c)(),eraseStack:Object(x.a)(),deleted:Object(x.e)()},m=Object(x.d)(v),g=function(){function e(t,n,r,a){Object(f.a)(this,e),this.immutable=t,this.width=n,this.height=r,this.lastOp=a}return Object(O.a)(e,[{key:"getImmutable",value:function(){return this.immutable}},{key:"getUidStack",value:function(){return this.getImmutable().get("uidStack")}},{key:"getUndoStack",value:function(){return this.getImmutable().get("undoStack")}},{key:"getEraseStack",value:function(){return this.getImmutable().get("eraseStack")}},{key:"getValidEraseStack",value:function(){var e=this.getDeleted(),t=this.getUndoStack();return this.getEraseStack().filter((function(n){var r=n.uid;return!e.has(r)&&!t.has(r)}))}},{key:"getStrokes",value:function(){return this.getImmutable().get("strokes")}},{key:"getValidStrokes",value:function(){var e=this.getDeleted(),t=this.getUndoStack(),n=this.getValidEraseStack();return this.getStrokes().filter((function(r){var a=r.uid;return!e.has(a)&&!t.has(a)&&!n.some((function(e){return e.erased.has(a)}))}))}},{key:"getDeleted",value:function(){return this.getImmutable().get("deleted")}},{key:"getState",value:function(){return this.getImmutable().get("state")}},{key:"getLastStroke",value:function(){return this.getImmutable().get("strokes").last()}},{key:"isEmpty",value:function(){return 0===this.getStrokes().size}}],[{key:"createEmpty",value:function(t,n){return new e(m(),t,n)}},{key:"undo",value:function(t){var n=t.getUidStack().last();if(!n)return t;var r={type:"undo",undoUid:n};return new e(t.getImmutable().set("state","revoking").update("undoStack",(function(e){return e.add(n)})).update("uidStack",(function(e){return e.pop()})),t.width,t.height,r)}},{key:"redo",value:function(t){var n=t.getUndoStack().last();if(!n)return t;var r={type:"redo",redoUid:n};return new e(t.getImmutable().update("undoStack",(function(e){return e.butLast()})).update("uidStack",(function(e){return e.push(n)})),t.width,t.height,r)}},{key:"addStroke",value:function(t,n){var r=Object(h.v4)(),a=Object(b.a)(Object(b.a)({},n),{},{uid:r});return e.pushStroke(t,a)}},{key:"pushStroke",value:function(t,n){var r=t.getUndoStack(),a=k(t.getImmutable().set("state","drawing").update("deleted",(function(e){return e.concat(r)})).set("undoStack",Object(x.c)()).update("strokes",(function(e){return e.push(n)})).update("uidStack",(function(e){return e.push(n.uid)}))),c={type:"add",stroke:n};return new e(a,t.width,t.height,c)}},{key:"eraseStrokes",value:function(t,n){var r={uid:Object(h.v4)(),erased:n};return e.pushErase(t,r)}},{key:"pushErase",value:function(t,n){var r=n.uid,a=n.erased,c={uid:r,erased:Object(x.e)(a)},u={type:"erase",erase:n};return new e(t.getImmutable().update("eraseStack",(function(e){return e.push(c)})).update("uidStack",(function(e){return e.push(r)})),t.width,t.height,u)}},{key:"pushUndo",value:function(t,n){return new e(t.getImmutable().update("undoStack",(function(e){return e.add(n)})),t.width,t.height)}},{key:"pushRedo",value:function(t,n){return new e(t.getImmutable().update("undoStack",(function(e){return e.delete(n)})),t.width,t.height)}},{key:"flaten",value:function(e){var t=k(e.getImmutable()),n=t.get("deleted"),r=e.getValidEraseStack().reduce((function(e,t){return e.concat(t.erased)}),Object(x.e)()),a=n.concat(r);return{strokes:t.get("strokes").filter((function(e){return!a.has(e.uid)})).toArray()}}},{key:"loadFromFlat",value:function(t,n,r){var a=t.strokes;return new e(m().set("strokes",Object(x.a)(a)),n,r)}}]),e}();function k(e){var t=e.get("undoStack");return e.update("deleted",(function(e){return e.concat(t)})).set("undoStack",Object(x.c)()).update("uidStack",(function(e){return e.filter((function(e){return!t.has(e)}))}))}function y(){var e=Object(h.v4)();return{uid:Object(h.v4)(),name:"New note ".concat(Date.now()),tagId:"DEFAULT",team:!1,withImg:!1,pageRec:Object(p.a)({},e,{ratio:1.5,state:{strokes:[]}}),pageOrder:[e]}}function w(e){return[Object(h.v4)(),null!==e&&void 0!==e?e:{ratio:1.5,state:{strokes:[]}}]}var S=n(10),I=n(37),C=n.n(I),N=function(){var e;return function(){if(e)return e;var t=localStorage.getItem("user_id");return t||(t=Object(h.v4)(),localStorage.setItem("user_id",t)),e=t,t}}(),E=function(){var e=localStorage.getItem("USER_NAME");return e||(e="User_"+Object(h.v4)().slice(0,8),localStorage.setItem("USER_NAME",e)),e},L=["#000000","#9ca3af","#64748b","#78716c","#f97316","#eab308","#84cc16","#22c55e","#10b981","#14b8a6","#06b6d4","#0ea5e9","#3b82f6","#6366f1","#8b5cf6","#a855f7","#d946ef","#ec4899","#f43f5e","#ef4444"],R=function(){var e=Math.floor(Math.random()*L.length);return L[e]},T=n(162),P=n(233),A=n.n(P);function U(e,t){var n=document.createElement("canvas"),r=n.getContext("2d");if(!r)throw new Error("can't get virtual canvas context");return n.width=e,n.height=t,{canvas:n,context:r}}function D(e){e.width=1,e.height=1;var t=e.getContext("2d");null===t||void 0===t||t.clearRect(0,0,1,1)}function F(e){return new Promise((function(t){e.toBlob(t)}))}function M(e,t,n){return _.apply(this,arguments)}function _(){return(_=Object(o.a)(j.a.mark((function e(t,n,r){var a,c,u,s,i,o,l,d,b;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getPage(n);case 2:return a=e.sent,c=a.getViewport({scale:r}),console.log({viewport:c}),u=c.height,s=c.width,i=u/s,o=U(Math.floor(s*r),Math.floor(u*r)),l=o.canvas,d=o.context,e.next=10,a.render({canvasContext:d,viewport:c,transform:[r,0,0,r,0,0]}).promise;case 10:return e.next=12,F(l);case 12:if(b=e.sent){e.next=15;break}throw new Error("can't get canvas image blob");case 15:return D(l),e.abrupt("return",[b,i]);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e){return B.apply(this,arguments)}function B(){return B=Object(o.a)(j.a.mark((function e(t){var n,r,a,c,u,s,i,o,d,b,p,f=arguments;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=f.length>1&&void 0!==f[1]?f[1]:2,r=f.length>2?f[2]:void 0,e.next=4,T.getDocument(t).promise;case 4:a=e.sent,c=a.numPages,u=[],s=[],i=1;case 9:if(!(i<=c)){e.next=22;break}return e.next=12,M(a,i,n);case 12:o=e.sent,d=Object(l.a)(o,2),b=d[0],p=d[1],u.push(b),s.push(p),r&&r(Math.floor(i/c*100));case 19:i+=1,e.next=9;break;case 22:return e.abrupt("return",{images:u,ratios:s});case 23:case"end":return e.stop()}}),e)}))),B.apply(this,arguments)}function K(e,t){return W.apply(this,arguments)}function W(){return W=Object(o.a)(j.a.mark((function e(t,n){var r,a,c,u,s,i,o=arguments;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>2&&void 0!==o[2]?o[2]:2,e.next=3,T.getDocument(t).promise;case 3:if(a=e.sent,c=a.numPages,!(n>c)){e.next=7;break}throw new Error("index out of range");case 7:return e.next=9,M(a,n,r);case 9:return u=e.sent,s=Object(l.a)(u,1),i=s[0],e.abrupt("return",i);case 13:case"end":return e.stop()}}),e)}))),W.apply(this,arguments)}function G(e,t){return V.apply(this,arguments)}function V(){return V=Object(o.a)(j.a.mark((function e(t,n){var r,a,c,u=arguments;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>2&&void 0!==u[2]?u[2]:2,a=URL.createObjectURL(t),e.next=4,K(a,n,r);case 4:return c=e.sent,URL.revokeObjectURL(a),e.abrupt("return",c);case 7:case"end":return e.stop()}}),e)}))),V.apply(this,arguments)}function Y(e,t){return H.apply(this,arguments)}function H(){return(H=Object(o.a)(j.a.mark((function e(t,n){var r,a,c,u,s,i,o;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=URL.createObjectURL(t),e.next=3,z(r,.5,n);case 3:return a=e.sent,c=a.images,u=a.ratios,URL.revokeObjectURL(r),s={},i=[],c.forEach((function(e,t){var n=Object(h.v4)();s[n]={image:e,ratio:u[t],state:{strokes:[]},pdfIndex:t+1},i.push(n)})),o=t.name.replace(".pdf",""),e.abrupt("return",Object(b.a)(Object(b.a)({},y()),{},{name:o,withImg:!0,pdf:t,thumbnail:c[0],pageRec:s,pageOrder:i}));case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(e){return q.apply(this,arguments)}function q(){return(q=Object(o.a)(j.a.mark((function e(t){var n,r,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=URL.createObjectURL(t),e.next=3,z(n,.5);case 3:return r=e.sent,a=r.images,URL.revokeObjectURL(n),e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}T.GlobalWorkerOptions.workerSrc=A.a;var $=["pageRec","pdf"],Q=["pdf","pageRec"],X=["pdf","pageRec"];function Z(){return ee.apply(this,arguments)}function ee(){return(ee=Object(o.a)(j.a.mark((function e(){var t;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.a.getItem("ALL_NOTES");case 2:if(!(t=e.sent)){e.next=7;break}return e.abrupt("return",t);case 7:return C.a.setItem("ALL_NOTES",{}),e.abrupt("return",{});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function te(){return ne.apply(this,arguments)}function ne(){return(ne=Object(o.a)(j.a.mark((function e(){var t;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.a.getItem("ALL_TAGS");case 2:if(!(t=e.sent)){e.next=7;break}return e.abrupt("return",t);case 7:return C.a.setItem("ALL_TAGS",{}),e.abrupt("return",{});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function re(e){return ae.apply(this,arguments)}function ae(){return(ae=Object(o.a)(j.a.mark((function e(t){var n,r,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(h.v4)(),r={uid:n,name:t,color:R(),notes:[]},e.t0=b.a,e.t1=b.a,e.t2={},e.next=7,te();case 7:return e.t3=e.sent,e.t4=(0,e.t1)(e.t2,e.t3),e.t5={},e.t6=Object(p.a)({},n,r),a=(0,e.t0)(e.t4,e.t5,e.t6),e.next=14,C.a.setItem("ALL_TAGS",a);case 14:return e.abrupt("return",a);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ce(e){return ue.apply(this,arguments)}function ue(){return(ue=Object(o.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,te();case 2:return delete(n=e.sent)[t],e.next=6,C.a.setItem("ALL_TAGS",n);case 6:return e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function se(e){return ie.apply(this,arguments)}function ie(){return(ie=Object(o.a)(j.a.mark((function e(t){var n,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,te();case 2:return n=e.sent,(r=n[t.uid]).name=t.name,r.color=t.color,r.notes=t.notes,e.next=9,C.a.setItem("ALL_TAGS",n);case 9:return e.abrupt("return",n);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function oe(e){return le.apply(this,arguments)}function le(){return(le=Object(o.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.a.getItem(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function de(e,t){return je.apply(this,arguments)}function je(){return(je=Object(o.a)(j.a.mark((function e(t,n){var r,a,c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("edit note data",n),e.next=3,Z();case 3:return r=e.sent,n.pageRec,n.pdf,a=Object(S.a)(n,$),r[t]=Object(b.a)(Object(b.a)({},r[t]),a),e.next=8,C.a.setItem("ALL_NOTES",r);case 8:return e.next=10,oe(t);case 10:if(c=e.sent){e.next=13;break}return e.abrupt("return");case 13:return e.next=15,C.a.setItem(t,Object(b.a)(Object(b.a)({},c),n));case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function be(e){return pe.apply(this,arguments)}function pe(){return(pe=Object(o.a)(j.a.mark((function e(t){var n,r,a,c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.uid,r=t.tagId,e.next=3,Z();case 3:return(a=e.sent)[n]=t,e.next=7,C.a.setItem("ALL_NOTES",a);case 7:return e.next=9,te();case 9:if(c=e.sent,"DEFAULT"===r){e.next=14;break}return c[r].notes.push(t.uid),e.next=14,C.a.setItem("ALL_TAGS",c);case 14:return e.abrupt("return",{tags:c,allNotes:a});case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function fe(e){return Oe.apply(this,arguments)}function Oe(){return(Oe=Object(o.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.a.setItem(t.uid,t);case 2:return t.pdf,t.pageRec,n=Object(S.a)(t,Q),e.next=5,be(n);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xe(e){return he.apply(this,arguments)}function he(){return(he=Object(o.a)(j.a.mark((function e(t){var n,r,a,c,u,s;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe(t);case 2:return n=e.sent,e.next=5,Z();case 5:return r=e.sent,e.next=8,te();case 8:if(a=e.sent,n){e.next=11;break}return e.abrupt("return",{tags:a,allNotes:r});case 11:return e.next=13,C.a.removeItem(t);case 13:return n.pdf,n.pageRec,c=Object(S.a)(n,X),delete r[t],e.next=17,C.a.setItem("ALL_NOTES",r);case 17:if("DEFAULT"===(u=c.tagId)){e.next=23;break}return s=a[u].notes,a[u].notes=s.filter((function(e){return e!==t})),e.next=23,C.a.setItem("ALL_TAGS",a);case 23:return e.abrupt("return",{tags:a,allNotes:r});case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ve(e,t){return me.apply(this,arguments)}function me(){return(me=Object(o.a)(j.a.mark((function e(t,n){var r,a,c,u,s,i;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe(t);case 2:return c=e.sent,e.next=5,Z();case 5:return u=e.sent,e.next=8,te();case 8:if(s=e.sent,c){e.next=11;break}return e.abrupt("return",{tags:s,allNotes:u});case 11:return i=c.tagId,c.tagId=n,e.next=15,C.a.setItem(t,c);case 15:return u[t].tagId=n,e.next=18,C.a.setItem("ALL_NOTES",u);case 18:return i in s&&(s[i].notes=s[i].notes.filter((function(e){return e!==t}))),null===(r=s[n])||void 0===r||null===(a=r.notes)||void 0===a||a.push(t),e.next=22,C.a.setItem("ALL_TAGS",s);case 22:return e.abrupt("return",{tags:s,allNotes:u});case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ge(e,t){return ke.apply(this,arguments)}function ke(){return(ke=Object(o.a)(j.a.mark((function e(t,n){var r,a,c,u,s,i,o,d,b,p;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe(t);case 2:if(e.t1=r=e.sent,e.t0=null===e.t1,e.t0){e.next=6;break}e.t0=void 0===r;case 6:if(!e.t0){e.next=10;break}e.t2=void 0,e.next=11;break;case 10:e.t2=r.pageRec;case 11:if(a=e.t2){e.next=14;break}return e.abrupt("return");case 14:c={},u=0,s=Object.entries(n);case 16:if(!(u<s.length)){e.next=27;break}if(i=Object(l.a)(s[u],2),o=i[0],d=i[1],b=d.states,p=a[o].ratio){e.next=22;break}return e.abrupt("continue",24);case 22:delete b[N()],c[o]={ratio:p,state:{strokes:Object.values(b).flat(1)}};case 24:u++,e.next=16;break;case 27:return e.abrupt("return",c);case 28:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ye(e,t,n,r){return we.apply(this,arguments)}function we(){return(we=Object(o.a)(j.a.mark((function e(t,n,r,a){var c,u,s;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe(t);case 2:if(!(c=e.sent)){e.next=5;break}return e.abrupt("return");case 5:for(u=0,s=Object.values(r);u<s.length;u++)s[u].state={strokes:[]};return c=Object(b.a)(Object(b.a)({},n),{},{tagId:"DEFAULT",team:!0,pageRec:r,pdf:a}),e.next=9,fe(c);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Se(e,t,n){return Ie.apply(this,arguments)}function Ie(){return(Ie=Object(o.a)(j.a.mark((function e(t,n,r){var a,c,u,s,i,o,d,b,p,f,O,x;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe(t);case 2:if(a=e.sent){e.next=5;break}return e.abrupt("return");case 5:if(!((c=n.pageOrder).length<a.pageOrder.length)){e.next=8;break}return e.abrupt("return");case 8:u=a.pageRec,s=a.pdf,i=0,o=Object.entries(r);case 10:if(!(i<o.length)){e.next=23;break}if(d=Object(l.a)(o[i],2),b=d[0],p=d[1],b in u){e.next=20;break}if(f=p.ratio,O=p.pdfIndex,x=void 0,!s||!O){e.next=19;break}return e.next=18,G(s,O,.5);case 18:x=e.sent;case 19:u[b]={ratio:f,state:{strokes:[]},pdfIndex:O,image:x};case 20:i++,e.next=10;break;case 23:return e.next=25,de(t,{pageOrder:c,pageRec:u});case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ce=n(495),Ne=n(68),Ee=n(247),Le=n(498),Re=n(496),Te=n(503),Pe=n(236),Ae=n(506),Ue=n(507),De=n(508),Fe=n(509),Me=n(510),_e=n(511),ze=n(512),Be=n(513),Ke=n(63),We=n.n(Ke),Ge=["statusCode"],Ve="https://api.slotdumpling.top/paint";function Ye(e){return He.apply(this,arguments)}function He(){return(He=Object(o.a)(j.a.mark((function e(t){var n,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,We.a.get("code/".concat(t));case 3:if(n=e.sent,r=n.data,console.log({data:r}),200===r.statusCode){e.next=8;break}return e.abrupt("return",null);case 8:return e.abrupt("return",r.noteId);case 11:return e.prev=11,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 15:case"end":return e.stop()}}),e,null,[[0,11]])})))).apply(this,arguments)}function Je(e){return qe.apply(this,arguments)}function qe(){return(qe=Object(o.a)(j.a.mark((function e(t){var n,r,a,c,u,s,i,o,l,d,b,p,f;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,We.a.get("info/".concat(t));case 3:if(n=e.sent,200===(r=n.data).statusCode){e.next=7;break}return e.abrupt("return",null);case 7:if(c=(a=r).pageInfos,u=a.noteInfo,s=void 0,!u.withImg){e.next=29;break}return e.next=12,We()({method:"GET",url:t,responseType:"blob"});case 12:return i=e.sent,o=i.data,s=new File([o],u.name+".pdf"),e.next=17,J(s);case 17:l=e.sent,d=0,b=Object.values(c);case 19:if(!(d<b.length)){e.next=28;break}if(p=b[d],f=p.pdfIndex){e.next=24;break}return e.abrupt("return");case 24:p.image=l[f-1];case 25:d++,e.next=19;break;case 28:u.thumbnail=l[0];case 29:return e.next=31,ye(t,u,c,s);case 31:e.next=37;break;case 33:return e.prev=33,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 37:case"end":return e.stop()}}),e,null,[[0,33]])})))).apply(this,arguments)}function $e(e){return Qe.apply(this,arguments)}function Qe(){return(Qe=Object(o.a)(j.a.mark((function e(t){var n,r,a,c,u,s,i,o,l,d,b,p;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe(t);case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return",null);case 5:return r=n.uid,a=n.name,c=n.withImg,u=n.pdf,s=n.pageOrder,i=n.pageRec,e.prev=6,e.next=9,We.a.put("create/".concat(t),{userId:N(),pageRec:i,noteInfo:{uid:r,name:a,withImg:c,pageOrder:s}});case 9:if(o=e.sent,l=o.data,!u){e.next=20;break}return d=new FormData,e.next=15,u.arrayBuffer();case 15:return b=e.sent,p=new Blob([b]),d.append("file",p,t),e.next=20,We()({method:"POST",url:"upload",data:d,headers:{"Content-Type":"multipart/form-data"}});case 20:if(201===l.statusCode){e.next=22;break}return e.abrupt("return",null);case 22:return e.abrupt("return",l.code);case 25:return e.prev=25,e.t0=e.catch(6),console.error(e.t0),e.abrupt("return",null);case 29:case"end":return e.stop()}}),e,null,[[6,25]])})))).apply(this,arguments)}function Xe(e){return Ze.apply(this,arguments)}function Ze(){return(Ze=Object(o.a)(j.a.mark((function e(t){var n,r,a,c,u,s,i;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe(t);case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return",null);case 5:return r=n.uid,a=n.name,c=n.withImg,u=n.pageOrder,s=n.pageRec,e.prev=6,e.next=9,We.a.put("update/".concat(t),{userId:N(),pageRec:s,noteInfo:{uid:r,name:a,withImg:c,pageOrder:u}});case 9:if(i=e.sent,201!==i.data.statusCode){e.next=15;break}return e.abrupt("return",!0);case 15:return e.abrupt("return",!1);case 16:e.next=22;break;case 18:return e.prev=18,e.t0=e.catch(6),console.error(e.t0),e.abrupt("return",!1);case 22:case"end":return e.stop()}}),e,null,[[6,18]])})))).apply(this,arguments)}function et(e){return tt.apply(this,arguments)}function tt(){return(tt=Object(o.a)(j.a.mark((function e(t){var n,r,a,c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,We.a.get("state/".concat(t));case 3:if(n=e.sent,200===(r=n.data).statusCode){e.next=7;break}return e.abrupt("return",null);case 7:return a=r.teamPages,e.next=10,ge(t,a);case 10:return c=e.sent,e.abrupt("return",c);case 14:return e.prev=14,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 18:case"end":return e.stop()}}),e,null,[[0,14]])})))).apply(this,arguments)}function nt(e){return rt.apply(this,arguments)}function rt(){return(rt=Object(o.a)(j.a.mark((function e(t){var n,r,a,c,u;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,We.a.get("info/".concat(t));case 3:if(n=e.sent,r=n.data,c=(a=r).statusCode,u=Object(S.a)(a,Ge),200===c){e.next=8;break}return e.abrupt("return",null);case 8:return e.abrupt("return",u);case 11:return e.prev=11,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 15:case"end":return e.stop()}}),e,null,[[0,11]])})))).apply(this,arguments)}function at(e){return ct.apply(this,arguments)}function ct(){return(ct=Object(o.a)(j.a.mark((function e(t){var n,r,a,c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,We.a.get("info/".concat(t));case 3:if(n=e.sent,200===(r=n.data).statusCode){e.next=7;break}return e.abrupt("return",null);case 7:return a=r.noteInfo,c=r.pageInfos,e.next=10,Se(t,a,c);case 10:return e.abrupt("return",!0);case 13:return e.prev=13,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",!1);case 17:case"end":return e.stop()}}),e,null,[[0,13]])})))).apply(this,arguments)}We.a.defaults.baseURL=Ve,We.a.interceptors.request.use((function(e){return console.log(e.method,e.url),e}));n(287);var ut=n(2);function st(e){var t=e.value,n=void 0===t?0:t,a=e.digitNum,c=void 0===a?4:a,u=e.onChange,s=void 0===u?function(){}:u,i=e.onSubmit;function o(e){return 0===e?new Array(c).fill(""):String(e).slice(0,c).padEnd(c,"x").split("").map((function(e){return"x"===e?"":e}))}var d=Object(r.useState)(0),j=Object(l.a)(d,2),b=j[0],p=j[1],f=Object(r.useState)(o(n)),O=Object(l.a)(f,2),x=O[0],h=O[1];function v(){-1===b?m.current.forEach((function(e){return e.blur()})):m.current[b].focus()}Object(r.useEffect)((function(){var e=o(n);h(e)}),[n]),Object(r.useEffect)((function(){var e=x.findIndex((function(e){return""===e}));p(e);var t=Number(x.join(""));t!==n&&(s(t),-1===e&&i(t))}),[x]),Object(r.useEffect)((function(){v()}),[b]);var m=Object(r.useRef)([]);function g(e){if("Backspace"===e.key){var t=Math.max(0,b-1);p(t),h((function(e){var n=e.slice();return n[t]="",n}))}}return Object(r.useEffect)((function(){m.current=m.current.slice(0,c)}),[c]),Object(ut.jsxs)("div",{className:"digit-input",children:[x.map((function(e,t){return Object(ut.jsx)("input",{ref:function(e){e&&(m.current[t]=e)},value:e,pattern:"\\d*",onChange:function(e){return function(e,t){/^[0-9]$/.test(e)&&h((function(n){var r=n.slice();return r[t]=e,r}))}(e.target.value,t)},onKeyUp:g},t)})),Object(ut.jsx)("div",{className:"click-area",onClick:v})]})}var it=n(497),ot=(n(289),n(151)),lt=n.n(ot),dt=n(184),jt=n.n(dt),bt=Object(r.createContext)({setActive:function(){}});function pt(){return Object(ut.jsxs)("div",{className:"right-tools",children:[Object(ut.jsx)(kt,{}),Object(ut.jsx)(gt,{})]})}var ft=function(){var e=Object(r.useContext)(bt).setActive,t=Ce.a.Item;return Object(ut.jsxs)(Ce.a,{onClick:function(t){var n=t.key;return e(n)},children:[Object(ut.jsxs)(t,{children:[Object(ut.jsx)(Ae.a,{}),Object(ut.jsx)("span",{children:"Load PDF"})]},"PDF"),Object(ut.jsxs)(t,{children:[Object(ut.jsx)(Ue.a,{}),Object(ut.jsx)("span",{children:"My profile"})]},"PROFILE"),Object(ut.jsxs)(t,{children:[Object(ut.jsx)(De.a,{}),Object(ut.jsx)("span",{children:"Settings"})]},"SETTINGS")]})},Ot=function(e){var t=e.children,n=e.title,a=Object(r.useContext)(bt).setActive;return Object(ut.jsxs)("div",{className:"secondary",children:[Object(ut.jsxs)("div",{className:"title",children:[Object(ut.jsx)(Ne.a,{type:"text",shape:"circle",onClick:function(){return a("MENU")},icon:Object(ut.jsx)(Fe.a,{})}),Object(ut.jsx)(lt.a,{level:5,children:n})]}),t]})};function xt(){var e=Object(r.useState)(!1),t=Object(l.a)(e,2),n=t[0],a=t[1],c=Object(r.useContext)(qt).tagUid,u=Object(r.useContext)($t),s=u.setAllTags,i=u.setAllNotes,d=Object(r.useState)(0),b=Object(l.a)(d,2),p=b[0],f=b[1];function O(){return(O=Object(o.a)(j.a.mark((function e(t){var n,r,u,o;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("application/pdf"===t.type){e.next=2;break}return e.abrupt("return");case 2:return a(!0),e.next=5,Y(t,f);case 5:return(n=e.sent).tagId=c,e.next=9,fe(n);case 9:return r=e.sent,u=r.tags,o=r.allNotes,s(u),i(o),a(!1),Ee.b.success("PDF Loaded"),e.abrupt("return",!1);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(ut.jsx)(Ot,{title:"Load PDF",children:Object(ut.jsxs)(jt.a,{disabled:n,multiple:!1,action:"#",accept:"application/pdf",beforeUpload:function(e){return O.apply(this,arguments)},children:[Object(ut.jsx)("p",{className:"ant-upload-drag-icon",children:n?Object(ut.jsx)(Le.a,{width:48,type:"circle",percent:p}):Object(ut.jsx)(Me.a,{})}),Object(ut.jsx)("p",{className:"ant-upload-hint",children:"Click or drag a pdf file here."})]})})}var ht=function(){var e=E(),t=Object(r.useState)(e),n=Object(l.a)(t,2),a=n[0],c=n[1];return Object(ut.jsx)(Ot,{title:"My profile",children:Object(ut.jsxs)("div",{className:"profile-page",children:[Object(ut.jsx)(Re.a,{prefix:Object(ut.jsx)(Ue.a,{}),value:a,onChange:function(e){return c(e.target.value)}}),Object(ut.jsx)(Ne.a,{onClick:function(){!function(e){!!(e=e.trim())&&localStorage.setItem("USER_NAME",e)}(a)},type:"primary",block:!0,children:"OK"})]})})},vt=function(){var e=Ce.a.Item,t=Object(r.useContext)($t).menuInit,n=function(){var e=Object(o.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.a.clear();case 2:t();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(ut.jsx)(Ot,{title:"Settings",children:Object(ut.jsx)(Ce.a,{children:Object(ut.jsx)(Te.a,{title:"Delete all notes and tags?",onConfirm:n,icon:Object(ut.jsx)(_e.a,{}),okText:"Yes",okType:"danger",cancelText:"No",placement:"left",children:Object(ut.jsxs)(e,{danger:!0,children:[Object(ut.jsx)(_e.a,{}),Object(ut.jsx)("span",{children:"Clear all"})]},"CLEAR")})})})},mt=function(){var e=Object(r.useState)(0),t=Object(l.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(""),u=Object(l.a)(c,2),s=u[0],i=u[1],o={timeout:300,onEnter:function(e){a(e.clientHeight)},unmountOnExit:!0},d=Object(b.a)(Object(b.a)({},o),{},{classNames:"secondary"});return Object(r.useEffect)((function(){return i("MENU")}),[]),Object(ut.jsx)(bt.Provider,{value:{setActive:i},children:Object(ut.jsxs)("section",{className:"others-menu",style:{height:n},children:[Object(ut.jsx)(it.a,Object(b.a)(Object(b.a)({classNames:"primary",in:"MENU"===s},o),{},{children:Object(ut.jsx)(ft,{})})),Object(ut.jsx)(it.a,Object(b.a)(Object(b.a)({in:"PDF"===s},d),{},{children:Object(ut.jsx)(xt,{})})),Object(ut.jsx)(it.a,Object(b.a)(Object(b.a)({in:"PROFILE"===s},d),{},{children:Object(ut.jsx)(ht,{})})),Object(ut.jsx)(it.a,Object(b.a)(Object(b.a)({in:"SETTINGS"===s},d),{},{children:Object(ut.jsx)(vt,{})}))]})})},gt=function(){return Object(ut.jsx)(Pe.a,{placement:"bottomRight",trigger:"click",content:Object(ut.jsx)(mt,{}),zIndex:900,children:Object(ut.jsx)(Ne.a,{shape:"circle",icon:Object(ut.jsx)(ze.a,{})})})};function kt(){var e=Object(r.useState)(0),t=Object(l.a)(e,2),n=t[0],a=t[1],c=Object(i.f)();function u(){return(u=Object(o.a)(j.a.mark((function e(t){var n,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ee.b.loading("Loading team note...",0),e.next=3,Ye(t);case 3:if(r=e.sent){e.next=8;break}return a(0),Ee.b.error("Room doesn't exist."),e.abrupt("return",n());case 8:return e.next=10,Je(r);case 10:n(),c("/team/".concat(r));case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(ut.jsxs)(Pe.a,{placement:"bottomRight",trigger:"click",title:"Join a team note",destroyTooltipOnHide:!0,content:Object(ut.jsx)(st,{value:n,onChange:a,onSubmit:function(e){return u.apply(this,arguments)}}),children:[Object(ut.jsx)(Ne.a,{className:"team-btn large",shape:"round",icon:Object(ut.jsx)(Be.a,{}),children:"Team"}),Object(ut.jsx)(Ne.a,{className:"team-btn small",shape:"circle",icon:Object(ut.jsx)(Be.a,{})})]})}var yt=n(514),wt=n(160),St=n(515);function It(){var e=Object(r.useContext)(qt).editing,t=Object(r.useContext)($t).setEditing;function n(){t((function(e){return!e}))}return Object(ut.jsxs)("div",{className:"left-tools",children:[Object(ut.jsx)("label",{htmlFor:"aside-checkbox",id:"aside-label",children:Object(ut.jsx)(yt.a,{})}),Object(ut.jsx)(Ne.a,{className:"edit-btn large",onClick:n,type:e?"primary":"text",block:!0,children:e?"Done":"Edit"}),Object(ut.jsx)(Ne.a,{className:"edit-btn small",onClick:n,type:e?"primary":"text",shape:"circle",children:e?Object(ut.jsx)(wt.a,{}):Object(ut.jsx)(St.a,{})})]})}var Ct=n(501),Nt=n(516),Et=n(60),Lt=n(249),Rt=n(517),Tt=n(518),Pt=n(238),At=n.n(Pt),Ut=function(e){var t={backgroundColor:e.color};return Object(ut.jsx)("div",{className:"tag-circle",style:t})};function Dt(e){var t=e.noteTag,n=t.uid,a=t.color,c=t.name,u=t.notes,s=Object(r.useContext)(qt).editing,i=Object(r.useContext)($t),d=i.setTagUid,b=i.setAllTags,p=Object(r.useState)(!1),f=Object(l.a)(p,2),O=f[0],x=f[1],h=Object(r.useState)(c),v=Object(l.a)(h,2),m=v[0],g=v[1],k=Object(r.useState)(a),y=Object(l.a)(k,2),w=y[0],S=y[1];function I(){return(I=Object(o.a)(j.a.mark((function e(){var t;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ce(n);case 2:t=e.sent,d("DEFAULT"),b(t);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(){return(C=Object(o.a)(j.a.mark((function e(){var t,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={uid:n,name:m,color:w,notes:u},e.next=3,se(t);case 3:r=e.sent,b(r),x(!1);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var N=Object(ut.jsx)(Ct.a,{value:w,onSelect:S,children:L.map((function(e){return Object(ut.jsx)(Ct.a.Option,{value:e,children:Object(ut.jsx)(Ut,{color:e})},e)}))}),E=function(){return Object(ut.jsx)(Re.a,{className:"tag-name-input",addonBefore:N,value:m,onChange:function(e){return g(e.target.value)}})};return Object(ut.jsxs)("div",{className:"menu-item",children:[s&&O?Object(ut.jsxs)(ut.Fragment,{children:[Object(ut.jsx)(Te.a,{title:"Delete this tag?",onConfirm:function(){return I.apply(this,arguments)},placement:"left",okText:"Yes",cancelText:"No",children:Object(ut.jsx)(Ne.a,{type:"text",danger:!0,size:"small",icon:Object(ut.jsx)(Nt.a,{})})}),Object(ut.jsx)(E,{})]}):Object(ut.jsxs)(ut.Fragment,{children:[Object(ut.jsx)(Ut,{color:w}),Object(ut.jsx)("span",{className:"tag-name",children:m})]}),s&&O&&Object(ut.jsxs)(ut.Fragment,{children:[Object(ut.jsx)(Ne.a,{disabled:""===m,size:"small",type:"link",onClick:function(){return C.apply(this,arguments)},icon:Object(ut.jsx)(wt.a,{})}),Object(ut.jsx)(Ne.a,{size:"small",type:"text",onClick:function(){g(c),S(a),x(!1)},icon:Object(ut.jsx)(Et.a,{})})]}),s&&!O&&Object(ut.jsx)(Ne.a,{size:"small",type:"text",onClick:function(){return x(!0)},icon:Object(ut.jsx)(De.a,{})})]})}var Ft=function(){var e=Object(r.useContext)($t).setAllTags;function t(){return(t=Object(o.a)(j.a.mark((function t(n){var r,a;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.trim()){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,re(r);case 7:a=t.sent,e(a);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var n=Object(ut.jsx)(At.a,{placeholder:"Tag name...",onSearch:function(e){return t.apply(this,arguments)},allowClear:!0,enterButton:Object(ut.jsx)(Lt.a,{})});return Object(ut.jsx)("div",{id:"add-tag",children:Object(ut.jsx)(Pe.a,{content:n,trigger:"click",placement:"topLeft",destroyTooltipOnHide:!0,children:Object(ut.jsx)(Ne.a,{shape:"circle",type:"text",icon:Object(ut.jsx)(Rt.a,{})})})})};function Mt(){var e=Object(r.useContext)(qt).allTags,t=Object(r.useContext)($t).setTagUid;var n=Ce.a.Item;return Object(ut.jsxs)("aside",{children:[Object(ut.jsx)("input",{type:"checkbox",id:"aside-checkbox"}),Object(ut.jsxs)("div",{className:"side-wrapper",children:[Object(ut.jsxs)(Ce.a,{onClick:function(e){var n=e.key;t(n)},className:"side-menu",defaultSelectedKeys:["DEFAULT"],defaultOpenKeys:["sub1"],mode:"inline",children:[Object(ut.jsx)(n,{children:Object(ut.jsxs)("div",{className:"menu-item",children:[Object(ut.jsx)(Tt.a,{id:"all-note-icon"}),Object(ut.jsx)("span",{className:"tag-name",children:"All Notes"})]})},"DEFAULT"),Object.values(e).map((function(e){return Object(ut.jsx)(n,{children:Object(ut.jsx)(Dt,{noteTag:e})},e.uid)}))]}),Object(ut.jsx)("footer",{children:Object(ut.jsx)(Ft,{})})]})]})}var _t=n(502),zt=n(504),Bt=n(519),Kt=n(520),Wt=n(521),Gt=n.p+"static/media/default.dd551273.png";function Vt(e){var t=Object(r.useMemo)((function(){return e?URL.createObjectURL(e):null}),[e]);return Object(r.useEffect)((function(){var e=t||"";return function(){return URL.revokeObjectURL(e)}}),[t]),t}function Yt(e){var t=e.noteList;return Object(ut.jsx)("div",{className:"note-list",children:t.map((function(e){return Object(ut.jsx)(Ht,{noteInfo:e},e.uid)}))})}var Ht=function(e){var t=e.noteInfo,n=t.team,a=t.uid,c=t.name,u=t.thumbnail,s=Object(r.useContext)(qt),d=s.editing,f=s.allTags,O=Object(r.useContext)($t),x=O.setAllTags,h=O.setAllNotes,v=Object(r.useState)(c),m=Object(l.a)(v,2),g=m[0],k=m[1],y=Object(r.useState)(!1),w=Object(l.a)(y,2),S=w[0],I=w[1],C=Object(i.f)(),N=Vt(u),E=d?"#":"".concat(n?"team":"reader","/").concat(a);function L(){return R.apply(this,arguments)}function R(){return(R=Object(o.a)(j.a.mark((function e(){var t,n,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,xe(a);case 2:t=e.sent,n=t.tags,r=t.allNotes,x(n),h(r);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var T=function(){var e=Object(o.a)(j.a.mark((function e(t){var n,r,c,u;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.key,e.next=3,ve(a,n);case 3:r=e.sent,c=r.tags,u=r.allNotes,x(c),h(u);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),P=function(){var e=Ce.a.Item,t=Object(ut.jsxs)(Ce.a,{onClick:T,children:[Object(ut.jsx)(e,{children:Object(ut.jsxs)("div",{className:"tag-select",children:[Object(ut.jsx)(Et.a,{className:"none-tag-icon"}),Object(ut.jsx)("span",{children:"None Tag"})]})},"DEFAULT"),Object.values(f).map((function(t){return Object(ut.jsx)(e,{children:Object(ut.jsxs)("div",{className:"tag-select",children:[Object(ut.jsx)(Ut,{color:t.color}),Object(ut.jsx)("span",{children:t.name})]})},t.uid)}))]});return Object(ut.jsx)(_t.a,{overlay:t,trigger:["click"],children:Object(ut.jsx)(Ne.a,{type:"text",icon:Object(ut.jsx)(Bt.a,{})})})},A=function(){return Object(ut.jsx)(Te.a,{title:"Delete this note?",onConfirm:L,okText:"Yes",icon:Object(ut.jsx)(Kt.a,{}),okType:"danger",cancelText:"No",children:Object(ut.jsx)(Ne.a,{type:"text",danger:!0,icon:Object(ut.jsx)(Kt.a,{})})})};return Object(ut.jsxs)("div",{className:"list-item",onClick:Object(o.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=6;break}return e.next=3,at(a);case 3:C(E),e.next=7;break;case 6:C(E);case 7:case"end":return e.stop()}}),e)}))),children:[Object(ut.jsxs)("div",{className:"thumbnail-wrapper",children:[Object(ut.jsx)("img",{src:N||Gt,alt:c,className:"thumbnail".concat(S?" loaded":""),onLoad:function(){return I(!0)}}),n&&Object(ut.jsx)(zt.a,{color:"blue",className:"cloud-icon",children:Object(ut.jsx)(Wt.a,{})})]}),d||Object(ut.jsx)("p",{className:"note-name",children:c}),d&&Object(ut.jsxs)(ut.Fragment,{children:[Object(ut.jsx)(Re.a,{className:"note-name-input",value:g,onChange:function(e){return k(e.target.value)},onBlur:function(){de(a,{name:g}),h((function(e){return Object(b.a)(Object(b.a)({},e),{},Object(p.a)({},a,Object(b.a)(Object(b.a)({},e[a]),{},{name:g})))}))}}),Object(ut.jsx)(P,{}),Object(ut.jsx)(A,{})]})]})},Jt=n(522),qt=Object(r.createContext)({tagUid:"DEFAULT",editing:!1,allNotes:{},allTags:{}}),$t=Object(r.createContext)({setAllNotes:function(){},setAllTags:function(){},setTagUid:function(){},setEditing:function(){},menuInit:function(){}});function Qt(){var e=Object(r.useState)({}),t=Object(l.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)({}),u=Object(l.a)(c,2),s=u[0],i=u[1],o=Object(r.useState)("DEFAULT"),d=Object(l.a)(o,2),j=d[0],b=d[1],p=Object(r.useState)(!1),f=Object(l.a)(p,2),O=f[0],x=f[1],h=Object(r.useMemo)((function(){return"DEFAULT"===j?{uid:"",name:"All Notes",color:"#000000",notes:Object.keys(n)}:s[j]}),[j,s,n]),v=Object(r.useMemo)((function(){return h.notes.filter((function(e){return e in n})).map((function(e){return n[e]}))}),[h,n]),m=function(){Z().then(a),te().then(i),document.title="Multibility"};return Object(r.useEffect)(m,[]),Object(ut.jsx)(qt.Provider,{value:{tagUid:j,editing:O,allNotes:n,allTags:s},children:Object(ut.jsx)($t.Provider,{value:{setAllNotes:a,setAllTags:i,setEditing:x,setTagUid:b,menuInit:m},children:Object(ut.jsxs)("div",{className:"menu-container",children:[Object(ut.jsxs)("header",{children:[Object(ut.jsx)(It,{}),Object(ut.jsx)(lt.a,{level:4,children:h.name}),Object(ut.jsx)(pt,{})]}),Object(ut.jsxs)("main",{children:[Object(ut.jsx)(Mt,{}),Object(ut.jsx)(Yt,{noteList:v}),Object(ut.jsx)(Xt,{})]})]})})})}var Xt=function(){var e=Object(r.useContext)(qt).tagUid,t=Object(r.useContext)($t),n=t.setAllTags,a=t.setAllNotes;function c(){return(c=Object(o.a)(j.a.mark((function t(){var r,c,u,s;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(r=y()).tagId=e,t.next=4,fe(r);case 4:c=t.sent,u=c.tags,s=c.allNotes,n(u),a(s);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return Object(ut.jsx)(Ne.a,{className:"new-note",size:"large",type:"primary",shape:"circle",onClick:function(){return c.apply(this,arguments)},icon:Object(ut.jsx)(Jt.a,{})})},Zt=n(8);var en=n(98),tn=n.n(en),nn=(n(481),function(e){var t=e.drawState,n=e.onChange,a=void 0===n?function(){}:n,c=e.erasing,u=void 0!==c&&c,s=e.finger,i=void 0!==s&&s,o=e.lineWidth,d=void 0===o?10:o,j=e.color,b=void 0===j?"#000000":j,p=e.highlight,f=void 0!==p&&p,O=e.readonly,h=void 0!==O&&O,v=e.preview,m=void 0!==v&&v,k=t.width,y=t.height,w=Object(r.useRef)(null),S=Object(r.useRef)(new tn.a.PaperScope),I=Object(r.useRef)(),C=Object(r.useRef)(1),N=Object(r.useRef)(),E=Object(r.useState)(Object(x.e)()),L=Object(l.a)(E,2),R=L[0],T=L[1];u&&(d=10,b="#aaa8");var P=function(){S.current.activate(),N.current=new S.current.Path;var e=new tn.a.Color(b);f&&(e.alpha/=2),N.current.strokeColor=e,N.current.strokeWidth=d,N.current.strokeCap="round",function(){var e,t=null===(e=w.current)||void 0===e?void 0:e.clientWidth;t&&(C.current=k/t)}()},A=function(e){var t;N.current&&(N.current.add(e.point.multiply(C.current)),N.current.smooth(),u&&(null===(t=I.current)||void 0===t||t.children.forEach((function(e){var t;e instanceof tn.a.Path&&null!==(t=N.current)&&void 0!==t&&t.intersects(e)&&T((function(t){return t.add(e.name)}))}))))},U=u?function(){N.current&&(a((function(e){return g.eraseStrokes(e,R.toArray())})),T(Object(x.e)()))}:function(){if(N.current){N.current.simplify();var e=N.current.pathData;e&&a((function(t){return g.addStroke(t,{pathData:e,lineWidth:d,color:b,highlight:f})}))}},F=function(e){(function(e){return i||function(e){var t=e.touches[0];return"stylus"===(null===t||void 0===t?void 0:t.touchType)}(e)})(e)||e.stopPropagation()};return Object(r.useEffect)((function(){!function(){if(w.current&&(S.current.setup(w.current),S.current.view.viewSize.width=k,S.current.view.viewSize.height=y,m)){var e=200/k;S.current.view.viewSize.width*=e,S.current.view.viewSize.height*=e,S.current.view.scale(e,new tn.a.Point(0,0))}}();var e=w.current;return function(){e&&D(e)}}),[]),Object(r.useEffect)((function(){h||(S.current.view.onMouseDown=P,S.current.view.onMouseDrag=A,S.current.view.onMouseUp=U)})),Object(r.useEffect)((function(){var e;null===(e=N.current)||void 0===e||e.remove()}),[t]),Object(r.useEffect)((function(){return S.current.activate(),I.current=new S.current.Group,t.getValidStrokes().forEach((function(e){var t,n=e.pathData,r=e.lineWidth,a=e.color,c=e.uid,u=e.highlight,s=new tn.a.Path(n);s.strokeWidth=r,s.strokeCap="round",s.strokeColor=new tn.a.Color(a),R.has(c)&&(s.opacity/=2),u&&(s.opacity/=2),s.name=c,null===(t=I.current)||void 0===t||t.addChild(s)})),function(){var e;null===(e=I.current)||void 0===e||e.removeChildren()}}),[t,R]),Object(ut.jsx)("canvas",{ref:w,className:"draw-canvas","data-paper-hidpi":!1,onTouchStartCapture:F,onTouchMoveCapture:F})}),rn=a.a.memo(nn),an={states:Object(x.b)(),editStack:Object(x.a)(),undoStack:Object(x.a)()},cn=Object(x.d)(an),un=function(){function e(t,n){Object(f.a)(this,e),this.immutable=t,this.lastOp=n}return Object(O.a)(e,[{key:"getImmutable",value:function(){return this.immutable}},{key:"getStates",value:function(){return this.getImmutable().get("states")}},{key:"getEditStack",value:function(){return this.getImmutable().get("editStack")}},{key:"getUndoStack",value:function(){return this.getImmutable().get("undoStack")}},{key:"setState",value:function(t,n){var r,a=this.getImmutable().update("states",(function(e){return e.set(t,n)}));return this.getStates().has(t)&&(a=a.update("editStack",(function(e){return e.push(t)}))),n.lastOp&&(r=Object(b.a)(Object(b.a)({},n.lastOp),{},{pageId:t})),new e(a,r)}},{key:"addState",value:function(t,n,r){var a=n.state,c=n.ratio;return new e(this.getImmutable().update("states",(function(e){return e.set(t,g.loadFromFlat(a,r,r*c))})))}},{key:"deleteState",value:function(t){return new e(this.getImmutable().update("states",(function(e){return e.delete(t)})))}},{key:"getOneState",value:function(e){return this.getImmutable().get("states").get(e)}},{key:"isUndoable",value:function(){return this.getEditStack().size>0}},{key:"isRedoable",value:function(){return this.getUndoStack().size>0}},{key:"undo",value:function(){if(!this.isUndoable())return this;var t=this.getImmutable(),n=t.get("editStack").last();if(!n)return this;var r=t.get("states").get(n);if(!r)return this;var a,c=g.undo(r),u=c.lastOp;return u&&(a=Object(b.a)({pageId:n},u)),new e(t.update("editStack",(function(e){return e.pop()})).update("undoStack",(function(e){return e.push(n)})).update("states",(function(e){return e.set(n,c)})),a)}},{key:"redo",value:function(){if(!this.isRedoable())return this;var t=this.getImmutable(),n=t.get("undoStack").last();if(!n)return this;var r=t.get("states").get(n);if(!r)return this;var a,c=g.redo(r),u=c.lastOp;return u&&(a=Object(b.a)({pageId:n},u)),new e(t.update("undoStack",(function(e){return e.pop()})).update("editStack",(function(e){return e.push(n)})).update("states",(function(e){return e.set(n,c)})),a)}},{key:"pushOperation",value:function(e){var t,n=e.type,r=e.pageId,a=this.getImmutable().get("states").get(r);if(!a)return this;switch(n){case"add":t=g.pushStroke(a,e.stroke);break;case"erase":t=g.pushErase(a,e.erase);break;case"undo":t=g.pushUndo(a,e.undoUid);break;case"redo":t=g.pushRedo(a,e.redoUid)}return this.setState(r,t)}},{key:"getLastDs",value:function(){var e,t=null===(e=this.lastOp)||void 0===e?void 0:e.pageId;if(!t)throw new Error("can't get last modified page.");var n=this.getOneState(t);if(!n)throw new Error("can't get last modified page drawstate.");return[t,n]}}],[{key:"createFromList",value:function(t){return new e(cn().set("states",Object(x.b)(t)))}},{key:"createFromPages",value:function(t,n){var r=Object.entries(t);return e.createFromList(r.map((function(e){var t=Object(l.a)(e,2),r=t[0],a=t[1],c=a.state,u=a.ratio;return[r,g.loadFromFlat(c,n,n*u)]})))}}]),e}(),sn=n(163),on=n(239),ln=n(494),dn=n(499),jn=n(492),bn=n(246),pn=n(523),fn=n(524),On=["image","state","marked"],xn=Object(r.createContext)({code:-2,userList:[],loadInfo:void 0,teamStateSet:void 0,pushOperation:void 0,teamUpdate:void 0,updateReorder:function(){},updateNewPage:function(){}});function hn(){var e,t=null!==(e=Object(i.g)().noteId)&&void 0!==e?e:"",n=Object(r.useState)(),a=Object(l.a)(n,2),c=a[0],u=a[1],s=Object(r.useState)(-2),d=Object(l.a)(s,2),p=d[0],f=d[1],O=Object(r.useState)([]),x=Object(l.a)(O,2),h=x[0],v=x[1],m=Object(r.useState)(function(e){return function(){return Object(bn.a)(Ve,{autoConnect:!1,query:{userId:N(),userName:E(),noteId:e}})}}(t)),g=Object(l.a)(m,1)[0],k=Object(r.useState)(),y=Object(l.a)(k,2),w=y[0],I=y[1],C=Object(i.f)();function L(){return R.apply(this,arguments)}function R(){return(R=Object(o.a)(j.a.mark((function e(){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,et(t);case 2:if(n=e.sent){e.next=6;break}return Ee.b.error("Failed loading the team note state"),e.abrupt("return",!1);case 6:return u(un.createFromPages(n,Xn)),e.abrupt("return",!0);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(){return P.apply(this,arguments)}function P(){return(P=Object(o.a)(j.a.mark((function e(){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,nt(t);case 2:if(n=e.sent){e.next=6;break}return Ee.b.error("Failed loading the team note info"),e.abrupt("return",!1);case 6:return f(n.code),e.abrupt("return",!0);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var A=function(){var e=Object(o.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L();case 2:if(e.t0=e.sent,!e.t0){e.next=7;break}return e.next=6,T();case 6:e.t0=e.sent;case 7:if(e.t0){e.next=9;break}return e.abrupt("return",C("/"));case 9:g.on("push",(function(e){var t=e.operation;u((function(e){return null===e||void 0===e?void 0:e.pushOperation(t)}))})),g.on("joined",(function(e){var t=e.joined,n=e.members,r=t.userId,a=t.userName;v(n),r!==N()&&(Ee.b.destroy(r),Ee.b.success({icon:Object(ut.jsx)(pn.a,{}),content:"".concat(a," joined room"),key:r,style:{marginTop:60}}))})),g.on("leaved",(function(e){var t=e.leaved,n=e.members,r=t.userId,a=t.userName;v(n),r!==N()&&(Ee.b.destroy(r),Ee.b.warning({icon:Object(ut.jsx)(fn.a,{}),content:"".concat(a," leaved room"),key:r,style:{marginTop:60}}))})),g.on("reorder",(function(e){var t=e.pageOrder;I({type:"reorder",pageOrder:t})})),g.on("newPage",(function(e){var t,n=e.pageId,r=e.newPage,a=e.pageOrder,c=(t=r,Object(b.a)(Object(b.a)({},t),{},{state:{strokes:[]}}));I({type:"newPage",pageOrder:a,pageId:n,newPage:c}),u((function(e){return null===e||void 0===e?void 0:e.addState(n,c,Xn)}))})),g.connect();case 15:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),U=function(){g.removeAllListeners(),g.disconnect()};Object(r.useEffect)((function(){return A(),U}),[t]);return Object(ut.jsx)(xn.Provider,{value:{code:p,userList:h,teamUpdate:w,teamStateSet:c,loadInfo:T,pushOperation:function(e){g.emit("push",{operation:e})},updateReorder:function(e){g.emit("reorder",{pageOrder:e})},updateNewPage:function(e,t,n){u((function(e){return null===e||void 0===e?void 0:e.addState(t,n,Xn)}));n.image,n.state,n.marked;var r=Object(S.a)(n,On);g.emit("newPage",{pageOrder:e,pageId:t,newPage:r})}},children:Object(ut.jsx)(rr,{teamOn:!0})})}n(482);function vn(e){var t=e.value,n=Object(r.useState)(9999),a=Object(l.a)(n,2),c=a[0],u=a[1],s=String(t>=0?t:c).padStart(4,"0").split("").map((function(e){return Number(e)}));function i(){u(Math.floor(1e4*Math.random()))}return Object(r.useEffect)((function(){if(-1!==t)return u(9999);var e=setTimeout(i,100);return function(){return clearTimeout(e)}}),[t]),Object(ut.jsx)("div",{className:"digit-display ".concat(-2===t?"disabled":""),children:s.map((function(e,t){return Object(ut.jsx)(mn,{digit:e},t)}))})}function mn(e){var t=e.digit;return t<=9&&t>=0?Object(ut.jsx)("div",{className:"digit",children:t}):Object(ut.jsx)("div",{className:"digit",children:"*"})}var gn=n(529),kn=n(530),yn=n(531),wn=n(532),Sn=n(533),In=n(534),Cn=(n(483),n(493)),Nn=n(500),En=n(525),Ln=n(526),Rn=n(527),Tn=n(528),Pn=n(505),An=Object(Pn.a)({scriptUrl:"//at.alicdn.com/t/font_3181679_eb02zt96p4p.js"}),Un=n(164);n(484);function Dn(e,t,n){var r=e.indexOf(t),a=e.slice();return-1===r||a.splice(r+1,0,n),a}var Fn=function(){var e=Object(r.useContext)(nr).addFinalPage,t=Object(r.useContext)(tr).pageOrder,n=Boolean(t&&!t.length);return Object(ut.jsx)("div",{className:"add-btn-wrapper".concat(n?" empty":""),children:Object(ut.jsx)(Ne.a,{type:"dashed",icon:Object(ut.jsx)(Lt.a,{}),block:!0,onClick:e,children:"Add page"})})},Mn=function(e){var t=e.activeKey,n=e.setActiveKey,a=Object(r.useContext)(tr),c=a.pageOrder,u=a.inviewPages,s=Object(r.useContext)(nr),i=s.setPageOrder,o=s.scrollPage,d=Object(r.useContext)(xn).updateReorder,j=Object(r.useMemo)((function(){return(null===c||void 0===c?void 0:c.find((function(e){return u.has(e)})))||""}),[c,u]);return Object(ut.jsxs)("div",{className:"preview-container",children:[Object(ut.jsx)(Bn,{activeKey:t,setActiveKey:n}),Object(ut.jsx)(Un.a,{onDragEnd:function(e){var t=e.source,n=e.destination;if(n&&c){var r=t.index,a=n.index,u=c[r];i((function(e){if(e){var t=function(e,t,n){var r=e.slice(),a=r.splice(t,1),c=Object(l.a)(a,1)[0];return r.splice(n,0,c),r}(e,r,a);return d&&d(t),t}})),requestAnimationFrame((function(){return o(u)}))}},children:Object(ut.jsx)(Un.c,{droppableId:"droppable",children:function(e){var n=e.droppableProps,r=e.innerRef,a=e.placeholder;return Object(ut.jsxs)("div",Object(b.a)(Object(b.a)({className:"pages"},n),{},{ref:r,children:[null===c||void 0===c?void 0:c.map((function(e,n){return Object(ut.jsx)(_n,{uid:e,pageIndex:n,mode:t,currPageId:j},e)})),a,"ALL"===t&&Object(ut.jsx)(Fn,{})]}))}})})]})},_n=function(e){var t=e.uid,n=e.pageIndex,a=e.mode,c=e.currPageId,u=Object(r.useContext)(tr),s=u.stateSet,i=u.teamStateSet,o=u.pageRec,l=Object(r.useContext)(nr),d=l.scrollPage,j=l.switchPageMarked,p=o&&o[t],f=null===s||void 0===s?void 0:s.getOneState(t),O=null===i||void 0===i?void 0:i.getOneState(t);if(!p||!f)return null;if("WRITTEN"===a&&f.isEmpty()&&(!O||O.isEmpty()))return null;if("MARKED"===a&&!p.marked)return null;var x=function(e){j(t),e.stopPropagation()},h=c===t,v="ALL"!==a;return Object(ut.jsx)(Un.b,{draggableId:t,index:n,isDragDisabled:v,children:function(e,r){var a=e.innerRef,c=e.draggableProps,u=e.dragHandleProps,s=r.isDragging;return Object(ut.jsxs)("div",Object(b.a)(Object(b.a)(Object(b.a)({ref:a,className:"page".concat(h?" curr":"").concat(s?" drag":""),onClick:function(){return d(t)}},c),u),{},{children:[Object(ut.jsx)(cr,{uid:t,drawState:f,teamState:O,imageBlob:p.image,preview:!0}),Object(ut.jsx)("span",{className:"bookmark".concat(p.marked?" marked":""),onClickCapture:x}),Object(ut.jsx)("span",{className:"index",children:n+1}),Object(ut.jsx)(zn,{uid:t})]}))}})},zn=function(e){var t=e.uid,n=Object(r.useState)(!1),a=Object(l.a)(n,2),c=a[0],u=a[1],s=Object(r.useContext)(nr),i=s.addPage,o=s.deletePage,d=Object(r.useContext)(tr).teamOn,j=Ce.a.Item,b=Object(ut.jsxs)(Ce.a,{onClick:function(e){var n=e.key,r=e.domEvent;"ADD"===n?i(t):"COPY"===n?i(t,!0):"DELETE"===n&&o(t),r.stopPropagation(),u(!1)},children:[Object(ut.jsx)(j,{icon:Object(ut.jsx)(Lt.a,{}),children:"Add page"},"ADD"),Object(ut.jsx)(j,{icon:Object(ut.jsx)(En.a,{}),children:"Duplicate"},"COPY"),Object(ut.jsx)(j,{danger:!0,icon:Object(ut.jsx)(Kt.a,{}),disabled:d,children:"Delete"},"DELETE")]});return Object(ut.jsx)(Pe.a,{content:b,trigger:"click",placement:"left",visible:c,onVisibleChange:u,destroyTooltipOnHide:!0,children:Object(ut.jsx)("span",{className:"option",onClickCapture:function(e){u((function(e){return!e})),e.stopPropagation()},children:Object(ut.jsx)(Ln.a,{})})})},Bn=function(e){var t=e.activeKey,n=e.setActiveKey,r=Cn.a.TabPane;return Object(ut.jsxs)(Cn.a,{className:"tabs",centered:!0,tabBarGutter:10,size:"small",activeKey:t,onChange:n,children:[Object(ut.jsx)(r,{tab:Object(ut.jsx)(An,{type:"icon-uf_paper"})},"ALL"),Object(ut.jsx)(r,{tab:Object(ut.jsx)(An,{type:"icon-bookmark2"})},"MARKED"),Object(ut.jsx)(r,{tab:Object(ut.jsx)(An,{type:"icon-write"})},"WRITTEN")]})};function Kn(){var e=Object(r.useState)(!1),t=Object(l.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)("ALL"),u=Object(l.a)(c,2),s=u[0],i=u[1],o={ALL:"All Pages",MARKED:"Bookmarks",WRITTEN:"Notes"}[s];return Object(ut.jsxs)(ut.Fragment,{children:[Object(ut.jsx)(Ne.a,{type:"text",icon:Object(ut.jsx)(Rn.a,{}),onClick:function(){return a((function(e){return!e}))}}),Object(ut.jsx)(Nn.a,{visible:n,onClose:function(){return a(!1)},width:200,title:o,closeIcon:Object(ut.jsx)(Tn.a,{}),bodyStyle:{padding:0,overflow:"hidden"},forceRender:!0,children:Object(ut.jsx)(Mn,{activeKey:s,setActiveKey:i})})]})}function Wn(e){var t=e.setDrawCtrl,n=e.handleUndo,a=e.handleRedo,c=e.instantSave,u=Object(r.useContext)(er),s=u.erasing,o=u.finger,l=Object(r.useContext)(tr),d=l.saved,j=l.stateSet,p=l.teamOn,f=Object(i.f)(),O=function(e){t((function(t){return Object(b.a)(Object(b.a)({},t),e)}))};return Object(ut.jsxs)("header",{children:[Object(ut.jsxs)("div",{className:"left",children:[Object(ut.jsx)(Ne.a,{type:"text",onClick:function(){return f("/")},icon:Object(ut.jsx)(gn.a,{className:"home-icon"})}),Object(ut.jsx)("br",{}),Object(ut.jsx)(Ne.a,{type:"text",className:"save",onClick:c,disabled:d,icon:Object(ut.jsx)(kn.a,{})})]}),Object(ut.jsxs)("div",{className:"middle",children:[Object(ut.jsx)(Ne.a,{type:"text",shape:"circle",icon:Object(ut.jsx)(yn.a,{}),onClick:n,disabled:!(null!==j&&void 0!==j&&j.isUndoable())}),Object(ut.jsx)(Ne.a,{className:"redo",type:"text",shape:"circle",icon:Object(ut.jsx)(wn.a,{}),onClick:a,disabled:!(null!==j&&void 0!==j&&j.isRedoable())}),Object(ut.jsx)("br",{}),Object(ut.jsx)(Gn,{erasing:s,updateDrawCtrl:O}),Object(ut.jsx)(Ne.a,{type:s?"default":"text",shape:"circle",onClick:function(){return O({erasing:!0})},icon:Object(ut.jsx)(An,{type:"icon-eraser"})}),Object(ut.jsx)(Ne.a,{type:o?"primary":"text",ghost:o,shape:"circle",onClick:function(){return O({finger:!o})},icon:Object(ut.jsx)(An,{type:"icon-finger"})})]}),Object(ut.jsxs)("div",{className:"right",children:[p&&Object(ut.jsx)(Jn,{}),p||Object(ut.jsx)(qn,{}),Object(ut.jsx)("br",{}),Object(ut.jsx)(Kn,{})]})]})}var Gn=a.a.memo((function(e){var t=e.erasing,n=e.updateDrawCtrl;return t?Object(ut.jsx)(Ne.a,{type:"text",shape:"circle",onClick:function(){return n({erasing:!1})},icon:Object(ut.jsx)(Sn.a,{})}):Object(ut.jsx)(Pe.a,{content:Object(ut.jsx)(Vn,{updateDrawCtrl:n}),trigger:"click",placement:"bottom",getPopupContainer:function(e){return e},children:Object(ut.jsx)(Ne.a,{type:"default",shape:"circle",icon:Object(ut.jsx)(Sn.a,{})})})})),Vn=function(e){var t=e.updateDrawCtrl,n=Object(r.useContext)(er),a=n.lineWidth,c=n.highlight;return Object(ut.jsxs)("div",{className:"pen-panel",children:[Object(ut.jsxs)("div",{className:"pen-status",children:[Object(ut.jsx)(ln.a,{min:5,max:50,value:a,onChange:function(e){return t({lineWidth:e})}}),Object(ut.jsx)(Ne.a,{type:c?"primary":"text",ghost:c,shape:"circle",icon:Object(ut.jsx)(An,{type:"icon-Highlight"}),onClick:function(){return t({highlight:!c})}})]}),Object(ut.jsx)(Yn,{updateDrawCtrl:t})]})},Yn=function(e){var t=e.updateDrawCtrl,n=Object(r.useContext)(er).color;return Object(ut.jsx)("div",{className:"color-select",children:L.map((function(e){return Object(ut.jsx)("input",{checked:n===e,type:"radio",name:"color",onChange:function(){return t({color:e})},style:{borderColor:e,backgroundColor:e}},e)}))})},Hn=function(e){var t=e.userInfo.userName,n=Object(r.useMemo)((function(){return function(e){var t=function(e){var t=0;if(0===e.length)return t;for(var n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t}(e)%L.length;return L[t]}(t)}),[t]);return Object(ut.jsxs)("div",{className:"user-card",children:[Object(ut.jsx)(dn.a,{className:"avatar",size:"small",style:{backgroundColor:n},children:t.slice(0,4)}),Object(ut.jsx)("span",{children:t})]})};function Jn(){var e=Object(r.useContext)(xn),t=e.code,n=e.userList,a=e.loadInfo,c=Object(ut.jsxs)("div",{className:"team-popover",children:[Object(ut.jsx)(vn,{value:t}),Object(ut.jsx)(jn.a,{}),Object(ut.jsx)("div",{className:"user-list",children:n.map((function(e){return Object(ut.jsx)(Hn,{userInfo:e},e.userId)}))})]}),u=Object(ut.jsxs)("div",{className:"team-title",children:[Object(ut.jsx)("span",{children:"Team info"}),Object(ut.jsx)(Ne.a,{shape:"circle",type:"text",size:"small",icon:Object(ut.jsx)(In.a,{}),onClick:a})]});return Object(ut.jsx)(Pe.a,{content:c,trigger:"click",placement:"bottomRight",title:u,defaultVisible:!0,getPopupContainer:function(e){return e},children:Object(ut.jsx)(Ne.a,{type:"text",icon:Object(ut.jsx)(Be.a,{})})})}var qn=function(){var e=Object(r.useContext)(nr).createRoom;return Object(ut.jsx)(Te.a,{placement:"bottomRight",title:"Enable team editing?",onConfirm:e,okText:"Yes",cancelText:"No",children:Object(ut.jsx)(Ne.a,{type:"text",icon:Object(ut.jsx)(Be.a,{})})})},$n=n(244),Qn=(n(488),["pageRec","pdf","pageOrder"]),Xn=2e3,Zn={erasing:!1,finger:!1,even:!0,lineWidth:10,color:"#000000",highlight:!1},er=Object(r.createContext)(Zn),tr=Object(r.createContext)({noteId:"",noteInfo:void 0,stateSet:void 0,teamStateSet:void 0,pdfUrl:void 0,pageRec:void 0,pageOrder:void 0,saved:!0,teamOn:!1,inviewPages:Object(x.e)(),refRec:{}}),nr=Object(r.createContext)({createRoom:function(){},scrollPage:function(){},setInviewPages:function(){},switchPageMarked:function(){},setPageOrder:function(){},setPageState:function(){},addPage:function(){},addFinalPage:function(){},deletePage:function(){}});function rr(e){var t,n=e.teamOn,a=null!==(t=Object(i.g)().noteId)&&void 0!==t?t:"",c=Object(i.f)(),u=Object(r.useState)(),s=Object(l.a)(u,2),d=s[0],f=s[1],O=Object(r.useState)(),h=Object(l.a)(O,2),v=h[0],m=h[1],k=Object(r.useState)(),y=Object(l.a)(k,2),I=y[0],C=y[1],N=Object(r.useState)(Zn),E=Object(l.a)(N,2),L=E[0],R=E[1],T=Object(r.useState)(!0),P=Object(l.a)(T,2),A=P[0],U=P[1],D=Object(r.useState)(),F=Object(l.a)(D,2),M=F[0],_=F[1],z=Object(r.useState)(Object(x.e)()),B=Object(l.a)(z,2),K=B[0],W=B[1],G=Object(r.useState)(),V=Object(l.a)(G,2),Y=V[0],H=V[1],J=Object(r.useState)(!1),q=Object(l.a)(J,2),$=q[0],Q=q[1],X=Object(r.useRef)({}),Z=Object(r.useContext)(xn),ee=Z.teamStateSet,te=Z.pushOperation,ne=Z.teamUpdate,re=Z.updateNewPage,ae=function(){var e=Object(o.a)(j.a.mark((function e(){var t,r,u,s,i;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe(a);case 2:if(t=e.sent){e.next=6;break}return Ee.b.error("Note not found"),e.abrupt("return",c("/"));case 6:r=t.pageRec,u=t.pdf,s=t.pageOrder,i=Object(S.a)(t,Qn),f(r),H(s),m(i),C(un.createFromPages(r,Xn)),Q(!0),u&&_(URL.createObjectURL(u)),n&&Xe(a);case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ce=Object(r.useCallback)(Object(sn.debounce)(function(){var e=Object(o.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,de(a,{pageRec:t});case 2:U(!0);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),1e3),[]),ue=ce.flush,se=function(){var e=Object(o.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ue();case 2:return e.next=4,$e(a);case 4:if(e.sent){e.next=8;break}return Ee.b.error("Can't create room."),e.abrupt("return");case 8:return e.next=10,de(a,{team:!0});case 10:c("/team/"+a);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ie=function(){ue()};Object(r.useEffect)((function(){return ae(),ie}),[a,n]),Object(r.useEffect)((function(){v&&(document.title=v.name)}),[v]),Object(on.a)(ie),Object(r.useEffect)((function(){null!==I&&void 0!==I&&I.lastOp&&te&&te(I.lastOp)}),[I]),Object(r.useEffect)((function(){d&&$&&(ce(d),U(!1))}),[d]),Object(r.useEffect)((function(){var e=function(){var e=Object(o.a)(j.a.mark((function e(){var t;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Y&&$){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,de(a,{pageOrder:Y});case 4:return e.next=6,ue();case 6:t=null===ne||void 0===ne?void 0:ne.pageOrder,n&&JSON.stringify(Y)!==JSON.stringify(t)&&Xe(a);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[Y]),Object(r.useEffect)((function(){if(ne){var e=ne.type,t=ne.pageOrder;if("reorder"===e)H(t);else if("newPage"===e){H(t);var n=ne.pageId,r=ne.newPage;f((function(e){return e&&Object(b.a)(Object(b.a)({},e),{},Object(p.a)({},n,r))})),C((function(e){return null===e||void 0===e?void 0:e.addState(n,r,Xn)}))}}}),[ne]);var le=function(e,t){var n=g.flaten(t);f((function(t){return t&&Object(b.a)(Object(b.a)({},t),{},Object(p.a)({},e,Object(b.a)(Object(b.a)({},t[e]),{},{state:n})))}))},je=Object(r.useCallback)((function(e,t){C((function(n){return null===n||void 0===n?void 0:n.setState(e,t)})),le(e,t)}),[]),be=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t?d&&d[e]:void 0,r=w(n),a=Object(l.a)(r,2),c=a[0],u=a[1];H((function(t){if(t){var n=Dn(t,e,c);return re&&re(n,c,u),n}})),f((function(e){return e&&Object(b.a)(Object(b.a)({},e),{},Object(p.a)({},c,u))})),C((function(e){return null===e||void 0===e?void 0:e.addState(c,u,Xn)}))},pe=Object(ut.jsxs)("div",{className:"reader-container",children:[Object(ut.jsx)(Wn,{setDrawCtrl:R,instantSave:ue,handleUndo:function(){C((function(e){if(e){var t=e.undo();return le.apply(void 0,Object(Zt.a)(t.getLastDs())),t}}))},handleRedo:function(){C((function(e){if(e){var t=e.redo();return le.apply(void 0,Object(Zt.a)(t.getLastDs())),t}}))}}),Object(ut.jsxs)("main",{children:[null===Y||void 0===Y?void 0:Y.map((function(e,t){return Object(ut.jsx)(ar,{uid:e,pageIndex:t},e)})),Object(ut.jsx)(Fn,{})]})]});return Object(ut.jsx)(er.Provider,{value:L,children:Object(ut.jsx)(tr.Provider,{value:{noteId:a,noteInfo:v,stateSet:I,teamStateSet:ee,saved:A,teamOn:n,pdfUrl:M,pageRec:d,pageOrder:Y,inviewPages:K,refRec:X.current},children:Object(ut.jsx)(nr.Provider,{value:{createRoom:se,scrollPage:function(e){var t;null===(t=X.current[e])||void 0===t||t.scrollIntoView()},setInviewPages:W,switchPageMarked:function(e){var t=d&&d[e];if(t){var n=!Boolean(t.marked);f((function(t){return t&&Object(b.a)(Object(b.a)({},t),{},Object(p.a)({},e,Object(b.a)(Object(b.a)({},t[e]),{},{marked:n})))}))}},setPageOrder:H,setPageState:je,addPage:be,addFinalPage:function(){var e=Object(sn.last)(Y);e&&be(e)},deletePage:function(e){n?Ee.b.error("You can't delete pages from a team note."):(H((function(t){return null===t||void 0===t?void 0:t.filter((function(t){return t!==e}))})),f((function(t){return t&&Object(sn.omit)(t,e)})),C((function(t){return null===t||void 0===t?void 0:t.deleteState(e)})))}},children:pe})})})}var ar=function(e){var t=e.uid,n=(e.pageIndex,Object(r.useContext)(tr)),a=n.pageRec,c=n.stateSet,u=n.teamStateSet,s=n.pdfUrl,i=n.refRec,o=Object(r.useContext)(nr).setPageState,l=a&&a[t],d=null===c||void 0===c?void 0:c.getOneState(t),j=null===u||void 0===u?void 0:u.getOneState(t);return l&&d?Object(ut.jsx)(cr,{drawState:d,teamState:j,updateState:o,imageBlob:l.image,pdfUrl:s,pdfIndex:l.pdfIndex,uid:t,refRec:i}):null},cr=a.a.memo((function(e){var t=e.imageBlob,n=e.drawState,a=e.teamState,c=e.uid,u=e.pdfUrl,s=e.pdfIndex,i=e.updateState,o=e.refRec,d=e.preview,j=void 0!==d&&d,b=Object(r.useContext)(nr).setInviewPages,p=Object(r.useState)(!1),f=Object(l.a)(p,2),O=f[0],x=f[1],h=Object(r.useState)(),v=Object(l.a)(h,2),m=v[0],g=v[1],k=Object($n.a)({delay:100}),y=Object(l.a)(k,2),w=y[0],S=y[1],I=Vt(t),C=Vt(m),N=Object(r.useCallback)((function(e){e&&(w(e),o&&(o[c]=e))}),[o]),E=Object(r.useCallback)(function(){var e=!1;return function(){!j&&u&&s&&!e&&(e=!0,K(u,s).then(g))}}(),[j,u,s]);Object(r.useEffect)((function(){j||(S?(E(),b((function(e){return e.add(c)}))):b((function(e){return e.delete(c)})))}),[S,E,j]);var L=a&&Object(ut.jsx)(rn,{drawState:a,readonly:!0,preview:j}),R=j?Object(ut.jsx)(rn,{drawState:n,readonly:!0,preview:!0}):Object(ut.jsx)(ur,{updateState:i,drawState:n,uid:c,preview:j}),T=Boolean(j||s&&!C);return Object(ut.jsxs)("section",{ref:N,className:"note-page".concat(O?" loaded":""),children:[Object(ut.jsx)("img",{src:C||I||Gt,alt:"pdf-page",onLoad:function(){return x(!0)}}),S&&Object(ut.jsxs)("div",{className:"page-draw",children:[L,R]}),T&&Object(ut.jsx)("div",{className:"mask"})]})}));cr.displayName="PageWrapper";var ur=a.a.memo((function(e){var t=e.drawState,n=e.uid,a=e.updateState,c=e.preview,u=void 0!==c&&c,s=Object(r.useContext)(er);return Object(ut.jsx)(rn,Object(b.a)({drawState:t,onChange:function(e){if(a){var r=e instanceof g?e:e(t);a(n,r)}},readonly:!a,preview:u},s))}));function sr(){return Object(ut.jsx)(ut.Fragment,{})}ur.displayName="DrawWrapper";var ir=Object(ut.jsx)("main",{style:{padding:"1rem"},children:Object(ut.jsx)("p",{children:"There's nothing here!"})});u.a.render(Object(ut.jsx)(s.a,{children:Object(ut.jsxs)(i.c,{children:[Object(ut.jsx)(i.a,{path:"/",element:Object(ut.jsx)(Qt,{})}),Object(ut.jsx)(i.a,{path:"/reader",children:Object(ut.jsx)(i.a,{path:":noteId",element:Object(ut.jsx)(rr,{teamOn:!1})})}),Object(ut.jsx)(i.a,{path:"/team",children:Object(ut.jsx)(i.a,{path:":noteId",element:Object(ut.jsx)(hn,{})})}),Object(ut.jsx)(i.a,{path:"/test",element:Object(ut.jsx)(sr,{})}),Object(ut.jsx)(i.a,{path:"*",element:ir})]})}),document.getElementById("root"))}},[[489,1,2]]]);
//# sourceMappingURL=main.73c83188.chunk.js.map