"use strict";(self.webpackChunkmultibility=self.webpackChunkmultibility||[]).push([[193],{80202:function(e,t,r){r.d(t,{W:function(){return s}});var n=r(81694),u=r.n(n),a=r(80184),s=function(e){var t=e.color,r=e.className,n={backgroundColor:t};return(0,a.jsx)("div",{className:u()("color-circle",r),style:n})}},74115:function(e,t,r){r.d(t,{O9:function(){return n},bM:function(){return a},mr:function(){return u}});var n=["#000000","#9ca3af","#64748b","#78716c","#f97316","#eab308","#84cc16","#22c55e","#10b981","#14b8a6","#06b6d4","#0ea5e9","#3b82f6","#6366f1","#8b5cf6","#a855f7","#d946ef","#ec4899","#f43f5e","#ef4444"],u=function(){var e=Math.floor(Math.random()*n.length);return n[e]},a=function(e){var t=function(e){var t=0;if(0===e.length)return t;for(var r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return Math.abs(t)}(e)%n.length;return n[t]}},82670:function(e,t,r){r.d(t,{Dw:function(){return m},F:function(){return d},mF:function(){return f}});var n=r(1413),u=r(29439),a=r(15671),s=r(43144),c=r(24124),o=r(24610),i=r(25641),p=r.n(i),f=2e3,l={strokes:(0,c.zN)(),undoStack:(0,c.aV)(),historyStack:(0,c.aV)()},h=(0,c.WV)(l),d=function(){return{strokes:{}}},m=function(){function e(t,r,n,u){(0,a.Z)(this,e),this.immutable=t,this.width=r,this.height=n,this.lastOp=u}return(0,s.Z)(e,[{key:"getImmutable",value:function(){return this.immutable}},{key:"getUndoStack",value:function(){return this.getImmutable().get("undoStack")}},{key:"getHistoryStack",value:function(){return this.getImmutable().get("historyStack")}},{key:"getStrokeMap",value:function(){return this.getImmutable().get("strokes")}},{key:"getStrokeList",value:function(){return this.getStrokeMap().toArray().map((function(e){var t=(0,u.Z)(e,2);t[0];return t[1]}))}},{key:"getLastStroke",value:function(){return this.getStrokeMap().last()}},{key:"isEmpty",value:function(){return 0===this.getStrokeMap().size}},{key:"hasStroke",value:function(e){return this.getStrokeMap().has(e)}}],[{key:"createEmpty",value:function(t,r){return new e(h(),t,r)}},{key:"undo",value:function(t){var r=t.getHistoryStack().last();if(!r)return t;var n=t.getUndoStack().unshift(t.getImmutable());return new e(r.set("undoStack",n),t.width,t.height,{type:"undo"})}},{key:"redo",value:function(t){var r=t.getUndoStack().first();return r?new e(r,t.width,t.height,{type:"redo"}):t}},{key:"addStroke",value:function(t,r){var n={pathData:r,uid:(0,o.v4)(),timestamp:Date.now()};return e.pushStroke(t,n)}},{key:"pushStroke",value:function(t,r){var n=r.uid,u=t.getImmutable(),a=u.update("strokes",(function(e){return e.set(n,r)})).update("historyStack",(function(e){return e.push(u)})).delete("undoStack"),s={type:"add",stroke:r};return new e(a,t.width,t.height,s)}},{key:"eraseStrokes",value:function(t,r){if(0===r.length)return t;var n=t.getImmutable(),u=n.update("strokes",(function(e){return e.deleteAll(r)})).update("historyStack",(function(e){return e.push(n)})).delete("undoStack"),a={type:"erase",erased:r};return new e(u,t.width,t.height,a)}},{key:"mutateStrokes",value:function(t,r){if(0===r.length)return t;var a=t.getImmutable(),s=t.getStrokeMap();r.forEach((function(e){var t=(0,u.Z)(e,2),r=t[0],a=t[1];return s=s.update(r,{uid:r,pathData:a,timestamp:Date.now()},(function(e){return(0,n.Z)((0,n.Z)({},e),{},{pathData:a})}))}));var c={type:"mutate",mutations:r};return new e(a.set("strokes",s).update("historyStack",(function(e){return e.push(a)})).delete("undoStack"),t.width,t.height,c)}},{key:"syncStrokeTime",value:function(e,t){var r=t.uid,n=t.timestamp,u=e.getStrokeMap().get(r);u&&(u.timestamp=n)}},{key:"pushOperation",value:function(t,r){switch(r.type){case"add":return e.pushStroke(t,r.stroke);case"erase":return e.eraseStrokes(t,r.erased);case"mutate":return e.mutateStrokes(t,r.mutations);case"undo":return e.undo(t);case"redo":return e.redo(t)}}},{key:"flaten",value:function(e){return{strokes:e.getImmutable().get("strokes").toObject()}}},{key:"loadFromFlat",value:function(t,r,n){var u=t.strokes,a=t.operations,s=new e(h().set("strokes",(0,c.zN)(u)),r,n);return null===a||void 0===a||a.forEach((function(t){return s=e.pushOperation(s,t)})),s}},{key:"mergeStates",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=t.map((function(e){return e.getStrokeMap().values()})),a=[],s=new(p())((function(e,t){var r=(0,u.Z)(e,1)[0],n=(0,u.Z)(t,1)[0];return r.timestamp-n.timestamp}));for(n.forEach((function(e,t){var r=e.next(),n=r.value;r.done||s.push([n,t])}));s.size()>0;){var c=s.pop();if(!c)break;var o=(0,u.Z)(c,2),i=o[0],f=o[1];a.push(i);var l=n[f].next(),h=l.value,d=l.done;d||s.push([h,f])}return a}}]),e}()},51570:function(e,t,r){r.d(t,{CD:function(){return S},_n:function(){return h},dn:function(){return g},f1:function(){return w},fI:function(){return d},r8:function(){return x}});var n=r(45987),u=r(15861),a=r(87757),s=r.n(a),c=r(74569),o=r.n(c),i=r(92198),p=r(75783),f=r(69951),l=["statusCode"],h="https://api.slotdumpling.top/paint";function d(e){return m.apply(this,arguments)}function m(){return(m=(0,u.Z)(s().mark((function e(t){var r,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o().get("code/".concat(t));case 3:if(r=e.sent,n=r.data,console.log({data:n}),200===n.statusCode){e.next=8;break}return e.abrupt("return",null);case 8:return e.abrupt("return",n.noteID);case 11:return e.prev=11,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 15:case"end":return e.stop()}}),e,null,[[0,11]])})))).apply(this,arguments)}function k(e){return v.apply(this,arguments)}function v(){return(v=(0,u.Z)(s().mark((function e(t){var r,u,a,c,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o().get("info/".concat(t));case 3:if(r=e.sent,u=r.data,c=(a=u).statusCode,i=(0,n.Z)(a,l),200===c){e.next=8;break}return e.abrupt("return",null);case 8:return e.abrupt("return",i);case 11:return e.prev=11,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 15:case"end":return e.stop()}}),e,null,[[0,11]])})))).apply(this,arguments)}function g(e){return b.apply(this,arguments)}function b(){return(b=(0,u.Z)(s().mark((function e(t){var r,n,u,a,c,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k(t);case 3:if(r=e.sent){e.next=6;break}return e.abrupt("return",null);case 6:return n=r.noteInfo,u=r.pageInfos,e.next=9,(0,p.Rb)(t,n,u);case 9:if(!e.sent){e.next=11;break}return e.abrupt("return",r);case 11:if(!n.withImg){e.next=21;break}return e.next=14,o()({method:"GET",url:t,responseType:"blob"});case 14:return a=e.sent,c=a.data,i=new Blob([c],{type:"application/pdf"}),e.next=19,(0,p.Vk)(t,n,u,i);case 19:e.next=23;break;case 21:return e.next=23,(0,p.Vk)(t,n,u);case 23:return e.abrupt("return",r);case 26:return e.prev=26,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 30:case"end":return e.stop()}}),e,null,[[0,26]])})))).apply(this,arguments)}function x(e){return y.apply(this,arguments)}function y(){return(y=(0,u.Z)(s().mark((function e(t){var r,n,u,a,c,l,h,d,m,k,v,g;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.U9)(t);case 2:if(r=e.sent){e.next=5;break}return e.abrupt("return",!1);case 5:return n=r.uid,u=r.name,a=r.withImg,c=r.pdf,l=r.pageOrder,h=r.pageRec,(0,i.Yl)(h),e.prev=7,e.next=10,o().put("create/".concat(t),{userID:(0,f.VN)(),pageRec:h,noteInfo:{uid:n,name:u,withImg:a,pageOrder:l}});case 10:if(d=e.sent,m=d.data,!c){e.next=21;break}return k=new FormData,e.next=16,c.arrayBuffer();case 16:return v=e.sent,g=new Blob([v]),k.append("file",g,t),e.next=21,o()({method:"POST",url:"upload",data:k,headers:{"Content-Type":"multipart/form-data"}});case 21:if(201===m.statusCode){e.next=23;break}return e.abrupt("return",!1);case 23:return e.abrupt("return",!0);case 26:return e.prev=26,e.t0=e.catch(7),console.error(e.t0),e.abrupt("return",!1);case 30:case"end":return e.stop()}}),e,null,[[7,26]])})))).apply(this,arguments)}function w(e){return I.apply(this,arguments)}function I(){return(I=(0,u.Z)(s().mark((function e(t){var r,n,u,a,c,l,h;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.U9)(t);case 2:if(r=e.sent){e.next=5;break}return e.abrupt("return",null);case 5:return n=r.uid,u=r.name,a=r.withImg,c=r.pageOrder,l=r.pageRec,(0,i.Yl)(l),e.prev=7,e.next=10,o().put("update/".concat(t),{userID:(0,f.VN)(),pageRec:l,noteInfo:{uid:n,name:u,withImg:a,pageOrder:c}});case 10:if(h=e.sent,201!==h.data.statusCode){e.next=16;break}return e.abrupt("return",!0);case 16:return e.abrupt("return",!1);case 17:e.next=23;break;case 19:return e.prev=19,e.t0=e.catch(7),console.error(e.t0),e.abrupt("return",!1);case 23:case"end":return e.stop()}}),e,null,[[7,19]])})))).apply(this,arguments)}function S(e){return Z.apply(this,arguments)}function Z(){return(Z=(0,u.Z)(s().mark((function e(t){var r,n,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o().get("state/".concat(t),{params:{userID:(0,f.VN)()}});case 3:if(r=e.sent,200===(n=r.data).statusCode){e.next=7;break}return e.abrupt("return",null);case 7:return u=n.teamPages,e.abrupt("return",u);case 11:return e.prev=11,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 15:case"end":return e.stop()}}),e,null,[[0,11]])})))).apply(this,arguments)}o().defaults.baseURL=h,o().interceptors.request.use((function(e){return console.log(e.method,e.url),e}))},75783:function(e,t,r){r.d(t,{HO:function(){return I},Pn:function(){return Z},Rb:function(){return H},SP:function(){return E},U9:function(){return O},Vk:function(){return G},Ys:function(){return y},au:function(){return M},f_:function(){return U},hY:function(){return b},tk:function(){return D},tw:function(){return P}});var n=r(29439),u=r(45987),a=r(49142),s=r(4942),c=r(1413),o=r(15861),i=r(87757),p=r.n(i),f=r(82670),l=r(61842),h=r.n(l),d=r(24610),m=r(46097),k=["pageRec","pageOrder"],v=["pdf"],g=["pageRec","pageOrder"];function b(){return x.apply(this,arguments)}function x(){return(x=(0,o.Z)(p().mark((function e(){var t;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h().getItem("ALL_NOTES");case 2:if(!(t=e.sent)){e.next=7;break}return e.abrupt("return",t);case 7:return h().setItem("ALL_NOTES",{}),e.abrupt("return",{});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(){return w.apply(this,arguments)}function w(){return(w=(0,o.Z)(p().mark((function e(){var t;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h().getItem("ALL_TAGS");case 2:if(!(t=e.sent)){e.next=7;break}return e.abrupt("return",t);case 7:return h().setItem("ALL_TAGS",{}),e.abrupt("return",{});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e,t){return S.apply(this,arguments)}function S(){return(S=(0,o.Z)(p().mark((function e(t,r){var n,u,a,o;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,d.v4)(),u={uid:n,name:t,color:r,notes:[]},e.next=4,y();case 4:return a=e.sent,o=(0,c.Z)((0,c.Z)({},a),{},(0,s.Z)({},n,u)),e.next=8,h().setItem("ALL_TAGS",o);case 8:return e.abrupt("return",o);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){return L.apply(this,arguments)}function L(){return(L=(0,o.Z)(p().mark((function e(t){var r,n;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y();case 2:return r=e.sent,r[t],n=(0,u.Z)(r,[t].map(a.Z)),e.next=6,h().setItem("ALL_TAGS",n);case 6:return e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e){return A.apply(this,arguments)}function A(){return(A=(0,o.Z)(p().mark((function e(t){var r,n;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y();case 2:return r=e.sent,n=(0,c.Z)((0,c.Z)({},r),{},(0,s.Z)({},t.uid,t)),e.next=6,h().setItem("ALL_TAGS",n);case 6:return e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e){return T.apply(this,arguments)}function T(){return(T=(0,o.Z)(p().mark((function e(t){var r,n;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h().getItem(t);case 2:if(r=e.sent){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,h().getItem("PDF_".concat(t));case 7:return n=e.sent,e.abrupt("return",(0,c.Z)((0,c.Z)({},r),{},{pdf:n}));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e,t){return _.apply(this,arguments)}function _(){return(_=(0,o.Z)(p().mark((function e(t,r){var n,a,s,o;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"pageRec"in(r=(0,m.Z)(r,(function(e){return void 0!==e})))&&(r.lastTime=Date.now()),console.dir(r),e.next=5,b();case 5:return n=e.sent,(a=r).pageRec,a.pageOrder,s=(0,u.Z)(a,k),n[t]=(0,c.Z)((0,c.Z)({},n[t]),s),e.next=10,h().setItem("ALL_NOTES",n);case 10:return e.next=12,O(t);case 12:if(o=e.sent){e.next=15;break}return e.abrupt("return");case 15:return e.next=17,h().setItem(t,(0,c.Z)((0,c.Z)({},o),r));case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e){return R.apply(this,arguments)}function R(){return(R=(0,o.Z)(p().mark((function e(t){var r,n,u,a;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.uid,n=t.tagID,e.next=3,b();case 3:return(u=e.sent)[r]=t,e.next=7,h().setItem("ALL_NOTES",u);case 7:return e.next=9,y();case 9:if(a=e.sent,!(n in a)){e.next=14;break}return a[n].notes.push(t.uid),e.next=14,h().setItem("ALL_TAGS",a);case 14:return e.abrupt("return",{tags:a,allNotes:u});case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return F.apply(this,arguments)}function F(){return(F=(0,o.Z)(p().mark((function e(t){var r,n,a;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.pdf,n=(0,u.Z)(t,v),e.next=3,h().setItem(n.uid,n);case 3:if(!r){e.next=6;break}return e.next=6,h().setItem("PDF_".concat(n.uid),r);case 6:return n.pageRec,n.pageOrder,a=(0,u.Z)(n,g),e.next=9,N(a);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(e){return C.apply(this,arguments)}function C(){return(C=(0,o.Z)(p().mark((function e(t){var r,n,u,a,s;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(t);case 2:return r=e.sent,e.next=5,b();case 5:return n=e.sent,e.next=8,y();case 8:if(u=e.sent,r){e.next=11;break}return e.abrupt("return",{tags:u,allNotes:n});case 11:return e.next=13,h().removeItem(t);case 13:return e.next=15,h().removeItem("PDF_".concat(t));case 15:return delete n[t],e.next=18,h().setItem("ALL_NOTES",n);case 18:if(!((a=r.tagID)in u)){e.next=24;break}return(s=u[a]).notes=s.notes.filter((function(e){return e!==t})),e.next=24,h().setItem("ALL_TAGS",u);case 24:return e.abrupt("return",{tags:u,allNotes:n});case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e,t){return V.apply(this,arguments)}function V(){return(V=(0,o.Z)(p().mark((function e(t,r){var n,u,a,s,c,o;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(t);case 2:return u=e.sent,e.next=5,b();case 5:return a=e.sent,e.next=8,y();case 8:if(s=e.sent,u){e.next=11;break}return e.abrupt("return",{tags:s,allNotes:a});case 11:return c=u.tagID,u.tagID=r,e.next=15,h().setItem(t,u);case 15:return a[t].tagID=r,e.next=18,h().setItem("ALL_NOTES",a);case 18:return c in s&&((o=s[c]).notes=o.notes.filter((function(e){return e!==t}))),null===(n=s[r])||void 0===n||n.notes.push(t),e.next=22,h().setItem("ALL_TAGS",s);case 22:return e.abrupt("return",{tags:s,allNotes:a});case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function G(e,t,r,n){return j.apply(this,arguments)}function j(){return(j=(0,o.Z)(p().mark((function e(t,u,a,s){var o,i,l,h,d,m,k;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(t);case 2:if(!(o=e.sent)){e.next=5;break}return e.abrupt("return");case 5:if(i=Date.now(),l={},o=(0,c.Z)((0,c.Z)({},u),{},{tagID:"DEFAULT",team:!0,pageRec:l,pdf:s,createTime:i,lastTime:i}),Object.entries(a).forEach((function(e){var t=(0,n.Z)(e,2),r=t[0],u=t[1];l[r]=(0,c.Z)((0,c.Z)({},u),{},{state:(0,f.F)()})})),!s){e.next=20;break}return e.next=12,Promise.all([r.e(643),r.e(701)]).then(r.bind(r,21176));case 12:return h=e.sent,d=h.getPDFImages,e.next=16,d(s);case 16:m=e.sent,k=m.images,Object.values(l).forEach((function(e){var t=e.pdfIndex;t&&(e.image=k[t-1])})),o.thumbnail=k[0];case 20:return e.next=22,M(o);case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e,t,r){return Y.apply(this,arguments)}function Y(){return(Y=(0,o.Z)(p().mark((function e(t,u,a){var s,o,i,l,h,d,m,k,v,g,b,x,y;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(t);case 2:if(s=e.sent){e.next=5;break}return e.abrupt("return",!1);case 5:if(!((o=u.pageOrder).length<s.pageOrder.length)){e.next=8;break}return e.abrupt("return",!0);case 8:return i=s.pageRec,l=s.pdf,e.next=11,Promise.all([r.e(643),r.e(701)]).then(r.bind(r,21176));case 11:h=e.sent,d=h.getOneImage,m=0,k=Object.entries(a);case 14:if(!(m<k.length)){e.next=29;break}if(v=(0,n.Z)(k[m],2),g=v[0],b=v[1],!(g in i)){e.next=18;break}return e.abrupt("continue",26);case 18:if(x=b.pdfIndex,y=(0,f.F)(),i[g]=(0,c.Z)((0,c.Z)({},b),{},{state:y}),l&&x){e.next=23;break}return e.abrupt("continue",26);case 23:return e.next=25,d(l,x,.5);case 25:i[g].image=e.sent;case 26:m++,e.next=14;break;case 29:return e.next=31,E(t,{pageOrder:o,pageRec:i});case 31:return e.abrupt("return",!0);case 32:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},92198:function(e,t,r){r.d(t,{BJ:function(){return o},D4:function(){return p},Xn:function(){return i},Yl:function(){return f}});var n=r(4942),u=r(82670),a=r(24610),s=r(97892),c=r.n(s),o={ratio:1.5,state:{strokes:{}}};function i(){var e=(0,a.v4)(),t=Date.now();return{uid:(0,a.v4)(),name:"Note ".concat(c()(t).format("HH:mm, ddd MMM D")),tagID:"DEFAULT",team:!1,withImg:!1,createTime:t,lastTime:t,pageRec:(0,n.Z)({},e,{ratio:1.5,state:(0,u.F)()}),pageOrder:[e]}}function p(e){return[(0,a.v4)(),null!==e&&void 0!==e?e:{ratio:1.5,state:(0,u.F)()}]}function f(e){Object.values(e).forEach((function(e){delete e.image,delete e.marked}))}},69951:function(e,t,r){r.d(t,{VN:function(){return u},lu:function(){return s},vW:function(){return a}});var n=r(24610),u=function(){var e;return function(){if(e)return e;var t=localStorage.getItem("USER_ID");return t||(t=(0,n.v4)(),localStorage.setItem("USER_ID",t)),e=t,t}}(),a=function(){var e=localStorage.getItem("USER_NAME");return e||(e=(0,n.v4)().slice(0,8),localStorage.setItem("USER_NAME",e)),e},s=function(e){return!!(e=e.trim())&&(localStorage.setItem("USER_NAME",e),!0)}}}]);
//# sourceMappingURL=193.2d26a405.chunk.js.map