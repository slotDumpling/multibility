(self.webpackChunkmultibility=self.webpackChunkmultibility||[]).push([[25],{22568:function(e,t,n){"use strict";var r=n(92721);t.Z=(0,r.Z)({scriptUrl:"//at.alicdn.com/t/font_3181679_yo844n7qgns.js"})},38117:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return le}});var r=n(15861),i=n(29439),o=n(87757),a=n.n(o),u=n(72791),c=n(11886),s=n(95099),l=n(1413),d=n(93433),f=n(46668),v=n.n(f),h=n(41446),p=n(1488),m=n(82670),w=n(96153),g=function(){var e=new Map,t=(0,w.v)(44,44),n=t.canvas,r=t.context,i=new Image;return i.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAAAXNSR0IArs4c6QAABWlJREFUWEftmF1IW2cYx580iaaNSTSmdWUtRVBBnENbSG40YVtRRpZM4ydqLEpJnd5sVzpxU7TipoMy8EYd6kwC6pakiDeCih/oyBGibS/qTZWaoE63RONXqiYZj5xIKtvFzhvRQl84nHPzvud3nvO8//f5Pyx4xwbrHeOF98Dn/cfeR/h9hM9EgDQlcP4VgJPNi/ezww8AeHnpO/EPIAXm2O32+3w+/xOv13vF5/O9tR6Hw/FxuVyvUChsAIDDUECTAOPca1NTU5+np6f/Zjab7X6//631cnJybjkcjp9v375dDwB7AHBMGmISYEwBocViUWVlZfVJpVLP3NwcLxjI7/fD4uJiR2Ji4vcA4AKAo4sEZgNApF6vzy4pKelCYK/Xy3K73dympqa/EaywsPD6/Px89927d78DgL/otCBiJokwAkf19vZqHjx40CGVSt8gyfLycrhMJvMMDw+fRHthYaEnNTUVgTcvJXBZWdlhZWWlID8/3z0wMCC02Wy99+7dCwCffBTJCHmEKYoKr66udra2torLy8v/7Orqik5JSUl+8eLFCgDsk8DiXFLgSKPRmFVUVPTLWZDc3NzdsbExVJFdgUDwNDY29msA2AYAHwk0CTCqhMBisahfv34tcbvdgsPDw7Dj42NOTU3Nw6mpqSO1Wv1BYWGhU6/Xc2tra+VtbW2LAOC5KGD82KsobQAgop/DASDCYDBoiouLKzUajdtisQiXlpYOfD7fr3Fxcd8CgJskyiQRxkBxACAMALj0M96FkZGRH9rt9gGj0ciuqKgQt7e3b2i1WqdIJPoUAFDy8NRjNEiBA/sA1wnUExEAcHNmZqYuNTVVJZFIIjIzM7cHBwe5XC73IwBYB4ADRrSEm+6/3on6e2N4eLhSqVRWKxSKY5fL5Xv+/HlYY2Pj/fr6egoAdi4TMKaJpL29XV1VVdWhVqv3bTZbuMPhYJtMJl1ubu7vALDFtBAKRUqcDRaqh1ilUn08NDQ0VlpaumUymSL39vaAoqgfZTLZTwDgZLrxzgMY14zKzs5ONpvNE1qt1mU2m6MQeGZmpi0tLS0AzKhyOzfg7u5uVVlZWa9ard6z2Ww8TImenp7K8vJyEx3hSwN8khKTk5NVcrm8QaFQHLlcLj9uukePHn3R2dlpvWwpcbLpnj179jghISE/OjpakJGRsd3f3w88Hi8dAOz0EY3W6X+P80gJ3p07d26+fPly1mAwcHQ6HSrGZl5e3mZMTEw2AKxdtKwFDo3Tg8NqtX4llUqbNRrNtsViEb169cqztrZmSEtLewwAGxd5cHBWV1c/293d5RwcHLA9Hg97fX2dn5GR0To+Pu5VKpW3CgoKtoxGY4RSqVSNjIws0EczY6tEkhInxY/Vas2USqXms8mYl5e3Mzo6yp+YmNjn8/m2+Pj4KgBwXGTxc1pe0iYU6wMWRVG85ubmjbq6uhs6nc7Z0dEhrq2tfdjS0jJKmg4hLeDRhCJwQ0PDQUFBgTA5OfnN7Ozs1enp6QG5XP4DrQ54JGNThfEgSYl/NaFbW1vs1dXVKysrK06xWCyhKEovk8kaaXXA3gTRCCkwwu7s7LCePHmCPQi0+RLahGJfAtXhcpnQubk5dBynAxspl87m9/X1ZWu12s7+/n7sOwT/MX9QIwUjfOF9CVQJ0eDg4JcKheKbo6MjbnBvjcVi+dls9rHT6fwjKSkJgbGkZKy/gd9GksM4l4+FDgBcRwdNe7vA2mjncZOhh8M2FboMRhVacJqRAOM6aDrROV+jzWhwjxiLG4woyh02UHDDMSp4QgmMH4zyhlegsR1YP7iZjdpL1EAJRUoQ6SnTyaQpwfS9jOe9c8D/AEaRMEuceu4YAAAAAElFTkSuQmCC",function(t){t=10*Math.round(t/10);var o=e.get(t);if(o)return o;r.translate(22,22),r.rotate(t*Math.PI/180),r.drawImage(i,-22,-22);var a=n.toDataURL();return r.clearRect(-22,-22,44,44),r.resetTransform(),e.set(t,a),a}}(),x=function(e){return"url(".concat(g(e),") 22 22, auto")};function C(e){var t=(0,u.useRef)(!1),n=function(e){return e.isPrimary&&(t.current="touch"===e.pointerType)},r=function(n){return function(n){return!t.current||function(e){var t=e.touches[0];return"stylus"===(null===t||void 0===t?void 0:t.touchType)}(n)||e&&1===n.touches.length}(n)||n.stopPropagation()};return{onPointerDownCapture:n,onPointerMoveCapture:n,onTouchStartCapture:r,onTouchMoveCapture:r}}var b=n(80184),S=u.forwardRef((function(e,t){var n=e.drawState,r=e.otherStates,o=e.onChange,a=void 0===o?function(){}:o,s=e.drawCtrl,g=void 0===s?c.Hq:s,S=e.readonly,j=void 0!==S&&S,z=e.imgSrc,V=e.setActiveTool,O=void 0===V?function(){}:V,F=n.width,J=n.height,U=g.mode,q=g.finger,B=g.lasso,I=g.eraserWidth,K=(0,u.useRef)(null),Y=(0,u.useRef)(new(v().PaperScope)),H=(0,u.useState)([]),Q=(0,i.Z)(H,2),X=Q[0],G=Q[1],_=Z(),$=(0,i.Z)(_,2),ee=$[0],te=$[1],ne=Z(),re=(0,i.Z)(ne,2),ie=re[0],oe=re[1],ae=Z(),ue=(0,i.Z)(ae,2),ce=ue[0],se=ue[1];(0,u.useEffect)((function(){var e,t=K.current,n=Y.current;if(t)return n.setup(t),n.settings.handleSize=10,n.settings.hitTolerance=20,[0,1,2].forEach((function(){return(new f.Layer).visible=!1})),null===(e=n.project.layers[2])||void 0===e||e.activate(),new n.Tool,function(){var e;null===(e=n.view)||void 0===e||e.remove(),(0,w.j)(t)}}),[]),(0,u.useEffect)((function(){Y.current.activate();var e=Y.current.project.layers,t=A(e,F,J);return function(){return t.forEach((function(e){return e.remove()}))}}),[F,J]);var le=(0,p.Z)(K),de=(0,i.Z)(le,1)[0],fe=de/F;(0,u.useEffect)((function(){if(fe){var e=Y.current,t=new f.Point(0,0);return e.view.viewSize=new f.Size(F,J).multiply(fe),e.view.scale(fe,t),e.project.layers.forEach((function(e){return e.visible=!0})),e.view.update(),function(){var n;return null===(n=e.view)||void 0===n?void 0:n.scale(1/fe,t)}}}),[F,J,fe]),(0,u.useEffect)((function(){var e;if(z){Y.current.activate();var t=new f.Raster(z);return null===(e=t.project.layers[0])||void 0===e||e.addChild(t),t.sendToBack(),t.onLoad=function(){t.view.update(),t.fitBounds(new(v().Rectangle)(0,0,F,J)),t.bringToFront()},function(){null===t||void 0===t||t.remove()}}}),[z,F,J]);var ve=(0,u.useMemo)((function(){return r?m.Dw.mergeStates.apply(m.Dw,[n].concat((0,d.Z)(r))):n.getStrokeList()}),[n,r]),he=(0,u.useRef)(!1);(0,u.useEffect)((function(){var e=[],t=Y.current.project.layers[1];if(t){Y.current.activate(),ve.forEach((function(r){var i=n.hasStroke(r.uid),o=y(r,t,!i);i&&e.push(o)})),G(e);var r=Date.now();return Y.current.view.update(),requestAnimationFrame((function(){var e=Date.now()-r;he.current=e>32})),function(){t.removeChildren(1)}}}),[ve,n]);var pe=(0,u.useRef)(),me=(0,u.useState)(!1),we=(0,i.Z)(me,2),ge=we[0],xe=we[1],Ce="select"===U&&ge?"selected":U,be=(0,u.useState)([]),Se=(0,i.Z)(be,2),je=Se[0],Ze=Se[1],ye=(0,u.useMemo)((function(){var e=new Set(je);return X.filter((function(t){return e.has(t.name)}))}),[X,je]),Ae=(0,u.useCallback)((function(){xe(!1),te(void 0),oe(void 0),se(void 0)}),[te,oe,se]);(0,u.useEffect)((function(){if("select"===U)return Ae}),[U,Ae]),(0,u.useEffect)((function(){return Ae}),[B,Ae]),(0,u.useEffect)((function(){if(ge)return function(){Ze([]),O("")}}),[ge,O]);var ke=Z(),Ee=(0,i.Z)(ke,2),De=Ee[0],Pe=Ee[1],Re=(0,u.useRef)(!1),Te=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(he.current){var t=(0,i.Z)(Y.current.project.layers,2),n=t[0],r=t[1],o=Y.current.view;n&&r&&Pe((function(t){Y.current.activate(),r.visible=!0;var i=new f.Size(F,J),a=e?f.Size.min(o.size,i):i,u=new f.Path.Rectangle(a);u.position=o.center,u.clipMask=!0;var c=r.firstChild;e&&c.replaceWith(u);var s=72*devicePixelRatio,l=de/a.width*s;return(t=r.rasterize({raster:t,resolution:l})).visible=!0,r.visible=!1,n.addChild(t),e&&u.replaceWith(c),u.remove(),t}))}},Ne=function(){var e=(0,i.Z)(Y.current.project.layers,2)[1];!Re.current&&e&&De&&(e.visible=!0,De.visible=!1)},Me=function(e){Te(),te(E(g,e.point))},We=function(e){Te(),oe(k(e.point))},Le={draw:Me,erase:Me,select:B?Me:We,selected:function(e){if(B){if(null!==ee&&void 0!==ee&&ee.contains(e.point))return;Me(e),xe(!1)}else{var t,n=null!==(t=null===ie||void 0===ie?void 0:ie.hitTest(e.point,{segments:!0}))&&void 0!==t?t:null===ce||void 0===ce?void 0:ce.hitTest(e.point,{segments:!0,selected:!0});if(pe.current=n,n)return;if(null!==ie&&void 0!==ie&&ie.contains(e.point))return;We(e),se(void 0),xe(!1)}},text:function(e){var t,n=Y.current.project.layers[1];if(n){var r=null!==(t=M(n,e.point))&&void 0!==t?t:W(e.point);it(r)}}}[Ce],ze=function(e){null===ee||void 0===ee||ee.add(e.point),null===ee||void 0===ee||ee.smooth()},Ve={draw:ze,erase:ze,select:B?ze:function(e){if(ie){var t=e.point,n=t.x,r=t.y,o=(0,i.Z)(ie.segments,4),a=o[1],u=o[2],c=o[3];a&&u&&c&&(a.point.x=n,u.point=e.point,c.point.y=r,ie.selected=!0)}},selected:function(e){var t=pe.current;if(null!==t&&void 0!==t&&t.segment&&ie&&ce){var n=t.segment;if(n.selected){var r=ie.bounds.center,i=n.point.subtract(r),o=e.point.subtract(r);Ke(x(o.angle));var a=o.angle-i.angle;ie.rotate(a,r),ce.rotate(a,r),ye.forEach((function(e){return null===e||void 0===e?void 0:e.rotate(a,r)}))}else{var u,c=n.point,s=n.next.next.point,l=c.subtract(s),d=e.point.subtract(s).project(l).x/l.x;if(d<0)return;ie.scale(d,s),ye.forEach((function(e){e.scale(d,s),e.strokeWidth*=d})),ce.scale(d,s);var f=null===(u=ce.segments[0])||void 0===u?void 0:u.point;if(!f)return;ce.scale(100/ce.length,f)}}else ye.forEach((function(t){return t.translate(e.delta)})),null===ee||void 0===ee||ee.translate(e.delta),null===ie||void 0===ie||ie.translate(e.delta),null===ce||void 0===ce||ce.translate(e.delta)},text:function(e){if(rt&&!rt.name){var t=rt.bounds,n=t.topCenter,r=t.bottomRight.subtract(n),i=e.point.subtract(n).project(r).x/r.x;i<0||rt.scale(i,n)}}}[Ce];(0,u.useEffect)((function(){Y.current.tool.maxDistance=I}),[I]);var Oe=(0,u.useRef)(new Set),Fe=(0,u.useRef)(new Map),Je=function(e){if("erase"===Ce){var t=Y.current.project.layers[1];if(t){var n=t.visible;t.visible=!0;var r=t.hitTestAll(e.point,{class:v().Path,stroke:!0,tolerance:I/2});t.visible=n,null===r||void 0===r||r.forEach((function(n){var r=n.item;if(r instanceof v().Path){for(var i=r;i.parent!==t&&i.parent instanceof v().PathItem;)i=i.parent;var o=i.name;if(g.pixelEraser){var a=(I+r.strokeWidth)/2,u=new f.Path.Circle({center:e.point,radius:a,insert:!1}),c=r.subtract(u,{trace:!1});r.replaceWith(c),i===r&&(i=c),Fe.current.set(o,i)}else i.opacity=.5,i.guide=!0,Oe.current.add(o)}}))}}},Ue={draw:function(){if(Ne(),ee&&!(ee.segments.length<=1)){ee.simplify();var e=ee.exportJSON();te(void 0),a((function(t){return m.Dw.addStroke(t,e)}))}},erase:function(){if(Ne(),te(void 0),g.pixelEraser){var e=Array.from(Fe.current);Fe.current.clear();var t=e.map((function(e){var t=(0,i.Z)(e,2),n=t[0],r=t[1];return[n,L(r).map((function(e){return e.exportJSON()}))]}));if(!t.length)return;a((function(e){return m.Dw.splitStrokes(e,t)}))}else{var n=Array.from(Oe.current);if(Oe.current.clear(),!n.length)return;a((function(e){return m.Dw.eraseStrokes(e,n)}))}},select:function(){var e;if(Ne(),B){if(!ee||Math.abs(ee.area)<1e3)return te(void 0);ee.closePath(),ee.simplify(),D(ee),e=T(X,ee)}else{if(!ie||Math.abs(ie.area)<1e3)return oe(void 0);e=T(X,ie);var t=new f.Path,n=ie.bounds.topCenter;t.add(n,n.subtract(new f.Point(0,100))),t.lastSegment.selected=!0,se(t)}xe(!0),Ze(e),O("select")},selected:function(e){Xe(),Ye(e)},text:function(){O("text")}}[Ce],qe=(0,u.useState)("auto"),Be=(0,i.Z)(qe,2),Ie=Be[0],Ke=Be[1];(0,u.useEffect)((function(){"text"===Ce||"select"===Ce?Ke("crosshair"):"selected"===Ce?Ke(B?"crosshair":"nwse-resize"):"draw"!==Ce&&"erase"!==Ce||Ke(function(e,t){var n=e.lineWidth,r=e.eraserWidth,i=t*("erase"===e.mode?r:n);if(i<5)return"crosshair";var o=i/2;return'url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" fill="%23FFF7" width="'.concat(i,'" height="').concat(i,'" viewBox="0 0 10 10"><circle cx="5" cy="5" r="5"/></svg>\') ').concat(o," ").concat(o,", auto")}(g,fe))}),[Ce,B,g,fe]);var Ye=function(e){var t,n,r=null!==(t=null===ie||void 0===ie?void 0:ie.hitTest(e.point,{segments:!0}))&&void 0!==t?t:null===ce||void 0===ce?void 0:ce.hitTest(e.point,{segments:!0,selected:!0});if(null!==r&&void 0!==r&&r.segment){if(r.segment.selected){var i=null===ie||void 0===ie?void 0:ie.bounds.center;if(!i)return;var o=r.segment.point.subtract(i);return Ke(x(o.angle))}var a=r.segment.point,u=r.segment.next.next.point,c=a.subtract(u),s=c.x,l=c.y;return Ke(s*l<0?"nesw-resize":"nwse-resize")}if(null!==(n=null!==ie&&void 0!==ie?ie:ee)&&void 0!==n&&n.contains(e.point))return Ke("move");Ke("crosshair")},He=(0,l.Z)({selected:Ye,text:function(e){var t=Y.current.project.layers[1];t&&(M(t,e.point)?Ke("text"):Ke("crosshair"))}},{select:null,draw:null,erase:null})[Ce],Qe="selected"===Ce?function(e){["delete","backspace"].includes(e.key)&&Ge()}:null;(0,u.useEffect)((function(){if(!j){var e=function(e){return function(t){if(Y.current.activate(),e)return e(t)}},t=Y.current,n=t.view,r=t.tool;n.onMouseDown=e(Le),n.onMouseDrag=e(Ve),n.onMouseUp=e(Ue),n.onMouseMove=e(He),r.onMouseDrag=e(Je),r.onKeyUp=e(Qe)}}));var Xe=function(){if(null!==ye&&void 0!==ye&&ye.length){var e=ye.map((function(e){return[e.name,e.exportJSON()]}));a((function(t){return m.Dw.mutateStrokes(t,e)}))}},Ge=function(){Ae(),je.length&&a((function(e){return m.Dw.eraseStrokes(e,je)}))},_e=function(e){Y.current.activate(),N(ye,e),Xe()},$e=function(){var e;Y.current.activate();var t=null===(e=ie||ee)||void 0===e?void 0:e.bounds.size;if(t&&ye.length){var n=t.width,r=t.height,o=new f.Point(n,r).divide(10),u=ye.map((function(e){return e.clone()}));u.forEach((function(e){return e.translate(o)})),null===ie||void 0===ie||ie.translate(o),null===ee||void 0===ee||ee.translate(o),null===ce||void 0===ce||ce.translate(o);var c=u.map((function(e){return[m.Dw.getUid(),e.exportJSON()]}));a((function(e){return m.Dw.mutateStrokes(e,c)})),Ze(c.map((function(e){return(0,i.Z)(e,1)[0]})))}},et=function(){var e=new f.Group(ye),t=Y.current.project.layers[1];return t?(e.addTo(t),e.rasterize({insert:!1}).toDataURL()):""},tt=Z(),nt=(0,i.Z)(tt,2),rt=nt[0],it=nt[1],ot=(0,u.useCallback)((function(){it(void 0),O("")}),[it,O]);(0,u.useEffect)((function(){if("text"===U)return ot}),[U,ot]);var at=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#000",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"center";if(rt){rt.content=e,rt.fillColor=new f.Color(t),rt.justification=n;var r=rt.exportJSON(),i=rt.name;if(ot(),!i)return a((function(e){return m.Dw.addStroke(e,r)}));a((function(e){return m.Dw.mutateStrokes(e,[[i,r]])}))}};(0,u.useImperativeHandle)(t,(function(){return{deleteSelected:Ge,duplicateSelected:$e,cancelText:ot,submitText:at,mutateStyle:_e,rasterize:et,pointText:rt}})),(0,u.useEffect)((function(){var e=function(e){return e.preventDefault()};return document.addEventListener("gesturestart",e),document.addEventListener("gesturechange",e),document.addEventListener("gestureend",e),function(){document.removeEventListener("gesturestart",e),document.removeEventListener("gesturechange",e),document.removeEventListener("gestureend",e)}}),[]),(0,h.usePinch)((function(e){var t=e.memo,n=(0,i.Z)(e.offset,1)[0],r=e.first,o=e.last,a=e.origin;Y.current.activate();var u,c,s,l=Y.current.view,d=new(v().Point)(a);if(r||!t){var h=K.current.getBoundingClientRect(),p=h.x,m=h.y;u=1,s=new f.Point(p,m),c=d.subtract(s),Te(!1),Re.current=!0}else{var w=(0,i.Z)(t,3);u=w[0],c=w[1],s=w[2]}var g=d.subtract(s),x=l.viewToProject(g),C=g.subtract(c).divide(l.zoom);l.translate(C),Math.abs(1-n)<.05&&(n=1);var b=r?1:n/u;if(Y.current.settings.hitTolerance/=b,!o)return l.scale(b,x),[n,g,s];P(l,x,b).then((function(){return R(l,new f.Size(F,J))})).then((function(){return Re.current=!1})).then(Ne)}),{scaleBounds:{max:5,min:.3},rubberband:.5,target:K});var ut=C(q);return(0,b.jsx)("div",(0,l.Z)((0,l.Z)({className:"draw-wrapper",style:{cursor:Ie},"data-readonly":j},ut),{},{children:(0,b.jsx)("canvas",{ref:K,className:"draw-canvas"})}))}));S.displayName="Draw";var j=u.memo(S);function Z(){var e=(0,u.useState)(),t=(0,i.Z)(e,1)[0];return(0,u.useDebugValue)(t),(0,u.useEffect)((function(){if(null===t||void 0===t||!t.name)return function(){null===t||void 0===t||t.remove()}}),[t]),e}var y=function(){var e=new WeakMap;return function(t,n){var r,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=t.pathData,a=t.uid,u=null!==(r=e.get(n))&&void 0!==r?r:new Map;e.set(n,u);var c,s=u.get(a);if((null===s||void 0===s?void 0:s.stroke)===t)n.addChild(s.item),c=s.item;else{var l;try{c=n.importJSON(o)}catch(d){console.error(d)}null!==(l=c)&&void 0!==l||(c=new(v().Item)),c.name=a,u.set(a,{item:c,stroke:t})}return c.opacity=1,c.guide=i,c}}(),A=function(e,t,n){var r=(0,i.Z)(e,3),o=r[0],a=r[1],u=r[2];if(!o||!a||!u)return[];var c=new f.Path.Rectangle(new f.Point(0,0),new f.Point(t,n)),s=c.clone(),l=c.clone();return c.fillColor=new f.Color("#fff"),o.addChild(c),a.addChild(s),u.addChild(l),a.clipped=!0,u.clipped=!0,[c,s,l]},k=function(e){var t=new f.Path.Rectangle(e,new f.Size(0,0));return t.onFrame=function(){},t},E=function(e,t){var n=e.mode,r=e.lineWidth,i=e.eraserWidth,o=e.color,a=e.highlight,u=new f.Path;u.add(t),"erase"===n&&(o="#ccc",r=i),"select"===n&&(o="#009dec",r=5);var c=new f.Color(o);return(a||"erase"===n)&&(c.alpha=.5,u.blendMode="multiply"),u.strokeColor=c,u.strokeWidth=r,u.strokeJoin="round",u.strokeCap="round",u.guide=!0,u},D=function(e){e.dashOffset=0,e.dashArray=[30,20],e.onFrame=function(){return e.dashOffset+=3}},P=function(e,t,n){return new Promise((function(r){if(Math.abs(n-1)<.05)return e.scale(n,t),r();var i=10;n=Math.pow(n,1/i);!function o(){e.scale(n,t),--i>0?requestAnimationFrame(o):requestAnimationFrame((function(){return r()}))}()}))},R=function(e,t){return new Promise((function(n){var r=function(e,t){var n=e.center,r=n.x,i=n.y,o=e.size,a=o.width,u=o.height,c=t.width,s=t.height,l=Math.min(a,c)/2,d=Math.min(u,s)/2,f=c-l,v=s-d;return[r<l?l-r:r>f?f-r:0,i<d?d-i:i>v?v-i:0]}(e,t),o=(0,i.Z)(r,2),a=o[0],u=o[1];if(!a&&!u)return n();var c=10,s=new f.Point(a,u).divide(-c);!function t(){e.translate(s),--c>0?requestAnimationFrame(t):requestAnimationFrame((function(){return n()}))}()}))},T=function(e,t){var n=function(e){var n=e.subtract(t,{insert:!1,trace:!1});return n.remove(),!n.compare(e)};return e.filter((function(e){if(!e.name)return!1;if(!e.bounds.intersects(t.bounds))return!1;if(e instanceof v().Path)return 4===t.segments.length&&e.isInside(t.bounds)||n(e);var r=new f.Path.Rectangle(e.bounds);return r.remove(),n(r)||t.isInside(e.bounds)})).map((function(e){return e.name}))},N=function(e,t){var n=t.lineWidth,r=t.color,i=t.highlight;e.forEach((function(e){if(e instanceof v().PointText&&r){var t=new f.Color(r);e.fillColor=t}if(e instanceof v().Path){if(r){var o=new f.Color(r);"multiply"===e.blendMode&&(o.alpha=.5),e.strokeColor=o}n&&(e.strokeWidth=n),e.strokeColor&&void 0!==i&&(e.strokeColor.alpha=i?.5:1,e.blendMode=i?"multiply":"normal")}}))},M=function(e,t){var n=e.hitTest(t,{class:v().PointText,fill:!0});if((null===n||void 0===n?void 0:n.item)instanceof v().PointText)return null===n||void 0===n?void 0:n.item},W=function(e){return new(v().PointText)({point:e.add(new f.Point(0,50)),content:"Insert text...",fontSize:50,justification:"center",fillColor:"#1890ff55"})},L=function e(t){return t instanceof v().Path?t.isEmpty()?[]:[t]:t instanceof v().CompoundPath?t.children.map(e).flat():[]},z=n(64239),V=n(61507),O=n(23414),F=n(82622),J=n(72785),U=n(22925),q=n(4720),B=n(41275),I=n(27190),K=n(69228),Y=n(87309),H=n(87501),Q=n(89295),X=n(48),G=n(66023),_=n(74115),$=n(54164),ee=n(64802),te=function(e){var t=e.drawRef,n=e.visible;return(0,b.jsx)(Q.Z,{timeout:300,in:n,unmountOnExit:!0,children:(0,b.jsx)(ne,{drawRef:t})})},ne=function(e){var t=e.drawRef,n={type:"text",shape:"round",size:"small"},r=(0,u.useState)({}),o=(0,i.Z)(r,2),a=o[0],c=o[1];return(0,$.createPortal)((0,b.jsxs)("div",{className:"select-tool",children:[(0,b.jsx)(K.Z,{trigger:"click",placement:"bottom",getPopupContainer:function(e){return e.parentElement},destroyTooltipOnHide:!0,content:(0,b.jsx)(X.Uk,{updateDrawCtrl:function(e){var n;c((function(t){return(0,l.Z)((0,l.Z)({},t),e)})),null===(n=t.current)||void 0===n||n.mutateStyle(e)},drawCtrl:a}),children:(0,b.jsx)(Y.Z,(0,l.Z)({icon:(0,b.jsx)(V.Z,{})},n))}),(0,b.jsx)(Y.Z,(0,l.Z)({icon:(0,b.jsx)(O.Z,{}),onClick:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.duplicateSelected()}},n)),(0,b.jsx)(Y.Z,(0,l.Z)({icon:(0,b.jsx)(z.Z,{}),onClick:function(){if(t.current){var e=t.current.rasterize();I.Z.confirm({title:"Screenshot",content:(0,b.jsx)("img",{className:"raster",src:e,alt:"raster"}),className:"raster-modal",icon:(0,b.jsx)(z.Z,{}),okText:"Save",onOk:function(){return(0,ee.saveAs)(e,"screenshot")}})}}},n)),(0,b.jsx)(Y.Z,(0,l.Z)({danger:!0,icon:(0,b.jsx)(F.Z,{}),onClick:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.deleteSelected()}},n))]}),document.querySelector(".reader.container > header"))},re=function(e){var t=e.visible,n=e.drawRef,r=(0,u.useState)(""),o=(0,i.Z)(r,2),a=o[0],c=o[1],s=(0,u.useState)(_.Qk[0]),l=(0,i.Z)(s,2),d=l[0],f=l[1],v=(0,u.useState)("center"),h=(0,i.Z)(v,2),p=h[0],m=h[1];(0,u.useEffect)((function(){var e,r=null===(e=n.current)||void 0===e?void 0:e.pointText;if(r&&t){var i,o=r.name,a=r.content,u=r.justification,s=r.fillColor;if(m(u),o)c(a),f(null!==(i=null===s||void 0===s?void 0:s.toCSS(!0))&&void 0!==i?i:_.Qk[0]);else c(""),f(_.Qk[0])}}),[t,n]);var w=(0,b.jsx)(K.Z,{content:(0,b.jsx)(X.Q5,{color:d,setColor:f}),overlayStyle:{width:200},placement:"bottom",getPopupContainer:function(e){return e.parentElement},children:(0,b.jsx)(Y.Z,{size:"small",icon:(0,b.jsx)(J.Z,{className:"font-icon",style:{color:d}})})}),g=(0,b.jsx)(H.ZP.Group,{size:"small",optionType:"button",value:p,buttonStyle:"solid",onChange:function(e){return m(e.target.value)},options:[{label:(0,b.jsx)(U.Z,{}),value:"left"},{label:(0,b.jsx)(q.Z,{}),value:"center"},{label:(0,b.jsx)(B.Z,{}),value:"right"}]});return(0,b.jsxs)(I.Z,{visible:t,title:"Insert text",onCancel:function(){var e;return null===(e=n.current)||void 0===e?void 0:e.cancelText()},onOk:function(){var e,t,r=a.trim();if(!r)return null===(e=n.current)||void 0===e?void 0:e.cancelText();null===(t=n.current)||void 0===t||t.submitText(r,d,p)},bodyStyle:{paddingTop:0},destroyOnClose:!0,children:[(0,b.jsxs)("div",{className:"insert-option",children:[w,g]}),(0,b.jsx)(G.Z,{size:"large",rows:3,autoFocus:!0,value:a,onChange:function(e){return c(e.target.value)}})]})},ie=n(763),oe=n(19348),ae=n(24124),ue=function(e){var t=e.thumbnail,o=e.drawState,c=e.teamStateMap,s=e.updateState,l=e.pdfIndex,d=e.noteID,f=void 0===d?"":d,v=e.preview,h=void 0!==v&&v,p=e.onViewChange,m=e.preload,w=void 0!==m&&m,g=e.ignores,x=void 0===g?(0,ae.l4)():g,C=e.skipInView,S=void 0!==C&&C,j=p&&(0,ie.range)(0,1.2,.2),Z=(0,oe.YD)({threshold:j,skip:S}),y=(0,i.Z)(Z,3),A=y[0],k=y[1],E=y[2];(0,u.useEffect)((function(){if(p)return E&&k?void p(E.intersectionRatio):p(0)}),[k,E,p]);var D=(0,u.useState)(),P=(0,i.Z)(D,2),R=P[0],T=P[1],N=(0,u.useCallback)((0,ie.once)((0,r.Z)(a().mark((function e(){var t,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l&&f){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,Promise.all([n.e(643),n.e(138)]).then(n.bind(n,21176));case 4:return t=e.sent,r=t.getNotePageImage,e.t0=T,e.next=9,r(f,l);case 9:e.t1=e.sent,(0,e.t0)(e.t1);case 11:case"end":return e.stop()}}),e)})))),[l,f]),M=k||w;(0,u.useEffect)((function(){!h&&M&&N()}),[M,h,N]);var W=(0,u.useMemo)((function(){return null===c||void 0===c?void 0:c.deleteAll(x).toList().toArray()}),[c,x]),L=Boolean(R||!l),z=M&&L,V=o.height/o.width;return(0,b.jsxs)("div",{ref:A,className:"page-wrapper",children:[(0,b.jsx)("svg",{viewBox:"0 0 100 ".concat(100*V)}),z&&(0,b.jsx)(se,{drawState:o,otherStates:W,updateState:s,imgSrc:R||t,preview:h})]})};ue.displayName="PageWrapper";var ce=u.memo(ue),se=function(e){var t=e.drawState,n=e.updateState,r=e.otherStates,o=e.preview,a=void 0!==o&&o,l=e.imgSrc,d=(0,c.gX)(),f=(0,u.useState)(""),v=(0,i.Z)(f,2),h=v[0],p=v[1],w=(0,u.useRef)(null),g=(0,s.Z)((function(e){if(n){var r=e instanceof m.Dw?e:e(t);r!==t&&n(r)}}));return a?(0,b.jsx)(j,{drawState:t,otherStates:r,imgSrc:l,readonly:!0}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(j,{drawState:t,otherStates:r,onChange:g,imgSrc:l,drawCtrl:d,ref:w,setActiveTool:p}),(0,b.jsx)(te,{drawRef:w,visible:"select"===h}),(0,b.jsx)(re,{drawRef:w,visible:"text"===h})]})};se.displayName="DrawWrapper";var le=ce},11886:function(e,t,n){"use strict";n.d(t,{Eq:function(){return f},F7:function(){return g},Hq:function(){return v},gX:function(){return w},w3:function(){return x}});var r=n(1413),i=n(29439),o=n(15861),a=n(87757),u=n.n(a),c=n(61842),s=n.n(c),l=n(72791),d=n(80184),f=[10,20,30,50],v={mode:"draw",finger:!0,lineWidth:10,eraserWidth:10,color:"#000000",highlight:!1,lasso:!0,pixelEraser:!1,widthList:f};function h(){return(h=(0,o.Z)(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s().getItem("DRAW_CTRL");case 2:if(t=e.sent){e.next=7;break}return t=v,e.next=7,s().setItem("DRAW_CTRL",t);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(){return(p=(0,o.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s().setItem("DRAW_CTRL",t);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var m=l.createContext({drawCtrl:v,updateDrawCtrl:function(){}});function w(){var e=(0,l.useContext)(m).drawCtrl;return(0,l.useDebugValue)(e),e}function g(){return(0,l.useContext)(m).updateDrawCtrl}var x=function(e){var t=e.children,n=(0,l.useState)(v),o=(0,i.Z)(n,2),a=o[0],u=o[1];(0,l.useEffect)((function(){(function(){return h.apply(this,arguments)})().then(u)}),[]);return(0,d.jsx)(m.Provider,{value:{drawCtrl:a,updateDrawCtrl:function(e){u((function(t){var n=(0,r.Z)((0,r.Z)({},t),e);return function(e){p.apply(this,arguments)}(n),n}))}},children:t})}},96153:function(e,t,n){"use strict";function r(e,t){var n=document.createElement("canvas"),r=n.getContext("2d");if(!r)throw new Error("can't get virtual canvas context");return n.width=e,n.height=t,{canvas:n,context:r}}function i(e){e.width=1,e.height=1;var t=e.getContext("2d");null===t||void 0===t||t.clearRect(0,0,1,1)}n.d(t,{j:function(){return i},v:function(){return r}})},48:function(e,t,n){"use strict";n.d(t,{Q5:function(){return C},Uk:function(){return w},Db:function(){return g}});var r=n(4942),i=n(93433),o=n(29439),a=n(72791),u=n(11886),c=n(35873),s=n(82670),l=n(69228),d=n(96272),f=n(53163),v=n(74115),h=n(22568),p=n(24124),m=n(80184),w=function(e){var t=e.updateDrawCtrl,n=e.drawCtrl,r=n.highlight,i=n.color,u=(0,a.useState)(!1),c=(0,o.Z)(u,2),s=c[0],l=c[1];return(0,m.jsxs)("div",{className:"pen-panel","data-blur":s,"data-hi":r,children:[(0,m.jsxs)("div",{className:"pen-status",children:[(0,m.jsx)(g,{updateDrawCtrl:t,drawCtrl:n,setPanelBlur:l}),(0,m.jsx)(x,{checked:r,updateDrawCtrl:t})]}),(0,m.jsx)(C,{color:i||"",setColor:function(e){return t({color:e})}})]})},g=function(e){var t,n,v=e.updateDrawCtrl,h=e.drawCtrl,w=e.setPanelBlur,g=void 0===w?function(){}:w,x=e.field,C=void 0===x?"lineWidth":x,b=h[C],S=null!==(t=h.widthList)&&void 0!==t?t:u.Eq,j="lineWidth"===C&&null!==(n=h.color)&&void 0!==n?n:"#aaa",Z=(0,a.useMemo)((function(){return S.indexOf(null!==b&&void 0!==b?b:-1)}),[b,S]),y=(0,a.useState)((0,p.aV)([!1,!1,!1,!1])),A=(0,o.Z)(y,2),k=A[0],E=A[1];(0,a.useEffect)((function(){k.includes(!0)?g(!0):g(!1)}),[k,g]);var D=function(e){return{"--real-size":"calc(".concat(100/s.mF,"vw * ").concat(e,")")}},P=[{value:-1,label:null}].concat((0,i.Z)(S.map((function(e,t){return{value:t,label:(0,m.jsx)(l.Z,{visible:k.get(t),onVisibleChange:function(e){return E((function(n){return n.set(t,e)}))},trigger:Z===t?["click"]:[],placement:"bottom",destroyTooltipOnHide:!0,content:(0,m.jsx)(d.Z,{min:5,max:100,className:"ctrl-slider",defaultValue:e,onAfterChange:function(e){if(S.includes(e))return E((function(e){return e.set(t,!1)})),v((0,r.Z)({},C,e));var n=S.slice();n[t]=e,v((0,r.Z)({widthList:n},C,e))}}),children:(0,m.jsx)("div",{className:"circle-wrapper",style:D(e),children:(0,m.jsx)(c.W,{className:"width-circle "+C,color:j})})})}}))));return(0,m.jsx)(f.Z,{className:"width-seg",value:Z,options:P,onChange:function(e){var t;return v((0,r.Z)({},C,null!==(t=S[+e])&&void 0!==t?t:10))}})},x=function(e){var t=e.checked,n=void 0!==t&&t,r=e.updateDrawCtrl;return(0,m.jsxs)("label",{className:"hi-wrapper",children:[(0,m.jsx)("input",{type:"checkbox",name:"highlight",checked:n,onChange:function(e){return r({highlight:e.target.checked})}}),(0,m.jsx)("div",{className:"hi-switch",children:(0,m.jsx)(h.Z,{type:"icon-Highlight"})})]})},C=function(e){var t=e.setColor,n=e.color;return(0,m.jsx)("div",{className:"color-select",children:v.Qk.map((function(e){return(0,m.jsxs)("label",{children:[(0,m.jsx)("input",{checked:n===e,type:"radio",name:"color",onChange:function(n){return n.target.checked&&t(e)}}),(0,m.jsx)("div",{"data-color":e,className:"circle",style:{backgroundColor:e,borderColor:e}})]},e)}))})}},90858:function(){},64158:function(){}}]);
//# sourceMappingURL=25.8a437a21.chunk.js.map