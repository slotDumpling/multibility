(self.webpackChunkmultibility=self.webpackChunkmultibility||[]).push([[25],{22568:function(e,t,n){"use strict";var r=n(92721);t.Z=(0,r.Z)({scriptUrl:"//at.alicdn.com/t/font_3181679_yo844n7qgns.js"})},38117:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return le}});var r=n(15861),i=n(29439),o=n(87757),a=n.n(o),u=n(72791),c=n(11886),s=n(81832),l=n(95099),d=n(1413),f=n(93433),v=n(46668),h=n.n(v),p=n(41446),m=n(1488),w=n(82670),g=n(96153),x=function(){var e=new Map,t=(0,g.v)(44,44),n=t.canvas,r=t.context,i=new Image;return i.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAAAXNSR0IArs4c6QAABWlJREFUWEftmF1IW2cYx580iaaNSTSmdWUtRVBBnENbSG40YVtRRpZM4ydqLEpJnd5sVzpxU7TipoMy8EYd6kwC6pakiDeCih/oyBGibS/qTZWaoE63RONXqiYZj5xIKtvFzhvRQl84nHPzvud3nvO8//f5Pyx4xwbrHeOF98Dn/cfeR/h9hM9EgDQlcP4VgJPNi/ezww8AeHnpO/EPIAXm2O32+3w+/xOv13vF5/O9tR6Hw/FxuVyvUChsAIDDUECTAOPca1NTU5+np6f/Zjab7X6//631cnJybjkcjp9v375dDwB7AHBMGmISYEwBocViUWVlZfVJpVLP3NwcLxjI7/fD4uJiR2Ji4vcA4AKAo4sEZgNApF6vzy4pKelCYK/Xy3K73dympqa/EaywsPD6/Px89927d78DgL/otCBiJokwAkf19vZqHjx40CGVSt8gyfLycrhMJvMMDw+fRHthYaEnNTUVgTcvJXBZWdlhZWWlID8/3z0wMCC02Wy99+7dCwCffBTJCHmEKYoKr66udra2torLy8v/7Orqik5JSUl+8eLFCgDsk8DiXFLgSKPRmFVUVPTLWZDc3NzdsbExVJFdgUDwNDY29msA2AYAHwk0CTCqhMBisahfv34tcbvdgsPDw7Dj42NOTU3Nw6mpqSO1Wv1BYWGhU6/Xc2tra+VtbW2LAOC5KGD82KsobQAgop/DASDCYDBoiouLKzUajdtisQiXlpYOfD7fr3Fxcd8CgJskyiQRxkBxACAMALj0M96FkZGRH9rt9gGj0ciuqKgQt7e3b2i1WqdIJPoUAFDy8NRjNEiBA/sA1wnUExEAcHNmZqYuNTVVJZFIIjIzM7cHBwe5XC73IwBYB4ADRrSEm+6/3on6e2N4eLhSqVRWKxSKY5fL5Xv+/HlYY2Pj/fr6egoAdi4TMKaJpL29XV1VVdWhVqv3bTZbuMPhYJtMJl1ubu7vALDFtBAKRUqcDRaqh1ilUn08NDQ0VlpaumUymSL39vaAoqgfZTLZTwDgZLrxzgMY14zKzs5ONpvNE1qt1mU2m6MQeGZmpi0tLS0AzKhyOzfg7u5uVVlZWa9ard6z2Ww8TImenp7K8vJyEx3hSwN8khKTk5NVcrm8QaFQHLlcLj9uukePHn3R2dlpvWwpcbLpnj179jghISE/OjpakJGRsd3f3w88Hi8dAOz0EY3W6X+P80gJ3p07d26+fPly1mAwcHQ6HSrGZl5e3mZMTEw2AKxdtKwFDo3Tg8NqtX4llUqbNRrNtsViEb169cqztrZmSEtLewwAGxd5cHBWV1c/293d5RwcHLA9Hg97fX2dn5GR0To+Pu5VKpW3CgoKtoxGY4RSqVSNjIws0EczY6tEkhInxY/Vas2USqXms8mYl5e3Mzo6yp+YmNjn8/m2+Pj4KgBwXGTxc1pe0iYU6wMWRVG85ubmjbq6uhs6nc7Z0dEhrq2tfdjS0jJKmg4hLeDRhCJwQ0PDQUFBgTA5OfnN7Ozs1enp6QG5XP4DrQ54JGNThfEgSYl/NaFbW1vs1dXVKysrK06xWCyhKEovk8kaaXXA3gTRCCkwwu7s7LCePHmCPQi0+RLahGJfAtXhcpnQubk5dBynAxspl87m9/X1ZWu12s7+/n7sOwT/MX9QIwUjfOF9CVQJ0eDg4JcKheKbo6MjbnBvjcVi+dls9rHT6fwjKSkJgbGkZKy/gd9GksM4l4+FDgBcRwdNe7vA2mjncZOhh8M2FboMRhVacJqRAOM6aDrROV+jzWhwjxiLG4woyh02UHDDMSp4QgmMH4zyhlegsR1YP7iZjdpL1EAJRUoQ6SnTyaQpwfS9jOe9c8D/AEaRMEuceu4YAAAAAElFTkSuQmCC",function(t){t=10*Math.round(t/10);var o=e.get(t);if(o)return o;r.translate(22,22),r.rotate(t*Math.PI/180),r.drawImage(i,-22,-22);var a=n.toDataURL();return r.clearRect(-22,-22,44,44),r.resetTransform(),e.set(t,a),a}}(),C=function(e){return"url(".concat(x(e),") 22 22, auto")};function b(e){var t=(0,u.useRef)(!1),n=function(e){return e.isPrimary&&(t.current="touch"===e.pointerType)},r=function(n){return function(n){return!t.current||function(e){var t=e.touches[0];return"stylus"===(null===t||void 0===t?void 0:t.touchType)}(n)||e&&1===n.touches.length}(n)||n.stopPropagation()};return{onPointerDownCapture:n,onPointerMoveCapture:n,onTouchStartCapture:r,onTouchMoveCapture:r}}var Z=n(80184),j=u.forwardRef((function(e,t){var n=e.drawState,r=e.otherStates,o=e.onChange,a=void 0===o?function(){}:o,s=e.drawCtrl,l=void 0===s?c.Hq:s,x=e.readonly,j=void 0!==x&&x,S=e.imgSrc,V=e.setActiveTool,z=void 0===V?function(){}:V,O=n.width,J=n.height,F=l.mode,U=l.finger,B=l.lasso,I=l.eraserWidth,K=(0,u.useRef)(null),q=(0,u.useRef)(new(h().PaperScope)),Y=(0,u.useState)([]),H=(0,i.Z)(Y,2),Q=H[0],X=H[1],G=y(),_=(0,i.Z)(G,2),$=_[0],ee=_[1],te=y(),ne=(0,i.Z)(te,2),re=ne[0],ie=ne[1],oe=y(),ae=(0,i.Z)(oe,2),ue=ae[0],ce=ae[1];(0,u.useEffect)((function(){var e,t=K.current,n=q.current;if(t)return n.setup(t),n.settings.handleSize=10,n.settings.hitTolerance=20,[0,1,2].forEach((function(){return(new v.Layer).visible=!1})),null===(e=n.project.layers[2])||void 0===e||e.activate(),new n.Tool,function(){var e;null===(e=n.view)||void 0===e||e.remove(),(0,g.j)(t)}}),[]),(0,u.useEffect)((function(){q.current.activate();var e=q.current.project.layers,t=A(e,O,J);return function(){return t.forEach((function(e){return e.remove()}))}}),[O,J]);var se=(0,m.Z)(K),le=(0,i.Z)(se,1)[0],de=le/O;(0,u.useEffect)((function(){if(de){var e=q.current,t=new v.Point(0,0);return e.view.viewSize=new v.Size(O,J).multiply(de),e.view.scale(de,t),e.project.layers.forEach((function(e){return e.visible=!0})),e.view.update(),function(){var n;return null===(n=e.view)||void 0===n?void 0:n.scale(1/de,t)}}}),[O,J,de]),(0,u.useEffect)((function(){var e;if(S){q.current.activate();var t=new v.Raster(S);return null===(e=t.project.layers[0])||void 0===e||e.addChild(t),t.sendToBack(),t.onLoad=function(){t.view.update(),t.fitBounds(new(h().Rectangle)(0,0,O,J)),t.bringToFront()},function(){null===t||void 0===t||t.remove()}}}),[S,O,J]);var fe=(0,u.useMemo)((function(){return r?w.Dw.mergeStates.apply(w.Dw,[n].concat((0,f.Z)(r))):n.getStrokeList()}),[n,r]);(0,u.useEffect)((function(){var e=[],t=q.current.project.layers[1];if(t)return q.current.activate(),fe.forEach((function(r){var i=n.hasStroke(r.uid),o=k(r,t,!i);i&&e.push(o)})),X(e),function(){t.removeChildren(1)}}),[fe,n]);var ve=(0,u.useRef)(),he=(0,u.useState)(!1),pe=(0,i.Z)(he,2),me=pe[0],we=pe[1],ge="select"===F&&me?"selected":F,xe=(0,u.useState)([]),Ce=(0,i.Z)(xe,2),be=Ce[0],Ze=Ce[1],je=(0,u.useMemo)((function(){var e=new Set(be);return Q.filter((function(t){return e.has(t.name)}))}),[Q,be]),Se=(0,u.useCallback)((function(){we(!1),ee(void 0),ie(void 0),ce(void 0)}),[ee,ie,ce]);(0,u.useEffect)((function(){if("select"===F)return Se}),[F,Se]),(0,u.useEffect)((function(){return Se}),[B,Se]),(0,u.useEffect)((function(){if(me)return function(){Ze([]),z("")}}),[me,z]);var ye=y(),ke=(0,i.Z)(ye,2),Ae=ke[0],Ee=ke[1],De=function(){if(!(fe.length<2e3)){var e=(0,i.Z)(q.current.project.layers,2),t=e[0],n=e[1];t&&n&&Ee((function(e){q.current.activate();var r=le/O*72*devicePixelRatio;return(e=n.rasterize({raster:e,resolution:r})).visible=!0,t.addChild(e),n.visible=!1,e}))}},Pe=function(){q.current.project.layers[1].visible=!0,Ae&&(Ae.visible=!1)},Re=function(e){De(),ee(D(l,e.point))},Te=function(e){De(),ie(E(e.point))},Ne={draw:Re,erase:Re,select:B?Re:Te,selected:function(e){if(B){if(null!==$&&void 0!==$&&$.contains(e.point))return;Re(e),we(!1)}else{var t,n=null!==(t=null===re||void 0===re?void 0:re.hitTest(e.point,{segments:!0}))&&void 0!==t?t:null===ue||void 0===ue?void 0:ue.hitTest(e.point,{segments:!0,selected:!0});if(ve.current=n,n)return;if(null!==re&&void 0!==re&&re.contains(e.point))return;Te(e),ce(void 0),we(!1)}},text:function(e){var t,n=q.current.project.layers[1];if(n){var r=null!==(t=M(n,e.point))&&void 0!==t?t:W(e.point);tt(r)}}}[ge],Me=function(e){null===$||void 0===$||$.add(e.point),null===$||void 0===$||$.smooth()},We={draw:Me,erase:Me,select:B?Me:function(e){if(re){var t=e.point,n=t.x,r=t.y,o=(0,i.Z)(re.segments,4),a=o[1],u=o[2],c=o[3];a&&u&&c&&(a.point.x=n,u.point=e.point,c.point.y=r,re.selected=!0)}},selected:function(e){var t=ve.current;if(null!==t&&void 0!==t&&t.segment&&re&&ue){var n=t.segment;if(n.selected){var r=re.bounds.center,i=n.point.subtract(r),o=e.point.subtract(r);Be(C(o.angle));var a=o.angle-i.angle;re.rotate(a,r),ue.rotate(a,r),je.forEach((function(e){return null===e||void 0===e?void 0:e.rotate(a,r)}))}else{var u,c=n.point,s=n.next.next.point,l=c.subtract(s),d=e.point.subtract(s).project(l).x/l.x;if(d<0)return;re.scale(d,s),je.forEach((function(e){e.scale(d,s),e.strokeWidth*=d})),ue.scale(d,s);var f=null===(u=ue.segments[0])||void 0===u?void 0:u.point;if(!f)return;ue.scale(100/ue.length,f)}}else je.forEach((function(t){return t.translate(e.delta)})),null===$||void 0===$||$.translate(e.delta),null===re||void 0===re||re.translate(e.delta),null===ue||void 0===ue||ue.translate(e.delta)},text:function(e){if(et&&!et.name){var t=et.bounds,n=t.topCenter,r=t.bottomRight.subtract(n),i=e.point.subtract(n).project(r).x/r.x;i<0||et.scale(i,n)}}}[ge];(0,u.useEffect)((function(){q.current.tool.maxDistance=I}),[I]);var Le=(0,u.useRef)(new Set),Ve=(0,u.useRef)(new Map),ze=function(e){if("erase"===ge){var t=q.current.project.layers[1];if(t){var n=t.visible;t.visible=!0;var r=t.hitTestAll(e.point,{class:h().Path,stroke:!0,tolerance:I/2});t.visible=n,null===r||void 0===r||r.forEach((function(n){var r=n.item;if(r instanceof h().Path){for(var i=r;i.parent!==t&&i.parent instanceof h().PathItem;)i=i.parent;var o=i.name;if(l.pixelEraser){var a=(I+r.strokeWidth)/2,u=new v.Path.Circle({center:e.point,radius:a,insert:!1}),c=r.subtract(u,{trace:!1});r.replaceWith(c),i===r&&(i=c),Ve.current.set(o,i)}else i.opacity=.5,i.guide=!0,Le.current.add(o)}}))}}},Oe={draw:function(){if(Pe(),$&&!($.segments.length<=1)){$.simplify();var e=$.exportJSON();ee(void 0),a((function(t){return w.Dw.addStroke(t,e)}))}},erase:function(){if(Pe(),ee(void 0),l.pixelEraser){var e=Array.from(Ve.current);Ve.current.clear();var t=e.map((function(e){var t=(0,i.Z)(e,2),n=t[0],r=t[1];return[n,L(r).map((function(e){return e.exportJSON()}))]}));if(!t.length)return;a((function(e){return w.Dw.splitStrokes(e,t)}))}else{var n=Array.from(Le.current);if(Le.current.clear(),!n.length)return;a((function(e){return w.Dw.eraseStrokes(e,n)}))}},select:function(){var e;if(Pe(),B){if(!$||Math.abs($.area)<1e3)return ee(void 0);$.closePath(),$.simplify(),P($),e=T(Q,$)}else{if(!re||Math.abs(re.area)<1e3)return ie(void 0);e=T(Q,re);var t=new v.Path,n=re.bounds.topCenter;t.add(n,n.subtract(new v.Point(0,100))),t.lastSegment.selected=!0,ce(t)}we(!0),Ze(e),z("select")},selected:function(e){Ye(),Ie(e)},text:function(){z("text")}}[ge],Je=(0,u.useState)("auto"),Fe=(0,i.Z)(Je,2),Ue=Fe[0],Be=Fe[1];(0,u.useEffect)((function(){"text"===ge||"select"===ge?Be("crosshair"):"selected"===ge?Be(B?"crosshair":"nwse-resize"):"draw"!==ge&&"erase"!==ge||Be(function(e,t){var n=e.lineWidth,r=e.eraserWidth,i=t*("erase"===e.mode?r:n);if(i<5)return"crosshair";var o=i/2;return'url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" fill="%23FFF7" width="'.concat(i,'" height="').concat(i,'" viewBox="0 0 10 10"><circle cx="5" cy="5" r="5"/></svg>\') ').concat(o," ").concat(o,", auto")}(l,de))}),[ge,B,l,de]);var Ie=function(e){var t,n,r=null!==(t=null===re||void 0===re?void 0:re.hitTest(e.point,{segments:!0}))&&void 0!==t?t:null===ue||void 0===ue?void 0:ue.hitTest(e.point,{segments:!0,selected:!0});if(null!==r&&void 0!==r&&r.segment){if(r.segment.selected){var i=null===re||void 0===re?void 0:re.bounds.center;if(!i)return;var o=r.segment.point.subtract(i);return Be(C(o.angle))}var a=r.segment.point,u=r.segment.next.next.point,c=a.subtract(u),s=c.x,l=c.y;return Be(s*l<0?"nesw-resize":"nwse-resize")}if(null!==(n=null!==re&&void 0!==re?re:$)&&void 0!==n&&n.contains(e.point))return Be("move");Be("crosshair")},Ke=(0,d.Z)({selected:Ie,text:function(e){var t=q.current.project.layers[1];t&&(M(t,e.point)?Be("text"):Be("crosshair"))}},{select:null,draw:null,erase:null})[ge],qe="selected"===ge?function(e){["delete","backspace"].includes(e.key)&&He()}:null;(0,u.useEffect)((function(){if(!j){var e=function(e){return function(t){if(q.current.activate(),e)return e(t)}},t=q.current,n=t.view,r=t.tool;n.onMouseDown=e(Ne),n.onMouseDrag=e(We),n.onMouseUp=e(Oe),n.onMouseMove=e(Ke),r.onMouseDrag=e(ze),r.onKeyUp=e(qe)}}));var Ye=function(){if(null!==je&&void 0!==je&&je.length){var e=je.map((function(e){return[e.name,e.exportJSON()]}));a((function(t){return w.Dw.mutateStrokes(t,e)}))}},He=function(){Se(),be.length&&a((function(e){return w.Dw.eraseStrokes(e,be)}))},Qe=function(e){q.current.activate(),N(je,e),Ye()},Xe=function(){var e;q.current.activate();var t=null===(e=re||$)||void 0===e?void 0:e.bounds.size;if(t&&je.length){var n=t.width,r=t.height,o=new v.Point(n,r).divide(10),u=je.map((function(e){return e.clone()}));u.forEach((function(e){return e.translate(o)})),null===re||void 0===re||re.translate(o),null===$||void 0===$||$.translate(o),null===ue||void 0===ue||ue.translate(o);var c=u.map((function(e){return[w.Dw.getUid(),e.exportJSON()]}));a((function(e){return w.Dw.mutateStrokes(e,c)})),Ze(c.map((function(e){return(0,i.Z)(e,1)[0]})))}},Ge=function(){var e=new v.Group(je),t=q.current.project.layers[1];return t?(e.addTo(t),e.rasterize({insert:!1}).toDataURL()):""},_e=y(),$e=(0,i.Z)(_e,2),et=$e[0],tt=$e[1],nt=(0,u.useCallback)((function(){tt(void 0),z("")}),[tt,z]);(0,u.useEffect)((function(){if("text"===F)return nt}),[F,nt]);var rt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#000",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"center";if(et){et.content=e,et.fillColor=new v.Color(t),et.justification=n;var r=et.exportJSON(),i=et.name;if(nt(),!i)return a((function(e){return w.Dw.addStroke(e,r)}));a((function(e){return w.Dw.mutateStrokes(e,[[i,r]])}))}};(0,u.useImperativeHandle)(t,(function(){return{deleteSelected:He,duplicateSelected:Xe,cancelText:nt,submitText:rt,mutateStyle:Qe,rasterize:Ge,pointText:et}})),(0,u.useEffect)((function(){var e=function(e){return e.preventDefault()};return document.addEventListener("gesturestart",e),document.addEventListener("gesturechange",e),document.addEventListener("gestureend",e),function(){document.removeEventListener("gesturestart",e),document.removeEventListener("gesturechange",e),document.removeEventListener("gestureend",e)}}),[]),(0,p.usePinch)((function(e){var t=e.memo,n=(0,i.Z)(e.offset,1)[0],r=e.first,o=e.last,a=e.origin;q.current.activate();var u,c,s,l=q.current.view,d=new v.Point(a);if(r||!t){var f=K.current.getBoundingClientRect(),h=f.x,p=f.y;u=1,s=new v.Point(h,p),c=d.subtract(s)}else{var m=(0,i.Z)(t,3);u=m[0],c=m[1],s=m[2]}var w=d.subtract(s),g=l.viewToProject(w);Math.abs(1-n)<.05&&(n=1);var x=r?1:n/u,C=o?10:1;x=Math.pow(x,1/C);!function e(){l.scale(x,g),q.current.settings.hitTolerance/=x,--C>0?requestAnimationFrame(e):o&&R(l,new v.Size(O,J))}();var b=w.subtract(c).divide(l.zoom);if(l.translate(b),!o)return[n,w,s]}),{scaleBounds:{max:10,min:.3},rubberband:.5,target:K});var it=b(U);return(0,Z.jsx)("div",(0,d.Z)((0,d.Z)({className:"draw-wrapper",style:{cursor:Ue},"data-readonly":j},it),{},{children:(0,Z.jsx)("canvas",{ref:K,className:"draw-canvas"})}))}));j.displayName="Draw";var S=u.memo(j);function y(){var e=(0,u.useState)(),t=(0,i.Z)(e,1)[0];return(0,u.useDebugValue)(t),(0,u.useEffect)((function(){if(null===t||void 0===t||!t.name)return function(){null===t||void 0===t||t.remove()}}),[t]),e}var k=function(){var e=new WeakMap;return function(t,n){var r,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=t.pathData,a=t.uid,u=null!==(r=e.get(n))&&void 0!==r?r:new Map;e.set(n,u);var c,s=u.get(a);if((null===s||void 0===s?void 0:s.stroke)===t)n.addChild(s.item),c=s.item;else{try{c=n.importJSON(o)}catch(l){console.error(l),c=new(h().Item)}c.name=a,u.set(a,{item:c,stroke:t})}return c.opacity=1,c.guide=i,c}}(),A=function(e,t,n){var r=(0,i.Z)(e,3),o=r[0],a=r[1],u=r[2];if(!o||!a||!u)return[];var c=new v.Path.Rectangle(new v.Point(0,0),new v.Point(t,n)),s=c.clone(),l=s.clone();return c.fillColor=new v.Color("#fff"),o.addChild(c),a.addChild(s),u.addChild(l),a.clipped=!0,u.clipped=!0,[c,s,l]},E=function(e){var t=new v.Path.Rectangle(e,new v.Size(0,0));return t.onFrame=function(){},t},D=function(e,t){var n=e.mode,r=e.lineWidth,i=e.eraserWidth,o=e.color,a=e.highlight,u=new v.Path;u.add(t),"erase"===n&&(o="#ccc",r=i),"select"===n&&(o="#009dec",r=5);var c=new v.Color(o);return(a||"erase"===n)&&(c.alpha=.5,u.blendMode="multiply"),u.strokeColor=c,u.strokeWidth=r,u.strokeJoin="round",u.strokeCap="round",u.guide=!0,u},P=function(e){e.dashOffset=0,e.dashArray=[30,20],e.onFrame=function(){return e.dashOffset+=3}},R=function(e,t){var n=function(e,t){var n=e.center,r=n.x,i=n.y,o=e.size,a=o.width,u=o.height,c=t.width,s=t.height,l=Math.min(a,c)/2,d=Math.min(u,s)/2,f=c-l,v=s-d;return[r<l?l-r:r>f?f-r:0,i<d?d-i:i>v?v-i:0]}(e,t),r=(0,i.Z)(n,2),o=r[0],a=r[1],u=10,c=new v.Point(o,a).divide(-u);!function t(){e.translate(c),--u>0&&requestAnimationFrame(t)}()},T=function(e,t){var n=function(e){var n=e.subtract(t,{insert:!1,trace:!1});return n.remove(),!n.compare(e)};return e.filter((function(e){if(!e.name)return!1;if(!e.bounds.intersects(t.bounds))return!1;if(e instanceof h().Path)return 4===t.segments.length&&e.isInside(t.bounds)||n(e);var r=new v.Path.Rectangle(e.bounds);return r.remove(),n(r)||t.isInside(e.bounds)})).map((function(e){return e.name}))},N=function(e,t){var n=t.lineWidth,r=t.color,i=t.highlight;e.forEach((function(e){if(e instanceof h().PointText&&r){var t=new v.Color(r);e.fillColor=t}if(e instanceof h().Path){if(r){var o=new v.Color(r);"multiply"===e.blendMode&&(o.alpha=.5),e.strokeColor=o}n&&(e.strokeWidth=n),e.strokeColor&&void 0!==i&&(e.strokeColor.alpha=i?.5:1,e.blendMode=i?"multiply":"normal")}}))},M=function(e,t){var n=e.hitTest(t,{class:h().PointText,fill:!0});if((null===n||void 0===n?void 0:n.item)instanceof h().PointText)return null===n||void 0===n?void 0:n.item},W=function(e){return new(h().PointText)({point:e.add(new v.Point(0,50)),content:"Insert text...",fontSize:50,justification:"center",fillColor:"#1890ff55"})},L=function e(t){return t instanceof h().Path?t.isEmpty()?[]:[t]:t instanceof h().CompoundPath?t.children.map(e).flat():[]},V=n(64239),z=n(61507),O=n(23414),J=n(82622),F=n(72785),U=n(22925),B=n(4720),I=n(41275),K=n(27190),q=n(69228),Y=n(87309),H=n(87501),Q=n(89295),X=n(48),G=n(66023),_=n(74115),$=n(54164),ee=n(64802),te=function(e){var t=e.drawRef,n=e.visible;return(0,Z.jsx)(Q.Z,{timeout:300,in:n,unmountOnExit:!0,children:(0,Z.jsx)(ne,{drawRef:t})})},ne=function(e){var t=e.drawRef,n={type:"text",shape:"round",size:"small"},r=(0,u.useState)({}),o=(0,i.Z)(r,2),a=o[0],c=o[1];return(0,$.createPortal)((0,Z.jsxs)("div",{className:"select-tool",children:[(0,Z.jsx)(q.Z,{trigger:"click",placement:"bottom",getPopupContainer:function(e){return e.parentElement},destroyTooltipOnHide:!0,content:(0,Z.jsx)(X.Uk,{updateDrawCtrl:function(e){var n;c((function(t){return(0,d.Z)((0,d.Z)({},t),e)})),null===(n=t.current)||void 0===n||n.mutateStyle(e)},drawCtrl:a}),children:(0,Z.jsx)(Y.Z,(0,d.Z)({icon:(0,Z.jsx)(z.Z,{})},n))}),(0,Z.jsx)(Y.Z,(0,d.Z)({icon:(0,Z.jsx)(O.Z,{}),onClick:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.duplicateSelected()}},n)),(0,Z.jsx)(Y.Z,(0,d.Z)({icon:(0,Z.jsx)(V.Z,{}),onClick:function(){if(t.current){var e=t.current.rasterize();K.Z.confirm({title:"Screenshot",content:(0,Z.jsx)("img",{className:"raster",src:e,alt:"raster"}),className:"raster-modal",icon:(0,Z.jsx)(V.Z,{}),okText:"Save",onOk:function(){return(0,ee.saveAs)(e,"screenshot")}})}}},n)),(0,Z.jsx)(Y.Z,(0,d.Z)({danger:!0,icon:(0,Z.jsx)(J.Z,{}),onClick:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.deleteSelected()}},n))]}),document.querySelector(".reader.container > header"))},re=function(e){var t=e.visible,n=e.drawRef,r=(0,u.useState)(""),o=(0,i.Z)(r,2),a=o[0],c=o[1],l=(0,u.useState)(_.Qk[0]),d=(0,i.Z)(l,2),f=d[0],v=d[1],h=(0,u.useState)("center"),p=(0,i.Z)(h,2),m=p[0],w=p[1],g=(0,s.iX)(),x=(0,i.Z)(g,1)[0];(0,u.useEffect)((function(){var e,r=null===(e=n.current)||void 0===e?void 0:e.pointText;if(r&&t){var i,o=r.name,a=r.content,u=r.justification,s=r.fillColor;if(w(u),o)c(a),v(null!==(i=null===s||void 0===s?void 0:s.toCSS(!0))&&void 0!==i?i:_.Qk[0]);else c(""),v(_.Qk[0])}}),[t,n]);var C=(0,Z.jsx)(q.Z,{content:(0,Z.jsx)(X.Q5,{color:f,setColor:v}),overlayStyle:{width:200},placement:"bottom",getPopupContainer:function(e){return e.parentElement},children:(0,Z.jsx)(Y.Z,{size:"small",icon:(0,Z.jsx)(F.Z,{className:"font-icon",style:{color:f}})})}),b=(0,Z.jsx)(H.ZP.Group,{size:"small",optionType:"button",value:m,buttonStyle:"solid",onChange:function(e){return w(e.target.value)},options:[{label:(0,Z.jsx)(U.Z,{}),value:"left"},{label:(0,Z.jsx)(B.Z,{}),value:"center"},{label:(0,Z.jsx)(I.Z,{}),value:"right"}]});return(0,Z.jsxs)(K.Z,{visible:t,title:"Insert text",onCancel:function(){var e;return null===(e=n.current)||void 0===e?void 0:e.cancelText()},onOk:function(){var e,t,r=a.trim();if(!r)return null===(e=n.current)||void 0===e?void 0:e.cancelText();null===(t=n.current)||void 0===t||t.submitText(r,f,m)},bodyStyle:{paddingTop:0},destroyOnClose:!0,children:[(0,Z.jsxs)("div",{className:"insert-option","data-force-light":x,children:[C,b]}),(0,Z.jsx)(G.Z,{size:"large",rows:3,autoFocus:!0,value:a,onChange:function(e){return c(e.target.value)}})]})},ie=n(763),oe=n(19348),ae=n(24124),ue=function(e){var t=e.thumbnail,o=e.drawState,c=e.teamStateMap,l=e.updateState,d=e.pdfIndex,f=e.noteID,v=void 0===f?"":f,h=e.preview,p=void 0!==h&&h,m=e.onViewChange,w=e.preload,g=void 0!==w&&w,x=e.ignores,C=void 0===x?(0,ae.l4)():x,b=e.skipInView,j=void 0!==b&&b,S=m&&(0,ie.range)(0,1.2,.2),y=(0,oe.YD)({threshold:S,skip:j}),k=(0,i.Z)(y,3),A=k[0],E=k[1],D=k[2];(0,u.useEffect)((function(){if(m)return D&&E?void m(D.intersectionRatio):m(0)}),[E,D,m]);var P=(0,u.useState)(),R=(0,i.Z)(P,2),T=R[0],N=R[1],M=(0,u.useCallback)((0,ie.once)((0,r.Z)(a().mark((function e(){var t,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d&&v){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,Promise.all([n.e(643),n.e(138)]).then(n.bind(n,21176));case 4:return t=e.sent,r=t.getNotePageImage,e.t0=N,e.next=9,r(v,d);case 9:e.t1=e.sent,(0,e.t0)(e.t1);case 11:case"end":return e.stop()}}),e)})))),[d,v]),W=E||g;(0,u.useEffect)((function(){!p&&W&&M()}),[W,p,M]);var L=(0,u.useMemo)((function(){return null===c||void 0===c?void 0:c.deleteAll(C).toList().toArray()}),[c,C]),V=Boolean(T||!d),z=W&&V,O=o.height/o.width,J=(0,s.iX)(),F=(0,i.Z)(J,1)[0];return(0,Z.jsxs)("div",{ref:A,className:"page-wrapper","data-force-light":F,children:[(0,Z.jsx)("svg",{viewBox:"0 0 100 ".concat(100*O)}),z&&(0,Z.jsx)(se,{drawState:o,otherStates:L,updateState:l,imgSrc:T||t,preview:p})]})};ue.displayName="PageWrapper";var ce=u.memo(ue),se=function(e){var t=e.drawState,n=e.updateState,r=e.otherStates,o=e.preview,a=void 0!==o&&o,s=e.imgSrc,d=(0,c.gX)(),f=(0,u.useState)(""),v=(0,i.Z)(f,2),h=v[0],p=v[1],m=(0,u.useRef)(null),g=(0,l.Z)((function(e){if(n){var r=e instanceof w.Dw?e:e(t);r!==t&&n(r)}}));return a?(0,Z.jsx)(S,{drawState:t,otherStates:r,imgSrc:s,readonly:!0}):(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(S,{drawState:t,otherStates:r,onChange:g,imgSrc:s,drawCtrl:d,ref:m,setActiveTool:p}),(0,Z.jsx)(te,{drawRef:m,visible:"select"===h}),(0,Z.jsx)(re,{drawRef:m,visible:"text"===h})]})};se.displayName="DrawWrapper";var le=ce},11886:function(e,t,n){"use strict";n.d(t,{Eq:function(){return f},F7:function(){return g},Hq:function(){return v},gX:function(){return w},w3:function(){return x}});var r=n(1413),i=n(29439),o=n(15861),a=n(87757),u=n.n(a),c=n(61842),s=n.n(c),l=n(72791),d=n(80184),f=[10,20,30,50],v={mode:"draw",finger:!0,lineWidth:10,eraserWidth:10,color:"#000000",highlight:!1,lasso:!0,pixelEraser:!1,widthList:f};function h(){return(h=(0,o.Z)(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s().getItem("DRAW_CTRL");case 2:if(t=e.sent){e.next=7;break}return t=v,e.next=7,s().setItem("DRAW_CTRL",t);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(){return(p=(0,o.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s().setItem("DRAW_CTRL",t);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var m=l.createContext({drawCtrl:v,updateDrawCtrl:function(){}});function w(){var e=(0,l.useContext)(m).drawCtrl;return(0,l.useDebugValue)(e),e}function g(){return(0,l.useContext)(m).updateDrawCtrl}var x=function(e){var t=e.children,n=(0,l.useState)(v),o=(0,i.Z)(n,2),a=o[0],u=o[1];(0,l.useEffect)((function(){(function(){return h.apply(this,arguments)})().then(u)}),[]);return(0,d.jsx)(m.Provider,{value:{drawCtrl:a,updateDrawCtrl:function(e){u((function(t){var n=(0,r.Z)((0,r.Z)({},t),e);return function(e){p.apply(this,arguments)}(n),n}))}},children:t})}},96153:function(e,t,n){"use strict";function r(e,t){var n=document.createElement("canvas"),r=n.getContext("2d");if(!r)throw new Error("can't get virtual canvas context");return n.width=e,n.height=t,{canvas:n,context:r}}function i(e){e.width=1,e.height=1;var t=e.getContext("2d");null===t||void 0===t||t.clearRect(0,0,1,1)}n.d(t,{j:function(){return i},v:function(){return r}})},48:function(e,t,n){"use strict";n.d(t,{Q5:function(){return b},Uk:function(){return g},Db:function(){return x}});var r=n(4942),i=n(93433),o=n(29439),a=n(72791),u=n(11886),c=n(35873),s=n(82670),l=n(69228),d=n(96272),f=n(53163),v=n(74115),h=n(22568),p=n(24124),m=n(81832),w=n(80184),g=function(e){var t=e.updateDrawCtrl,n=e.drawCtrl,r=n.highlight,i=n.color,u=(0,a.useState)(!1),c=(0,o.Z)(u,2),s=c[0],l=c[1];return(0,w.jsxs)("div",{className:"pen-panel","data-blur":s,"data-hi":r,children:[(0,w.jsxs)("div",{className:"pen-status",children:[(0,w.jsx)(x,{updateDrawCtrl:t,drawCtrl:n,setPanelBlur:l}),(0,w.jsx)(C,{checked:r,updateDrawCtrl:t})]}),(0,w.jsx)(b,{color:i||"",setColor:function(e){return t({color:e})}})]})},x=function(e){var t,n,v=e.updateDrawCtrl,h=e.drawCtrl,g=e.setPanelBlur,x=void 0===g?function(){}:g,C=e.field,b=void 0===C?"lineWidth":C,Z=h[b],j=null!==(t=h.widthList)&&void 0!==t?t:u.Eq,S="lineWidth"===b&&null!==(n=h.color)&&void 0!==n?n:"#aaa",y=(0,a.useMemo)((function(){return j.indexOf(null!==Z&&void 0!==Z?Z:-1)}),[Z,j]),k=(0,a.useState)((0,p.aV)([!1,!1,!1,!1])),A=(0,o.Z)(k,2),E=A[0],D=A[1];(0,a.useEffect)((function(){E.includes(!0)?x(!0):x(!1)}),[E,x]);var P=function(e){return{"--real-size":"calc(".concat(100/s.mF,"vw * ").concat(e,")")}},R=(0,m.iX)(),T=(0,o.Z)(R,1)[0],N=[{value:-1,label:null}].concat((0,i.Z)(j.map((function(e,t){return{value:t,label:(0,w.jsx)(l.Z,{visible:E.get(t),onVisibleChange:function(e){return D((function(n){return n.set(t,e)}))},trigger:y===t?["click"]:[],placement:"bottom",destroyTooltipOnHide:!0,content:(0,w.jsx)(d.Z,{min:5,max:100,className:"ctrl-slider",defaultValue:e,onAfterChange:function(e){if(j.includes(e))return D((function(e){return e.set(t,!1)})),v((0,r.Z)({},b,e));var n=j.slice();n[t]=e,v((0,r.Z)({widthList:n},b,e))}}),children:(0,w.jsx)("div",{className:"circle-wrapper","data-force-light":T,style:P(e),children:(0,w.jsx)(c.W,{className:"width-circle "+b,color:S})})})}}))));return(0,w.jsx)(f.Z,{className:"width-seg",value:y,options:N,onChange:function(e){var t;return v((0,r.Z)({},b,null!==(t=j[+e])&&void 0!==t?t:10))}})},C=function(e){var t=e.checked,n=void 0!==t&&t,r=e.updateDrawCtrl;return(0,w.jsxs)("label",{className:"hi-wrapper",children:[(0,w.jsx)("input",{type:"checkbox",name:"highlight",checked:n,onChange:function(e){return r({highlight:e.target.checked})}}),(0,w.jsx)("div",{className:"hi-switch",children:(0,w.jsx)(h.Z,{type:"icon-Highlight"})})]})},b=function(e){var t=e.setColor,n=e.color,r=(0,m.iX)(),i=(0,o.Z)(r,1)[0];return(0,w.jsx)("div",{className:"color-select","data-force-light":i,children:v.Qk.map((function(e){return(0,w.jsxs)("label",{children:[(0,w.jsx)("input",{checked:n===e,type:"radio",name:"color",onChange:function(n){return n.target.checked&&t(e)}}),(0,w.jsx)("div",{"data-color":e,className:"circle",style:{backgroundColor:e,borderColor:e}})]},e)}))})}},90858:function(){},64158:function(){}}]);
//# sourceMappingURL=25.29fef8a0.chunk.js.map