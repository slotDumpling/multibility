(this.webpackJsonpmultibility=this.webpackJsonpmultibility||[]).push([[0],{186:function(e,t){},264:function(e,t,n){},265:function(e,t,n){},271:function(e,t){},272:function(e,t){},273:function(e,t){},274:function(e,t){},275:function(e,t){},294:function(e,t,n){},296:function(e,t,n){},481:function(e,t){},483:function(e,t){},484:function(e,t,n){},485:function(e,t,n){},511:function(e,t,n){},512:function(e,t,n){},513:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(34),u=n.n(c),s=(n(264),n(80)),i=n(24),o=n(10),l=n.n(o),d=n(21),j=n(13),b=(n(265),n(62)),f=n(134),p=n(135),O=n(35),h=n(51),v={state:"drawing",strokes:Object(O.a)(),uidStack:Object(O.a)(),undoStack:Object(O.c)(),eraseStack:Object(O.a)(),deleted:Object(O.e)()},m=Object(O.d)(v),x={strokes:[]},g=function(){function e(t,n,r,a){Object(f.a)(this,e),this.immutable=t,this.width=n,this.height=r,this.lastOp=a}return Object(p.a)(e,[{key:"getImmutable",value:function(){return this.immutable}},{key:"getUidStack",value:function(){return this.getImmutable().get("uidStack")}},{key:"getUndoStack",value:function(){return this.getImmutable().get("undoStack")}},{key:"getEraseStack",value:function(){return this.getImmutable().get("eraseStack")}},{key:"getValidEraseStack",value:function(){var e=this.getDeleted(),t=this.getUndoStack();return this.getEraseStack().filter((function(n){var r=n.uid;return!e.has(r)&&!t.has(r)}))}},{key:"getStrokes",value:function(){return this.getImmutable().get("strokes")}},{key:"getValidStrokes",value:function(){var e=this.getDeleted(),t=this.getUndoStack(),n=this.getValidEraseStack();return this.getStrokes().filter((function(r){var a=r.uid;return!e.has(a)&&!t.has(a)&&!n.some((function(e){return e.erased.has(a)}))}))}},{key:"getDeleted",value:function(){return this.getImmutable().get("deleted")}},{key:"getState",value:function(){return this.getImmutable().get("state")}},{key:"getLastStroke",value:function(){return this.getImmutable().get("strokes").last()}}],[{key:"createEmpty",value:function(t,n){return new e(m(),t,n)}},{key:"undo",value:function(t){var n=t.getUidStack().last();if(!n)return t;var r={type:"undo",undoUid:n};return new e(t.getImmutable().set("state","revoking").update("undoStack",(function(e){return e.add(n)})).update("uidStack",(function(e){return e.pop()})),t.width,t.height,r)}},{key:"redo",value:function(t){var n=t.getUndoStack().last();if(!n)return t;var r={type:"redo",redoUid:n};return new e(t.getImmutable().update("undoStack",(function(e){return e.butLast()})).update("uidStack",(function(e){return e.push(n)})),t.width,t.height,r)}},{key:"addStroke",value:function(t,n,r,a){var c={uid:Object(h.v4)(),pathData:n,color:a,lineWidth:r};return e.pushStroke(t,c)}},{key:"pushStroke",value:function(t,n){var r=t.getUndoStack(),a=k(t.getImmutable().set("state","drawing").update("deleted",(function(e){return e.concat(r)})).set("undoStack",Object(O.c)()).update("strokes",(function(e){return e.push(n)})).update("uidStack",(function(e){return e.push(n.uid)}))),c={type:"add",stroke:n};return new e(a,t.width,t.height,c)}},{key:"eraseStrokes",value:function(t,n){var r={uid:Object(h.v4)(),erased:n};return e.pushErase(t,r)}},{key:"pushErase",value:function(t,n){var r=n.uid,a=n.erased,c={uid:r,erased:Object(O.e)(a)},u={type:"erase",erase:n};return new e(t.getImmutable().update("eraseStack",(function(e){return e.push(c)})).update("uidStack",(function(e){return e.push(r)})),t.width,t.height,u)}},{key:"pushUndo",value:function(t,n){return new e(t.getImmutable().update("undoStack",(function(e){return e.add(n)})),t.width,t.height)}},{key:"pushRedo",value:function(t,n){return new e(t.getImmutable().update("undoStack",(function(e){return e.delete(n)})),t.width,t.height)}},{key:"flaten",value:function(e){var t=k(e.getImmutable()),n=t.get("deleted"),r=e.getValidEraseStack().reduce((function(e,t){return e.concat(t.erased)}),Object(O.e)()),a=n.concat(r);return{strokes:t.get("strokes").filter((function(e){return!a.has(e.uid)})).toArray()}}},{key:"loadFromFlat",value:function(t,n,r){var a=t.strokes;return new e(m().set("strokes",Object(O.a)(a)),n,r)}}]),e}();function k(e){var t=e.get("undoStack");return e.update("deleted",(function(e){return e.concat(t)})).set("undoStack",Object(O.c)()).update("uidStack",(function(e){return e.filter((function(e){return!t.has(e)}))}))}function y(){return{uid:Object(h.v4)(),name:"New note ".concat(Date.now()),tagId:"DEFAULT",team:!1,withImg:!1,pages:Object(b.a)({},Object(h.v4)(),{ratio:1.5,state:x})}}var S=n(156),w=n(25),I=n(40),C=n.n(I),N=function(){var e;return function(){if(e)return e;var t=localStorage.getItem("user_id");return t||(t=Object(h.v4)(),localStorage.setItem("user_id",t)),e=t,t}}(),E=function(){var e=localStorage.getItem("USER_NAME");return e||(e="User_"+Object(h.v4)().slice(0,8),localStorage.setItem("USER_NAME",e)),e},L=["#000000","#9ca3af","#64748b","#78716c","#f97316","#eab308","#84cc16","#22c55e","#10b981","#14b8a6","#06b6d4","#0ea5e9","#3b82f6","#6366f1","#8b5cf6","#a855f7","#d946ef","#ec4899","#f43f5e","#ef4444"],U=function(){var e=Math.floor(Math.random()*L.length);return L[e]};function T(){return A.apply(this,arguments)}function A(){return(A=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.a.getItem("ALL_NOTES");case 2:if(!(t=e.sent)){e.next=7;break}return e.abrupt("return",t);case 7:return C.a.setItem("ALL_NOTES",{}),e.abrupt("return",{});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(){return D.apply(this,arguments)}function D(){return(D=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.a.getItem("ALL_TAGS");case 2:if(!(t=e.sent)){e.next=7;break}return e.abrupt("return",t);case 7:return C.a.setItem("ALL_TAGS",{}),e.abrupt("return",{});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e){return P.apply(this,arguments)}function P(){return(P=Object(d.a)(l.a.mark((function e(t){var n,r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(h.v4)(),r={uid:n,name:t,color:U(),notes:[]},e.t0=w.a,e.t1=w.a,e.t2={},e.next=7,R();case 7:return e.t3=e.sent,e.t4=(0,e.t1)(e.t2,e.t3),e.t5={},e.t6=Object(b.a)({},n,r),a=(0,e.t0)(e.t4,e.t5,e.t6),e.next=14,C.a.setItem("ALL_TAGS",a);case 14:return e.abrupt("return",a);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return _.apply(this,arguments)}function _(){return(_=Object(d.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R();case 2:return delete(n=e.sent)[t],e.next=6,C.a.setItem("ALL_TAGS",n);case 6:return e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(e){return G.apply(this,arguments)}function G(){return(G=Object(d.a)(l.a.mark((function e(t){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R();case 2:return n=e.sent,(r=n[t.uid]).name=t.name,r.color=t.color,r.notes=t.notes,e.next=9,C.a.setItem("ALL_TAGS",n);case 9:return e.abrupt("return",n);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e){return B.apply(this,arguments)}function B(){return(B=Object(d.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.a.getItem(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e,t){return K.apply(this,arguments)}function K(){return(K=Object(d.a)(l.a.mark((function e(t,n){var r,a,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T();case 2:return r=e.sent,n.pages,n.pdf,a=Object(S.a)(n,["pages","pdf"]),r[t]=Object(w.a)(Object(w.a)({},r[t]),a),e.next=7,C.a.setItem("ALL_NOTES",r);case 7:return e.next=9,z(t);case 9:if(c=e.sent){e.next=12;break}return e.abrupt("return");case 12:return e.next=14,C.a.setItem(t,Object(w.a)(Object(w.a)({},c),n));case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e){return J.apply(this,arguments)}function J(){return(J=Object(d.a)(l.a.mark((function e(t){var n,r,a,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.uid,r=t.tagId,e.next=3,T();case 3:return(a=e.sent)[n]=t,e.next=7,C.a.setItem("ALL_NOTES",a);case 7:return e.next=9,R();case 9:if(c=e.sent,"DEFAULT"===r){e.next=14;break}return c[r].notes.push(t.uid),e.next=14,C.a.setItem("ALL_TAGS",c);case 14:return e.abrupt("return",{tags:c,allNotes:a});case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(e){return q.apply(this,arguments)}function q(){return(q=Object(d.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.a.setItem(t.uid,t);case 2:return t.pdf,t.pages,n=Object(S.a)(t,["pdf","pages"]),e.next=5,H(n);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(e){return Q.apply(this,arguments)}function Q(){return(Q=Object(d.a)(l.a.mark((function e(t){var n,r,a,c,u,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z(t);case 2:return n=e.sent,e.next=5,T();case 5:return r=e.sent,e.next=8,R();case 8:if(a=e.sent,n){e.next=11;break}return e.abrupt("return",{tags:a,allNotes:r});case 11:return e.next=13,C.a.removeItem(t);case 13:return n.pdf,n.pages,c=Object(S.a)(n,["pdf","pages"]),delete r[t],e.next=17,C.a.setItem("ALL_NOTES",r);case 17:if("DEFAULT"===(u=c.tagId)){e.next=23;break}return s=a[u].notes,a[u].notes=s.filter((function(e){return e!==t})),e.next=23,C.a.setItem("ALL_TAGS",a);case 23:return e.abrupt("return",{tags:a,allNotes:r});case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function X(e,t){return Z.apply(this,arguments)}function Z(){return(Z=Object(d.a)(l.a.mark((function e(t,n){var r,a,c,u,s,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z(t);case 2:return c=e.sent,e.next=5,T();case 5:return u=e.sent,e.next=8,R();case 8:if(s=e.sent,c){e.next=11;break}return e.abrupt("return",{tags:s,allNotes:u});case 11:return i=c.tagId,c.tagId=n,e.next=15,C.a.setItem(t,c);case 15:return u[t].tagId=n,e.next=18,C.a.setItem("ALL_NOTES",u);case 18:return i in s&&(s[i].notes=s[i].notes.filter((function(e){return e!==t}))),null===(r=s[n])||void 0===r||null===(a=r.notes)||void 0===a||a.push(t),e.next=22,C.a.setItem("ALL_TAGS",s);case 22:return e.abrupt("return",{tags:s,allNotes:u});case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ee(e){return te.apply(this,arguments)}function te(){return(te=Object(d.a)(l.a.mark((function e(t){var n,r,a,c,u,s,i,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n={},r=0,a=Object.entries(t);r<a.length;r++)c=Object(j.a)(a[r],2),u=c[0],s=c[1],i=s.ratio,delete(o=s.states)[N()],n[u]={ratio:i,state:{strokes:Object.values(o).flat(1)}};return e.abrupt("return",n);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ne(e,t,n,r){return re.apply(this,arguments)}function re(){return(re=Object(d.a)(l.a.mark((function e(t,n,r,a){var c,u,s,i,o,d;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z(t);case 2:if(!e.sent){e.next=5;break}return e.abrupt("return");case 5:for(c={},u=0,s=Object.entries(r);u<s.length;u++)i=Object(j.a)(s[u],2),o=i[0],d=i[1],c[o]=Object(w.a)(Object(w.a)({},d),{},{state:x});Y(Object(w.a)(Object(w.a)({},n),{},{tagId:"DEFAULT",team:!0,pages:c,pdf:a}));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ae=n(519),ce=n(65),ue=n(255),se=n(521),ie=n(518),oe=n(248),le=n(154),de=n(244),je=n.n(de);function be(e,t){var n=document.createElement("canvas"),r=n.getContext("2d");if(!r)throw new Error("can't get virtual canvas context");return n.width=e,n.height=t,{canvas:n,context:r}}function fe(e){return new Promise((function(t){e.toBlob(t)}))}function pe(e,t,n){return Oe.apply(this,arguments)}function Oe(){return(Oe=Object(d.a)(l.a.mark((function e(t,n,r){var a,c,u,s,i,o,d,j,b;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getPage(n);case 2:return a=e.sent,c=a.getViewport({scale:r}),console.log({viewport:c}),u=c.height,s=c.width,i=u/s,o=be(Math.floor(s*r),Math.floor(u*r)),d=o.canvas,j=o.context,e.next=10,a.render({canvasContext:j,viewport:c,transform:[r,0,0,r,0,0]}).promise;case 10:return e.next=12,fe(d);case 12:if(b=e.sent){e.next=15;break}throw new Error("can't get canvas image blob");case 15:return e.abrupt("return",[b,i]);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function he(e){return ve.apply(this,arguments)}function ve(){return(ve=Object(d.a)(l.a.mark((function e(t){var n,r,a,c,u,s,i,o,d,b,f,p=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=p.length>1&&void 0!==p[1]?p[1]:2,r=p.length>2?p[2]:void 0,e.next=4,le.getDocument(t).promise;case 4:a=e.sent,c=a.numPages,u=[],s=[],i=1;case 9:if(!(i<=c)){e.next=22;break}return e.next=12,pe(a,i,n);case 12:o=e.sent,d=Object(j.a)(o,2),b=d[0],f=d[1],u.push(b),s.push(f),r&&r(Math.floor(i/c*100));case 19:i+=1,e.next=9;break;case 22:return e.abrupt("return",{images:u,ratios:s});case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function me(e,t){return xe.apply(this,arguments)}function xe(){return(xe=Object(d.a)(l.a.mark((function e(t,n){var r,a,c,u,s,i,o=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>2&&void 0!==o[2]?o[2]:2,e.next=3,le.getDocument(t).promise;case 3:if(a=e.sent,c=a.numPages,!(n>c)){e.next=7;break}throw new Error("index out of range");case 7:return e.next=9,pe(a,n+1,r);case 9:return u=e.sent,s=Object(j.a)(u,1),i=s[0],e.abrupt("return",i);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ge(e,t){return ke.apply(this,arguments)}function ke(){return(ke=Object(d.a)(l.a.mark((function e(t,n){var r,a,c,u,s,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=URL.createObjectURL(t),e.next=3,he(r,.5,n);case 3:return a=e.sent,c=a.images,u=a.ratios,URL.revokeObjectURL(r),s={},c.forEach((function(e,t){s[Object(h.v4)()]={image:e,ratio:u[t],state:{strokes:[]}}})),i=t.name.replace(".pdf",""),e.abrupt("return",{uid:Object(h.v4)(),name:i,tagId:"DEFAULT",team:!1,withImg:!0,pdf:t,thumbnail:c[0],pages:s});case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ye(e){return Se.apply(this,arguments)}function Se(){return(Se=Object(d.a)(l.a.mark((function e(t){var n,r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=URL.createObjectURL(t),e.next=3,he(n,.5);case 3:return r=e.sent,a=r.images,URL.revokeObjectURL(n),e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}le.GlobalWorkerOptions.workerSrc=je.a;var we=n(528),Ie=n(529),Ce=n(530),Ne=n(531),Ee=n(532),Le=n(533),Ue=n(77),Te=n.n(Ue),Ae="https://api.slotdumpling.top/paint";function Re(e){return De.apply(this,arguments)}function De(){return(De=Object(d.a)(l.a.mark((function e(t){var n,r,a,c,u,s,i,o,d,j,b,f,p;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Te.a.get("code/".concat(t));case 3:if(n=e.sent,r=n.data,console.log({data:r}),200===r.statusCode){e.next=8;break}return e.abrupt("return",null);case 8:if(c=(a=r).noteId,u=a.pageInfos,s=a.noteInfo,i=void 0,!s.withImg){e.next=22;break}return e.next=13,Te()({method:"GET",url:c,responseType:"blob"});case 13:return o=e.sent,d=o.data,i=new File([d],s.name+".pdf"),e.next=18,ye(i);case 18:for(j=e.sent,b=0,f=0,p=Object.values(u);f<p.length;f++)p[f].image=j[b++];s.thumbnail=j[0];case 22:return e.next=24,ne(c,s,u,i);case 24:return e.abrupt("return",c);case 27:return e.prev=27,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 31:case"end":return e.stop()}}),e,null,[[0,27]])})))).apply(this,arguments)}function Fe(e,t,n){return Pe.apply(this,arguments)}function Pe(){return(Pe=Object(d.a)(l.a.mark((function e(t,n,r){var a,c,u,s,i,o,d;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.uid,c=n.name,u=n.withImg,s=n.pdf,e.prev=1,e.next=4,Te.a.put("create/".concat(t),{userId:N(),pageRecord:r,noteInfo:{uid:a,name:c,withImg:u}});case 4:if(i=e.sent,o=i.data,s&&((d=new FormData).append("noteId",t),d.append("file",s),Te()({method:"POST",url:"upload",data:d,headers:{"Content-Type":"multipart/form-data"}})),201!==o.statusCode){e.next=11;break}return e.abrupt("return",o.code);case 11:return e.abrupt("return",null);case 12:e.next=18;break;case 14:return e.prev=14,e.t0=e.catch(1),console.error(e.t0),e.abrupt("return",null);case 18:case"end":return e.stop()}}),e,null,[[1,14]])})))).apply(this,arguments)}function Me(e,t){return _e.apply(this,arguments)}function _e(){return(_e=Object(d.a)(l.a.mark((function e(t,n){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Te.a.put("pages/".concat(t),{userId:N(),pageRecord:n});case 3:if(r=e.sent,201!==r.data.statusCode){e.next=9;break}return e.abrupt("return",!0);case 9:return e.abrupt("return",!1);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,null,[[0,12]])})))).apply(this,arguments)}function We(e){return Ge.apply(this,arguments)}function Ge(){return(Ge=Object(d.a)(l.a.mark((function e(t){var n,r,a,c,u,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Te.a.get("room/".concat(t));case 3:if(n=e.sent,200!==(r=n.data).statusCode){e.next=13;break}return a=r.teamPages,c=r.code,u=r.noteInfo,e.next=9,ee(a);case 9:return s=e.sent,e.abrupt("return",{code:c,pages:s,info:u});case 13:return e.abrupt("return",null);case 14:e.next=20;break;case 16:return e.prev=16,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 20:case"end":return e.stop()}}),e,null,[[0,16]])})))).apply(this,arguments)}Te.a.defaults.baseURL=Ae,Te.a.interceptors.request.use((function(e){return console.log(e.method,e.url),e}));n(294);var ze=n(3);function Be(e){var t=e.value,n=void 0===t?0:t,a=e.digitNum,c=void 0===a?4:a,u=e.onChange,s=void 0===u?function(){}:u,i=e.onSubmit;function o(e){return 0===e?new Array(c).fill(""):String(e).slice(0,c).padEnd(c,"x").split("").map((function(e){return"x"===e?"":e}))}var l=Object(r.useState)(0),d=Object(j.a)(l,2),b=d[0],f=d[1],p=Object(r.useState)(o(n)),O=Object(j.a)(p,2),h=O[0],v=O[1];function m(){-1===b?x.current.forEach((function(e){return e.blur()})):x.current[b].focus()}Object(r.useEffect)((function(){var e=o(n);v(e)}),[n]),Object(r.useEffect)((function(){var e=h.findIndex((function(e){return""===e}));f(e);var t=Number(h.join(""));t!==n&&(s(t),-1===e&&i(t))}),[h]),Object(r.useEffect)((function(){m()}),[b]);var x=Object(r.useRef)([]);function g(e){if("Backspace"===e.key){var t=Math.max(0,b-1);f(t),v((function(e){var n=e.slice();return n[t]="",n}))}}return Object(r.useEffect)((function(){x.current=x.current.slice(0,c)}),[c]),Object(ze.jsxs)("div",{className:"digit-input",children:[h.map((function(e,t){return Object(ze.jsx)("input",{ref:function(e){e&&(x.current[t]=e)},value:e,pattern:"\\d*",onChange:function(e){return function(e,t){/^[0-9]$/.test(e)&&v((function(n){var r=n.slice();return r[t]=e,r}))}(e.target.value,t)},onKeyUp:g},t)})),Object(ze.jsx)("div",{className:"click-area",onClick:m})]})}var Ve=n(520),Ke=(n(296),n(144)),He=n.n(Ke),Je=n(178),Ye=n.n(Je),qe=Object(r.createContext)({setActive:function(){}});function $e(){return Object(ze.jsxs)("div",{id:"right-tools",children:[Object(ze.jsx)(rt,{}),Object(ze.jsx)(nt,{})]})}var Qe=function(){var e=Object(r.useContext)(qe).setActive,t=ae.a.Item;return Object(ze.jsxs)(ae.a,{onClick:function(t){var n=t.key;return e(n)},children:[Object(ze.jsxs)(t,{children:[Object(ze.jsx)(we.a,{}),Object(ze.jsx)("span",{children:"Load PDF"})]},"pdf"),Object(ze.jsxs)(t,{children:[Object(ze.jsx)(Ie.a,{}),Object(ze.jsx)("span",{children:"My profile"})]},"profile")]})},Xe=function(e){var t=e.children,n=e.title,a=Object(r.useContext)(qe).setActive;return Object(ze.jsxs)("div",{className:"secondary",children:[Object(ze.jsxs)("div",{className:"title",children:[Object(ze.jsx)(ce.a,{type:"text",shape:"circle",onClick:function(){return a("menu")},icon:Object(ze.jsx)(Ce.a,{})}),Object(ze.jsx)(He.a,{level:5,children:n})]}),t]})};function Ze(){var e=Object(r.useState)(!1),t=Object(j.a)(e,2),n=t[0],a=t[1],c=Object(r.useContext)(Lt).tagUid,u=Object(r.useContext)(Ut),s=u.setAllTags,i=u.setAllNotes,o=Object(r.useState)(0),b=Object(j.a)(o,2),f=b[0],p=b[1];function O(){return(O=Object(d.a)(l.a.mark((function e(t){var n,r,u,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("application/pdf"===t.type){e.next=2;break}return e.abrupt("return");case 2:return a(!0),e.next=5,ge(t,p);case 5:return(n=e.sent).tagId=c,e.next=9,Y(n);case 9:return r=e.sent,u=r.tags,o=r.allNotes,s(u),i(o),a(!1),ue.b.success("PDF Loaded"),e.abrupt("return",!1);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(ze.jsx)(Xe,{title:"Load PDF",children:Object(ze.jsxs)(Ye.a,{disabled:n,multiple:!1,action:"#",accept:"application/pdf",beforeUpload:function(e){return O.apply(this,arguments)},children:[Object(ze.jsx)("p",{className:"ant-upload-drag-icon",children:n?Object(ze.jsx)(se.a,{width:48,type:"circle",percent:f}):Object(ze.jsx)(Ne.a,{})}),Object(ze.jsx)("p",{className:"ant-upload-hint",children:"Click or drag a pdf file here."})]})})}var et=function(){var e=E(),t=Object(r.useState)(e),n=Object(j.a)(t,2),a=n[0],c=n[1];return Object(ze.jsx)(Xe,{title:"My profile",children:Object(ze.jsxs)("div",{className:"profile-page",children:[Object(ze.jsx)(ie.a,{prefix:Object(ze.jsx)(Ie.a,{}),value:a,onChange:function(e){return c(e.target.value)}}),Object(ze.jsx)(ce.a,{onClick:function(){!function(e){!!(e=e.trim())&&localStorage.setItem("USER_NAME",e)}(a)},type:"primary",block:!0,children:"Enter"})]})})},tt=function(){var e=Object(r.useState)(100),t=Object(j.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)("menu"),u=Object(j.a)(c,2),s=u[0],i=u[1],o={timeout:300,onEnter:function(e){a(e.clientHeight)},unmountOnExit:!0},l=Object(w.a)(Object(w.a)({},o),{},{classNames:"secondary"});return Object(ze.jsx)(qe.Provider,{value:{setActive:i},children:Object(ze.jsxs)("section",{className:"others-menu",style:{height:n},children:[Object(ze.jsx)(Ve.a,Object(w.a)(Object(w.a)({classNames:"primary",in:"menu"===s},o),{},{children:Object(ze.jsx)(Qe,{})})),Object(ze.jsx)(Ve.a,Object(w.a)(Object(w.a)({in:"pdf"===s},l),{},{children:Object(ze.jsx)(Ze,{})})),Object(ze.jsx)(Ve.a,Object(w.a)(Object(w.a)({in:"profile"===s},l),{},{children:Object(ze.jsx)(et,{})}))]})})},nt=function(){return Object(ze.jsx)(oe.a,{placement:"bottomRight",trigger:"click",content:Object(ze.jsx)(tt,{}),children:Object(ze.jsx)(ce.a,{shape:"circle",icon:Object(ze.jsx)(Ee.a,{})})})};function rt(){var e=Object(r.useState)(0),t=Object(j.a)(e,2),n=t[0],a=t[1],c=Object(i.f)();function u(){return(u=Object(d.a)(l.a.mark((function e(t){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=ue.b.loading("Loading team note...",0),e.next=3,Re(t);case 3:r=e.sent,n(),r?c("/team/".concat(r)):(a(0),ue.b.error("Room doesn't exist."));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(ze.jsx)(oe.a,{placement:"bottomRight",trigger:"click",title:"Join a team note",destroyTooltipOnHide:!0,content:Object(ze.jsx)(Be,{value:n,onChange:a,onSubmit:function(e){return u.apply(this,arguments)}}),children:Object(ze.jsx)(ce.a,{shape:"round",icon:Object(ze.jsx)(Le.a,{}),children:"Team"})})}function at(){var e=Object(r.useContext)(Lt).editing,t=Object(r.useContext)(Ut).setEditing;return Object(ze.jsx)("div",{className:"left-tools",children:Object(ze.jsx)(ce.a,{onClick:function(){t((function(e){return!e}))},type:e?"primary":"text",block:!0,children:e?"Done":"Edit"})})}var ct=n(523),ut=n(524),st=n(534),it=n(152),ot=n(86),lt=n(535),dt=n(536),jt=n(537),bt=n(538),ft=n(539),pt=n(250),Ot=n.n(pt),ht=function(e){var t={backgroundColor:e.color};return Object(ze.jsx)("div",{className:"tag-circle",style:t})};function vt(e){var t=e.noteTag,n=t.uid,a=t.color,c=t.name,u=t.notes,s=Object(r.useContext)(Lt).editing,i=Object(r.useContext)(Ut),o=i.setTagUid,b=i.setAllTags,f=Object(r.useState)(!1),p=Object(j.a)(f,2),O=p[0],h=p[1],v=Object(r.useState)(c),m=Object(j.a)(v,2),x=m[0],g=m[1],k=Object(r.useState)(a),y=Object(j.a)(k,2),S=y[0],w=y[1];function I(){return(I=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M(n);case 2:t=e.sent,o("DEFAULT"),b(t);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(){return(C=Object(d.a)(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={uid:n,name:x,color:S,notes:u},e.next=3,W(t);case 3:r=e.sent,b(r),h(!1);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var N=Object(ze.jsx)(ct.a,{value:S,onSelect:w,children:L.map((function(e){return Object(ze.jsx)(ct.a.Option,{value:e,children:Object(ze.jsx)(ht,{color:e})},e)}))}),E=function(){return Object(ze.jsx)(ie.a,{className:"tag-name-input",addonBefore:N,value:x,onChange:function(e){return g(e.target.value)}})};return Object(ze.jsxs)("div",{className:"menu-item",children:[s&&O?Object(ze.jsxs)(ze.Fragment,{children:[Object(ze.jsx)(ut.a,{title:"Delete this tag?",onConfirm:function(){return I.apply(this,arguments)},placement:"left",okText:"Yes",cancelText:"No",children:Object(ze.jsx)(ce.a,{type:"text",danger:!0,size:"small",icon:Object(ze.jsx)(st.a,{})})}),Object(ze.jsx)(E,{})]}):Object(ze.jsxs)(ze.Fragment,{children:[Object(ze.jsx)(ht,{color:S}),Object(ze.jsx)("span",{className:"tag-name",children:x})]}),s&&O&&Object(ze.jsxs)(ze.Fragment,{children:[Object(ze.jsx)(ce.a,{disabled:""===x,size:"small",type:"link",onClick:function(){return C.apply(this,arguments)},icon:Object(ze.jsx)(it.a,{})}),Object(ze.jsx)(ce.a,{size:"small",type:"text",onClick:function(){g(c),w(a),h(!1)},icon:Object(ze.jsx)(ot.a,{})})]}),s&&!O&&Object(ze.jsx)(ce.a,{size:"small",type:"text",onClick:function(){return h(!0)},icon:Object(ze.jsx)(lt.a,{})})]})}var mt=function(){var e=Object(r.useContext)(Ut).setAllTags;function t(){return(t=Object(d.a)(l.a.mark((function t(n){var r,a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.trim()){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,F(r);case 7:a=t.sent,e(a);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var n=Object(ze.jsx)(Ot.a,{placeholder:"Tag name...",onSearch:function(e){return t.apply(this,arguments)},allowClear:!0,enterButton:Object(ze.jsx)(dt.a,{})});return Object(ze.jsx)("div",{id:"add-tag",children:Object(ze.jsx)(oe.a,{content:n,trigger:"click",placement:"topLeft",destroyTooltipOnHide:!0,children:Object(ze.jsx)(ce.a,{shape:"circle",type:"text",icon:Object(ze.jsx)(jt.a,{})})})})};function xt(){var e=Object(r.useContext)(Lt).allTags,t=Object(r.useContext)(Ut).setTagUid;var n=ae.a.Item;return Object(ze.jsxs)("aside",{children:[Object(ze.jsx)("label",{htmlFor:"aside-checkbox",id:"aside-label",children:Object(ze.jsx)(bt.a,{})}),Object(ze.jsx)("input",{type:"checkbox",id:"aside-checkbox"}),Object(ze.jsxs)("div",{id:"side-wrapper",children:[Object(ze.jsxs)(ae.a,{onClick:function(e){var n=e.key;t(n)},id:"side-menu",defaultSelectedKeys:["DEFAULT"],defaultOpenKeys:["sub1"],mode:"inline",children:[Object(ze.jsx)(n,{children:Object(ze.jsxs)("div",{className:"menu-item",children:[Object(ze.jsx)(ft.a,{id:"all-note-icon"}),Object(ze.jsx)("span",{className:"tag-name",children:"All Notes"})]})},"DEFAULT"),Object.values(e).map((function(e){return Object(ze.jsx)(n,{children:Object(ze.jsx)(vt,{noteTag:e})},e.uid)}))]}),Object(ze.jsx)("footer",{children:Object(ze.jsx)(mt,{})})]})]})}var gt=n(525),kt=n(526),yt=n(540),St=n(541),wt=n(542),It=n.p+"static/media/default.dd551273.png";function Ct(e){var t=e.noteList;return Object(ze.jsx)("div",{id:"note-list",children:t.map((function(e){return Object(ze.jsx)(Nt,{noteInfo:e},e.uid)}))})}var Nt=function(e){var t=e.noteInfo,n=Object(r.useContext)(Lt),a=n.editing,c=n.allTags,u=t.team,i=t.uid,o=t.name,f=t.thumbnail,p=a?"#":"".concat(u?"team":"reader","/").concat(i),O=Object(r.useContext)(Ut),h=O.setAllTags,v=O.setAllNotes,m=Object(r.useState)(o),x=Object(j.a)(m,2),g=x[0],k=x[1],y=Object(r.useState)(!1),S=Object(j.a)(y,2),I=S[0],C=S[1];function N(){return E.apply(this,arguments)}function E(){return(E=Object(d.a)(l.a.mark((function e(){var t,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$(i);case 2:t=e.sent,n=t.tags,r=t.allNotes,h(n),v(r);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var L=Object(r.useMemo)((function(){return f?URL.createObjectURL(f):null}),[f]);Object(r.useEffect)((function(){var e=L||"";return function(){return URL.revokeObjectURL(e)}}),[L]);var U=function(){var e=Object(d.a)(l.a.mark((function e(t){var n,r,a,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.key,e.next=3,X(i,n);case 3:r=e.sent,a=r.tags,c=r.allNotes,h(a),v(c);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),T=function(){var e=ae.a.Item,t=Object(ze.jsxs)(ae.a,{onClick:U,children:[Object(ze.jsx)(e,{children:Object(ze.jsxs)("div",{className:"tag-select",children:[Object(ze.jsx)(ot.a,{className:"none-tag-icon"}),Object(ze.jsx)("span",{children:"None Tag"})]})},"DEFAULT"),Object.values(c).map((function(t){return Object(ze.jsx)(e,{children:Object(ze.jsxs)("div",{className:"tag-select",children:[Object(ze.jsx)(ht,{color:t.color}),Object(ze.jsx)("span",{children:t.name})]})},t.uid)}))]});return Object(ze.jsx)(gt.a,{overlay:t,trigger:["click"],children:Object(ze.jsx)(ce.a,{className:"note-delete",type:"text",icon:Object(ze.jsx)(yt.a,{})})})},A=function(){return Object(ze.jsx)(ut.a,{title:"Delete this note?",onConfirm:N,okText:"Yes",cancelText:"No",children:Object(ze.jsx)(ce.a,{className:"note-delete",type:"text",danger:!0,icon:Object(ze.jsx)(St.a,{})})})};return Object(ze.jsx)(s.b,{to:p,children:Object(ze.jsxs)("div",{className:"list-item",children:[Object(ze.jsxs)("div",{className:"thumbnail-wrapper",children:[Object(ze.jsx)("img",{src:L||It,alt:o,className:"thumbnail".concat(I?" loaded":""),onLoad:function(){return C(!0)}}),u&&Object(ze.jsx)(kt.a,{color:"blue",className:"cloud-icon",children:Object(ze.jsx)(wt.a,{})})]}),a||Object(ze.jsx)("p",{className:"note-name",children:o}),a&&Object(ze.jsxs)(ze.Fragment,{children:[Object(ze.jsx)(ie.a,{className:"note-name-input",value:g,onChange:function(e){return k(e.target.value)},onBlur:function(){V(i,{name:g}),v((function(e){return Object(w.a)(Object(w.a)({},e),{},Object(b.a)({},i,Object(w.a)(Object(w.a)({},e[i]),{},{name:g})))}))}}),Object(ze.jsx)(T,{}),Object(ze.jsx)(A,{})]})]})})},Et=n(543),Lt=Object(r.createContext)({tagUid:"DEFAULT",editing:!1,allNotes:{},allTags:{}}),Ut=Object(r.createContext)({setAllNotes:function(){},setAllTags:function(){},setTagUid:function(){},setEditing:function(){}});function Tt(){var e=Object(r.useState)({}),t=Object(j.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)({}),u=Object(j.a)(c,2),s=u[0],i=u[1],o=Object(r.useState)("DEFAULT"),l=Object(j.a)(o,2),d=l[0],b=l[1],f=Object(r.useState)(!1),p=Object(j.a)(f,2),O=p[0],h=p[1],v=Object(r.useMemo)((function(){return"DEFAULT"===d?{uid:"",name:"All Notes",color:"#000000",notes:Object.keys(n)}:s[d]}),[d,s,n]),m=Object(r.useMemo)((function(){return v.notes.filter((function(e){return e in n})).map((function(e){return n[e]}))}),[v,n]);return Object(r.useEffect)((function(){T().then(a),R().then(i),document.title="Multibility"}),[]),Object(ze.jsx)(Lt.Provider,{value:{tagUid:d,editing:O,allNotes:n,allTags:s},children:Object(ze.jsx)(Ut.Provider,{value:{setAllNotes:a,setAllTags:i,setEditing:h,setTagUid:b},children:Object(ze.jsxs)("div",{id:"menu-container",children:[Object(ze.jsxs)("header",{children:[Object(ze.jsx)(at,{}),Object(ze.jsx)(He.a,{level:4,children:v.name}),Object(ze.jsx)($e,{})]}),Object(ze.jsxs)("main",{children:[Object(ze.jsx)(xt,{}),Object(ze.jsx)(Ct,{noteList:m}),Object(ze.jsx)(At,{})]})]})})})}var At=function(){var e=Object(r.useContext)(Lt).tagUid,t=Object(r.useContext)(Ut),n=t.setAllTags,a=t.setAllNotes;function c(){return(c=Object(d.a)(l.a.mark((function t(){var r,c,u,s;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(r=y()).tagId=e,t.next=4,Y(r);case 4:c=t.sent,u=c.tags,s=c.allNotes,n(u),a(s);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return Object(ze.jsx)(ce.a,{id:"new-note",size:"large",type:"primary",shape:"circle",onClick:function(){return c.apply(this,arguments)},icon:Object(ze.jsx)(Et.a,{})})};var Rt=n(108),Dt=n.n(Rt);n(484);function Ft(e){var t=e.drawState,n=e.onChange,a=void 0===n?function(){}:n,c=e.erasing,u=void 0!==c&&c,s=e.finger,i=void 0!==s&&s,o=e.lineWidth,l=void 0===o?10:o,d=e.color,b=void 0===d?"#000000":d,f=t.width,p=t.height,h=Object(r.useRef)(null),v=Object(r.useRef)(new Dt.a.PaperScope),m=Object(r.useRef)(),x=Object(r.useRef)(1),k=Object(r.useRef)(),y=Object(r.useState)(Object(O.e)()),S=Object(j.a)(y,2),w=S[0],I=S[1];u&&(l=10,b="#eee");var C=function(){v.current.activate(),k.current=new v.current.Path,k.current.strokeColor=new Dt.a.Color(b),k.current.strokeWidth=l,k.current.strokeCap="round",function(){var e,t=null===(e=h.current)||void 0===e?void 0:e.clientWidth;t&&(x.current=f/t)}()},N=function(e){var t;k.current&&(k.current.add(e.point.multiply(x.current)),k.current.smooth(),u&&(null===(t=m.current)||void 0===t||t.children.forEach((function(e){var t;e instanceof Dt.a.Path&&(null===(t=k.current)||void 0===t?void 0:t.intersects(e))&&I((function(t){return t.add(e.name)}))}))))},E=u?function(){k.current&&(a((function(e){return g.eraseStrokes(e,w.toArray())})),I(Object(O.e)()))}:function(){if(k.current){k.current.simplify();var e=k.current.pathData;a((function(t){return g.addStroke(t,e,l,b)}))}},L=function(e){(function(e){return i||function(e){var t=e.touches[0];return"stylus"===(null===t||void 0===t?void 0:t.touchType)}(e)})(e)||e.stopPropagation()};return Object(r.useEffect)((function(){h.current&&(v.current.setup(h.current),v.current.view.viewSize.width=f,v.current.view.viewSize.height=p)}),[]),Object(r.useEffect)((function(){var e;null===(e=k.current)||void 0===e||e.remove()}),[t]),Object(r.useEffect)((function(){v.current.view.onMouseDown=C,v.current.view.onMouseDrag=N,v.current.view.onMouseUp=E})),Object(r.useEffect)((function(){return v.current.activate(),m.current=new v.current.Group,t.getValidStrokes().forEach((function(e){var t,n=e.pathData,r=e.lineWidth,a=e.color,c=e.uid;w.has(c)&&(a+="55");var u=new Dt.a.Path(n);u.strokeWidth=r,u.strokeCap="round",u.strokeColor=new Dt.a.Color(a),u.name=c,null===(t=m.current)||void 0===t||t.addChild(u)})),function(){var e;null===(e=m.current)||void 0===e||e.removeChildren()}}),[t,w]),Object(ze.jsx)("canvas",{"data-paper-hidpi":!1,className:"draw-canvas",ref:h,onTouchStartCapture:L,onTouchMoveCapture:L})}var Pt={states:Object(O.b)(),keys:Object(O.a)(),editStack:Object(O.a)(),undoStack:Object(O.a)()},Mt=Object(O.d)(Pt),_t=function(){function e(t,n){Object(f.a)(this,e),this.immutable=t,this.lastOp=n}return Object(p.a)(e,[{key:"getImmutable",value:function(){return this.immutable}},{key:"getStates",value:function(){return this.getImmutable().get("states")}},{key:"getKeys",value:function(){return this.getImmutable().get("keys")}},{key:"getEditStack",value:function(){return this.getImmutable().get("editStack")}},{key:"getUndoStack",value:function(){return this.getImmutable().get("undoStack")}},{key:"setState",value:function(t,n){var r,a=this.getImmutable().update("states",(function(e){return e.set(t,n)}));return this.getStates().has(t)&&(a=a.update("editStack",(function(e){return e.push(t)}))),n.lastOp&&(r=Object(w.a)(Object(w.a)({},n.lastOp),{},{pageId:t})),new e(a,r)}},{key:"getOneState",value:function(e){return this.getImmutable().get("states").get(e)}},{key:"isUndoable",value:function(){return this.getEditStack().size>0}},{key:"isRedoable",value:function(){return this.getUndoStack().size>0}},{key:"undo",value:function(){if(!this.isUndoable())return this;var t=this.getImmutable().get("editStack").last();if(!t)return this;var n=this.getImmutable().get("states").get(t);if(!n)return this;var r,a=g.undo(n),c=a.lastOp;return c&&(r=Object(w.a)({pageId:t},c)),new e(this.getImmutable().update("editStack",(function(e){return e.pop()})).update("undoStack",(function(e){return e.push(t)})).update("states",(function(e){return e.set(t,a)})),r)}},{key:"redo",value:function(){if(this.isRedoable()){var t=this.getImmutable().get("undoStack").last();if(!t)return this;var n=this.getImmutable().get("states").get(t);if(!n)return this;var r,a=g.redo(n),c=a.lastOp;return c&&(r=Object(w.a)({pageId:t},c)),new e(this.getImmutable().update("undoStack",(function(e){return e.pop()})).update("editStack",(function(e){return e.push(t)})).update("states",(function(e){return e.set(t,a)})),r)}return this}},{key:"pushStroke",value:function(e,t){var n=this.getImmutable().get("states").get(e);if(!n)return this;var r=g.pushStroke(n,t);return this.setState(e,r)}},{key:"pushOperation",value:function(e){var t,n=e.type,r=e.pageId,a=this.getImmutable().get("states").get(r);if(!a)return this;switch(n){case"add":t=g.pushStroke(a,e.stroke);break;case"erase":t=g.pushErase(a,e.erase);break;case"undo":t=g.pushUndo(a,e.undoUid);break;case"redo":t=g.pushRedo(a,e.redoUid)}return this.setState(r,t)}}],[{key:"createEmpty",value:function(){return new e(Mt())}},{key:"createKeyed",value:function(t){return new e(Mt().set("keys",Object(O.a)(t)))}},{key:"createFromList",value:function(t){return new e(Mt().set("keys",Object(O.a)(t.map((function(e){return e[0]})))).set("states",Object(O.b)(t)))}},{key:"createFromPages",value:function(t,n){var r=Object.entries(t);return e.createFromList(r.map((function(e){var t=Object(j.a)(e,2),r=t[0],a=t[1],c=a.state,u=a.ratio;return[r,g.loadFromFlat(c,n,n*u)]})))}}]),e}(),Wt=n(251),Gt=n(257),zt=n(94),Bt=n(517),Vt=n(522),Kt=n(516),Ht=n(527),Jt=n(182),Yt=n(546),qt=n(547),$t=n(548),Qt=n(549),Xt=(n(485),n(252)),Zt=n(544),en=n(545),tn=Object(r.createContext)({code:-2,userList:[]});function nn(){var e,t=null!==(e=Object(i.g)().noteId)&&void 0!==e?e:"",n=Object(r.useState)(),a=Object(j.a)(n,2),c=a[0],u=a[1],s=Object(r.useState)(-2),o=Object(j.a)(s,2),b=o[0],f=o[1],p=Object(r.useState)([]),O=Object(j.a)(p,2),h=O[0],v=O[1],m=Object(r.useState)(function(e){return function(){return Object(Xt.io)(Ae,{autoConnect:!1,query:{userId:N(),userName:E(),noteId:e}})}}(t)),x=Object(j.a)(m,1)[0],g=Object(i.f)();function k(){return y.apply(this,arguments)}function y(){return(y=Object(d.a)(l.a.mark((function e(){var n,r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,We(t);case 2:if(n=e.sent){e.next=6;break}return ue.b.error("Failed loading the team note"),e.abrupt("return",g("/"));case 6:r=n.code,a=n.pages,f(r),u(_t.createFromPages(a,pn));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var S=function(){var e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k();case 2:x.on("push",(function(e){var t=e.operation;u((function(e){return null===e||void 0===e?void 0:e.pushOperation(t)}))})),x.on("joined",(function(e){var t=e.joined,n=e.members,r=t.userId,a=t.userName;v(n),r!==N()&&ue.b.success({icon:Object(ze.jsx)(Zt.a,{}),content:a+" joined room"})})),x.on("leaved",(function(e){var t=e.leaved,n=e.members,r=t.userId,a=t.userName;v(n),r!==N()&&ue.b.warning({icon:Object(ze.jsx)(en.a,{}),content:a+" leaved room"})})),x.connect();case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),w=function(){x.off("connect"),x.off("push"),x.off("joined"),x.off("leaved"),x.disconnect()};Object(r.useEffect)((function(){return S(),w}),[t]);return Object(ze.jsx)(tn.Provider,{value:{code:b,userList:h},children:Object(ze.jsx)(xn,{teamOn:!0,teamStateSet:c,pushOperation:function(e){x.emit("push",{operation:e})}})})}n(511);function rn(e){var t=e.value,n=Object(r.useState)(9999),a=Object(j.a)(n,2),c=a[0],u=a[1],s=String(t>=0?t:c).padStart(4,"0").split("").map((function(e){return Number(e)}));function i(){u(Math.floor(1e4*Math.random()))}return Object(r.useEffect)((function(){if(-1!==t)return u(9999);var e=setTimeout(i,100);return function(){return clearTimeout(e)}}),[t]),Object(ze.jsx)("div",{className:"digit-display ".concat(-2===t?"disabled":""),children:s.map((function(e,t){return Object(ze.jsx)(an,{digit:e},t)}))})}function an(e){var t=e.digit;return t<=9&&t>=0?Object(ze.jsx)("div",{className:"digit",children:t}):Object(ze.jsx)("div",{className:"digit",children:"*"})}var cn=Object(Ht.a)({scriptUrl:"//at.alicdn.com/t/font_3181679_dsms7mr75hd.js"});function un(e){var t=e.setDrawCtrl,n=e.handleUndo,a=e.handleRedo,c=e.instantSave,u=Object(r.useContext)(hn),s=u.erasing,o=u.finger,l=Object(r.useContext)(vn),d=l.saved,j=l.stateSet,b=l.teamOn,f=Object(i.f)(),p=function(e){t((function(t){return Object(w.a)(Object(w.a)({},t),e)}))};return Object(ze.jsxs)("div",{className:"tool-bar",children:[Object(ze.jsxs)("div",{className:"left-buttons",children:[Object(ze.jsx)(ce.a,{type:"text",onClick:function(){return f("/")},icon:Object(ze.jsx)(Jt.a,{}),children:"Back"}),Object(ze.jsx)(ce.a,{type:"text",onClick:c,disabled:d,icon:Object(ze.jsx)(Yt.a,{})})]}),Object(ze.jsxs)("div",{className:"middle-buttons",children:[Object(ze.jsx)(ce.a,{type:"text",icon:Object(ze.jsx)(qt.a,{}),onClick:n,disabled:!(null===j||void 0===j?void 0:j.isUndoable())}),Object(ze.jsx)(ce.a,{className:"redo-button",type:"text",icon:Object(ze.jsx)($t.a,{}),onClick:a,disabled:!(null===j||void 0===j?void 0:j.isRedoable())}),Object(ze.jsx)(sn,{erasing:s,updateDrawCtrl:p}),Object(ze.jsx)(ce.a,{type:s?"default":"text",shape:"circle",onClick:function(){return p({erasing:!0})},icon:Object(ze.jsx)(cn,{type:"icon-eraser"})}),Object(ze.jsx)(ce.a,{type:o?"primary":"text",ghost:o,shape:"circle",onClick:function(){return p({finger:!o})},icon:Object(ze.jsx)(cn,{type:"icon-finger"})})]}),Object(ze.jsxs)("div",{className:"right-buttons",children:[b&&Object(ze.jsx)(jn,{}),b||Object(ze.jsx)(bn,{})]})]})}var sn=a.a.memo((function(e){var t=e.erasing,n=e.updateDrawCtrl;return t?Object(ze.jsx)(ce.a,{type:"text",shape:"circle",onClick:function(){return n({erasing:!1})},icon:Object(ze.jsx)(Qt.a,{})}):Object(ze.jsx)(oe.a,{content:Object(ze.jsx)(on,{updateDrawCtrl:n}),trigger:"click",placement:"bottom",getPopupContainer:function(e){var t;return(null===(t=e.parentElement)||void 0===t?void 0:t.parentElement)||e},children:Object(ze.jsx)(ce.a,{type:"default",shape:"circle",icon:Object(ze.jsx)(Qt.a,{})})})})),on=function(e){var t=e.updateDrawCtrl,n=Object(r.useContext)(hn).lineWidth;return Object(ze.jsxs)("div",{className:"pen-panel",children:[Object(ze.jsx)(Bt.a,{min:5,max:50,value:n,onChange:function(e){return t({lineWidth:e})}}),Object(ze.jsx)(ln,{updateDrawCtrl:t})]})},ln=function(e){var t=e.updateDrawCtrl,n=Object(r.useContext)(hn).color;return Object(ze.jsx)("div",{className:"color-select",children:L.map((function(e){return Object(ze.jsx)("input",{checked:n===e,type:"radio",name:"color",onChange:function(){return t({color:e})},style:{borderColor:e,backgroundColor:e}},e)}))})},dn=function(e){var t=e.userInfo.userName;return Object(ze.jsxs)("div",{className:"user-card",children:[Object(ze.jsx)(Vt.a,{className:"avatar",size:"small",style:{backgroundColor:U()},children:t.slice(0,4)}),Object(ze.jsx)("span",{children:t})]})};function jn(){var e=Object(r.useContext)(tn),t=e.code,n=e.userList,a=Object(ze.jsxs)("div",{className:"team-popover",children:[Object(ze.jsx)(rn,{value:t}),Object(ze.jsx)(Kt.a,{}),Object(ze.jsx)("div",{className:"user-list",children:n.map((function(e){return Object(ze.jsx)(dn,{userInfo:e},e.userId)}))})]});return Object(ze.jsx)(oe.a,{content:a,trigger:"click",placement:"bottomRight",title:"Team info",defaultVisible:!0,getPopupContainer:function(e){var t;return(null===(t=e.parentElement)||void 0===t?void 0:t.parentElement)||e},children:Object(ze.jsx)(ce.a,{shape:"round",icon:Object(ze.jsx)(Le.a,{}),children:"Team"})})}var bn=function(){var e=Object(r.useContext)(mn).createRoom;return Object(ze.jsx)(ut.a,{placement:"bottomRight",title:"Enable team editing?",onConfirm:e,okText:"Yes",cancelText:"No",children:Object(ze.jsx)(ce.a,{shape:"round",icon:Object(ze.jsx)(Le.a,{}),children:"Team"})})},fn=(n(512),n(253)),pn=2e3,On={erasing:!1,finger:!1,even:!0,lineWidth:10,color:"#000000"},hn=Object(r.createContext)(On),vn=Object(r.createContext)({noteId:"",stateSet:void 0,saved:!0,teamOn:!1}),mn=Object(r.createContext)({setSaved:function(){},createRoom:function(){}});function xn(e){var t,n=e.teamOn,a=e.teamStateSet,c=e.pushOperation,u=null!==(t=Object(i.g)().noteId)&&void 0!==t?t:"",s=Object(i.f)(),o=Object(r.useState)(),f=Object(j.a)(o,2),p=f[0],O=f[1],h=Object(r.useState)(),v=Object(j.a)(h,2),m=v[0],x=v[1],k=Object(r.useState)(),y=Object(j.a)(k,2),S=y[0],I=y[1],C=Object(r.useState)(On),N=Object(j.a)(C,2),E=N[0],L=N[1],U=Object(r.useState)(!0),T=Object(j.a)(U,2),A=T[0],R=T[1],D=Object(r.useState)(),F=Object(j.a)(D,2),P=F[0],M=F[1],_=function(){var e=Object(d.a)(l.a.mark((function e(){var t,r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z(u);case 2:if(t=e.sent){e.next=6;break}return ue.b.error("Note not found"),e.abrupt("return",s("/"));case 6:r=t.pages,a=t.pdf,O(r),a&&M(URL.createObjectURL(a)),x(t),I(_t.createFromPages(r,pn)),n&&Me(u,r);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),W=Object(r.useCallback)(Object(Wt.debounce)(function(){var e=Object(d.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V(u,{pages:t});case 2:R(!0);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),1e3),[]),G=W.flush,B=function(){var e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(m&&p){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,Fe(u,m,p);case 4:if(e.sent){e.next=8;break}return ue.b.error("Can't create room."),e.abrupt("return");case 8:return e.next=10,V(u,{team:!0});case 10:s("/team/"+u);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),K=function(){G()};Object(r.useEffect)((function(){return _(),K}),[u,n]),Object(r.useEffect)((function(){m&&(document.title=m.name)}),[m]),Object(Gt.a)(K),Object(r.useEffect)((function(){(null===S||void 0===S?void 0:S.lastOp)&&c&&c(S.lastOp)}),[S]),Object(r.useEffect)((function(){p&&(W(p),R(!1))}),[p]);var H=Object(r.useCallback)((function(e,t){I((function(n){return null===n||void 0===n?void 0:n.setState(e,t)})),O((function(n){if(n)return Object(w.a)(Object(w.a)({},n),{},Object(b.a)({},e,Object(w.a)(Object(w.a)({},n[e]),{},{state:g.flaten(t)})))}))}),[]),J=Object(ze.jsxs)("div",{className:"reader-container",children:[Object(ze.jsx)(un,{setDrawCtrl:L,instantSave:G,handleUndo:function(){I((function(e){return null===e||void 0===e?void 0:e.undo()}))},handleRedo:function(){I((function(e){return null===e||void 0===e?void 0:e.redo()}))}}),null===S||void 0===S?void 0:S.getKeys().map((function(e,t){if(!p)return Object(ze.jsx)(ze.Fragment,{});var n=p[e],r=S.getOneState(e),c=null===a||void 0===a?void 0:a.getOneState(e);return n&&r?Object(ze.jsx)(gn,{drawState:r,teamState:c,updateState:H,imageBlob:n.image,pdfUrl:P,index:t,uid:e},e):Object(ze.jsx)(ze.Fragment,{})})),Object(ze.jsx)(zt.a,{className:"page-loading"})]});return Object(ze.jsx)(hn.Provider,{value:E,children:Object(ze.jsx)(vn.Provider,{value:{noteId:u,stateSet:S,saved:A,teamOn:n},children:Object(ze.jsx)(mn.Provider,{value:{setSaved:R,createRoom:B},children:J})})})}var gn=a.a.memo((function(e){var t=e.imageBlob,n=e.drawState,a=e.teamState,c=e.pdfUrl,u=e.index,s=e.uid,i=e.updateState,o=Object(r.useState)(!1),b=Object(j.a)(o,2),f=b[0],p=b[1],O=Object(r.useState)(),h=Object(j.a)(O,2),v=h[0],m=h[1],x=Object(fn.a)({delay:100}),g=Object(j.a)(x,2),k=g[0],y=g[1],S=Object(r.useMemo)((function(){return t?URL.createObjectURL(t):null}),[t]);Object(r.useEffect)((function(){var e=S||"";return function(){return URL.revokeObjectURL(e)}}),[S]);var w=Object(r.useMemo)((function(){return v?URL.createObjectURL(v):null}),[v]);Object(r.useEffect)((function(){var e=w||"";return function(){return URL.revokeObjectURL(e)}}),[w]);var I=function(){var e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c&&!v){e.next=2;break}return e.abrupt("return");case 2:return e.t0=m,e.next=5,me(c,u);case 5:e.t1=e.sent,(0,e.t0)(e.t1);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.useEffect)((function(){y&&I()}),[y]),Object(ze.jsxs)("div",{className:"pdf-page ".concat(f?"loaded":""),children:[Object(ze.jsx)("img",{ref:k,className:w?void 0:"thumbnail",src:w||S||It,alt:"pdf-page",onLoad:function(){return p(!0)}}),y&&Object(ze.jsxs)("div",{className:"page-draw",children:[a&&Object(ze.jsx)(Ft,{drawState:a}),Object(ze.jsx)(kn,{updateState:i,drawState:n,uid:s})]})]})})),kn=function(e){var t=e.drawState,n=e.uid,a=e.updateState,c=Object(r.useContext)(hn),u=c.erasing,s=c.lineWidth,i=c.color,o=c.finger;return Object(ze.jsx)(Ft,{drawState:t,onChange:function(e){var r=e instanceof g?e:e(t);a(n,r)},erasing:u,lineWidth:s,color:i,finger:o})};function yn(){var e=Object(r.useState)(g.createEmpty(500,500)),t=Object(j.a)(e,2),n=t[0],a=t[1];return Object(ze.jsxs)(ze.Fragment,{children:[Object(ze.jsx)(Ft,{drawState:n,onChange:a,finger:!0}),Object(ze.jsx)("h1",{children:"title"})]})}var Sn=Object(ze.jsx)("main",{style:{padding:"1rem"},children:Object(ze.jsx)("p",{children:"There's nothing here!"})});u.a.render(Object(ze.jsx)(s.a,{children:Object(ze.jsxs)(i.c,{children:[Object(ze.jsx)(i.a,{path:"/",element:Object(ze.jsx)(Tt,{})}),Object(ze.jsx)(i.a,{path:"/reader",children:Object(ze.jsx)(i.a,{path:":noteId",element:Object(ze.jsx)(xn,{teamOn:!1})})}),Object(ze.jsx)(i.a,{path:"/team",children:Object(ze.jsx)(i.a,{path:":noteId",element:Object(ze.jsx)(nn,{})})}),Object(ze.jsx)(i.a,{path:"/test",element:Object(ze.jsx)(yn,{})}),Object(ze.jsx)(i.a,{path:"*",element:Sn})]})}),document.getElementById("root"))}},[[513,1,2]]]);
//# sourceMappingURL=main.d704fba2.chunk.js.map