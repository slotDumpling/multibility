(self.webpackChunkmultibility=self.webpackChunkmultibility||[]).push([[350],{8406:function(e,t,n){"use strict";n.r(t),n.d(t,{PageWrapper:function(){return dt},ReaderMethodCtx:function(){return st},ReaderStateCtx:function(){return ot},default:function(){return ct}});var r=n(3433),a=n(4942),i=n(1413),u=n(5987),o=n(9439),s=n(5861),c=n(7757),l=n.n(c),d=n(2791),f=n(1842),v=n.n(f),p={finger:!0,lineWidth:10,eraserWidth:10,color:"#000000",highlight:!1};function m(){return g.apply(this,arguments)}function g(){return(g=(0,s.Z)(l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v().getItem("DRAW_CTRL");case 2:if(t=e.sent){e.next=7;break}return t=p,e.next=7,v().setItem("DRAW_CTRL",t);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(){return(h=(0,s.Z)(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v().setItem("DRAW_CTRL",t);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var x=n(2198),w=n(5783),Z=n(7309),j=n(9496),y=n(9286),k=n(1694),S=n.n(k),C=n(184),b=function(){var e=(0,d.useContext)(st).addFinalPage,t=(0,d.useContext)(ot).pageOrder,n=Boolean(t&&!t.length);return(0,C.jsx)("div",{className:S()("add-btn-wrapper",{empty:n}),children:(0,C.jsx)(Z.Z,{type:"dashed",icon:(0,C.jsx)(y.Z,{}),block:!0,onClick:e,children:"New page"})})},P=n(6871),D=n(8105),I=n(1570),O=n(7725),N=n(2670);var E=n(5671),R=n(3144),T=n(4124),A={states:(0,T.D5)(),editStack:(0,T.aV)(),undoStack:(0,T.aV)()},M=(0,T.WV)(A),L=function(){function e(t,n){(0,E.Z)(this,e),this.immutable=t,this.lastOp=n}return(0,R.Z)(e,[{key:"getImmutable",value:function(){return this.immutable}},{key:"getStates",value:function(){return this.getImmutable().get("states")}},{key:"getOneState",value:function(e){return this.getStates().get(e)}},{key:"getEditStack",value:function(){return this.getImmutable().get("editStack")}},{key:"getUndoStack",value:function(){return this.getImmutable().get("undoStack")}},{key:"setState",value:function(t,n){var r=this.getOneState(t);if(!r||r===n)return this;var a=this.getImmutable().update("states",(function(e){return e.set(t,n)})).update("editStack",(function(e){return e.push(t)})).delete("undoStack"),u=n.lastOp;return new e(a,u&&(0,i.Z)((0,i.Z)({},u),{},{pageID:t}))}},{key:"addState",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:N.mF,a=n.state,i=n.ratio,u=N.Dw.loadFromFlat(a,r,r*i),o=this.getImmutable().update("states",(function(e){return e.set(t,u)}));return new e(o)}},{key:"deleteState",value:function(t){return new e(this.getImmutable().update("states",(function(e){return e.delete(t)})))}},{key:"isUndoable",value:function(){return this.getEditStack().size>0}},{key:"isRedoable",value:function(){return this.getUndoStack().size>0}},{key:"undo",value:function(){if(!this.isUndoable())return this;var t=this.getEditStack().last(),n=t&&this.getOneState(t);if(!n)return this;var r=N.Dw.undo(n),a=r.lastOp,u=a&&(0,i.Z)({pageID:t},a);return new e(this.getImmutable().update("editStack",(function(e){return e.pop()})).update("undoStack",(function(e){return e.push(t)})).update("states",(function(e){return e.set(t,r)})),u)}},{key:"redo",value:function(){if(!this.isRedoable())return this;var t=this.getUndoStack().last(),n=t&&this.getOneState(t);if(!n)return this;var r=N.Dw.redo(n),a=r.lastOp,u=a&&(0,i.Z)({pageID:t},a);return new e(this.getImmutable().update("undoStack",(function(e){return e.pop()})).update("editStack",(function(e){return e.push(t)})).update("states",(function(e){return e.set(t,r)})),u)}},{key:"getLastDS",value:function(){var e,t=null===(e=this.lastOp)||void 0===e?void 0:e.pageID,n=t&&this.getOneState(t);return n?[t,n]:void 0}}],[{key:"createFromList",value:function(t){return new e(M().set("states",(0,T.D5)(t)))}},{key:"createFromPages",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:N.mF,r=Object.entries(t);return e.createFromList(r.map((function(e){var t=(0,o.Z)(e,2),r=t[0],a=t[1],i=a.state,u=a.ratio;return[r,N.Dw.loadFromFlat(i,n,n*u)]})))}}]),e}();function F(e,t,n){var r=e.indexOf(t),a=e.slice();return-1===r||a.splice(r+1,0,n),a}var W=n(763),B=n(9228),U=n(6272),z=n(6586),V=n(785),K=n(1333),_=n(5594),G=n(4240),H=n(5055),q=n(1511);function J(e){var t=e.value,n=(0,d.useState)(9999),r=(0,o.Z)(n,2),a=r[0],i=r[1],u=String(t>=0?t:a).padStart(4,"0").split("").map((function(e){return Number(e)}));function s(){i(Math.floor(1e4*Math.random()))}return(0,d.useEffect)((function(){if(-1!==t)return i(9999);var e=setTimeout(s,100);return function(){return clearTimeout(e)}}),[t]),(0,C.jsx)("div",{className:S()("digit-display",{disabled:-2===t}),children:u.map((function(e,t){return(0,C.jsx)(Y,{digit:e},t)}))})}function Y(e){var t=e.digit;return t<=9&&t>=0?(0,C.jsx)("div",{className:"digit",children:t}):(0,C.jsx)("div",{className:"digit",children:"*"})}var Q=n(4115),X=n(9951),$=n(140),ee=n(262),te=n(7629),ne=n(3414),re=n(2622),ae=n(711),ie=n(3621),ue=n(5546),oe=(0,n(2721).Z)({scriptUrl:"//at.alicdn.com/t/font_3181679_eb02zt96p4p.js"}),se=n(9798),ce=function(e){var t=e.activeKey,n=e.setActiveKey,r=(0,d.useContext)(ot),a=r.pageOrder,u=r.inviewPages,s=(0,d.useContext)(st),c=s.scrollPage,l=s.saveReorder,f=(0,d.useRef)({}),v=(0,d.useRef)(),p=(0,d.useMemo)((function(){return(null===a||void 0===a?void 0:a.find((function(e){return u.has(e)})))||""}),[a,u]);return(0,d.useEffect)((function(){var e,t,n,r;null===(e=f.current[p])||void 0===e||e.scrollIntoView();var a=(null===(t=f.current[p])||void 0===t?void 0:t.clientHeight)||0,i=(null===(n=v.current)||void 0===n?void 0:n.clientHeight)||0;null===(r=v.current)||void 0===r||r.scrollBy(0,-i/2+a/2)}),[]),(0,C.jsxs)("div",{className:"preview-container",children:[(0,C.jsx)(fe,{activeKey:t,setActiveKey:n}),(0,C.jsx)(se.Z5,{onDragEnd:function(e){var t=e.source,n=e.destination;if(n&&a){var r=t.index,i=n.index,u=a[r],s=function(e,t,n){var r=e.slice(),a=r.splice(t,1),i=(0,o.Z)(a,1)[0];return r.splice(n,0,i),r}(a,r,i);l(s,!0),requestAnimationFrame((function(){return c(u)}))}},children:(0,C.jsx)(se.bK,{droppableId:"droppable",children:function(e){var n=e.droppableProps,r=e.innerRef,u=e.placeholder;return(0,C.jsxs)("div",(0,i.Z)((0,i.Z)({className:"page-list",ref:function(e){r(e),e&&(v.current=e)}},n),{},{children:[null===a||void 0===a?void 0:a.map((function(e,n){return(0,C.jsx)(le,{uid:e,mode:t,pageIndex:n,currpageID:p,refRec:f.current},e)})),u,"ALL"===t&&(0,C.jsx)(b,{})]}))}})})]})},le=function(e){var t=e.uid,n=e.pageIndex,r=e.mode,a=e.currpageID,u=e.refRec,o=(0,d.useContext)(ot),s=o.stateSet,c=o.teamState,l=o.pageRec,f=(0,d.useContext)(st),v=f.scrollPage,p=f.switchPageMarked,m=l&&l[t],g=null===s||void 0===s?void 0:s.getOneState(t),h=null===c||void 0===c?void 0:c.getOnePageState(t);if(!m||!g)return null;if("WRITTEN"===r&&g.isEmpty()&&(!h||h.every((function(e){return e.isEmpty()}))))return null;if("MARKED"===r&&!m.marked)return null;var x=function(e){p(t),e.stopPropagation()},w=a===t,Z="ALL"!==r;return(0,C.jsx)(se._l,{draggableId:t,index:n,isDragDisabled:Z,children:function(e,r){var a=e.innerRef,o=e.draggableProps,s=e.dragHandleProps,c=r.isDragging,l=m.image,d=m.marked;return(0,C.jsxs)("div",(0,i.Z)((0,i.Z)((0,i.Z)({ref:function(e){a(e),e&&(u[t]=e)},className:S()("page",{curr:w,drag:c}),onClick:function(){return v(t)}},o),s),{},{children:[(0,C.jsx)(dt,{uid:t,drawState:g,teamStateMap:h,thumbnail:l,preview:!0}),(0,C.jsx)("span",{className:S()("bookmark",{marked:d}),onClickCapture:x}),(0,C.jsx)("span",{className:"index",children:n+1}),(0,C.jsx)(de,{uid:t})]}))}})},de=function(e){var t=e.uid,n=(0,d.useState)(!1),r=(0,o.Z)(n,2),a=r[0],i=r[1],u=(0,d.useContext)(st),s=u.addPage,c=u.deletePage,l=$.Z.Item,f=(0,C.jsxs)($.Z,{onClick:function(e){var n=e.key,r=e.domEvent;"ADD"===n?s(t):"COPY"===n?s(t,!0):"DELETE"===n&&c(t),r.stopPropagation(),i(!1)},children:[(0,C.jsx)(l,{icon:(0,C.jsx)(y.Z,{}),children:"Add page"},"ADD"),(0,C.jsx)(l,{icon:(0,C.jsx)(ne.Z,{}),children:"Duplicate"},"COPY"),(0,C.jsx)(l,{danger:!0,icon:(0,C.jsx)(re.Z,{}),children:"Delete"},"DELETE")]});return(0,C.jsx)(B.Z,{content:f,trigger:"click",placement:"left",visible:a,onVisibleChange:i,destroyTooltipOnHide:!0,children:(0,C.jsx)("span",{className:"option",onClickCapture:function(e){i((function(e){return!e})),e.stopPropagation()},children:(0,C.jsx)(ae.Z,{})})})},fe=function(e){var t=e.activeKey,n=e.setActiveKey,r=ee.Z.TabPane;return(0,C.jsxs)(ee.Z,{className:"tabs",activeKey:t,onChange:n,tabBarGutter:10,size:"small",centered:!0,children:[(0,C.jsx)(r,{tab:(0,C.jsx)(oe,{type:"icon-uf_paper"})},"ALL"),(0,C.jsx)(r,{tab:(0,C.jsx)(oe,{type:"icon-bookmark2"})},"MARKED"),(0,C.jsx)(r,{tab:(0,C.jsx)(oe,{type:"icon-write"})},"WRITTEN")]})};function ve(){var e=(0,d.useState)(!1),t=(0,o.Z)(e,2),n=t[0],r=t[1],a=(0,d.useState)("ALL"),i=(0,o.Z)(a,2),u=i[0],s=i[1],c={ALL:"All Pages",MARKED:"Bookmarks",WRITTEN:"Notes"}[u];return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(Z.Z,{type:"text",icon:n?(0,C.jsx)(ie.Z,{}):(0,C.jsx)(ue.Z,{}),onClick:function(){return r((function(e){return!e}))}}),(0,C.jsx)(te.Z,{visible:n,onClose:function(){return r(!1)},width:200,title:c,closable:!1,className:"preview-drawer",contentWrapperStyle:{boxShadow:"none"},bodyStyle:{padding:0,overflow:"hidden"},headerStyle:{textAlign:"center",borderTop:"1px solid #eee"},destroyOnClose:!0,children:(0,C.jsx)(ce,{activeKey:u,setActiveKey:s})})]})}var pe=n(6540),me=n(2242),ge=n(5323),he=n(8030),xe=n(446),we=n(5020),Ze=n(62),je=n(6781),ye=n(9784),ke=n(7575),Se=n(501),Ce=n(8272),be=n(4215),Pe=n(1361),De=n(3605),Ie=n(6200),Oe=n(8301);function Ne(e){var t=e.handleUndo,n=e.handleRedo,r=e.instantSave,a=(0,d.useContext)(ot),u=a.saved,o=a.stateSet,c=a.teamOn,f=a.mode,v=a.drawCtrl,p=(0,d.useContext)(st),m=p.setDrawCtrl,g=p.setMode,h=v.finger,x=(0,P.s0)(),w=function(e){m((function(t){return(0,i.Z)((0,i.Z)({},t),e)}))};return(0,d.useEffect)((function(){if("selected"===f)return j.ZP.info({icon:(0,C.jsx)(pe.Z,{style:{display:"none"}}),content:(0,C.jsx)(Me,{setMode:g}),className:"select-message",key:"selected",duration:0}),function(){return j.ZP.destroy("selected")}}),[f]),(0,C.jsxs)("header",{children:[(0,C.jsxs)("div",{className:"left",children:[(0,C.jsx)(Z.Z,{type:"text",onClick:(0,s.Z)(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r();case 2:x("/");case 3:case"end":return e.stop()}}),e)}))),icon:(0,C.jsx)(me.Z,{style:{opacity:.8}})}),(0,C.jsx)("br",{}),(0,C.jsx)(Z.Z,{type:"text",className:"save",onClick:r,disabled:u,icon:(0,C.jsx)(ge.Z,{})})]}),(0,C.jsxs)("div",{className:"middle",children:[(0,C.jsx)(Z.Z,{type:"text",shape:"circle",icon:(0,C.jsx)(he.Z,{}),onClick:t,disabled:!(null!==o&&void 0!==o&&o.isUndoable())}),(0,C.jsx)(Z.Z,{className:"redo",type:"text",shape:"circle",icon:(0,C.jsx)(xe.Z,{}),onClick:n,disabled:!(null!==o&&void 0!==o&&o.isRedoable())}),(0,C.jsx)("br",{}),(0,C.jsx)(Ee,{updateDrawCtrl:w}),(0,C.jsx)(Ae,{updateDrawCtrl:w}),(0,C.jsx)(Z.Z,{type:["select","selected"].includes(f)?"default":"text",shape:"circle",onClick:function(){return g("select")},icon:(0,C.jsx)(we.Z,{})}),(0,C.jsx)(Z.Z,{className:"finger",type:h?"primary":"text",ghost:h,shape:"circle",onClick:function(){return w({finger:!h})},icon:(0,C.jsx)(oe,{type:"icon-finger"})})]}),(0,C.jsxs)("div",{className:"right",children:[c&&(0,C.jsx)(Fe,{}),c||(0,C.jsx)(We,{instantSave:r}),(0,C.jsx)("br",{}),(0,C.jsx)(ve,{})]})]})}var Ee=function(e){var t=e.updateDrawCtrl,n=(0,d.useContext)(ot).mode,r=(0,d.useContext)(st).setMode;return"draw"===n?(0,C.jsx)(B.Z,{content:(0,C.jsx)(Re,{updateDrawCtrl:t}),trigger:"click",placement:"bottom",getPopupContainer:function(e){return e},destroyTooltipOnHide:!0,children:(0,C.jsx)(Z.Z,{type:"default",shape:"circle",icon:(0,C.jsx)(Ze.Z,{})})}):(0,C.jsx)(Z.Z,{type:"text",shape:"circle",onClick:function(){return r("draw")},icon:(0,C.jsx)(Ze.Z,{})})},Re=function(e){var t=e.updateDrawCtrl,n=(0,d.useContext)(ot).drawCtrl,r=n.lineWidth,a=n.highlight,i=(0,d.useState)(r),u=(0,o.Z)(i,2),s=u[0],c=u[1];return(0,C.jsxs)("div",{className:"pen-panel",children:[(0,C.jsxs)("div",{className:"pen-status",children:[(0,C.jsx)(U.Z,{min:5,max:100,value:s,onChange:c,onAfterChange:function(e){return t({lineWidth:e})}}),(0,C.jsx)(Z.Z,{type:a?"primary":"text",ghost:a,shape:"circle",icon:(0,C.jsx)(oe,{type:"icon-Highlight"}),onClick:function(){return t({highlight:!a})}})]}),(0,C.jsx)(Te,{updateDrawCtrl:t})]})},Te=function(e){var t=e.updateDrawCtrl,n=(0,d.useContext)(ot).drawCtrl.color;return(0,C.jsx)("div",{className:"color-select",children:Q.O9.map((function(e){return(0,C.jsxs)("label",{children:[(0,C.jsx)("input",{checked:n===e,type:"radio",name:"color",onChange:function(){return t({color:e})}}),(0,C.jsx)("div",{className:"circle",style:{"--circle-color":e}})]},e)}))})},Ae=function(e){var t=e.updateDrawCtrl,n=(0,d.useContext)(st).setMode,r=(0,d.useContext)(ot),a=r.mode,i=r.drawCtrl.eraserWidth,u=(0,d.useState)(i),s=(0,o.Z)(u,2),c=s[0],l=s[1],f=(0,C.jsx)("div",{className:"pen-panel",children:(0,C.jsx)(U.Z,{min:5,max:100,value:c,onChange:l,onAfterChange:function(e){return t({eraserWidth:e})}})});return"erase"===a?(0,C.jsx)(B.Z,{content:f,trigger:"click",placement:"bottom",getPopupContainer:function(e){return e},destroyTooltipOnHide:!0,children:(0,C.jsx)(Z.Z,{type:"default",shape:"circle",icon:(0,C.jsx)(oe,{type:"icon-eraser"})})}):(0,C.jsx)(Z.Z,{type:"text",shape:"circle",onClick:function(){return n("erase")},icon:(0,C.jsx)(oe,{type:"icon-eraser"})})},Me=function(e){var t=e.setMode,n={type:"text",shape:"round"};return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(Z.Z,(0,i.Z)({icon:(0,C.jsx)(je.Z,{})},n)),(0,C.jsx)(Z.Z,(0,i.Z)({icon:(0,C.jsx)(ye.Z,{})},n)),(0,C.jsx)(Z.Z,(0,i.Z)({danger:!0,icon:(0,C.jsx)(re.Z,{}),onClick:function(){return t("delete")}},n))]})},Le=function(e){var t=e.userInfo,n=e.self,r=void 0!==n&&n,a=t.userName,i=t.userID,u=t.online,s=(0,d.useContext)(q.TeamCtx),c=s.ignores,l=s.setIgnores,f=s.resetIO,v=(0,d.useMemo)((function(){return(0,Q.bM)(i)}),[i]),p=c.has(i)&&!r,m=(0,d.useState)(!1),g=(0,o.Z)(m,2),h=g[0],x=g[1];return(0,C.jsxs)("div",{className:S()("user-item",{online:u}),children:[(0,C.jsx)(z.C,{className:"avatar",size:"small",style:{backgroundColor:v},children:null===a||void 0===a?void 0:a.slice(0,4)}),h||(0,C.jsx)("span",{className:"user-name",children:a}),h&&(0,C.jsx)(H.Z,{autoFocus:!0,className:"rename-input",defaultValue:a,onSearch:function(e){var t=e.trim();if(!t)return x(!1);(0,X.b4)(t),f(),x(!1)},enterButton:(0,C.jsx)(Z.Z,{icon:(0,C.jsx)(ke.Z,{})})}),r?h||(0,C.jsx)(Z.Z,{type:"text",icon:(0,C.jsx)(Se.Z,{}),onClick:function(){return x(!0)}}):(0,C.jsx)(Z.Z,{type:"text",icon:p?(0,C.jsx)(Ce.Z,{}):(0,C.jsx)(be.Z,{}),onClick:function(){l((function(e){return e.has(i)?e.delete(i):e.add(i)}))}})]})};function Fe(){var e=(0,d.useContext)(q.TeamCtx),t=e.code,n=e.userRec,a=e.connected,i=e.loadInfo,u=e.resetIO,o=window.location.href,s=(0,d.useMemo)((function(){var e=Object.values(n),t=(0,X.VN)(),a=n[t],i=a?[a]:[];return i.push.apply(i,(0,r.Z)(e.filter((function(e){var n=e.online,r=e.userID;return n&&r!==t}))).concat((0,r.Z)(e.filter((function(e){var n=e.online,r=e.userID;return!n&&r!==t}))))),i}),[n]),c=s.filter((function(e){return e.online})).length,l=(0,C.jsxs)("div",{className:"team-popover",children:[a||(0,C.jsx)(V.Z,{className:"disconn-alert",message:"Network failed.",icon:(0,C.jsx)(Pe.Z,{}),type:"error",showIcon:!0,banner:!0}),(0,C.jsx)(J,{value:t}),(0,C.jsx)(H.Z,{className:"copy-link code-font",value:o,enterButton:(0,C.jsx)(Z.Z,{icon:(0,C.jsx)(ne.Z,{})}),onSearch:function(){navigator.clipboard.writeText(o),j.ZP.destroy("copy"),j.ZP.success({content:"Share link copied!",icon:(0,C.jsx)(ne.Z,{}),key:"copy"})}}),(0,C.jsx)(K.Z,{}),(0,C.jsx)("div",{className:"user-list",children:s.map((function(e){return(0,C.jsx)(Le,{userInfo:e,self:e.userID===(0,X.VN)()},e.userID)}))})]}),f=(0,C.jsxs)("div",{className:"team-title",children:[(0,C.jsx)("span",{children:"Team info"}),(0,C.jsx)(Z.Z,{shape:"circle",type:"text",size:"small",icon:(0,C.jsx)(De.Z,{}),onClick:function(){i(),u()}})]});return(0,C.jsx)(B.Z,{content:l,trigger:"click",placement:"bottomRight",title:f,defaultVisible:!0,getPopupContainer:function(e){return e},children:(0,C.jsx)(Z.Z,{type:"text",icon:(0,C.jsx)(_.Z,{status:a?"success":"error",count:a?c:"!",size:"small",children:(0,C.jsx)(Ie.Z,{})})})})}var We=function(e){var t=e.instantSave,n=(0,d.useContext)(ot).noteID,r=(0,P.s0)(),a=function(){var e=(0,s.Z)(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t();case 2:return e.next=4,(0,I.r8)(n);case 4:if(e.sent){e.next=8;break}return j.ZP.error("Can't create room."),e.abrupt("return");case 8:return e.next=10,(0,w.SP)(n,{team:!0});case 10:r("/team/"+n);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,C.jsx)(G.Z,{placement:"bottomRight",title:"Enable team editing?",onConfirm:a,okText:"Yes",cancelText:"No",children:(0,C.jsx)(Z.Z,{type:"text",icon:(0,C.jsx)(Oe.Z,{})})})},Be=n(4309);var Ue=n(5955),ze=n(2262),Ve=n.n(ze),Ke=Ve().Point,_e=Ve().Path,Ge=Ve().Group,He=Ve().Shape.Rectangle,qe=Ve().Color,Je=Ve().Size,Ye=Ve().Raster,Qe=function(e){var t=e.drawState,n=e.onChange,a=void 0===n?function(){}:n,i=e.otherStates,u=e.drawCtrl,s=void 0===u?p:u,c=e.mode,l=void 0===c?"draw":c,f=e.setMode,v=void 0===f?function(){}:f,m=e.readonly,g=void 0!==m&&m,h=e.preview,x=void 0!==h&&h,w=e.imgSrc,Z=t.width,j=t.height,y=(0,d.useRef)(null),k=(0,d.useRef)(new(Ve().PaperScope)),S=(0,d.useRef)(),b=(0,d.useRef)(),P=(0,d.useState)(),D=(0,o.Z)(P,2),I=D[0],O=D[1],E=(0,d.useRef)(),R=(0,d.useState)((0,T.l4)()),A=(0,o.Z)(R,2),M=A[0],L=A[1],F=(0,d.useRef)(1),W=s.color,B=s.finger,U=s.lineWidth,z=s.highlight,V=s.eraserWidth,K=function(e){(function(e){return B||function(e){var t=e.touches[0];return"stylus"===(null===t||void 0===t?void 0:t.touchType)}(e)})(e)||e.stopPropagation()},_=function(){var e,t=null===(e=y.current)||void 0===e?void 0:e.clientWidth;t&&(F.current=Z/t)},G=function(e){var t=k.current.view,n=t.center,r=t.zoom,a=k.current.view.projectToView(e).multiply(F.current),i=new Ke(Z,j).divide(2).subtract(n.multiply(r));return a.subtract(i).divide(r)},H=function(e){_(),k.current.activate();var t=G(e.point),n=rt(t);O(n)},q={draw:function(){_(),k.current.activate(),b.current=at(W,U,z)},erase:function(){_(),k.current.activate(),b.current=at("#0003",V)},select:function(e){H(e)},selected:function(e){k.current.activate();var t=G(e.point);I&&(t.isInside(I.strokeBounds)||(H(e),v("select")))},delete:function(){}}[l],J={draw:function(e){if(b.current){k.current.activate();var t=G(e.point);b.current.add(t),b.current.smooth()}},erase:function(e){var t,n=b.current;if(n){k.current.activate();var r=G(e.point);n.add(r),n.smooth();var a=null===(t=S.current)||void 0===t?void 0:t.filter((function(e){return!M.has(e.name)})).filter((function(e){return tt(e,n)})).map((function(e){return e.name}));a&&L((function(e){return e.concat(a)}))}},select:function(e){if(I){k.current.activate();var t=e.delta.multiply(F.current);I.size=I.size.add(new Je(t.x,t.y)),I.position=I.position.add(t.divide(2))}},selected:function(e){var t=E.current;if(I&&t){var n=e.delta.multiply(F.current);I.position=I.position.add(n),t.position=t.position.add(n)}},delete:function(){}}[l],Y={erase:function(){b.current&&(k.current.activate(),b.current.remove(),a((function(e){return N.Dw.eraseStrokes(e,M.toArray())})),L((0,T.l4)()))},draw:function(){if(b.current&&0!==b.current.segments.length&&(b.current.simplify(),0!==b.current.segments.length)){var e=b.current.exportJSON();b.current.remove(),a((function(t){return N.Dw.addStroke(t,e)}))}},select:function(){var e;if(!I||I.size.width<10||I.size.height<10)return O(void 0);k.current.activate();var t=I.strokeBounds;E.current=new Ge,null===(e=S.current)||void 0===e||e.forEach((function(e){var n;e instanceof Ve().Path&&((e.isInside(t)||e.intersects(I))&&(null===(n=E.current)||void 0===n||n.addChild(e)))})),E.current.shadowColor=new qe("#0005"),E.current.shadowBlur=10,v("selected")},selected:function(){},delete:function(){}}[l];(0,d.useEffect)((function(){!function(){if(y.current){k.current.setup(y.current);var e=x?200/Z:1;k.current.view.viewSize=new Je(Z,j).multiply(e),k.current.view.scale(e,new Ke(0,0)),nt(Z,j)}}(),k.current.activate();var e=y.current;return function(){e&&(0,Be.j)(e)}}),[]);(0,d.useEffect)((function(){g||(k.current.view.onMouseDown=q,k.current.view.onMouseDrag=J,k.current.view.onMouseUp=Y)})),(0,d.useEffect)((function(){if(w){var e,t=new Image;return t.src=w,t.onload=function(){var n;k.current.activate(),(e=new Ye(t)).position=k.current.view.center;var r=Z/t.width;e.scale(r),e.sendToBack(),null===(n=e.parent.getItem({name:"BGRECT"}))||void 0===n||n.sendToBack()},function(){var t;null===(t=e)||void 0===t||t.remove()}}}),[w]);var Q=(0,d.useMemo)((function(){return i?N.Dw.mergeStates([t].concat((0,r.Z)(i))):t.getStrokeList()}),[t,i]);(0,d.useEffect)((function(){k.current.activate(),S.current=[];var e=[];return Q.forEach((function(n){var r=t.hasStroke(n.uid)?S.current:e;$e(n,r,M)})),function(){var t;null===(t=S.current)||void 0===t||t.forEach((function(e){return e.remove()})),e.forEach((function(e){return e.remove()}))}}),[Q,M]);var X=function(){var e=E.current;if(e){e.shadowColor=null;var t=e.children;if(t.length){var n=t.map((function(e){return[e.name,e.exportJSON()]}));a((function(e){return N.Dw.mutateStroke(e,n)}))}}};return(0,d.useEffect)((function(){if("select"===l);else{if("selected"===l)return null!==I&&void 0!==I&&I.strokeColor&&(I.strokeColor.alpha/=2),k.current.activate(),X;"delete"===l?(!function(){var e,t=null===(e=E.current)||void 0===e?void 0:e.children;if(null!==t&&void 0!==t&&t.length){var n=t.map((function(e){return e.name}));a((function(e){return N.Dw.eraseStrokes(e,n)}))}}(),v("select"),O(void 0)):O(void 0)}}),[l]),(0,d.useEffect)((function(){if(I){var e=0;return function t(){I.dashOffset+=3,e=requestAnimationFrame(t)}(),function(){I.remove(),cancelAnimationFrame(e)}}}),[I]),(0,Ue.usePinch)((function(e){var t=e.memo,n=e.offset,r=e.last,a=e.first,i=e.origin;if(y.current){var u,s,c,l,d;if(a||!t){_(),k.current.activate();var f=y.current.getBoundingClientRect(),v=f.x,p=f.y;u=1,s=i[0]-v,c=i[1]-p,l=v,d=p}else{var m=(0,o.Z)(t,3);u=m[0];var g=(0,o.Z)(m[1],2);s=g[0],c=g[1];var h=(0,o.Z)(m[2],2);l=h[0],d=h[1]}var x=k.current.view,w=a?1:n[0]/u,Z=F.current,j=i[0]-l,S=i[1]-d,C=new Ke(j,S).multiply(Z),b=x.viewToProject(C);x.scale(w,b);var P=new Ke(j-s,S-c).multiply(Z/n[0]);if(x.translate(P),!r)return[n[0],[j,S],[l,d]];it(x)}}),{scaleBounds:{max:5,min:1},target:y,enabled:!B}),(0,d.useEffect)((function(){var e=function(e){return e.preventDefault()};return document.addEventListener("gesturestart",e),document.addEventListener("gesturechange",e),document.addEventListener("gestureend",e),function(){document.removeEventListener("gesturestart",e),document.removeEventListener("gesturechange",e),document.removeEventListener("gestureend",e)}}),[]),(0,C.jsx)("canvas",{ref:y,className:"draw-canvas","data-paper-hidpi":!1,onTouchStartCapture:K,onTouchMoveCapture:K})},Xe=d.memo(Qe),$e=function(e,t,n){var r=e.pathData,a=e.uid;try{var i=new _e;i.importJSON(r),i.name=a,null!==n&&void 0!==n&&n.has(a)&&(i.opacity/=2),null===t||void 0===t||t.push(i)}catch(u){console.error(u)}},et=function(){var e=new WeakMap;return function(t,n){var r,a=e.get(t);if(a)return a;var i=t.point,u=null===(r=t.previous)||void 0===r?void 0:r.point;if(!u)return[];for(var o=i.subtract(u),s=o.length/n*2,c=[],l=0;l<s;l+=1)c.push(i.subtract(o.multiply(l/s)));return e.set(t,c),c}}(),tt=function(e,t){var n,r=null===(n=t.lastSegment.curve)||void 0===n?void 0:n.strokeBounds;if(!(e instanceof Ve().Path)||null===r||void 0===r||!r.intersects(e.strokeBounds))return!1;if(t.intersects(e))return!0;var a=t.strokeWidth,i=t.lastSegment;return et(i,a).some((function(t){var n,r=null===(n=e.getNearestPoint(t))||void 0===n?void 0:n.getDistance(t);return r&&r<(e.strokeWidth+a)/2}))},nt=function(e,t){var n=new He(new Ke(0,0),new Ke(e,t));return n.fillColor=new qe("#fff"),n.name="BGRECT",n.sendToBack(),n.strokeColor=new qe("#ddd"),n.strokeWidth=1,n},rt=function(e){var t=new He(e,new Je(0,0));return t.strokeColor=new qe("#1890ff"),t.strokeWidth=3,t.dashOffset=0,t.dashArray=[30,20],t},at=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=new _e,a=new qe(e);return n&&(a.alpha/=2,r.blendMode="multiply"),r.strokeColor=a,r.strokeWidth=t,r.strokeJoin="round",r.strokeCap="round",r},it=function(e){var t=function(e){var t=e.center,n=e.zoom,r=e.viewSize,a=r.height,i=r.width,u=i*(n-1)/n/2,o=a*(n-1)/n/2,s=i/2-u,c=i/2+u,l=a/2-o,d=a/2+o,f=t.x,v=t.y;return[f<s?s-f:f>c?c-f:0,v<l?l-v:v>d?d-v:0]}(e),n=(0,o.Z)(t,2),r=n[0],a=n[1],i=10,u=new Ke(r,a).divide(i);!function t(){e.center=e.center.add(u),--i>0&&requestAnimationFrame(t)}()},ut=["pageRec","pdf","pageOrder"],ot=(0,d.createContext)({noteID:"",noteInfo:void 0,stateSet:void 0,teamState:void 0,pageRec:void 0,pageOrder:void 0,saved:!0,teamOn:!1,inviewPages:(0,T.l4)(),refRec:{},drawCtrl:p,mode:"draw"}),st=(0,d.createContext)({scrollPage:function(e){},switchPageMarked:function(e){},setPageState:function(e,t){},addPage:function(e,t){},addFinalPage:function(){},deletePage:function(e){},saveReorder:function(){var e=(0,s.Z)(l().mark((function e(t,n){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),setInviewPages:function(){},setMode:function(){},setDrawCtrl:function(){}});function ct(e){var t,n=e.teamOn,c=null!==(t=(0,P.UO)().noteID)&&void 0!==t?t:"",f=(0,P.s0)(),v=(0,d.useState)(),g=(0,o.Z)(v,2),y=g[0],k=g[1],S=(0,d.useState)(),D=(0,o.Z)(S,2),E=D[0],R=D[1],A=(0,d.useState)(),M=(0,o.Z)(A,2),B=M[0],U=M[1],z=(0,d.useState)(p),V=(0,o.Z)(z,2),K=V[0],_=V[1],G=(0,d.useState)("draw"),H=(0,o.Z)(G,2),J=H[0],Y=H[1],Q=(0,d.useState)(!0),X=(0,o.Z)(Q,2),$=X[0],ee=X[1],te=(0,d.useState)((0,T.l4)()),ne=(0,o.Z)(te,2),re=ne[0],ae=ne[1],ie=(0,d.useState)(),ue=(0,o.Z)(ie,2),oe=ue[0],se=ue[1],ce=(0,d.useState)(!1),le=(0,o.Z)(ce,2),de=le[0],fe=le[1],ve=(0,d.useRef)({}),pe=function(){var e=(0,d.useRef)(!1);return(0,d.useEffect)((function(){return e.current=!0,function(){e.current=!1}}),[]),e}(),me=(0,d.useContext)(q.TeamCtx),ge=me.teamState,he=me.pushOperation,xe=me.teamUpdate,we=me.pushNewPage,Ze=me.pushReorder,je=function(){var e=(0,s.Z)(l().mark((function e(){var t,r,a,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,w.U9)(c);case 2:if(t=e.sent){e.next=6;break}return j.ZP.error("Note not found"),e.abrupt("return",f("/"));case 6:return r=t.pageRec,t.pdf,a=t.pageOrder,i=(0,u.Z)(t,ut),k(r),se(a),R(i),U(L.createFromPages(r)),e.t0=_,e.next=14,m();case 14:e.t1=e.sent,(0,e.t0)(e.t1),fe(!0),n&&(0,I.f1)(c);case 18:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ye=(0,d.useCallback)((0,W.debounce)(function(){var e=(0,s.Z)(l().mark((function e(t){var n,r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=document.querySelector("canvas"),r=null===n||void 0===n?void 0:n.toDataURL(),e.next=4,(0,w.SP)(c,{pageRec:t,thumbnail:r});case 4:pe.current&&ee(!0);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),2e3),[]),ke=ye.flush;(0,d.useLayoutEffect)((function(){return je(),function(){ke()}}),[c,n]),(0,O.x)(ke),(0,d.useEffect)((function(){E&&(document.title=E.name+" - Multibility")}),[E]),(0,d.useEffect)((function(){de&&function(e){h.apply(this,arguments)}(K)}),[K]),(0,d.useEffect)((function(){null!==B&&void 0!==B&&B.lastOp&&he(B.lastOp)}),[B]),(0,d.useEffect)((function(){y&&de&&(ye(y),ee(!1))}),[y]),(0,d.useEffect)((function(){if(xe){var e,t=xe.type,n=xe.pageOrder;if("reorder"===t){if(be(n),!xe.deleted)return;e=function(){be(xe.prevOrder,!0)},j.ZP.warning({content:(0,C.jsxs)(C.Fragment,{children:["One page was deleted.",(0,C.jsx)(Z.Z,{size:"small",type:"link",onClick:function(){j.ZP.destroy("DELETE"),e()},children:"Undo"})]}),key:"DELETE",duration:10})}else if("newPage"===t){be(n);var r=xe.pageID,u=xe.newPage;k((function(e){return e&&(0,i.Z)((0,i.Z)({},e),{},(0,a.Z)({},r,u))})),U((function(e){return null===e||void 0===e?void 0:e.addState(r,u)}))}}}),[xe]);var Se=function(e,t){var n=N.Dw.flaten(t);k((function(t){return t&&(0,i.Z)((0,i.Z)({},t),{},(0,a.Z)({},e,(0,i.Z)((0,i.Z)({},t[e]),{},{state:n})))}))},Ce=(0,d.useCallback)((function(e,t){U((function(n){return null===n||void 0===n?void 0:n.setState(e,t)})),Se(e,t)}),[]),be=function(){var e=(0,s.Z)(l().mark((function e(t){var n,r=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]&&r[1],se(t),e.next=4,(0,w.SP)(c,{pageOrder:t});case 4:return e.next=6,ke();case 6:n&&Ze(t);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Pe=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(oe){var n=t?y&&y[e]:void 0,r=(0,x.D)(n),u=(0,o.Z)(r,2),s=u[0],c=u[1],l=F(oe,e,s);we(l,s,c),be(l),k((function(e){return e&&(0,i.Z)((0,i.Z)({},e),{},(0,a.Z)({},s,c))})),U((function(e){return null===e||void 0===e?void 0:e.addState(s,c)}))}},De=(0,C.jsxs)("div",{className:"reader container",children:[(0,C.jsx)(Ne,{instantSave:ke,handleUndo:function(){U((function(e){if(e){var t=e.undo(),n=t.getLastDS();return n&&Se.apply(void 0,(0,r.Z)(n)),t}}))},handleRedo:function(){U((function(e){if(e){var t=e.redo(),n=t.getLastDS();return n&&Se.apply(void 0,(0,r.Z)(n)),t}}))}}),(0,C.jsxs)("main",{children:[null===oe||void 0===oe?void 0:oe.map((function(e){return(0,C.jsx)(lt,{uid:e},e)})),(0,C.jsx)(b,{})]})]});return(0,C.jsx)(ot.Provider,{value:{noteID:c,noteInfo:E,stateSet:B,teamState:ge,saved:$,teamOn:n,pageRec:y,pageOrder:oe,inviewPages:re,refRec:ve.current,mode:J,drawCtrl:K},children:(0,C.jsx)(st.Provider,{value:{scrollPage:function(e){var t;null===(t=ve.current[e])||void 0===t||t.scrollIntoView()},setInviewPages:ae,switchPageMarked:function(e){var t=y&&y[e];if(t){var n=!Boolean(t.marked);k((function(t){return t&&(0,i.Z)((0,i.Z)({},t),{},(0,a.Z)({},e,(0,i.Z)((0,i.Z)({},t[e]),{},{marked:n})))}))}},setPageState:Ce,addPage:Pe,addFinalPage:function(){var e=(0,W.last)(oe);e&&Pe(e)},deletePage:function(e){var t=null===oe||void 0===oe?void 0:oe.filter((function(t){return t!==e}));t&&be(t,!0)},setMode:Y,setDrawCtrl:_,saveReorder:be},children:De})})}var lt=function(e){var t=e.uid,n=(0,d.useContext)(ot),r=n.pageRec,a=n.stateSet,i=n.teamState,u=(0,d.useContext)(st).setPageState,o=r&&r[t],s=null===a||void 0===a?void 0:a.getOneState(t),c=null===i||void 0===i?void 0:i.getOnePageState(t),l=(0,d.useCallback)((function(e){return u(t,e)}),[t,u]);return o&&s?(0,C.jsx)(dt,{drawState:s,teamStateMap:c,updateState:l,pdfIndex:o.pdfIndex,uid:t}):null},dt=function(e){var t=e.thumbnail,r=e.drawState,a=e.teamStateMap,i=e.updateState,u=e.pdfIndex,c=e.preview,f=void 0!==c&&c,v=e.uid,p=(0,d.useContext)(st).setInviewPages,m=(0,d.useContext)(ot),g=m.refRec,h=m.noteID,x=(0,d.useState)(),w=(0,o.Z)(x,2),Z=w[0],j=w[1],y=(0,D.YD)({delay:100}),k=(0,o.Z)(y,2),S=k[0],b=k[1],P=r.height/r.width,I=(0,d.useCallback)((function(e){e&&(S(e),!f&&g&&(g[v]=e))}),[g]),O=(0,d.useCallback)(function(){var e=!1;return(0,s.Z)(l().mark((function t(){var r,a;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!f&&u&&!e){t.next=2;break}return t.abrupt("return");case 2:return e=!0,t.next=5,Promise.all([n.e(643),n.e(701)]).then(n.bind(n,1176));case 5:return r=t.sent,a=r.getOnePageImage,t.t0=j,t.next=10,a(h,u);case 10:t.t1=t.sent,(0,t.t0)(t.t1);case 12:case"end":return t.stop()}}),t)})))}(),[f,u]);(0,d.useEffect)((function(){f||(b?(O(),p((function(e){return e.add(v)}))):p((function(e){return e.delete(v)})))}),[b,O,f]);var N=(0,d.useContext)(q.TeamCtx).ignores,E=(0,d.useMemo)((function(){return a&&Array.from(a.deleteAll(N).values())}),[a,N]),R=Z||!u,T=b&&R,A=Boolean(f||!R);return(0,C.jsxs)("section",{ref:I,className:"note-page",style:{paddingTop:"".concat(100*P,"%")},children:[T&&(0,C.jsx)(ft,{drawState:r,otherStates:E,updateState:i,imgSrc:Z||t||void 0,preview:f}),A&&(0,C.jsx)("div",{className:"mask"})]})};dt.displayName="PageWrapper";var ft=function(e){var t=e.drawState,n=e.updateState,r=e.otherStates,a=e.preview,i=void 0!==a&&a,u=e.imgSrc,o=(0,d.useContext)(ot),s=o.mode,c=o.drawCtrl,l=(0,d.useContext)(st).setMode,f=(0,d.useCallback)((function(e){if(n){var r=e instanceof N.Dw?e:e(t);n(r)}}),[n,t]);return(0,C.jsx)("div",{className:"page-draw",children:i?(0,C.jsx)(Xe,{drawState:t,otherStates:r,imgSrc:u,readonly:!0,preview:!0}):(0,C.jsx)(Xe,{drawState:t,otherStates:r,onChange:f,imgSrc:u,drawCtrl:c,mode:s,setMode:l})})};ft.displayName="DrawWrapper"},1511:function(e,t,n){"use strict";n.r(t),n.d(t,{TeamCtx:function(){return I},default:function(){return O}});var r=n(5987),a=n(1413),i=n(9439),u=n(5861),o=n(7757),s=n.n(o),c=n(9496),l=n(2791),d=n(1570),f=n(6058),v=n(7962),p=n(6871),m=n(5671),g=n(3144),h=n(4124),x=n(2670),w=["pageID"],Z={pageStates:(0,h.D5)(),pageInfos:(0,h.D5)()},j=(0,h.WV)(Z),y=function(){function e(t){(0,m.Z)(this,e),this.immutable=t}return(0,g.Z)(e,[{key:"getImmutable",value:function(){return this.immutable}},{key:"getPageStates",value:function(){return this.getImmutable().get("pageStates")}},{key:"getPageInfos",value:function(){return this.getImmutable().get("pageInfos")}},{key:"getOneState",value:function(e,t){var n;return null===(n=this.getPageStates().get(e))||void 0===n?void 0:n.get(t)}},{key:"getOnePageState",value:function(e){return this.getPageStates().get(e)}},{key:"getPageRatio",value:function(e){var t;return null===(t=this.getPageInfos().get(e))||void 0===t?void 0:t.ratio}},{key:"includesPage",value:function(e){return this.getPageStates().has(e)}},{key:"setState",value:function(t,n,r){var a=this.getPageStates().get(t);return a?new e(this.getImmutable().update("pageStates",(function(e){return e.set(t,a.set(n,r))}))):this}},{key:"addPage",value:function(t,n){var r=n.ratio;return new e(this.getImmutable().update("pageStates",(function(e){return e.set(t,(0,h.D5)())})).update("pageInfos",(function(e){return e.set(t,{ratio:r})})))}},{key:"pushOperation",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:x.mF,a=e.pageID,i=(0,r.Z)(e,w),u=this.getPageRatio(a);if(!this.includesPage(a)||!u)return this;var o=this.getOneState(a,t)||x.Dw.createEmpty(n,n*u),s=x.Dw.pushOperation(o,i);return this.setState(a,t,s)}},{key:"resetUser",value:function(e,t){for(var n=this,r=0,a=Object.entries(t);r<a.length;r++){var u=(0,i.Z)(a[r],2),o=u[0],s=u[1],c=s.state,l=s.ratio,d=n.getOneState(o,e);if(d){var f=d.width;n=n.setState(o,e,x.Dw.loadFromFlat(c,f,f*l))}}return n}}],[{key:"createFromTeamPages",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:x.mF,r=j();return Object.entries(t).forEach((function(e){var t=(0,i.Z)(e,2),a=t[0],u=t[1],o=u.states,s=u.ratio,c=(0,h.D5)(Object.entries(o).map((function(e){var t=(0,i.Z)(e,2),r=t[0],a=t[1];return[r,x.Dw.loadFromFlat(a,n,n*s)]})));r=r.update("pageStates",(function(e){return e.set(a,c)})).update("pageInfos",(function(e){return e.set(a,{ratio:s})}))})),new e(r)}}]),e}(),k=n(9951),S=n(9609),C=function(e){return function(){return(0,S.io)(d._n,{query:{userID:(0,k.VN)(),userName:(0,k.vW)(),noteID:e}})}},b=n(8406),P=n(184),D=["image","marked"],I=(0,l.createContext)({code:-2,connected:!1,ignores:(0,h.l4)(),userRec:{},teamState:void 0,teamUpdate:void 0,loadInfo:function(){var e=(0,u.Z)(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!1);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),pushOperation:function(e){},pushReorder:function(e){},pushNewPage:function(e,t,n){},setIgnores:function(){},resetIO:function(){}});function O(){var e,t=null!==(e=(0,p.UO)().noteID)&&void 0!==e?e:"",n=(0,l.useState)(),o=(0,i.Z)(n,2),m=o[0],g=o[1],x=(0,l.useState)(-2),w=(0,i.Z)(x,2),Z=w[0],j=w[1],S=(0,l.useState)({}),O=(0,i.Z)(S,2),N=O[0],E=O[1],R=(0,l.useState)((0,h.l4)()),T=(0,i.Z)(R,2),A=T[0],M=T[1],L=(0,l.useState)(C(t)),F=(0,i.Z)(L,2),W=F[0],B=F[1],U=(0,l.useState)(),z=(0,i.Z)(U,2),V=z[0],K=z[1],_=(0,l.useState)(!1),G=(0,i.Z)(_,2),H=G[0],q=G[1],J=(0,l.useState)(!1),Y=(0,i.Z)(J,2),Q=Y[0],X=Y[1],$=(0,p.s0)(),ee=function(){var e=(0,u.Z)(s().mark((function e(){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,d.CD)(t);case 2:if(n=e.sent){e.next=6;break}return c.ZP.error("Failed loading the team note state"),e.abrupt("return",!1);case 6:return g(y.createFromTeamPages(n)),e.abrupt("return",!0);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),te=function(){var e=(0,u.Z)(s().mark((function e(){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,d.dn)(t);case 2:if(n=e.sent){e.next=6;break}return c.ZP.error("Failed loading the team note info"),e.abrupt("return",!1);case 6:return j(n.code),e.abrupt("return",!0);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ne=function(){var e=(0,u.Z)(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c.ZP.loading({content:"Loading team note...",duration:0,key:"TEAM_LOADING"}),e.next=3,te();case 3:if(e.t0=e.sent,!e.t0){e.next=8;break}return e.next=7,ee();case 7:e.t0=e.sent;case 8:if(e.t0){e.next=11;break}return c.ZP.destroy("TEAM_LOADING"),e.abrupt("return",$("/"));case 11:c.ZP.destroy("TEAM_LOADING"),q(!0);case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,l.useEffect)((function(){return W.compress(!0).on("push",(function(e){var t=e.operation,n=e.userID;g((function(e){return null===e||void 0===e?void 0:e.pushOperation(t,n)}))})),W.on("join",(function(e){var t=e.joined,n=e.members,r=t.userID,a=t.userName;E(n),r!==(0,k.VN)()&&(c.ZP.destroy(r),c.ZP.success({content:"".concat(a," joined room"),icon:(0,P.jsx)(f.Z,{}),key:r}))})),W.on("rejoin",(function(e){var t=e.members;return E(t)})),W.on("leave",(function(e){var t=e.leaved,n=e.members,r=t.userID,a=t.userName;if(E(n),r===(0,k.VN)())return W.emit("join");c.ZP.destroy(r),c.ZP.warning({content:"".concat(a," leaved room"),icon:(0,P.jsx)(v.Z,{}),key:r})})),W.on("reorder",(function(e){K((0,a.Z)({type:"reorder"},e))})),W.on("newPage",(function(e){var t=e.pageID,n=e.newPage;g((function(e){return null===e||void 0===e?void 0:e.addPage(t,n)})),K((0,a.Z)({type:"newPage"},e))})),W.on("reset",(function(e){var t=e.userID,n=e.pageRec;t!==(0,k.VN)()&&g((function(e){return null===e||void 0===e?void 0:e.resetUser(t,n)}))})),W.connect(),W.on("connect_error",console.error),W.on("connect",(function(){return X(!0)})),W.on("disconnect",(function(){return X(!1)})),function(){W.removeAllListeners(),W.close()}}),[W]);var re=function(){c.ZP.destroy("TEAM_LOADING")};(0,l.useEffect)((function(){return ne(),re}),[t]);return H?(0,P.jsx)(I.Provider,{value:{code:Z,ignores:A,userRec:N,connected:Q,teamState:m,teamUpdate:V,resetIO:function(){return B(C(t))},loadInfo:te,setIgnores:M,pushReorder:function(e){W.emit("reorder",{pageOrder:e})},pushNewPage:function(e,t,n){g((function(e){return null===e||void 0===e?void 0:e.addPage(t,n)}));n.image,n.marked;var a=(0,r.Z)(n,D);W.emit("newPage",{pageOrder:e,pageID:t,newPage:a})},pushOperation:function(e){W.emit("push",{operation:e})}},children:(0,P.jsx)(b.default,{teamOn:!0})}):null}},4309:function(e,t,n){"use strict";function r(e,t){var n=document.createElement("canvas"),r=n.getContext("2d");if(!r)throw new Error("can't get virtual canvas context");return n.width=e,n.height=t,{canvas:n,context:r}}function a(e){e.width=1,e.height=1;var t=e.getContext("2d");null===t||void 0===t||t.clearRect(0,0,1,1)}n.d(t,{j:function(){return a},v:function(){return r}})},858:function(){},4158:function(){}}]);
//# sourceMappingURL=350.718b59d1.chunk.js.map