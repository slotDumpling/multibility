(self.webpackChunkmultibility=self.webpackChunkmultibility||[]).push([[350],{18406:function(e,t,n){"use strict";n.r(t),n.d(t,{PageWrapper:function(){return $e},ReaderMethodCtx:function(){return qe},ReaderStateCtx:function(){return Je},default:function(){return Ye}});var r=n(93433),a=n(4942),i=n(1413),u=n(45987),o=n(29439),s=n(15861),c=n(87757),l=n.n(c),d=n(72791),f=n(61842),v=n.n(f),p={finger:!1,lineWidth:10,eraserWidth:10,color:"#000000",highlight:!1};function h(){return g.apply(this,arguments)}function g(){return(g=(0,s.Z)(l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v().getItem("DRAW_CTRL");case 2:if(t=e.sent){e.next=7;break}return t=p,e.next=7,v().setItem("DRAW_CTRL",t);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(){return(m=(0,s.Z)(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v().setItem("DRAW_CTRL",t);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var x=n(92198),Z=n(75783),w=n(51570),j=n(16871),y=n(58105),k=n(97725),S=n(82670),C=n(15671),b=n(43144),P=n(24124),D={states:(0,P.D5)(),editStack:(0,P.aV)(),undoStack:(0,P.aV)()},I=(0,P.WV)(D),N=function(){function e(t,n){(0,C.Z)(this,e),this.immutable=t,this.lastOp=n}return(0,b.Z)(e,[{key:"getImmutable",value:function(){return this.immutable}},{key:"getStates",value:function(){return this.getImmutable().get("states")}},{key:"getOneState",value:function(e){return this.getStates().get(e)}},{key:"getEditStack",value:function(){return this.getImmutable().get("editStack")}},{key:"getUndoStack",value:function(){return this.getImmutable().get("undoStack")}},{key:"setState",value:function(t,n){var r=this.getOneState(t);if(!r||r===n)return this;var a=this.getImmutable().update("states",(function(e){return e.set(t,n)})).update("editStack",(function(e){return e.push(t)})).delete("undoStack"),u=n.lastOp;return new e(a,u&&(0,i.Z)((0,i.Z)({},u),{},{pageID:t}))}},{key:"addState",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.mF,a=n.state,i=n.ratio,u=S.Dw.loadFromFlat(a,r,r*i),o=this.getImmutable().update("states",(function(e){return e.set(t,u)}));return new e(o)}},{key:"deleteState",value:function(t){return new e(this.getImmutable().update("states",(function(e){return e.delete(t)})))}},{key:"isUndoable",value:function(){return this.getEditStack().size>0}},{key:"isRedoable",value:function(){return this.getUndoStack().size>0}},{key:"undo",value:function(){if(!this.isUndoable())return this;var t=this.getEditStack().last(),n=t&&this.getOneState(t);if(!n)return this;var r=S.Dw.undo(n),a=r.lastOp,u=a&&(0,i.Z)({pageID:t},a);return new e(this.getImmutable().update("editStack",(function(e){return e.pop()})).update("undoStack",(function(e){return e.push(t)})).update("states",(function(e){return e.set(t,r)})),u)}},{key:"redo",value:function(){if(!this.isRedoable())return this;var t=this.getUndoStack().last(),n=t&&this.getOneState(t);if(!n)return this;var r=S.Dw.redo(n),a=r.lastOp,u=a&&(0,i.Z)({pageID:t},a);return new e(this.getImmutable().update("undoStack",(function(e){return e.pop()})).update("editStack",(function(e){return e.push(t)})).update("states",(function(e){return e.set(t,r)})),u)}},{key:"getLastDS",value:function(){var e,t=null===(e=this.lastOp)||void 0===e?void 0:e.pageID,n=t&&this.getOneState(t);return n?[t,n]:void 0}}],[{key:"createFromList",value:function(t){return new e(I().set("states",(0,P.D5)(t)))}},{key:"createFromPages",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S.mF,r=Object.entries(t);return e.createFromList(r.map((function(e){var t=(0,o.Z)(e,2),r=t[0],a=t[1],i=a.state,u=a.ratio;return[r,S.Dw.loadFromFlat(i,n,n*u)]})))}}]),e}(),O=n(763);function R(e,t,n){var r=e.indexOf(t),a=e.slice();return-1===r||a.splice(r+1,0,n),a}var E=n(87309),M=n(79286),T=n(81694),A=n.n(T),L=n(80184),F=function(){var e=(0,d.useContext)(qe).addFinalPage,t=(0,d.useContext)(Je).pageOrder,n=Boolean(t&&!t.length);return(0,L.jsx)("div",{className:A()("add-btn-wrapper",{empty:n}),children:(0,L.jsx)(E.Z,{type:"dashed",icon:(0,L.jsx)(M.Z,{}),block:!0,onClick:e,children:"Add page"})})};var W=n(49496),U=n(69228),z=n(96272),V=n(76586),K=n(47528),B=n(90785),_=n(91333),H=n(75594),G=n(4240),J=n(95055),q=n(91511);function Y(e){var t=e.value,n=(0,d.useState)(9999),r=(0,o.Z)(n,2),a=r[0],i=r[1],u=String(t>=0?t:a).padStart(4,"0").split("").map((function(e){return Number(e)}));function s(){i(Math.floor(1e4*Math.random()))}return(0,d.useEffect)((function(){if(-1!==t)return i(9999);var e=setTimeout(s,100);return function(){return clearTimeout(e)}}),[t]),(0,L.jsx)("div",{className:A()("digit-display",{disabled:-2===t}),children:u.map((function(e,t){return(0,L.jsx)(Q,{digit:e},t)}))})}function Q(e){var t=e.digit;return t<=9&&t>=0?(0,L.jsx)("div",{className:"digit",children:t}):(0,L.jsx)("div",{className:"digit",children:"*"})}var X=n(74115),$=n(69951),ee=n(61176),te=n(87661),ne=n(67629),re=n(23414),ae=n(82622),ie=n(10711),ue=n(75797),oe=n(53621),se=(0,n(92721).Z)({scriptUrl:"//at.alicdn.com/t/font_3181679_eb02zt96p4p.js"}),ce=n(29798),le=function(e){var t=e.activeKey,n=e.setActiveKey,r=(0,d.useContext)(Je),a=r.pageOrder,u=r.inviewPages,s=(0,d.useContext)(qe),c=s.scrollPage,l=s.saveReorder,f=(0,d.useRef)({}),v=(0,d.useRef)(),p=(0,d.useMemo)((function(){return(null===a||void 0===a?void 0:a.find((function(e){return u.has(e)})))||""}),[a,u]);return(0,d.useEffect)((function(){var e,t,n,r;null===(e=f.current[p])||void 0===e||e.scrollIntoView();var a=(null===(t=f.current[p])||void 0===t?void 0:t.clientHeight)||0,i=(null===(n=v.current)||void 0===n?void 0:n.clientHeight)||0;null===(r=v.current)||void 0===r||r.scrollBy(0,-i/2+a/2)}),[]),(0,L.jsxs)("div",{className:"preview-container",children:[(0,L.jsx)(ve,{activeKey:t,setActiveKey:n}),(0,L.jsx)(ce.Z5,{onDragEnd:function(e){var t=e.source,n=e.destination;if(n&&a){var r=t.index,i=n.index,u=a[r],s=function(e,t,n){var r=e.slice(),a=r.splice(t,1),i=(0,o.Z)(a,1)[0];return r.splice(n,0,i),r}(a,r,i);l(s,!0),requestAnimationFrame((function(){return c(u)}))}},children:(0,L.jsx)(ce.bK,{droppableId:"droppable",children:function(e){var n=e.droppableProps,r=e.innerRef,u=e.placeholder;return(0,L.jsxs)("div",(0,i.Z)((0,i.Z)({className:"page-list",ref:function(e){r(e),e&&(v.current=e)}},n),{},{children:[null===a||void 0===a?void 0:a.map((function(e,n){return(0,L.jsx)(de,{uid:e,mode:t,pageIndex:n,currpageID:p,refRec:f.current},e)})),u,"ALL"===t&&(0,L.jsx)(F,{})]}))}})})]})},de=function(e){var t=e.uid,n=e.pageIndex,r=e.mode,a=e.currpageID,u=e.refRec,o=(0,d.useContext)(Je),s=o.stateSet,c=o.teamState,l=o.pageRec,f=(0,d.useContext)(qe),v=f.scrollPage,p=f.switchPageMarked,h=l&&l[t],g=null===s||void 0===s?void 0:s.getOneState(t),m=null===c||void 0===c?void 0:c.getOnePageState(t);if(!h||!g)return null;if("WRITTEN"===r&&g.isEmpty()&&(!m||m.every((function(e){return e.isEmpty()}))))return null;if("MARKED"===r&&!h.marked)return null;var x=function(e){p(t),e.stopPropagation()},Z=a===t,w="ALL"!==r;return(0,L.jsx)(ce._l,{draggableId:t,index:n,isDragDisabled:w,children:function(e,r){var a=e.innerRef,o=e.draggableProps,s=e.dragHandleProps,c=r.isDragging,l=h.image,d=h.marked;return(0,L.jsxs)("div",(0,i.Z)((0,i.Z)((0,i.Z)({ref:function(e){a(e),e&&(u[t]=e)},className:A()("page",{curr:Z,drag:c}),onClick:function(){return v(t)}},o),s),{},{children:[(0,L.jsx)($e,{uid:t,drawState:g,teamStateMap:m,thumbnail:l,preview:!0}),(0,L.jsx)("span",{className:A()("bookmark",{marked:d}),onClickCapture:x}),(0,L.jsx)("span",{className:"index",children:n+1}),(0,L.jsx)(fe,{uid:t})]}))}})},fe=function(e){var t=e.uid,n=(0,d.useState)(!1),r=(0,o.Z)(n,2),a=r[0],i=r[1],u=(0,d.useContext)(qe),s=u.addPage,c=u.deletePage,l=ee.Z.Item,f=(0,L.jsxs)(ee.Z,{onClick:function(e){var n=e.key,r=e.domEvent;"ADD"===n?s(t):"COPY"===n?s(t,!0):"DELETE"===n&&c(t),r.stopPropagation(),i(!1)},children:[(0,L.jsx)(l,{icon:(0,L.jsx)(M.Z,{}),children:"Add page"},"ADD"),(0,L.jsx)(l,{icon:(0,L.jsx)(re.Z,{}),children:"Duplicate"},"COPY"),(0,L.jsx)(l,{danger:!0,icon:(0,L.jsx)(ae.Z,{}),children:"Delete"},"DELETE")]});return(0,L.jsx)(U.Z,{content:f,trigger:"click",placement:"left",visible:a,onVisibleChange:i,destroyTooltipOnHide:!0,children:(0,L.jsx)("span",{className:"option",onClickCapture:function(e){i((function(e){return!e})),e.stopPropagation()},children:(0,L.jsx)(ie.Z,{})})})},ve=function(e){var t=e.activeKey,n=e.setActiveKey,r=te.Z.TabPane;return(0,L.jsxs)(te.Z,{className:"tabs",activeKey:t,onChange:n,tabBarGutter:10,size:"small",centered:!0,children:[(0,L.jsx)(r,{tab:(0,L.jsx)(se,{type:"icon-uf_paper"})},"ALL"),(0,L.jsx)(r,{tab:(0,L.jsx)(se,{type:"icon-bookmark2"})},"MARKED"),(0,L.jsx)(r,{tab:(0,L.jsx)(se,{type:"icon-write"})},"WRITTEN")]})};function pe(){var e=(0,d.useState)(!1),t=(0,o.Z)(e,2),n=t[0],r=t[1],a=(0,d.useState)("ALL"),i=(0,o.Z)(a,2),u=i[0],s=i[1],c={ALL:"All Pages",MARKED:"Bookmarks",WRITTEN:"Notes"}[u];return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(E.Z,{type:"text",icon:(0,L.jsx)(ue.Z,{}),onClick:function(){return r((function(e){return!e}))}}),(0,L.jsx)(ne.Z,{visible:n,onClose:function(){return r(!1)},width:200,title:c,closeIcon:(0,L.jsx)(oe.Z,{}),bodyStyle:{padding:0,overflow:"hidden"},destroyOnClose:!0,children:(0,L.jsx)(le,{activeKey:u,setActiveKey:s})})]})}var he=n(56540),ge=n(52242),me=n(65323),xe=n(78030),Ze=n(50446),we=n(14988),je=n(62),ye=n(46781),ke=n(79784),Se=n(98272),Ce=n(24215),be=n(17973),Pe=n(23605),De=n(56200),Ie=n(18301);function Ne(e){var t=e.handleUndo,n=e.handleRedo,r=e.instantSave,a=(0,d.useContext)(Je),u=a.saved,o=a.stateSet,s=a.teamOn,c=a.mode,l=a.drawCtrl,f=(0,d.useContext)(qe),v=f.setDrawCtrl,p=f.setMode,h=l.finger,g=(0,j.s0)(),m=function(e){v((function(t){return(0,i.Z)((0,i.Z)({},t),e)}))};return(0,d.useEffect)((function(){if("selected"===c)return W.ZP.info({className:"select-message",icon:(0,L.jsx)(he.Z,{style:{display:"none"}}),content:(0,L.jsx)(Te,{setMode:p}),duration:0,key:"selected"}),function(){return W.ZP.destroy("selected")}}),[c]),(0,L.jsxs)("header",{children:[(0,L.jsxs)("div",{className:"left",children:[(0,L.jsx)(E.Z,{type:"text",onClick:function(){return g("/")},icon:(0,L.jsx)(ge.Z,{style:{opacity:.8}})}),(0,L.jsx)("br",{}),(0,L.jsx)(E.Z,{type:"text",className:"save",onClick:r,disabled:u,icon:(0,L.jsx)(me.Z,{})})]}),(0,L.jsxs)("div",{className:"middle",children:[(0,L.jsx)(E.Z,{type:"text",shape:"circle",icon:(0,L.jsx)(xe.Z,{}),onClick:t,disabled:!(null!==o&&void 0!==o&&o.isUndoable())}),(0,L.jsx)(E.Z,{className:"redo",type:"text",shape:"circle",icon:(0,L.jsx)(Ze.Z,{}),onClick:n,disabled:!(null!==o&&void 0!==o&&o.isRedoable())}),(0,L.jsx)("br",{}),(0,L.jsx)(Oe,{updateDrawCtrl:m}),(0,L.jsx)(Me,{updateDrawCtrl:m}),(0,L.jsx)(E.Z,{type:["select","selected"].includes(c)?"default":"text",shape:"circle",onClick:function(){return p("select")},icon:(0,L.jsx)(we.Z,{})}),(0,L.jsx)(E.Z,{className:"finger",type:h?"primary":"text",ghost:h,shape:"circle",onClick:function(){return m({finger:!h})},icon:(0,L.jsx)(se,{type:"icon-finger"})})]}),(0,L.jsxs)("div",{className:"right",children:[s&&(0,L.jsx)(Le,{}),s||(0,L.jsx)(Fe,{instantSave:r}),(0,L.jsx)("br",{}),(0,L.jsx)(pe,{})]})]})}var Oe=function(e){var t=e.updateDrawCtrl,n=(0,d.useContext)(Je).mode,r=(0,d.useContext)(qe).setMode;return"draw"===n?(0,L.jsx)(U.Z,{content:(0,L.jsx)(Re,{updateDrawCtrl:t}),trigger:"click",placement:"bottom",getPopupContainer:function(e){return e},destroyTooltipOnHide:!0,children:(0,L.jsx)(E.Z,{type:"default",shape:"circle",icon:(0,L.jsx)(je.Z,{})})}):(0,L.jsx)(E.Z,{type:"text",shape:"circle",onClick:function(){return r("draw")},icon:(0,L.jsx)(je.Z,{})})},Re=function(e){var t=e.updateDrawCtrl,n=(0,d.useContext)(Je).drawCtrl,r=n.lineWidth,a=n.highlight,i=(0,d.useState)(r),u=(0,o.Z)(i,2),s=u[0],c=u[1];return(0,L.jsxs)("div",{className:"pen-panel",children:[(0,L.jsxs)("div",{className:"pen-status",children:[(0,L.jsx)(z.Z,{min:5,max:100,value:s,onChange:c,onAfterChange:function(e){return t({lineWidth:e})}}),(0,L.jsx)(E.Z,{type:a?"primary":"text",ghost:a,shape:"circle",icon:(0,L.jsx)(se,{type:"icon-Highlight"}),onClick:function(){return t({highlight:!a})}})]}),(0,L.jsx)(Ee,{updateDrawCtrl:t})]})},Ee=function(e){var t=e.updateDrawCtrl,n=(0,d.useContext)(Je).drawCtrl.color;return(0,L.jsx)("div",{className:"color-select",children:X.O9.map((function(e){return(0,L.jsxs)("label",{children:[(0,L.jsx)("input",{checked:n===e,type:"radio",name:"color",onChange:function(){return t({color:e})}}),(0,L.jsx)("div",{className:"circle",style:{"--circle-color":e}})]},e)}))})},Me=function(e){var t=e.updateDrawCtrl,n=(0,d.useContext)(qe).setMode,r=(0,d.useContext)(Je),a=r.mode,i=r.drawCtrl.eraserWidth,u=(0,d.useState)(i),s=(0,o.Z)(u,2),c=s[0],l=s[1],f=(0,L.jsx)("div",{className:"pen-panel",children:(0,L.jsx)(z.Z,{min:5,max:100,value:c,onChange:l,onAfterChange:function(e){return t({eraserWidth:e})}})});return"erase"===a?(0,L.jsx)(U.Z,{content:f,trigger:"click",placement:"bottom",getPopupContainer:function(e){return e},destroyTooltipOnHide:!0,children:(0,L.jsx)(E.Z,{type:"default",shape:"circle",icon:(0,L.jsx)(se,{type:"icon-eraser"})})}):(0,L.jsx)(E.Z,{type:"text",shape:"circle",onClick:function(){return n("erase")},icon:(0,L.jsx)(se,{type:"icon-eraser"})})},Te=function(e){var t=e.setMode,n={type:"text",shape:"round"};return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(E.Z,(0,i.Z)({icon:(0,L.jsx)(ye.Z,{})},n)),(0,L.jsx)(E.Z,(0,i.Z)({icon:(0,L.jsx)(ke.Z,{})},n)),(0,L.jsx)(E.Z,(0,i.Z)({danger:!0,icon:(0,L.jsx)(ae.Z,{}),onClick:function(){return t("delete")}},n))]})},Ae=function(e){var t=e.userInfo,n=e.self,r=void 0!==n&&n,a=t.userName,i=t.userID,u=t.online,o=(0,d.useContext)(q.TeamCtx),s=o.ignores,c=o.setIgnores,l=(0,d.useMemo)((function(){return(0,X.bM)(i)}),[i]),f=s.has(i)&&!r;return(0,L.jsxs)("div",{className:"user-item",children:[(0,L.jsx)(V.C,{className:"avatar",size:"small",style:{backgroundColor:l,opacity:u?1:.5},children:a.slice(0,4)}),(0,L.jsx)("span",{className:"user-name",children:a}),r?(0,L.jsx)(K.Z,{className:"me-tag",children:"Me"}):(0,L.jsx)(E.Z,{type:"text",icon:f?(0,L.jsx)(Se.Z,{}):(0,L.jsx)(Ce.Z,{}),onClick:function(){c((function(e){return e.has(i)?e.delete(i):e.add(i)}))}})]})};function Le(){var e=(0,d.useContext)(q.TeamCtx),t=e.code,n=e.userRec,a=e.loadInfo,i=e.connected,u=window.location.href,o=(0,d.useMemo)((function(){var e=Object.values(n),t=(0,$.VN)(),a=n[t],i=a?[a]:[];return i.push.apply(i,(0,r.Z)(e.filter((function(e){var n=e.online,r=e.userID;return n&&r!==t}))).concat((0,r.Z)(e.filter((function(e){var n=e.online,r=e.userID;return!n&&r!==t}))))),i}),[n]),s=o.filter((function(e){return e.online})).length,c=(0,L.jsxs)("div",{className:"team-popover",children:[i||(0,L.jsx)(B.Z,{className:"disconn-alert",message:"Network failed.",icon:(0,L.jsx)(be.Z,{}),type:"error",showIcon:!0,banner:!0}),(0,L.jsx)(Y,{value:t}),(0,L.jsx)(J.Z,{className:"copy-link code-font",value:u,enterButton:(0,L.jsx)(E.Z,{icon:(0,L.jsx)(re.Z,{})}),onSearch:function(){navigator.clipboard.writeText(u),W.ZP.destroy("copy"),W.ZP.success({content:"Share link copied!",icon:(0,L.jsx)(re.Z,{}),key:"copy"})}}),(0,L.jsx)(_.Z,{}),(0,L.jsx)("div",{className:"user-list",children:o.map((function(e){return(0,L.jsx)(Ae,{userInfo:e,self:e.userID===(0,$.VN)()},e.userID)}))})]}),l=(0,L.jsxs)("div",{className:"team-title",children:[(0,L.jsx)("span",{children:"Team info"}),(0,L.jsx)(E.Z,{shape:"circle",type:"text",size:"small",icon:(0,L.jsx)(Pe.Z,{}),onClick:a})]});return(0,L.jsx)(U.Z,{content:c,trigger:"click",placement:"bottomRight",title:l,defaultVisible:!0,getPopupContainer:function(e){return e},children:(0,L.jsx)(E.Z,{type:"text",icon:(0,L.jsx)(H.Z,{status:i?"success":"error",count:i?s:"!",size:"small",children:(0,L.jsx)(De.Z,{})})})})}var Fe=function(e){var t=e.instantSave,n=(0,d.useContext)(Je).noteID,r=(0,j.s0)(),a=function(){var e=(0,s.Z)(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t();case 2:return e.next=4,(0,w.r8)(n);case 4:if(e.sent){e.next=8;break}return W.ZP.error("Can't create room."),e.abrupt("return");case 8:return e.next=10,(0,Z.SP)(n,{team:!0});case 10:r("/team/"+n);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,L.jsx)(G.Z,{placement:"bottomRight",title:"Enable team editing?",onConfirm:a,okText:"Yes",cancelText:"No",children:(0,L.jsx)(E.Z,{type:"text",icon:(0,L.jsx)(Ie.Z,{})})})},We=n(64309);var Ue=n(12262),ze=n.n(Ue),Ve=function(e){var t=e.drawState,n=e.onChange,r=void 0===n?function(){}:n,a=e.otherStates,i=e.drawCtrl,u=void 0===i?p:i,s=e.mode,c=void 0===s?"draw":s,l=e.setMode,f=void 0===l?function(){}:l,v=e.readonly,h=void 0!==v&&v,g=e.preview,m=void 0!==g&&g,x=e.imgSrc,Z=t.width,w=t.height,j=(0,d.useRef)(null),y=(0,d.useRef)(new(ze().PaperScope)),k=(0,d.useRef)(),C=(0,d.useRef)(1),b=(0,d.useRef)(),D=(0,d.useState)(),I=(0,o.Z)(D,2),N=I[0],O=I[1],R=(0,d.useRef)(),E=(0,d.useState)((0,P.l4)()),M=(0,o.Z)(E,2),T=M[0],A=M[1],F=u.color,W=u.finger,U=u.lineWidth,z=u.highlight,V=u.eraserWidth,K=function(){var e,t=null===(e=j.current)||void 0===e?void 0:e.clientWidth;t&&(C.current=Z/t)},B=function(e){K(),y.current.activate();var t=e.point.multiply(C.current),n=new(ze().Shape.Rectangle)(t,new(ze().Size)(0,0));n.strokeColor=new(ze().Color)("#1890ff"),n.strokeWidth=3,n.dashOffset=0,n.dashArray=[30,20],O(n)},_={draw:function(){K(),y.current.activate(),b.current=new y.current.Path;var e=new(ze().Color)(F);z&&(e.alpha/=2,b.current.blendMode="multiply"),b.current.strokeColor=e,b.current.strokeWidth=U,b.current.strokeJoin="round",b.current.strokeCap="round"},erase:function(){K(),y.current.activate(),b.current=new y.current.Path;var e=new(ze().Color)("#0003");b.current.strokeColor=e,b.current.strokeWidth=V,b.current.strokeJoin="round",b.current.strokeCap="round"},select:function(e){B(e)},selected:function(e){y.current.activate();var t=e.point.multiply(C.current);N&&(t.isInside(N.strokeBounds)||(B(e),f("select")))},delete:function(){}}[c],H={draw:function(e){if(b.current){y.current.activate();var t=e.point.multiply(C.current);b.current.add(t),b.current.smooth()}},erase:function(e){var t,n=b.current;if(n){y.current.activate();var r=e.point.multiply(C.current);n.add(r),n.smooth();var a=null===(t=k.current)||void 0===t?void 0:t.filter((function(e){return!T.has(e.name)})).filter((function(t){return He(t,n,e,C.current,V)})).map((function(e){return e.name}));a&&A((function(e){return e.concat(a)}))}},select:function(e){if(N){y.current.activate();var t=e.delta.multiply(C.current);N.size=N.size.add(new(ze().Size)(t.x,t.y)),N.position=N.position.add(t.divide(2))}},selected:function(e){var t=R.current;if(N&&t){var n=e.delta.multiply(C.current);N.position=N.position.add(n),t.position=t.position.add(n)}},delete:function(){}}[c],G={erase:function(){b.current&&(y.current.activate(),b.current.remove(),r((function(e){return S.Dw.eraseStrokes(e,T.toArray())})),A((0,P.l4)()))},draw:function(){if(b.current&&0!==b.current.segments.length&&(b.current.simplify(),0!==b.current.segments.length)){var e=b.current.exportJSON();b.current.remove(),r((function(t){return S.Dw.addStroke(t,e)}))}},select:function(){var e;if(!N||N.size.width<10||N.size.height<10)return O(void 0);y.current.activate();var t=N.strokeBounds;R.current=new(ze().Group),null===(e=k.current)||void 0===e||e.forEach((function(e){var n;e instanceof ze().Path&&((e.isInside(t)||e.intersects(N))&&(null===(n=R.current)||void 0===n||n.addChild(e)))})),f("selected")},selected:function(){},delete:function(){}}[c];(0,d.useEffect)((function(){!function(){if(j.current){y.current.setup(j.current);var e=m?200/Z:1;y.current.view.viewSize.width=Z*e,y.current.view.viewSize.height=w*e,y.current.view.scale(e,new(ze().Point)(0,0))}}(),y.current.activate();var e=j.current;return function(){e&&(0,We.j)(e)}}),[]);(0,d.useEffect)((function(){h||(y.current.view.onMouseDown=_,y.current.view.onMouseDrag=H,y.current.view.onMouseUp=G)}));var J=function(e){(function(e){return W||function(e){var t=e.touches[0];return"stylus"===(null===t||void 0===t?void 0:t.touchType)}(e)})(e)||e.stopPropagation()};(0,d.useEffect)((function(){if(x){var e,t=new Image;return t.src=x,t.onload=function(){y.current.activate(),(e=new(ze().Raster)(t)).position=y.current.view.center;var n=Z/t.width;e.scale(n),e.sendToBack()},function(){var t;null===(t=e)||void 0===t||t.remove()}}}),[x]),(0,d.useEffect)((function(){return y.current.activate(),k.current=[],t.getValidStrokes().forEach((function(e){Be(e,k.current,T)})),function(){var e;return null===(e=k.current)||void 0===e?void 0:e.forEach((function(e){return e.remove()}))}}),[t,T]),(0,d.useEffect)((function(){y.current.activate();var e=[];return null===a||void 0===a||a.forEach((function(t){t.getValidStrokes().forEach((function(t){Be(t,e)}))})),function(){return e.forEach((function(e){return e.remove()}))}}),[a]);var q=function(){var e,t=null===(e=R.current)||void 0===e?void 0:e.children;if(null!==t&&void 0!==t&&t.length){var n=t.map((function(e){return[e.name,e.exportJSON()]}));r((function(e){return S.Dw.mutateStroke(e,n)}))}};return(0,d.useEffect)((function(){if("select"===c);else{if("selected"===c)return null!==N&&void 0!==N&&N.strokeColor&&(N.strokeColor.alpha/=2),y.current.activate(),q;"delete"===c?(!function(){var e,t=null===(e=R.current)||void 0===e?void 0:e.children;if(null!==t&&void 0!==t&&t.length){var n=t.map((function(e){return e.name}));r((function(e){return S.Dw.eraseStrokes(e,n)}))}}(),f("select"),O(void 0)):O(void 0)}}),[c]),(0,d.useEffect)((function(){if(N){var e=0;return function t(){e=requestAnimationFrame((function(){N.dashOffset+=3,t()}))}(),function(){N.remove(),cancelAnimationFrame(e)}}}),[N]),(0,L.jsx)("canvas",{ref:j,className:"draw-canvas","data-paper-hidpi":!1,onTouchStartCapture:J,onTouchMoveCapture:J})},Ke=d.memo(Ve),Be=function(e,t,n){var r=e.pathData,a=e.uid;try{var i=new(ze().Path);i.importJSON(r),i.name=a,null!==n&&void 0!==n&&n.has(a)&&(i.opacity/=2),null===t||void 0===t||t.push(i)}catch(u){console.error(u)}},_e=function(){var e=new WeakMap;return function(t,n,r){var a=e.get(t);if(a)return a;for(var i=t.point.multiply(n),u=t.delta.multiply(n),o=u.length/r*2,s=[],c=0;c<o;c+=1)s.push(i.subtract(u.multiply(c/o)));return e.set(t,s),s}}(),He=function(e,t,n,r,a){var i,u=null===(i=t.lastSegment.curve)||void 0===i?void 0:i.strokeBounds;return!!(e instanceof ze().Path&&null!==u&&void 0!==u&&u.intersects(e.strokeBounds))&&(!!t.intersects(e)||_e(n,r,a).some((function(t){var n,r=null===(n=e.getNearestPoint(t))||void 0===n?void 0:n.getDistance(t);return r&&r<(e.strokeWidth+a)/2})))},Ge=["pageRec","pdf","pageOrder"],Je=(0,d.createContext)({noteID:"",noteInfo:void 0,stateSet:void 0,teamState:void 0,pageRec:void 0,pageOrder:void 0,saved:!0,teamOn:!1,inviewPages:(0,P.l4)(),refRec:{},drawCtrl:p,mode:"draw"}),qe=(0,d.createContext)({scrollPage:function(){},setInviewPages:function(){},switchPageMarked:function(){},setPageState:function(){},addPage:function(){},addFinalPage:function(){},deletePage:function(){},setMode:function(){},setDrawCtrl:function(){},saveReorder:function(){var e=(0,s.Z)(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()});function Ye(e){var t,n=e.teamOn,c=null!==(t=(0,j.UO)().noteID)&&void 0!==t?t:"",f=(0,j.s0)(),v=(0,d.useState)(),g=(0,o.Z)(v,2),y=g[0],C=g[1],b=(0,d.useState)(),D=(0,o.Z)(b,2),I=D[0],E=D[1],M=(0,d.useState)(),T=(0,o.Z)(M,2),A=T[0],U=T[1],z=(0,d.useState)(p),V=(0,o.Z)(z,2),K=V[0],B=V[1],_=(0,d.useState)("draw"),H=(0,o.Z)(_,2),G=H[0],J=H[1],Y=(0,d.useState)(!0),Q=(0,o.Z)(Y,2),X=Q[0],$=Q[1],ee=(0,d.useState)((0,P.l4)()),te=(0,o.Z)(ee,2),ne=te[0],re=te[1],ae=(0,d.useState)(),ie=(0,o.Z)(ae,2),ue=ie[0],oe=ie[1],se=(0,d.useState)(!1),ce=(0,o.Z)(se,2),le=ce[0],de=ce[1],fe=(0,d.useRef)({}),ve=function(){var e=(0,d.useRef)(!1);return(0,d.useEffect)((function(){return e.current=!0,function(){e.current=!1}}),[]),e}(),pe=(0,d.useContext)(q.TeamCtx),he=pe.teamState,ge=pe.pushOperation,me=pe.teamUpdate,xe=pe.pushNewPage,Ze=pe.pushReorder,we=function(){var e=(0,s.Z)(l().mark((function e(){var t,r,a,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,Z.U9)(c);case 2:if(t=e.sent){e.next=6;break}return W.ZP.error("Note not found"),e.abrupt("return",f("/"));case 6:return r=t.pageRec,t.pdf,a=t.pageOrder,i=(0,u.Z)(t,Ge),C(r),oe(a),E(i),U(N.createFromPages(r)),e.t0=B,e.next=14,h();case 14:e.t1=e.sent,(0,e.t0)(e.t1),de(!0),n&&(0,w.f1)(c);case 18:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),je=(0,d.useCallback)((0,O.debounce)(function(){var e=(0,s.Z)(l().mark((function e(t){var n,r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,Z.SP)(c,{pageRec:t});case 2:n=document.querySelector("canvas"),(r=null===n||void 0===n?void 0:n.toDataURL())&&(0,Z.SP)(c,{thumbnail:r}),ve.current&&$(!0);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),3e3),[]),ye=je.flush;(0,d.useLayoutEffect)((function(){return we(),function(){ye()}}),[c,n]),(0,k.x)(ye),(0,d.useEffect)((function(){I&&(document.title=I.name+" - Multibility")}),[I]),(0,d.useEffect)((function(){le&&function(e){m.apply(this,arguments)}(K)}),[K]),(0,d.useEffect)((function(){null!==A&&void 0!==A&&A.lastOp&&ge(A.lastOp)}),[A]),(0,d.useEffect)((function(){y&&le&&(je(y),$(!1))}),[y]),(0,d.useEffect)((function(){if(me){var e=me.type,t=me.pageOrder;if("reorder"===e){if(Ce(t),!me.deleted)return;Qe((function(){Ce(me.prevOrder,!0)}))}else if("newPage"===e){Ce(t);var n=me.pageID,r=me.newPage;C((function(e){return e&&(0,i.Z)((0,i.Z)({},e),{},(0,a.Z)({},n,r))})),U((function(e){return null===e||void 0===e?void 0:e.addState(n,r)}))}}}),[me]);var ke=function(e,t){var n=S.Dw.flaten(t);C((function(t){return t&&(0,i.Z)((0,i.Z)({},t),{},(0,a.Z)({},e,(0,i.Z)((0,i.Z)({},t[e]),{},{state:n})))}))},Se=(0,d.useCallback)((function(e,t){U((function(n){return null===n||void 0===n?void 0:n.setState(e,t)})),ke(e,t)}),[]),Ce=function(){var e=(0,s.Z)(l().mark((function e(t){var n,r=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]&&r[1],oe(t),e.next=4,(0,Z.SP)(c,{pageOrder:t});case 4:return e.next=6,ye();case 6:n&&Ze(t);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),be=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(ue){var n=t?y&&y[e]:void 0,r=(0,x.D)(n),u=(0,o.Z)(r,2),s=u[0],c=u[1],l=R(ue,e,s);xe(l,s,c),Ce(l),C((function(e){return e&&(0,i.Z)((0,i.Z)({},e),{},(0,a.Z)({},s,c))})),U((function(e){return null===e||void 0===e?void 0:e.addState(s,c)}))}},Pe=(0,L.jsxs)("div",{className:"reader container",children:[(0,L.jsx)(Ne,{instantSave:ye,handleUndo:function(){U((function(e){if(e){var t=e.undo(),n=t.getLastDS();return n&&ke.apply(void 0,(0,r.Z)(n)),t}}))},handleRedo:function(){U((function(e){if(e){var t=e.redo(),n=t.getLastDS();return n&&ke.apply(void 0,(0,r.Z)(n)),t}}))}}),(0,L.jsxs)("main",{children:[null===ue||void 0===ue?void 0:ue.map((function(e){return(0,L.jsx)(Xe,{uid:e},e)})),(0,L.jsx)(F,{})]})]});return(0,L.jsx)(Je.Provider,{value:{noteID:c,noteInfo:I,stateSet:A,teamState:he,saved:X,teamOn:n,pageRec:y,pageOrder:ue,inviewPages:ne,refRec:fe.current,mode:G,drawCtrl:K},children:(0,L.jsx)(qe.Provider,{value:{scrollPage:function(e){var t;null===(t=fe.current[e])||void 0===t||t.scrollIntoView()},setInviewPages:re,switchPageMarked:function(e){var t=y&&y[e];if(t){var n=!Boolean(t.marked);C((function(t){return t&&(0,i.Z)((0,i.Z)({},t),{},(0,a.Z)({},e,(0,i.Z)((0,i.Z)({},t[e]),{},{marked:n})))}))}},setPageState:Se,addPage:be,addFinalPage:function(){var e=(0,O.last)(ue);e&&be(e)},deletePage:function(e){var t=null===ue||void 0===ue?void 0:ue.filter((function(t){return t!==e}));t&&Ce(t,!0)},setMode:J,setDrawCtrl:B,saveReorder:Ce},children:Pe})})}var Qe=function(e){W.ZP.warning({content:(0,L.jsxs)(L.Fragment,{children:["One page was deleted.",(0,L.jsx)(E.Z,{size:"small",type:"link",onClick:function(){W.ZP.destroy("DELETE"),e()},children:"Undo"})]}),key:"DELETE",duration:10})},Xe=function(e){var t=e.uid,n=(0,d.useContext)(Je),r=n.pageRec,a=n.stateSet,i=n.teamState,u=(0,d.useContext)(qe).setPageState,o=r&&r[t],s=null===a||void 0===a?void 0:a.getOneState(t),c=null===i||void 0===i?void 0:i.getOnePageState(t),l=(0,d.useCallback)((function(e){return u(t,e)}),[t,u]);return o&&s?(0,L.jsx)($e,{drawState:s,teamStateMap:c,updateState:l,pdfIndex:o.pdfIndex,uid:t}):null},$e=function(e){var t=e.thumbnail,r=e.drawState,a=e.teamStateMap,i=e.updateState,u=e.pdfIndex,c=e.preview,f=void 0!==c&&c,v=e.uid,p=(0,d.useContext)(qe).setInviewPages,h=(0,d.useContext)(Je),g=h.refRec,m=h.noteID,x=(0,d.useState)(),Z=(0,o.Z)(x,2),w=Z[0],j=Z[1],k=(0,y.YD)({delay:100}),S=(0,o.Z)(k,2),C=S[0],b=S[1],P=r.height/r.width,D=(0,d.useCallback)((function(e){e&&(C(e),!f&&g&&(g[v]=e))}),[g]),I=(0,d.useCallback)(function(){var e=!1;return(0,s.Z)(l().mark((function t(){var r,a;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!f&&u&&!e){t.next=2;break}return t.abrupt("return");case 2:return e=!0,t.next=5,Promise.all([n.e(643),n.e(701)]).then(n.bind(n,21176));case 5:return r=t.sent,a=r.getOnePageImage,t.t0=j,t.next=10,a(m,u);case 10:t.t1=t.sent,(0,t.t0)(t.t1);case 12:case"end":return t.stop()}}),t)})))}(),[f,u]);(0,d.useEffect)((function(){f||(b?(I(),p((function(e){return e.add(v)}))):p((function(e){return e.delete(v)})))}),[b,I,f]);var N=(0,d.useContext)(q.TeamCtx).ignores,O=(0,d.useMemo)((function(){return a&&Array.from(a.deleteAll(N).values())}),[a,N]),R=w||!u,E=b&&R,M=Boolean(f||!R);return(0,L.jsxs)("section",{ref:D,className:"note-page",style:{paddingTop:"".concat(100*P,"%")},children:[E&&(0,L.jsx)(et,{drawState:r,otherStates:O,updateState:i,imgSrc:w||t||void 0,preview:f}),M&&(0,L.jsx)("div",{className:"mask"})]})};$e.displayName="PageWrapper";var et=function(e){var t=e.drawState,n=e.updateState,r=e.otherStates,a=e.preview,i=void 0!==a&&a,u=e.imgSrc,o=(0,d.useContext)(Je),s=o.mode,c=o.drawCtrl,l=(0,d.useContext)(qe).setMode,f=(0,d.useCallback)((function(e){if(n){var r=e instanceof S.Dw?e:e(t);n(r)}}),[n,t]);return(0,L.jsx)("div",{className:"page-draw",children:i?(0,L.jsx)(Ke,{drawState:t,otherStates:r,imgSrc:u,readonly:!0,preview:!0}):(0,L.jsx)(Ke,{drawState:t,otherStates:r,onChange:f,imgSrc:u,drawCtrl:c,mode:s,setMode:l})})};et.displayName="DrawWrapper"},91511:function(e,t,n){"use strict";n.r(t),n.d(t,{TeamCtx:function(){return D},default:function(){return I}});var r=n(45987),a=n(1413),i=n(15861),u=n(29439),o=n(87757),s=n.n(o),c=n(49496),l=n(72791),d=n(16871),f=n(51570),v=n(13623),p=n(69951),h=n(18406),g=n(56058),m=n(87962),x=n(15671),Z=n(43144),w=n(24124),j=n(82670),y=["pageID"],k={pageStates:(0,w.D5)(),pageInfos:(0,w.D5)()},S=(0,w.WV)(k),C=function(){function e(t){(0,x.Z)(this,e),this.immutable=t}return(0,Z.Z)(e,[{key:"getImmutable",value:function(){return this.immutable}},{key:"getPageStates",value:function(){return this.getImmutable().get("pageStates")}},{key:"getPageInfos",value:function(){return this.getImmutable().get("pageInfos")}},{key:"getOneState",value:function(e,t){var n;return null===(n=this.getPageStates().get(e))||void 0===n?void 0:n.get(t)}},{key:"getOnePageState",value:function(e){return this.getPageStates().get(e)}},{key:"getPageRatio",value:function(e){var t;return null===(t=this.getPageInfos().get(e))||void 0===t?void 0:t.ratio}},{key:"includesPage",value:function(e){return this.getPageStates().has(e)}},{key:"setState",value:function(t,n,r){var a=this.getPageStates().get(t);return a?new e(this.getImmutable().update("pageStates",(function(e){return e.set(t,a.set(n,r))}))):this}},{key:"addPage",value:function(t,n){var r=n.ratio;return new e(this.getImmutable().update("pageStates",(function(e){return e.set(t,(0,w.D5)())})).update("pageInfos",(function(e){return e.set(t,{ratio:r})})))}},{key:"pushOperation",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:j.mF,a=e.pageID,i=(0,r.Z)(e,y),u=this.getPageRatio(a);if(!this.includesPage(a)||!u)return this;var o=this.getOneState(a,t)||j.Dw.createEmpty(n,n*u),s=j.Dw.pushOperation(o,i);return this.setState(a,t,s)}},{key:"resetUser",value:function(e,t){for(var n=this,r=0,a=Object.entries(t);r<a.length;r++){var i=(0,u.Z)(a[r],2),o=i[0],s=i[1],c=s.state,l=s.ratio,d=n.getOneState(o,e);if(d){var f=d.width;n=n.setState(o,e,j.Dw.loadFromFlat(c,f,f*l))}}return n}}],[{key:"createFromTeamPages",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:j.mF,r=t.pageRec,a=S();return Object.entries(r).forEach((function(e){var t=(0,u.Z)(e,2),r=t[0],i=t[1],o=i.states,s=i.ratio,c=(0,w.D5)(Object.entries(o).map((function(e){var t=(0,u.Z)(e,2),r=t[0],a=t[1];return[r,j.Dw.loadFromFlat(a,n,n*s)]})));a=a.update("pageStates",(function(e){return e.set(r,c)})).update("pageInfos",(function(e){return e.set(r,{ratio:s})}))})),new e(a)}}]),e}(),b=n(80184),P=["image","marked"],D=(0,l.createContext)({code:-2,userRec:{},ignores:(0,w.l4)(),setIgnores:function(){},loadInfo:function(){},teamState:void 0,pushOperation:function(){},teamUpdate:void 0,pushReorder:function(){},pushNewPage:function(){},connected:!1});function I(){var e,t=null!==(e=(0,d.UO)().noteID)&&void 0!==e?e:"",n=(0,l.useState)(),o=(0,u.Z)(n,2),x=o[0],Z=o[1],j=(0,l.useState)(-2),y=(0,u.Z)(j,2),k=y[0],S=y[1],I=(0,l.useState)({}),N=(0,u.Z)(I,2),O=N[0],R=N[1],E=(0,l.useState)((0,w.l4)()),M=(0,u.Z)(E,2),T=M[0],A=M[1],L=(0,l.useState)(function(e){return function(){return(0,v.io)(f._n,{autoConnect:!1,query:{userID:(0,p.VN)(),userName:(0,p.vW)(),noteID:e}})}}(t)),F=(0,u.Z)(L,1)[0],W=(0,l.useState)(),U=(0,u.Z)(W,2),z=U[0],V=U[1],K=(0,l.useState)(!1),B=(0,u.Z)(K,2),_=B[0],H=B[1],G=(0,l.useState)(!0),J=(0,u.Z)(G,2),q=J[0],Y=J[1],Q=(0,d.s0)(),X=function(){var e=(0,i.Z)(s().mark((function e(){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,f.CD)(t);case 2:if(n=e.sent){e.next=6;break}return c.ZP.error("Failed loading the team note state"),e.abrupt("return",!1);case 6:return Z(C.createFromTeamPages(n)),e.abrupt("return",!0);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),$=function(){var e=(0,i.Z)(s().mark((function e(){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,f.dn)(t);case 2:if(n=e.sent){e.next=6;break}return c.ZP.error("Failed loading the team note info"),e.abrupt("return",!1);case 6:return S(n.code),e.abrupt("return",!0);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ee=function(){var e=(0,i.Z)(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c.ZP.loading({content:"Loading team note...",duration:0,key:"TEAM_LOADING"}),e.next=3,$();case 3:if(e.t0=e.sent,!e.t0){e.next=8;break}return e.next=7,X();case 7:e.t0=e.sent;case 8:if(e.t0){e.next=11;break}return c.ZP.destroy("TEAM_LOADING"),e.abrupt("return",Q("/"));case 11:c.ZP.destroy("TEAM_LOADING"),H(!0),F.on("push",(function(e){var t=e.operation,n=e.userID;Z((function(e){return null===e||void 0===e?void 0:e.pushOperation(t,n)}))})),F.on("joined",(function(e){var t=e.joined,n=e.members,r=t.userID,a=t.userName;R(n),r!==(0,p.VN)()&&(c.ZP.destroy(r),c.ZP.success({icon:(0,b.jsx)(g.Z,{}),content:"".concat(a," joined room"),key:r}))})),F.on("leaved",(function(e){var t=e.leaved,n=e.members,r=t.userID,a=t.userName;R(n),r!==(0,p.VN)()&&(c.ZP.destroy(r),c.ZP.warning({icon:(0,b.jsx)(m.Z,{}),content:"".concat(a," leaved room"),key:r}))})),F.on("reorder",(function(e){V((0,a.Z)({type:"reorder"},e))})),F.on("newPage",(function(e){var t=e.pageID,n=e.newPage;Z((function(e){return null===e||void 0===e?void 0:e.addPage(t,n)})),V((0,a.Z)({type:"newPage"},e))})),F.on("reset",(function(e){var t=e.userID,n=e.pageRec;t!==(0,p.VN)()&&Z((function(e){return null===e||void 0===e?void 0:e.resetUser(t,n)}))})),F.on("connect",(function(){return Y(!0)})),F.on("disconnect",(function(){return Y(!1)})),F.connect();case 22:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),te=function(){F.removeAllListeners(),F.disconnect(),c.ZP.destroy("TEAM_LOADING")};(0,l.useEffect)((function(){return ee(),te}),[t]);return _?(0,b.jsx)(D.Provider,{value:{code:k,ignores:T,userRec:O,loadInfo:$,connected:q,teamState:x,setIgnores:A,teamUpdate:z,pushOperation:function(e){F.emit("push",{operation:e})},pushReorder:function(e){F.emit("reorder",{pageOrder:e})},pushNewPage:function(e,t,n){Z((function(e){return null===e||void 0===e?void 0:e.addPage(t,n)}));n.image,n.marked;var a=(0,r.Z)(n,P);F.emit("newPage",{pageOrder:e,pageID:t,newPage:a})}},children:(0,b.jsx)(h.default,{teamOn:!0})}):null}},64309:function(e,t,n){"use strict";function r(e,t){var n=document.createElement("canvas"),r=n.getContext("2d");if(!r)throw new Error("can't get virtual canvas context");return n.width=e,n.height=t,{canvas:n,context:r}}function a(e){e.width=1,e.height=1;var t=e.getContext("2d");null===t||void 0===t||t.clearRect(0,0,1,1)}n.d(t,{j:function(){return a},v:function(){return r}})},90858:function(){},64158:function(){}}]);
//# sourceMappingURL=350.ab074c4e.chunk.js.map