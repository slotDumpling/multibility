"use strict";(self.webpackChunkmultibility=self.webpackChunkmultibility||[]).push([[794,44],{87850:function(e,n,t){t.r(n),t.d(n,{default:function(){return xn}});var r=t(93433),a=t(1413),i=t(45987),o=t(15861),s=t(29439),u=t(87757),c=t.n(u),l=t(72791),d=t(92198),f=t(11886),p=t(81832),v=t(95099),g=t(15671),x=t(43144),m=t(82670),Z=t(24124),h={states:(0,Z.D5)(),editStack:(0,Z.aV)(),undoStack:(0,Z.aV)()},j=(0,Z.WV)(h),k=function(){function e(n,t){(0,g.Z)(this,e),this.immutable=n,this.lastOp=t}return(0,x.Z)(e,[{key:"getImmutable",value:function(){return this.immutable}},{key:"getStates",value:function(){return this.getImmutable().get("states")}},{key:"getOneState",value:function(e){return this.getStates().get(e)}},{key:"getEditStack",value:function(){return this.getImmutable().get("editStack")}},{key:"getUndoStack",value:function(){return this.getImmutable().get("undoStack")}},{key:"setState",value:function(n,t){var r=this.getOneState(n);if(!r||r===t)return this;var i=this.getImmutable().update("states",(function(e){return e.set(n,t)})).update("editStack",(function(e){return e.push(n)})).delete("undoStack"),o=t.lastOp;return new e(i,o&&(0,a.Z)((0,a.Z)({},o),{},{pageID:n}))}},{key:"syncStrokeTime",value:function(e,n){var t=this.getOneState(e);return t&&m.Dw.syncStrokeTime(t,n),this}},{key:"addState",value:function(n,t){var r=t.state,a=t.ratio,i=m.Dw.loadFromFlat(r,a);return new e(this.getImmutable().update("states",(function(e){return e.set(n,i)})))}},{key:"deleteState",value:function(n){return new e(this.getImmutable().update("states",(function(e){return e.delete(n)})))}},{key:"isUndoable",value:function(){return this.getEditStack().size>0}},{key:"isRedoable",value:function(){return this.getUndoStack().size>0}},{key:"undo",value:function(){if(!this.isUndoable())return this;var n=this.getEditStack().last(),t=n&&this.getOneState(n);if(!t)return this;var r=m.Dw.undo(t),i=r.lastOp,o=i&&(0,a.Z)({pageID:n},i);return new e(this.getImmutable().update("editStack",(function(e){return e.pop()})).update("undoStack",(function(e){return e.push(n)})).update("states",(function(e){return e.set(n,r)})),o)}},{key:"redo",value:function(){if(!this.isRedoable())return this;var n=this.getUndoStack().last(),t=n&&this.getOneState(n);if(!t)return this;var r=m.Dw.redo(t),i=r.lastOp,o=i&&(0,a.Z)({pageID:n},i);return new e(this.getImmutable().update("undoStack",(function(e){return e.pop()})).update("editStack",(function(e){return e.push(n)})).update("states",(function(e){return e.set(n,r)})),o)}},{key:"getLastDS",value:function(){var e,n=null===(e=this.lastOp)||void 0===e?void 0:e.pageID,t=n&&this.getOneState(n);if(t)return[n,t]}}],[{key:"createFromPages",value:function(n){return new e(j().set("states",(0,Z.D5)(n).map((function(e){var n=e.state,t=e.ratio;return m.Dw.loadFromFlat(n,t)}))))}}]),e}(),b=t(75783),y=t(49742),w=t(16871),S=t(38117),I=t(37762),D=t(61842),P=t.n(D),C=t(763),N=P().createInstance({name:"scroll"}),O=(0,C.debounce)((function(e,n){N.setItem(e,n)}),2e3);var E=function(e,n){var t,r="",a=0,i=(0,I.Z)(n);try{for(i.s();!(t=i.n()).done;){var o=t.value,s=e.get(o);if(s){if(1===s)return o;s>a&&(r=o,a=s)}}}catch(u){i.e(u)}finally{i.f()}return r},R=t(79930),T=t(82898);function L(e,n,t){var r=e.indexOf(n),a=e.slice();return-1===r||a.splice(r+1,0,t),a}var z=t(79286),F=t(23414),V=t(82622),M=t(10711),A=t(36146),U=t(21830),H=t(18780),K=t(2649),B=t(36090),W=t(69228),_=t(87661),G=t(26987),X=t(87309),q=t(37382),J=t(52365),Q=t(74115),Y=t(80184),$=function(e){var n=e.userInfo,t=e.size,r=void 0===t?"default":t,a=e.onClick,i=void 0===a?function(){}:a,o=e.chosen,s=void 0!==o&&o,u=e.className,c=(0,l.useMemo)((function(){return(0,Q.bM)(n.userID)}),[n]);if(!n)return null;var d=n.userName;return(0,Y.jsx)(K.C,{className:u,"data-chosen":s,size:r,style:{backgroundColor:c},children:(0,Y.jsx)("div",{className:"avatar-wrapper",onClick:i,children:null===d||void 0===d?void 0:d.slice(0,3)})})},ee=t(22568),ne=t(81694),te=t.n(ne),re=t(60559),ae=t(13892),ie=t(79856),oe=function(e){var n=e.addFinalPage;return(0,Y.jsx)("div",{className:"add-btn-wrapper",children:(0,Y.jsx)(X.Z,{type:"dashed",icon:(0,Y.jsx)(z.Z,{}),block:!0,onClick:n,children:"New page"})})},se=t(89295),ue=["left"],ce=["ref"],le=["cardDragged"],de=["uid","pageIndex","refRec","cardDragged"],fe=["uid","index","chosen","setChosen","page","userIDs"],pe=function(e){var n=(0,l.useState)(!1),t=(0,s.Z)(n,2),r=t[0],i=t[1],o=(0,J.LH)(),u=(0,s.Z)(o,1)[0],c=(0,Y.jsx)(H._l,{draggableId:"OPPOSITE",index:r?1:0,isDragDisabled:!0,children:function(e){var n=e.innerRef;return(0,Y.jsx)("div",{className:"opposite",ref:n})}});return(0,Y.jsx)(se.Z,{in:u,timeout:300,unmountOnExit:!0,children:(0,Y.jsx)(J.s2,{initKey:"ALL",children:(0,Y.jsx)(H.Z5,{onDragEnd:function(e){var n=e.destination;0===(null===n||void 0===n?void 0:n.index)&&i(!0),1===(null===n||void 0===n?void 0:n.index)&&i(!1)},children:(0,Y.jsx)(H.bK,{droppableId:"preview-drop",direction:"horizontal",children:function(n,t){var i=n.droppableProps,o=n.innerRef,s=n.placeholder,u=t.isDraggingOver;return(0,Y.jsxs)("aside",(0,a.Z)((0,a.Z)({className:"preview-drop","data-left":r,ref:o,"data-dragged":u},i),{},{children:[c,(0,Y.jsx)(ve,(0,a.Z)({left:r},e)),s]}))}})})})})},ve=function(e){var n=e.left,t=(0,i.Z)(e,ue),r=(0,J.zI)(),o=(0,s.Z)(r,1)[0],u=(0,J.LH)(),c=(0,s.Z)(u,2)[1],l={ALL:"All Pages",MARKED:"Bookmarks",WRITTEN:"Notes"}[o],d=(0,ae.QS)({onSwipedLeft:function(){n&&c(!1)},onSwipedRight:function(){n||c(!1)},swipeDuration:200}),f=d.ref,p=(0,i.Z)(d,ce);return(0,Y.jsx)(H._l,{draggableId:"CARD",index:n?0:1,children:function(e,n){var r=e.innerRef,i=e.draggableProps,o=e.dragHandleProps,s=n.isDragging,u=n.isDropAnimating;return(0,Y.jsxs)("div",(0,a.Z)((0,a.Z)((0,a.Z)({className:"preview-card",ref:function(e){r(e),f(e)},"data-animating":u},i),p),{},{children:[(0,Y.jsx)("div",(0,a.Z)({className:"drag-handle"},o)),(0,Y.jsx)("h3",{children:l}),(0,Y.jsx)(je,{}),(0,Y.jsx)(ge,(0,a.Z)({cardDragged:s},t)),(0,Y.jsx)(ke,(0,a.Z)({},t))]}))}})},ge=l.memo((function(e){var n=e.cardDragged,t=(0,i.Z)(e,le),r=(0,l.useRef)({}),o=(0,J.zI)(),u=(0,s.Z)(o,1)[0],c=(0,J.LH)(),d=(0,s.Z)(c,1)[0],f=t.pageOrder,p=t.currPageID,g=t.saveReorder,x=t.addFinalPage,m=(0,v.Z)((function(){var e;null===(e=r.current[p])||void 0===e||e.scrollIntoView()}));return(0,l.useLayoutEffect)((function(){d&&m()}),[d,u,m]),(0,Y.jsx)(H.Z5,{onDragEnd:function(e){var n=e.source,t=e.destination;if(t&&f){var r=n.index,a=t.index,i=f[r];if(r!==a&&i){var o=function(e,n,t){var r=e.slice(),a=r.splice(n,1),i=(0,s.Z)(a,1)[0];return i?(r.splice(t,0,i),r):e}(f,r,a);g(o,!0)}}},children:(0,Y.jsx)(H.bK,{droppableId:"preview-list",isDropDisabled:n,children:function(e){var i=e.droppableProps,o=e.innerRef,s=e.placeholder;return(0,Y.jsxs)("div",(0,a.Z)((0,a.Z)({className:"page-list",ref:o},i),{},{children:[null===f||void 0===f?void 0:f.map((function(e,i){return(0,Y.jsx)(xe,(0,a.Z)({uid:e,pageIndex:i,refRec:r.current,cardDragged:n},t),e)})),s,"ALL"===u&&(0,Y.jsx)(oe,{addFinalPage:x})]}))}})})}));ge.displayName="PageList";var xe=function(e){var n=e.uid,t=e.pageIndex,r=e.refRec,o=e.cardDragged,u=(0,i.Z)(e,de),c=u.stateSet,d=u.pageRec,f=u.currPageID,p=u.scrollPage,v=(0,l.useContext)(re.TeamCtx),g=v.teamState,x=v.ignores,m=(0,J.zI)(),Z=(0,s.Z)(m,1)[0],h=(0,l.useState)(""),j=(0,s.Z)(h,2),k=j[0],b=j[1],y=null===d||void 0===d?void 0:d.get(n),w=null===c||void 0===c?void 0:c.getOneState(n),I=null===g||void 0===g?void 0:g.getOnePageStateMap(n),D=(0,l.useRef)(!1);D.current="MARKED"===Z&&((null===y||void 0===y?void 0:y.marked)||D.current);var P=(0,l.useMemo)((function(){return ie.f.getValidUsers(I,x)}),[I,x]);if(!y||!w)return null;if("WRITTEN"===Z&&w.isEmpty()&&ie.f.isEmpty(I))return null;if("MARKED"===Z&&!D.current)return null;var C=f===n;return(0,Y.jsx)(H._l,{draggableId:n,index:t,isDragDisabled:"ALL"!==Z||o,children:function(e,i){var s=e.innerRef,c=e.draggableProps,l=e.dragHandleProps,d=i.isDragging,f=i.isDropAnimating;return(0,Y.jsxs)("div",(0,a.Z)((0,a.Z)((0,a.Z)({ref:function(e){s(e),e&&(r[n]=e)},className:"page","data-curr":C,"data-dragged":d,"data-animating":f,onClick:function(){return p(n)}},c),l),{},{children:[(0,Y.jsx)(S.default,{drawState:(null===I||void 0===I?void 0:I.get(k))||w,teamStateMap:k?void 0:I,thumbnail:y.image,ignores:x,preview:!0,skipInView:d||o}),(0,Y.jsx)(me,(0,a.Z)({uid:n,index:t,chosen:k,setChosen:b,page:y,userIDs:P},u))]}))}})},me=l.memo((function(e){var n=e.uid,t=e.index,r=e.chosen,o=e.setChosen,s=e.page,u=e.userIDs,c=(0,i.Z)(e,fe),l=c.switchPageMarked;return(0,Y.jsxs)("div",{className:"tools",onClick:function(e){return e.stopPropagation()},children:[(0,Y.jsx)("div",{className:"bookmark","data-marked":s.marked,onClick:function(){return l(n)}}),(0,Y.jsx)("div",{className:"index",children:t+1}),(0,Y.jsx)(he,(0,a.Z)({uid:n},c)),(0,Y.jsx)(Ze,{userIDs:u,chosen:r,setChosen:o})]})}));me.displayName="PreviewTools";var Ze=function(e){var n=e.userIDs,t=e.chosen,r=e.setChosen,a=(0,l.useContext)(re.TeamCtx).userRec;return(0,Y.jsx)(K.C.Group,{maxCount:2,size:"default",className:te()("team-group",{chosen:t}),maxPopoverPlacement:"bottom",children:n.map((function(e){var n=a[e];return n?(0,Y.jsx)($,{size:"default",userInfo:n,className:"preview-avatar",chosen:t===e,onClick:function(){return r((function(n){return n===e?"":e}))}},e):null}))})},he=function(e){var n=e.uid,t=e.addPage,r=e.deletePage,a=(0,Y.jsx)(B.Z,{items:[{key:"ADD",icon:(0,Y.jsx)(z.Z,{}),label:"Add page",onClick:function(){return t(n)}},{key:"COPY",icon:(0,Y.jsx)(F.Z,{}),label:"Duplicate",onClick:function(){return t(n,!0)}},{key:"DELETE",icon:(0,Y.jsx)(V.Z,{}),label:"Delete",danger:!0,onClick:function(){return r(n)}}]});return(0,Y.jsx)(W.Z,{content:a,trigger:"click",placement:"left",destroyTooltipOnHide:!0,getPopupContainer:function(e){var n,t;return null===(n=e.parentElement)||void 0===n||null===(t=n.parentElement)||void 0===t?void 0:t.parentElement},children:(0,Y.jsx)("div",{className:"option",children:(0,Y.jsx)(M.Z,{})})})},je=l.memo((function(){var e=(0,J.zI)(),n=(0,s.Z)(e,2),t=n[0],r=n[1],a=_.Z.TabPane;return(0,Y.jsxs)(_.Z,{className:"tabs",activeKey:t,onChange:r,tabBarGutter:0,size:"small",centered:!0,children:[(0,Y.jsx)(a,{tab:(0,Y.jsx)(ee.Z,{type:"icon-uf_paper"})},"ALL"),(0,Y.jsx)(a,{tab:(0,Y.jsx)(ee.Z,{type:"icon-bookmark2"})},"MARKED"),(0,Y.jsx)(a,{tab:(0,Y.jsx)(ee.Z,{type:"icon-write"})},"WRITTEN")]})}));je.displayName="PreviewTabs";var ke=function(e){var n=e.currPageID,t=e.pageOrder,r=e.scrollPage,a=e.size,i=e.setSize,o=(0,l.useMemo)((function(){var e;return(null!==(e=null===t||void 0===t?void 0:t.indexOf(n))&&void 0!==e?e:0)+1}),[n,t]),s=t&&(0,Y.jsx)(G.Z,{pageSize:1,total:t.length,simple:!0,current:o,onChange:function(e){var n=t[e-1];n&&r(n)}}),u=(0,Y.jsx)(B.Z,{items:(0,C.range)(40,120,20).map((function(e){return{key:e,label:e+"%",className:"size-li",onClick:function(){return i(e)}}}))});return(0,Y.jsxs)("footer",{children:[(0,Y.jsx)(W.Z,{content:s,trigger:"click",getPopupContainer:function(e){return e.parentElement},destroyTooltipOnHide:!0,children:(0,Y.jsxs)(X.Z,{type:"text",size:"small",icon:(0,Y.jsx)(A.Z,{}),children:[o," / ",null===t||void 0===t?void 0:t.length]})}),(0,Y.jsx)(q.Z,{overlay:u,placement:"topRight",trigger:["click"],getPopupContainer:function(e){return e.parentElement},children:(0,Y.jsxs)(X.Z,{type:"text",size:"small",icon:(0,Y.jsx)(U.Z,{}),className:"size-btn",children:[a,"%"]})})]})},be=t(52242),ye=t(65323),we=function(e){var n=e.saved,t=e.instantSave,r=(0,w.s0)();return(0,Y.jsxs)("div",{className:"left",children:[(0,Y.jsx)(X.Z,{type:"text",onClick:(0,o.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t();case 2:r("/");case 3:case"end":return e.stop()}}),e)}))),icon:(0,Y.jsx)(be.Z,{style:{opacity:.8}})}),(0,Y.jsx)(X.Z,{type:"text",className:"save",onClick:t,disabled:n,icon:(0,Y.jsx)(ye.Z,{})})]})},Se=t(50419),Ie=t(53163),De=t(78030),Pe=t(50446),Ce=t(74006),Ne=t(52542),Oe=t(76849),Ee=t(62),Re=t(14965),Te=t(48),Le=function(e){var n=e.handleUndo,t=e.handleRedo,r=e.undoable,a=e.redoable,i=(0,f.gX)(),o=i.mode,u=i.finger,c=(0,f.F7)(),l=(0,p.iX)(),d=(0,s.Z)(l,2),v=d[0],g=d[1];return(0,Y.jsxs)("div",{className:"middle","data-force-light":v,children:[(0,Y.jsx)(X.Z,{type:"text",icon:(0,Y.jsx)(De.Z,{}),onClick:n,disabled:!r}),(0,Y.jsx)(X.Z,{type:"text",icon:(0,Y.jsx)(Pe.Z,{}),onClick:t,disabled:!a}),(0,Y.jsx)(X.Z,{type:u?"link":"text",onClick:function(){c({finger:!u}),Se.ZP.destroy("FINGER"),Se.ZP.open({content:u?"Pencil only":"Draw with finger",key:"FINGER"})},icon:(0,Y.jsx)(ee.Z,{type:"icon-finger"})}),(0,Y.jsx)(X.Z,{className:"force-light-btn",type:"text",icon:v?(0,Y.jsx)(Ce.Z,{}):(0,Y.jsx)(Ne.Z,{}),onClick:function(){return g((function(e){return!e}))}}),(0,Y.jsx)(ze,{}),(0,Y.jsx)(Fe,{}),(0,Y.jsx)(X.Z,{type:"text"===o?"link":"text",onClick:function(){return c({mode:"text"})},icon:(0,Y.jsx)(ee.Z,{type:"icon-text1"})}),(0,Y.jsx)(Ve,{})]})},ze=function(){var e=(0,f.gX)(),n=e.mode,t=e.color,r=(0,f.F7)();return"draw"===n?(0,Y.jsx)(W.Z,{content:(0,Y.jsx)(Te.Uk,{updateDrawCtrl:r,drawCtrl:e}),trigger:"click",placement:"bottom",getPopupContainer:function(e){return e.parentElement},destroyTooltipOnHide:!0,children:(0,Y.jsx)(X.Z,{type:"link",icon:(0,Y.jsx)(Oe.Z,{twoToneColor:t,className:"pen-icon"})})}):(0,Y.jsx)(X.Z,{type:"text",onClick:function(){return r({mode:"draw"})},icon:(0,Y.jsx)(Ee.Z,{})})},Fe=function(){var e=(0,f.gX)(),n=e.mode,t=e.pixelEraser,r=(0,f.F7)();return"erase"===n?(0,Y.jsx)(W.Z,{content:(0,Y.jsxs)("div",{className:"width-seg-wrapper",children:[(0,Y.jsx)(Ie.Z,{block:!0,size:"small",className:"pixel-seg",options:["Pixel","Object"],value:t?"Pixel":"Object",onChange:function(e){r("Pixel"===e?{pixelEraser:!0}:{pixelEraser:!1})}}),(0,Y.jsx)(Te.Db,{drawCtrl:e,updateDrawCtrl:r,field:"eraserWidth"})]}),trigger:"click",placement:"bottom",getPopupContainer:function(e){return e.parentElement},destroyTooltipOnHide:!0,children:(0,Y.jsx)(X.Z,{type:"link",icon:(0,Y.jsx)(ee.Z,{type:"icon-eraser"})})}):(0,Y.jsx)(X.Z,{type:"text",onClick:function(){return r({mode:"erase"})},icon:(0,Y.jsx)(ee.Z,{type:"icon-eraser"})})},Ve=function(){var e=(0,f.gX)(),n=e.lasso,t=e.mode,r=(0,f.F7)(),a=n?(0,Y.jsx)(ee.Z,{type:"icon-lasso1"}):(0,Y.jsx)(Re.Z,{});return"select"===t?(0,Y.jsx)(X.Z,{type:"link",icon:a,onClick:function(){return r({lasso:!n})}}):(0,Y.jsx)(X.Z,{type:"text",icon:a,onClick:function(){return r({mode:"select"})}})},Me=t(49142),Ae=t(90785),Ue=t(91333),He=t(75594),Ke=t(27190),Be=t(95055),We=t(56118),_e=t(69951),Ge=t(96324),Xe=t(67575),qe=t(30501),Je=t(98272),Qe=t(24215),Ye=t(17973),$e=t(78823),en=t(23605),nn=t(56200),tn=t(18301),rn=t(51570),an=t(1829),on=t.n(an),sn=function(e){var n=e.instantSave,t=(0,l.useContext)(re.TeamCtx).teamOn;return(0,Y.jsxs)("div",{className:"right",children:[t?(0,Y.jsx)(ln,{}):(0,Y.jsx)(dn,{instantSave:n}),(0,Y.jsx)(un,{})]})},un=function(){var e=(0,J.LH)(),n=(0,s.Z)(e,2),t=n[0],r=n[1];return(0,Y.jsx)(X.Z,{type:t?"link":"text",icon:(0,Y.jsx)(Ge.Z,{}),onClick:function(){return r((function(e){return!e}))}})},cn=function(e){var n=e.userID,t=(0,l.useState)(!1),r=(0,s.Z)(t,2),a=r[0],i=r[1],o=(0,l.useContext)(re.TeamCtx),u=o.ignores,c=o.setIgnores,d=o.resetIO,f=o.userRec[n];if((0,l.useEffect)((function(){return i(!1)}),[f]),!f)return null;var p=f.userName,v=f.online,g=n===(0,_e.VN)(),x=u.has(n)&&!g;return(0,Y.jsxs)("div",{className:"user-item","data-online":v,children:[(0,Y.jsx)($,{userInfo:f,size:"small",className:"room-avatar"}),a||(0,Y.jsx)("span",{className:"user-name",children:p}),a&&(0,Y.jsx)(Be.Z,{autoFocus:!0,className:"rename-input",defaultValue:p,onSearch:function(e){var n=e.trim();if(!n||n===p)return i(!1);(0,_e.lu)(n),d()},enterButton:(0,Y.jsx)(X.Z,{icon:(0,Y.jsx)(Xe.Z,{})})}),g?a||(0,Y.jsx)(X.Z,{type:"text",icon:(0,Y.jsx)(qe.Z,{}),onClick:function(){return i(!0)}}):(0,Y.jsx)(X.Z,{type:"text",icon:x?(0,Y.jsx)(Je.Z,{}):(0,Y.jsx)(Qe.Z,{}),onClick:function(){c((function(e){return e.has(n)?e.delete(n):e.add(n)}))}})]})},ln=function(){var e=(0,l.useContext)(re.TeamCtx),n=e.code,t=e.userRec,a=e.connected,u=e.loadInfo,d=e.loadState,f=e.resetIO,p=window.location.href,v=function(){var e=(0,o.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,on()("".concat(document.title,"\n").concat(p));case 3:Se.ZP.destroy("copy"),Se.ZP.success({content:"Link copied!",icon:(0,Y.jsx)(F.Z,{}),key:"copy"}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),g=(0,l.useMemo)((function(){var e=(0,_e.VN)(),n=t[e],a=(0,i.Z)(t,[e].map(Me.Z)),o=n?[n]:[],s=Object.values(a);return o.push.apply(o,(0,r.Z)(s.filter((function(e){return e.online}))).concat((0,r.Z)(s.filter((function(e){return!e.online}))))),o}),[t]),x=(0,l.useMemo)((function(){return g.filter((function(e){return e.online})).length}),[g]),m=(0,Y.jsxs)("div",{className:"team-popover",children:[a||(0,Y.jsx)(Ae.Z,{className:"disconn-alert",message:"Network failed.",icon:(0,Y.jsx)(Ye.Z,{}),type:"error",showIcon:!0,banner:!0}),(0,Y.jsx)(We.GD,{className:"code-display",value:String(n),length:4,plain:!0}),(0,Y.jsx)(X.Z,{icon:(0,Y.jsx)($e.Z,{}),className:"share-btn",onClick:v,block:!0,children:"Copy link"}),(0,Y.jsx)(Ue.Z,{}),(0,Y.jsx)("div",{className:"user-list",children:g.map((function(e){return(0,Y.jsx)(cn,{userID:e.userID},e.userID)}))})]}),Z=(0,l.useState)(!1),h=(0,s.Z)(Z,2),j=h[0],k=h[1],b=(0,Y.jsxs)("div",{className:"team-title",children:[(0,Y.jsx)("span",{children:"Team info"}),(0,Y.jsx)(X.Z,{shape:"circle",type:"text",size:"small",loading:j,icon:(0,Y.jsx)(en.Z,{}),onClick:(0,o.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k(!0),e.next=3,u();case 3:return e.next=5,d();case 5:k(!1),f();case 7:case"end":return e.stop()}}),e)})))})]});return(0,Y.jsx)(W.Z,{content:m,trigger:"click",placement:"bottomRight",title:b,getPopupContainer:function(e){return e.parentElement},children:(0,Y.jsx)(X.Z,{type:"text",icon:(0,Y.jsx)(He.Z,{status:a?"success":"error",count:a?x:"!",size:"small",children:(0,Y.jsx)(nn.Z,{})})})})},dn=function(e){var n,t=e.instantSave,r=null!==(n=(0,w.UO)().noteID)&&void 0!==n?n:"",a=(0,w.s0)(),i=function(){var e=(0,o.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t();case 2:return e.next=4,(0,rn.r8)(r);case 4:if(e.sent){e.next=7;break}return e.abrupt("return",Se.ZP.error("Can't create room."));case 7:return e.next=9,(0,b.SP)(r,{team:!0});case 9:a("/team/"+r);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,Y.jsx)(X.Z,{type:"text",icon:(0,Y.jsx)(tn.Z,{}),onClick:function(){Ke.Z.confirm({title:"Enable team editing",content:"This will make your note public to anyone with the link.",icon:(0,Y.jsx)(nn.Z,{style:{color:"#555"}}),onOk:i})}})},fn=["saved","instantSave"],pn=function(e){var n=e.saved,t=e.instantSave,r=(0,i.Z)(e,fn);return(0,Y.jsxs)("header",{children:[(0,Y.jsx)(we,{saved:n,instantSave:t}),(0,Y.jsx)(Le,(0,a.Z)({},r)),(0,Y.jsx)(sn,{instantSave:t})]})},vn=["pageRec","pdf","pageOrder"],gn=["image","marked"];function xn(){var e,n,t,u=null!==(e=(0,w.UO)().noteID)&&void 0!==e?e:"",g=(0,w.s0)(),x=(0,l.useState)(),h=(0,s.Z)(x,2),j=h[0],S=h[1],I=(0,l.useState)(),D=(0,s.Z)(I,2),P=D[0],C=D[1],z=(0,l.useState)(),F=(0,s.Z)(z,2),V=F[0],M=F[1],A=(0,l.useState)(),U=(0,s.Z)(A,2),H=U[0],K=U[1],B=(0,l.useState)(!0),W=(0,s.Z)(B,2),_=W[0],G=W[1],X=(0,l.useContext)(re.TeamCtx),q=X.io,Q=X.teamOn,$=X.addTeamStatePage;(0,l.useEffect)((function(){(0,o.Z)(c().mark((function e(){var n,t,r,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,b.U9)(u);case 2:if(n=e.sent){e.next=6;break}return Se.ZP.error("Note not found"),e.abrupt("return",g("/"));case 6:t=n.pageRec,n.pdf,r=n.pageOrder,a=(0,i.Z)(n,vn),S((0,Z.D5)(t)),K(r),C(a),M(k.createFromPages(t));case 11:case"end":return e.stop()}}),e)})))()}),[g,u,Q]),(0,l.useEffect)((function(){P&&(document.title=P.name+" - Multibility")}),[P]),(0,l.useEffect)((function(){return document.body.classList.add("reader"),function(){return document.body.classList.remove("reader")}}),[]);var ee=(0,v.Z)((0,o.Z)(c().mark((function e(){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null===j||void 0===j?void 0:j.toObject(),e.next=3,(0,b.SP)(u,{pageRec:n});case 3:G(!0);case 4:case"end":return e.stop()}}),e)})))),ne=(0,l.useCallback)((0,R.Z)(ee,2e3),[ee]),te=ne.flush,ae=function(e,n){S((function(t){return null===t||void 0===t?void 0:t.update(e,d.BJ,n)})),G(!1),ne()},ie=function(){var e=(0,o.Z)(c().mark((function e(n){var t,r=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>1&&void 0!==r[1]&&r[1],K(n),e.next=4,(0,b.SP)(u,{pageOrder:n});case 4:return e.next=6,te();case 6:t&&se(n);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),se=function(e){return null===q||void 0===q?void 0:q.emit("reorder",{pageOrder:e})},ue=(0,v.Z)((function(e){var n=e.deleted,t=e.pageOrder,r=e.prevOrder;ie(t),n&&(0,y.Ow)((function(){return ie(r,!0)}))})),ce=(0,v.Z)((function(e){var n=e.pageOrder,t=e.pageID,r=e.newPage;ie(n),ae(t,(function(){return r})),M((function(e){return null===e||void 0===e?void 0:e.addState(t,r)}))}));(0,l.useEffect)((function(){return null===q||void 0===q||q.on("reorder",ue),null===q||void 0===q||q.on("newPage",ce),function(){null===q||void 0===q||q.removeAllListeners()}}),[q,ue,ce]);var le=function(e,n,t){t.image,t.marked;var r=(0,i.Z)(t,gn);null===q||void 0===q||q.emit("newPage",{pageOrder:e,pageID:n,newPage:r}),$(n,t)},de=function(e,n){var t=m.Dw.flaten(n);ae(e,(function(e){return(0,a.Z)((0,a.Z)({},e),{},{state:t})}))},fe=function(e){if(V){var n=e(V);if(n!==V){M(n);var t,a=n.getLastDS(),i=n.lastOp;if(a&&i)de.apply(void 0,(0,r.Z)(a)),t=i,null===q||void 0===q||q.emit("push",{operation:t},(function(e){var n=e.pageID,t=e.stroke;return M((function(e){return null===e||void 0===e?void 0:e.syncStrokeTime(n,t)}))}))}}},ve=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(H){var t=n?null===j||void 0===j?void 0:j.get(e):void 0,r=(0,d.D4)(t),a=(0,s.Z)(r,2),i=a[0],o=a[1],u=L(H,e,i);le(u,i,o),ie(u),ae(i,(function(){return o})),M((function(e){return null===e||void 0===e?void 0:e.addState(i,o)}))}},ge=function(){var e=(0,T.Z)(H);e&&ve(e)},xe=(0,l.useState)(100),me=(0,s.Z)(xe,2),Ze=me[0],he=me[1],je="".concat((100-Ze)/2,"%"),ke=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=(0,l.useState)((0,Z.D5)()),i=(0,s.Z)(a,2),u=i[0],d=i[1],f=(0,l.useRef)(!1),p=(0,l.useState)(""),g=(0,s.Z)(p,2),x=g[0],m=g[1];(0,l.useEffect)((function(){(0,o.Z)(c().mark((function n(){var t;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,N.getItem(e);case 2:if(t=n.sent){n.next=5;break}return n.abrupt("return",f.current=!0);case 5:m(t);case 6:case"end":return n.stop()}}),n)})))()}),[e]),(0,l.useLayoutEffect)((function(){var e=u.get(x);!f.current&&e&&(e.scrollIntoView(),f.current=!0)}),[x,u]);var h=(0,l.useState)((0,Z.D5)()),j=(0,s.Z)(h,2),k=j[0],b=j[1],y=(0,l.useDeferredValue)(k),w=(0,l.useDeferredValue)(n),S=(0,l.useMemo)((function(){return E(y,w)}),[y,w]);(0,l.useEffect)((function(){f.current&&O(e,S)}),[e,S]);var I=(0,v.Z)((function(){var e,n=u.get(S),t=null===n||void 0===n||null===(e=n.parentElement)||void 0===e?void 0:e.previousElementSibling;return t?-n.getBoundingClientRect().top+t.getBoundingClientRect().height:0})),D=(0,l.useMemo)(I,[n,I].concat((0,r.Z)(t))),P=(0,v.Z)((function(){var e=u.get(S);e&&(e.scrollIntoView(),window.scrollBy(0,D))}));(0,l.useLayoutEffect)(P,[n,P].concat((0,r.Z)(t)));var C=function(e){return function(n){n&&d((function(t){return t.set(e,n)}))}},R=(0,l.useRef)(0),T=(0,l.useState)(!1),L=(0,s.Z)(T,2),z=L[0],F=L[1],V=function(e){var n=u.get(e);n&&(document.addEventListener("scroll",(function e(){window.clearTimeout(R.current),R.current=window.setTimeout((function(){F(!1),document.removeEventListener("scroll",e)}),50)})),n.scrollIntoView({behavior:"smooth"}),F(!0))};return(0,l.useDebugValue)(S),{scrollPage:V,setInviewRatios:b,sectionRef:C,currPageID:S,scrolling:z}}(u,H,[Ze]),be=ke.setInviewRatios,ye=ke.scrollPage,we=ke.sectionRef,Ie=ke.currPageID,De=ke.scrolling,Pe={noteID:u,pageRec:j,pageOrder:H,stateSet:V,currPageID:Ie,size:Ze},Ce=(0,Y.jsxs)("div",{className:"reader container",children:[(0,Y.jsx)(pn,{saved:_,instantSave:te,handleUndo:function(){return fe((function(e){return e.undo()}))},handleRedo:function(){return fe((function(e){return e.redo()}))},undoable:null!==(n=null===V||void 0===V?void 0:V.isUndoable())&&void 0!==n&&n,redoable:null!==(t=null===V||void 0===V?void 0:V.isRedoable())&&void 0!==t&&t}),(0,Y.jsxs)("main",{style:{paddingLeft:je,paddingRight:je},children:[null===H||void 0===H?void 0:H.map((function(e){return(0,Y.jsx)("section",{className:"note-page",ref:we(e),children:(0,Y.jsx)(mn,(0,a.Z)({uid:e,updateStateSet:fe,setInviewRatios:be,scrolling:De},Pe))},e)})),(0,Y.jsx)(oe,{addFinalPage:ge})]}),(0,Y.jsx)(pe,(0,a.Z)({addPage:ve,addFinalPage:ge,scrollPage:ye,deletePage:function(e){var n=null===H||void 0===H?void 0:H.filter((function(n){return n!==e}));(null===n||void 0===n?void 0:n.length)&&ie(n,!0)},saveReorder:ie,switchPageMarked:function(e){return ae(e,(function(e){return(0,a.Z)((0,a.Z)({},e),{},{marked:!e.marked})}))},setSize:he},Pe))]});return(0,Y.jsx)(J.kV,{children:(0,Y.jsx)(p.Wk,{children:(0,Y.jsx)(f.w3,{children:Ce})})})}var mn=function(e){var n=e.uid,t=e.updateStateSet,r=e.setInviewRatios,a=e.scrolling,i=e.pageRec,o=e.stateSet,s=e.currPageID,u=e.pageOrder,c=e.noteID,d=(0,l.useContext)(re.TeamCtx),f=d.teamState,p=d.ignores,g=null===i||void 0===i?void 0:i.get(n),x=null===o||void 0===o?void 0:o.getOneState(n),m=null===f||void 0===f?void 0:f.getOnePageStateMap(n),Z=(0,v.Z)((function(e){t((function(t){return t.setState(n,e)}))})),h=(0,v.Z)((function(e){if(!e)return r((function(e){return e.delete(n)}));r((function(t){return t.set(n,e)}))})),j=(0,l.useMemo)((function(){if(!u)return!1;var e=u.indexOf(s),t=u.indexOf(n);return Math.abs(t-e)<=1}),[s,n,u]);return g&&x?(0,Y.jsx)(S.default,{drawState:x,teamStateMap:m,updateState:Z,pdfIndex:g.pdfIndex,noteID:c,ignores:p,onViewChange:h,preload:j,skipInView:a}):null}},60559:function(e,n,t){t.r(n),t.d(n,{TeamCtx:function(){return j},default:function(){return k}});var r=t(29439),a=t(15861),i=t(87757),o=t.n(i),s=t(72791),u=t(51570),c=t(78577),l=t(69951),d=function(e){return function(){return(0,c.io)(u._n,{query:{userID:(0,l.VN)(),userName:(0,l.vW)(),noteID:e}})}},f=t(16871),p=t(49742),v=t(79856),g=t(5799),x=t(50419),m=t(24124),Z=t(87850),h=t(80184),j=s.createContext({io:void 0,code:0,teamOn:!1,connected:!1,ignores:(0,m.l4)(),userRec:{},teamState:void 0,resetIO:function(){},loadInfo:function(){var e=(0,a.Z)(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!1);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),loadState:function(){var e=(0,a.Z)(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!1);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),setIgnores:function(){},addTeamStatePage:function(e,n){}});function k(){var e,n=null!==(e=(0,f.UO)().noteID)&&void 0!==e?e:"",t=(0,s.useState)(),i=(0,r.Z)(t,2),c=i[0],k=i[1],b=(0,s.useState)(-2),y=(0,r.Z)(b,2),w=y[0],S=y[1],I=(0,s.useState)({}),D=(0,r.Z)(I,2),P=D[0],C=D[1],N=(0,s.useState)((0,m.l4)()),O=(0,r.Z)(N,2),E=O[0],R=O[1],T=(0,s.useState)(d(n)),L=(0,r.Z)(T,2),z=L[0],F=L[1],V=(0,s.useState)(!1),M=(0,r.Z)(V,2),A=M[0],U=M[1],H=(0,s.useState)(!1),K=(0,r.Z)(H,2),B=K[0],W=K[1],_=(0,f.s0)(),G=(0,s.useCallback)((0,a.Z)(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.dn)(n);case 2:if(t=e.sent){e.next=6;break}return x.ZP.error("Failed loading the team note info"),e.abrupt("return",!1);case 6:return S(t.code),e.abrupt("return",!0);case 8:case"end":return e.stop()}}),e)}))),[n]),X=(0,s.useCallback)((0,a.Z)(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.CD)(n);case 2:if(t=e.sent){e.next=6;break}return x.ZP.error("Failed loading the team note state"),e.abrupt("return",!1);case 6:return k(v.f.createFromTeamPages(t)),e.abrupt("return",!0);case 8:case"end":return e.stop()}}),e)}))),[n]),q=(0,s.useCallback)((function(){(0,u.f1)(n)}),[n]);(0,s.useEffect)((function(){var e=function(){var e=(0,a.Z)(o().mark((function e(){var n,t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G();case 2:return n=e.sent,e.next=5,X();case 5:if(t=e.sent,n&&t){e.next=8;break}return e.abrupt("return",_("/"));case 8:U(!0),q();case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return e(),q}),[G,X,_,q]),(0,s.useEffect)((function(){return z.on("push",(function(e){var n=e.operation,t=e.userID;k((function(e){return null===e||void 0===e?void 0:e.pushOperation(n,t)}))})),z.on("join",(function(e){var n=e.joined,t=e.members,r=n.userID,a=n.userName;C(t),r!==(0,l.VN)()&&(0,p.gd)(r,a)})),z.on("leave",(function(e){var n=e.leaved,t=e.members,r=n.userID,a=n.userName;if(C(t),r===(0,l.VN)())return z.emit("join");(0,p.mz)(r,a)})),z.on("newPage",(function(e){var n=e.pageID,t=e.newPage;k((function(e){return null===e||void 0===e?void 0:e.addPage(n,t)}))})),z.on("reset",(function(e){var n=e.userID,t=e.pageRec;n!==(0,l.VN)()&&k((function(e){return null===e||void 0===e?void 0:e.resetUser(n,t)}))})),z.on("connect_error",console.error),z.on("connect",(function(){return W(!0)})),z.on("disconnect",(function(){return W(!1)})),function(){z.removeAllListeners(),z.close()}}),[z]);return(0,h.jsx)(g.g,{loading:!A,children:(0,h.jsx)(j.Provider,{value:{io:z,code:w,teamOn:!0,ignores:E,userRec:P,connected:B,teamState:c,resetIO:function(){return F(d(n))},loadInfo:G,loadState:X,setIgnores:R,addTeamStatePage:function(e,n){k((function(t){return null===t||void 0===t?void 0:t.addPage(e,n)}))}},children:(0,h.jsx)(Z.default,{})})})}},49742:function(e,n,t){t.d(n,{Ow:function(){return u},gd:function(){return c},mz:function(){return l}});var r=t(50419),a=t(87309),i=t(56058),o=t(87962),s=t(80184),u=function(e){r.ZP.warning({content:(0,s.jsxs)(s.Fragment,{children:["One page was deleted.",(0,s.jsx)(a.Z,{size:"small",type:"link",onClick:function(){r.ZP.destroy("DELETE"),e()},children:"Undo"})]}),key:"DELETE",duration:10})},c=function(e,n){r.ZP.destroy(e),r.ZP.success({content:"".concat(n," joined the room"),icon:(0,s.jsx)(i.Z,{}),key:e})},l=function(e,n){r.ZP.destroy(e),r.ZP.warning({content:"".concat(n," leaved the room"),icon:(0,s.jsx)(o.Z,{}),key:e})}}}]);
//# sourceMappingURL=794.7a87ed58.chunk.js.map