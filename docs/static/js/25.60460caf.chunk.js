(self.webpackChunkmultibility=self.webpackChunkmultibility||[]).push([[25],{22568:function(e,t,n){"use strict";var r=n(92721);t.Z=(0,r.Z)({scriptUrl:"//at.alicdn.com/t/font_3181679_yo844n7qgns.js"})},38117:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return we}});var r=n(15861),i=n(29439),a=n(87757),o=n.n(a),u=n(72791),c=n(11886),s=n(81832),l=n(95099),d=n(1413),f=n(93433),v=n(46668),h=n.n(v),p=n(41446),m=n(1488),w=n(82670),g=n(96153),x=function(){var e=new Map,t=(0,g.v)(44,44),n=t.canvas,r=t.context,i=new Image;return i.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAAAXNSR0IArs4c6QAABWlJREFUWEftmF1IW2cYx580iaaNSTSmdWUtRVBBnENbSG40YVtRRpZM4ydqLEpJnd5sVzpxU7TipoMy8EYd6kwC6pakiDeCih/oyBGibS/qTZWaoE63RONXqiYZj5xIKtvFzhvRQl84nHPzvud3nvO8//f5Pyx4xwbrHeOF98Dn/cfeR/h9hM9EgDQlcP4VgJPNi/ezww8AeHnpO/EPIAXm2O32+3w+/xOv13vF5/O9tR6Hw/FxuVyvUChsAIDDUECTAOPca1NTU5+np6f/Zjab7X6//631cnJybjkcjp9v375dDwB7AHBMGmISYEwBocViUWVlZfVJpVLP3NwcLxjI7/fD4uJiR2Ji4vcA4AKAo4sEZgNApF6vzy4pKelCYK/Xy3K73dympqa/EaywsPD6/Px89927d78DgL/otCBiJokwAkf19vZqHjx40CGVSt8gyfLycrhMJvMMDw+fRHthYaEnNTUVgTcvJXBZWdlhZWWlID8/3z0wMCC02Wy99+7dCwCffBTJCHmEKYoKr66udra2torLy8v/7Orqik5JSUl+8eLFCgDsk8DiXFLgSKPRmFVUVPTLWZDc3NzdsbExVJFdgUDwNDY29msA2AYAHwk0CTCqhMBisahfv34tcbvdgsPDw7Dj42NOTU3Nw6mpqSO1Wv1BYWGhU6/Xc2tra+VtbW2LAOC5KGD82KsobQAgop/DASDCYDBoiouLKzUajdtisQiXlpYOfD7fr3Fxcd8CgJskyiQRxkBxACAMALj0M96FkZGRH9rt9gGj0ciuqKgQt7e3b2i1WqdIJPoUAFDy8NRjNEiBA/sA1wnUExEAcHNmZqYuNTVVJZFIIjIzM7cHBwe5XC73IwBYB4ADRrSEm+6/3on6e2N4eLhSqVRWKxSKY5fL5Xv+/HlYY2Pj/fr6egoAdi4TMKaJpL29XV1VVdWhVqv3bTZbuMPhYJtMJl1ubu7vALDFtBAKRUqcDRaqh1ilUn08NDQ0VlpaumUymSL39vaAoqgfZTLZTwDgZLrxzgMY14zKzs5ONpvNE1qt1mU2m6MQeGZmpi0tLS0AzKhyOzfg7u5uVVlZWa9ard6z2Ww8TImenp7K8vJyEx3hSwN8khKTk5NVcrm8QaFQHLlcLj9uukePHn3R2dlpvWwpcbLpnj179jghISE/OjpakJGRsd3f3w88Hi8dAOz0EY3W6X+P80gJ3p07d26+fPly1mAwcHQ6HSrGZl5e3mZMTEw2AKxdtKwFDo3Tg8NqtX4llUqbNRrNtsViEb169cqztrZmSEtLewwAGxd5cHBWV1c/293d5RwcHLA9Hg97fX2dn5GR0To+Pu5VKpW3CgoKtoxGY4RSqVSNjIws0EczY6tEkhInxY/Vas2USqXms8mYl5e3Mzo6yp+YmNjn8/m2+Pj4KgBwXGTxc1pe0iYU6wMWRVG85ubmjbq6uhs6nc7Z0dEhrq2tfdjS0jJKmg4hLeDRhCJwQ0PDQUFBgTA5OfnN7Ozs1enp6QG5XP4DrQ54JGNThfEgSYl/NaFbW1vs1dXVKysrK06xWCyhKEovk8kaaXXA3gTRCCkwwu7s7LCePHmCPQi0+RLahGJfAtXhcpnQubk5dBynAxspl87m9/X1ZWu12s7+/n7sOwT/MX9QIwUjfOF9CVQJ0eDg4JcKheKbo6MjbnBvjcVi+dls9rHT6fwjKSkJgbGkZKy/gd9GksM4l4+FDgBcRwdNe7vA2mjncZOhh8M2FboMRhVacJqRAOM6aDrROV+jzWhwjxiLG4woyh02UHDDMSp4QgmMH4zyhlegsR1YP7iZjdpL1EAJRUoQ6SnTyaQpwfS9jOe9c8D/AEaRMEuceu4YAAAAAElFTkSuQmCC",function(t){t=10*Math.round(t/10);var a=e.get(t);if(a)return a;r.translate(22,22),r.rotate(t*Math.PI/180),r.drawImage(i,-22,-22);var o=n.toDataURL();return r.clearRect(-22,-22,44,44),r.resetTransform(),e.set(t,o),o}}(),C=function(e){return"url(".concat(x(e),") 22 22, auto")};function Z(e){var t=(0,u.useRef)(!1),n=function(e){return e.isPrimary&&(t.current="touch"===e.pointerType)},r=function(n){return function(n){return!t.current||function(e){var t=e.touches[0];return"stylus"===(null===t||void 0===t?void 0:t.touchType)}(n)||e&&1===n.touches.length}(n)||n.stopPropagation()};return{onPointerDownCapture:n,onPointerMoveCapture:n,onTouchStartCapture:r,onTouchMoveCapture:r}}var j=n(80184),S=h().Path,b=h().Size,y=h().Point,A=h().Group,k=h().Color,E=h().Raster,D=h().Layer,R=u.forwardRef((function(e,t){var n=e.drawState,r=e.otherStates,a=e.onChange,o=void 0===a?function(){}:a,s=e.drawCtrl,l=void 0===s?c.Hq:s,v=e.readonly,x=void 0!==v&&v,R=e.imgSrc,T=e.setActiveTool,I=void 0===T?function(){}:T,K=n.width,q=n.height,Y=l.mode,H=l.finger,Q=l.lasso,X=l.eraserWidth,G=(0,u.useRef)(null),_=(0,u.useRef)(new(h().PaperScope)),$=(0,u.useState)([]),ee=(0,i.Z)($,2),te=ee[0],ne=ee[1],re=N(),ie=(0,i.Z)(re,2),ae=ie[0],oe=ie[1],ue=N(),ce=(0,i.Z)(ue,2),se=ce[0],le=ce[1],de=N(),fe=(0,i.Z)(de,2),ve=fe[0],he=fe[1];(0,u.useEffect)((function(){var e,t=G.current,n=_.current;if(t)return n.setup(t),n.settings.handleSize=10,n.settings.hitTolerance=20,[0,1,2].forEach((function(){return(new D).visible=!1})),null===(e=n.project.layers[2])||void 0===e||e.activate(),new n.Tool,function(){var e;null===(e=n.view)||void 0===e||e.remove(),(0,g.j)(t)}}),[]),(0,u.useEffect)((function(){_.current.activate();var e=_.current.project.layers,t=M(e,K,q);return function(){return t.forEach((function(e){return e.remove()}))}}),[K,q]);var pe=(0,m.Z)(G),me=(0,i.Z)(pe,1)[0]/K;(0,u.useEffect)((function(){if(me){var e=_.current,t=new y(0,0);return e.view.viewSize=new b(K,q).multiply(me),e.view.scale(me,t),e.project.layers.forEach((function(e){return e.visible=!0})),e.view.update(),function(){var n;return null===(n=e.view)||void 0===n?void 0:n.scale(1/me,t)}}}),[K,q,me]),(0,u.useEffect)((function(){var e;if(R){_.current.activate();var t=new E(R);return null===(e=t.project.layers[0])||void 0===e||e.addChild(t),t.sendToBack(),t.onLoad=function(){t.view.update(),t.fitBounds(new(h().Rectangle)(0,0,K,q)),t.bringToFront()},function(){null===t||void 0===t||t.remove()}}}),[R,K,q]);var we=(0,u.useMemo)((function(){return r?w.Dw.mergeStates.apply(w.Dw,[n].concat((0,f.Z)(r))):n.getStrokeList()}),[n,r]);(0,u.useEffect)((function(){var e=[],t=_.current.project.layers[1];if(t)return _.current.activate(),we.forEach((function(r){var i=n.hasStroke(r.uid),a=P(r,t,!i);i&&e.push(a)})),ne(e),function(){t.removeChildren(1)}}),[we,n]);var ge=(0,u.useRef)(),xe=(0,u.useState)(!1),Ce=(0,i.Z)(xe,2),Ze=Ce[0],je=Ce[1],Se="select"===Y&&Ze?"selected":Y,be=(0,u.useState)([]),ye=(0,i.Z)(be,2),Ae=ye[0],ke=ye[1],Ee=(0,u.useMemo)((function(){var e=new Set(Ae);return te.filter((function(t){return e.has(t.name)}))}),[te,Ae]),De=(0,u.useCallback)((function(){je(!1),oe(void 0),le(void 0),he(void 0)}),[oe,le,he]);(0,u.useEffect)((function(){if("select"===Y)return De}),[Y,De]),(0,u.useEffect)((function(){return De}),[Q,De]),(0,u.useEffect)((function(){if(Ze)return function(){ke([]),I("")}}),[Ze,I]);var Re=function(){return oe(L(l))},Te=function(e){return le(W(e.point))},Ne={draw:Re,erase:Re,select:Q?Re:Te,selected:function(e){if(Q){if(null!==ae&&void 0!==ae&&ae.contains(e.point))return;Re(),je(!1)}else{var t,n=null!==(t=null===se||void 0===se?void 0:se.hitTest(e.point,{segments:!0}))&&void 0!==t?t:null===ve||void 0===ve?void 0:ve.hitTest(e.point,{segments:!0,selected:!0});if(ge.current=n,n)return;if(null!==se&&void 0!==se&&se.contains(e.point))return;Te(e),he(void 0),je(!1)}},text:function(e){var t,n=_.current.project.layers[1];if(n){var r=null!==(t=F(n,e.point))&&void 0!==t?t:U(e.point);et(r)}}}[Se],Pe=function(e){null===ae||void 0===ae||ae.add(e.point),null===ae||void 0===ae||ae.smooth()},Me={draw:Pe,erase:Pe,select:Q?Pe:function(e){if(se){var t=e.point,n=t.x,r=t.y,a=(0,i.Z)(se.segments,4),o=a[1],u=a[2],c=a[3];o&&u&&c&&(o.point.x=n,u.point=e.point,c.point.y=r,se.selected=!0)}},selected:function(e){var t=ge.current;if(null!==t&&void 0!==t&&t.segment&&se&&ve){var n=t.segment;if(n.selected){var r=se.bounds.center,i=n.point.subtract(r),a=e.point.subtract(r);Ue(C(a.angle));var o=a.angle-i.angle;se.rotate(o,r),ve.rotate(o,r),Ee.forEach((function(e){return null===e||void 0===e?void 0:e.rotate(o,r)}))}else{var u,c=n.point,s=n.next.next.point,l=c.subtract(s),d=e.point.subtract(s).project(l).x/l.x;if(d<0)return;se.scale(d,s),Ee.forEach((function(e){e.scale(d,s),e.strokeWidth*=d})),ve.scale(d,s);var f=null===(u=ve.segments[0])||void 0===u?void 0:u.point;if(!f)return;ve.scale(100/ve.length,f)}}else Ee.forEach((function(t){return t.translate(e.delta)})),null===ae||void 0===ae||ae.translate(e.delta),null===se||void 0===se||se.translate(e.delta),null===ve||void 0===ve||ve.translate(e.delta)},text:function(e){if($e&&!$e.name){var t=$e.bounds,n=t.topCenter,r=t.bottomRight.subtract(n),i=e.point.subtract(n).project(r).x/r.x;i<0||$e.scale(i,n)}}}[Se];(0,u.useEffect)((function(){_.current.tool.maxDistance=X}),[X]);var We=(0,u.useRef)(new Set),Le=(0,u.useRef)(new Map),Ve=function(e){if("erase"===Se){var t=_.current.project.layers[1],n=null===t||void 0===t?void 0:t.hitTestAll(e.point,{class:h().Path,stroke:!0,tolerance:X/2});null===n||void 0===n||n.forEach((function(n){var r=n.item;if(r instanceof h().Path){for(var i=r;i.parent!==t&&i.parent instanceof h().PathItem;)i=i.parent;var a=i.name;if(l.pixelEraser){var o=(X+r.strokeWidth)/2,u=new S.Circle(e.point,o);u.remove();var c=r.subtract(u,{trace:!1});r.replaceWith(c),i===r&&(i=c),Le.current.set(a,i)}else i.opacity=.5,i.guide=!0,We.current.add(a)}}))}},Oe={draw:function(){if(ae&&!ae.isEmpty()){ae.simplify();var e=ae.exportJSON();oe(void 0),o((function(t){return w.Dw.addStroke(t,e)}))}},erase:function(){if(oe(void 0),l.pixelEraser){var e=Array.from(Le.current);Le.current.clear();var t=e.map((function(e){var t=(0,i.Z)(e,2),n=t[0],r=t[1];return[n,B(r).map((function(e){return e.exportJSON()}))]}));if(!t.length)return;o((function(e){return w.Dw.splitStrokes(e,t)}))}else{var n=Array.from(We.current);if(We.current.clear(),!n.length)return;o((function(e){return w.Dw.eraseStrokes(e,n)}))}},select:function(){var e;if(Q){if(!ae||Math.abs(ae.area)<1e3)return oe(void 0);ae.closePath(),ae.simplify(),V(ae),e=z(te,ae)}else{if(!se||Math.abs(se.area)<1e3)return le(void 0);e=z(te,se);var t=new S,n=se.bounds.topCenter;t.add(n,n.subtract(new y(0,100))),t.lastSegment.selected=!0,he(t)}je(!0),ke(e),I("select")},selected:function(e){qe(),Be(e)},text:function(){I("text")}}[Se],ze=(0,u.useState)("auto"),Je=(0,i.Z)(ze,2),Fe=Je[0],Ue=Je[1];(0,u.useEffect)((function(){"text"===Se||"select"===Se?Ue("crosshair"):"selected"===Se?Ue(Q?"crosshair":"nwse-resize"):"draw"!==Se&&"erase"!==Se||Ue(function(e,t){var n=e.lineWidth,r=e.eraserWidth,i=t*("erase"===e.mode?r:n);if(i<5)return"crosshair";var a=i/2;return'url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" fill="%23FFF7" width="'.concat(i,'" height="').concat(i,'" viewBox="0 0 10 10"><circle cx="5" cy="5" r="5"/></svg>\') ').concat(a," ").concat(a,", auto")}(l,me))}),[Se,Q,l,me]);var Be=function(e){var t,n,r=null!==(t=null===se||void 0===se?void 0:se.hitTest(e.point,{segments:!0}))&&void 0!==t?t:null===ve||void 0===ve?void 0:ve.hitTest(e.point,{segments:!0,selected:!0});if(null!==r&&void 0!==r&&r.segment){if(r.segment.selected){var i=null===se||void 0===se?void 0:se.bounds.center;if(!i)return;var a=r.segment.point.subtract(i);return Ue(C(a.angle))}var o=r.segment.point,u=r.segment.next.next.point,c=o.subtract(u),s=c.x,l=c.y;return Ue(s*l<0?"nesw-resize":"nwse-resize")}if(null!==(n=null!==se&&void 0!==se?se:ae)&&void 0!==n&&n.contains(e.point))return Ue("move");Ue("crosshair")},Ie=(0,d.Z)({selected:Be,text:function(e){var t=_.current.project.layers[1];t&&(F(t,e.point)?Ue("text"):Ue("crosshair"))}},{select:null,draw:null,erase:null})[Se],Ke="selected"===Se?function(e){["delete","backspace"].includes(e.key)&&Ye()}:null;(0,u.useEffect)((function(){if(!x){var e=function(e){return function(t){if(_.current.activate(),e)return e(t)}},t=_.current,n=t.view,r=t.tool;n.onMouseDown=e(Ne),n.onMouseDrag=e(Me),n.onMouseUp=e(Oe),n.onMouseMove=e(Ie),r.onMouseDrag=e(Ve),r.onKeyUp=e(Ke)}}));var qe=function(){if(null!==Ee&&void 0!==Ee&&Ee.length){var e=Ee.map((function(e){return[e.name,e.exportJSON()]}));o((function(t){return w.Dw.mutateStrokes(t,e)}))}},Ye=function(){De(),Ae.length&&o((function(e){return w.Dw.eraseStrokes(e,Ae)}))},He=function(e){_.current.activate(),J(Ee,e),qe()},Qe=function(){var e;_.current.activate();var t=null===(e=se||ae)||void 0===e?void 0:e.bounds.size;if(t&&Ee.length){var n=t.width,r=t.height,a=new y(n,r).divide(10),u=Ee.map((function(e){return e.clone()}));u.forEach((function(e){return e.translate(a)})),null===se||void 0===se||se.translate(a),null===ae||void 0===ae||ae.translate(a),null===ve||void 0===ve||ve.translate(a);var c=u.map((function(e){return[w.Dw.getUid(),e.exportJSON()]}));o((function(e){return w.Dw.mutateStrokes(e,c)})),ke(c.map((function(e){return(0,i.Z)(e,1)[0]})))}},Xe=function(){var e=new A(Ee),t=_.current.project.layers[1];return t?(e.addTo(t),e.rasterize({insert:!1}).toDataURL()):""},Ge=N(),_e=(0,i.Z)(Ge,2),$e=_e[0],et=_e[1],tt=(0,u.useCallback)((function(){et(void 0),I("")}),[et,I]);(0,u.useEffect)((function(){if("text"===Y)return tt}),[Y,tt]);var nt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#000",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"center";if($e){$e.content=e,$e.fillColor=new k(t),$e.justification=n;var r=$e.exportJSON(),i=$e.name;if(tt(),!i)return o((function(e){return w.Dw.addStroke(e,r)}));o((function(e){return w.Dw.mutateStrokes(e,[[i,r]])}))}};(0,u.useImperativeHandle)(t,(function(){return{deleteSelected:Ye,duplicateSelected:Qe,cancelText:tt,submitText:nt,mutateStyle:He,rasterize:Xe,pointText:$e}})),(0,u.useEffect)((function(){var e=function(e){return e.preventDefault()};return document.addEventListener("gesturestart",e),document.addEventListener("gesturechange",e),document.addEventListener("gestureend",e),function(){document.removeEventListener("gesturestart",e),document.removeEventListener("gesturechange",e),document.removeEventListener("gestureend",e)}}),[]),(0,p.usePinch)((function(e){var t=e.memo,n=(0,i.Z)(e.offset,1)[0],r=e.first,a=e.last,o=e.origin;_.current.activate();var u,c,s,l=_.current.view,d=new y(o);if(r||!t){var f=G.current.getBoundingClientRect(),v=f.x,h=f.y;u=1,s=new y(v,h),c=d.subtract(s)}else{var p=(0,i.Z)(t,3);u=p[0],c=p[1],s=p[2]}var m=d.subtract(s),w=l.viewToProject(m);Math.abs(1-n)<.05&&(n=1);var g=r?1:n/u,x=a?10:1;g=Math.pow(g,1/x);!function e(){l.scale(g,w),_.current.settings.hitTolerance/=g,--x>0?requestAnimationFrame(e):a&&O(l,new b(K,q))}();var C=m.subtract(c).divide(l.zoom);if(l.translate(C),!a)return[n,m,s]}),{scaleBounds:{max:10,min:.3},rubberband:.5,target:G});var rt=Z(H);return(0,j.jsx)("div",(0,d.Z)((0,d.Z)({className:"draw-wrapper",style:{cursor:Fe},"data-readonly":x},rt),{},{children:(0,j.jsx)("canvas",{ref:G,className:"draw-canvas"})}))}));R.displayName="Draw";var T=u.memo(R);function N(){var e=(0,u.useState)(),t=(0,i.Z)(e,1)[0];return(0,u.useDebugValue)(t),(0,u.useEffect)((function(){if(null===t||void 0===t||!t.name)return function(){null===t||void 0===t||t.remove()}}),[t]),e}var P=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.pathData,i=e.uid;try{var a=t.importJSON(r);return a?(a.name=i,a.guide=n,a):new(h().Item)}catch(o){return console.error(o),new(h().Item)}},M=function(e,t,n){var r=(0,i.Z)(e,3),a=r[0],o=r[1],u=r[2];if(!a||!o||!u)return[];var c=new S.Rectangle(new y(0,0),new y(t,n)),s=c.clone(),l=s.clone();return c.fillColor=new k("#fff"),a.addChild(c),o.addChild(s),u.addChild(l),o.clipped=!0,u.clipped=!0,[c,s,l]},W=function(e){var t=new S.Rectangle(e,new b(0,0));return t.onFrame=function(){},t},L=function(e){var t=e.mode,n=e.lineWidth,r=e.eraserWidth,i=e.color,a=e.highlight,o=new S;"erase"===t&&(i="#ccc",n=r),"select"===t&&(i="#009dec",n=5);var u=new k(i);return(a||"erase"===t)&&(u.alpha=.5,o.blendMode="multiply"),o.strokeColor=u,o.strokeWidth=n,o.strokeJoin="round",o.strokeCap="round",o.guide=!0,o},V=function(e){e.dashOffset=0,e.dashArray=[30,20],e.onFrame=function(){return e.dashOffset+=3}},O=function(e,t){var n=function(e,t){var n=e.center,r=n.x,i=n.y,a=e.size,o=a.width,u=a.height,c=t.width,s=t.height,l=Math.min(o,c)/2,d=Math.min(u,s)/2,f=c-l,v=s-d;return[r<l?l-r:r>f?f-r:0,i<d?d-i:i>v?v-i:0]}(e,t),r=(0,i.Z)(n,2),a=r[0],o=r[1],u=10,c=new y(a,o).divide(-u);!function t(){e.translate(c),--u>0&&requestAnimationFrame(t)}()},z=function(e,t){var n=function(e){var n=e.subtract(t,{insert:!1,trace:!1});return n.remove(),!n.compare(e)};return e.filter((function(e){if(!e.name)return!1;if(!e.bounds.intersects(t.bounds))return!1;if(e instanceof h().Path)return n(e);var r=new S.Rectangle(e.bounds);return r.remove(),n(r)||t.isInside(e.bounds)})).map((function(e){return e.name}))},J=function(e,t){var n=t.lineWidth,r=t.color,i=t.highlight;e.forEach((function(e){if(e instanceof h().PointText&&r){var t=new k(r);e.fillColor=t}if(e instanceof h().Path){if(r){var a=new k(r);"multiply"===e.blendMode&&(a.alpha=.5),e.strokeColor=a}n&&(e.strokeWidth=n),e.strokeColor&&void 0!==i&&(e.strokeColor.alpha=i?.5:1,e.blendMode=i?"multiply":"normal")}}))},F=function(e,t){var n=e.hitTest(t,{class:h().PointText,fill:!0});if((null===n||void 0===n?void 0:n.item)instanceof h().PointText)return null===n||void 0===n?void 0:n.item},U=function(e){return new(h().PointText)({point:e.add(new y(0,50)),content:"Insert text...",fontSize:50,justification:"center",fillColor:"#1890ff55"})},B=function e(t){return t instanceof h().Path?t.isEmpty()?[]:[t]:t instanceof h().CompoundPath?t.children.map(e).flat():[]},I=n(64239),K=n(61507),q=n(23414),Y=n(82622),H=n(72785),Q=n(22925),X=n(4720),G=n(41275),_=n(27190),$=n(69228),ee=n(87309),te=n(87501),ne=n(89295),re=n(48),ie=n(66023),ae=n(74115),oe=n(54164),ue=n(64802),ce=function(e){var t=e.drawRef,n=e.visible;return(0,j.jsx)(ne.Z,{timeout:300,in:n,unmountOnExit:!0,children:(0,j.jsx)(se,{drawRef:t})})},se=function(e){var t=e.drawRef,n={type:"text",shape:"round",size:"small"},r=(0,u.useState)({}),a=(0,i.Z)(r,2),o=a[0],c=a[1];return(0,oe.createPortal)((0,j.jsxs)("div",{className:"select-tool",children:[(0,j.jsx)($.Z,{trigger:"click",placement:"bottom",getPopupContainer:function(e){return e.parentElement},destroyTooltipOnHide:!0,content:(0,j.jsx)(re.Uk,{updateDrawCtrl:function(e){var n;c((function(t){return(0,d.Z)((0,d.Z)({},t),e)})),null===(n=t.current)||void 0===n||n.mutateStyle(e)},drawCtrl:o}),children:(0,j.jsx)(ee.Z,(0,d.Z)({icon:(0,j.jsx)(K.Z,{})},n))}),(0,j.jsx)(ee.Z,(0,d.Z)({icon:(0,j.jsx)(q.Z,{}),onClick:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.duplicateSelected()}},n)),(0,j.jsx)(ee.Z,(0,d.Z)({icon:(0,j.jsx)(I.Z,{}),onClick:function(){if(t.current){var e=t.current.rasterize();_.Z.confirm({title:"Screenshot",content:(0,j.jsx)("img",{className:"raster",src:e,alt:"raster"}),className:"raster-modal",icon:(0,j.jsx)(I.Z,{}),okText:"Save",onOk:function(){return(0,ue.saveAs)(e,"screenshot")}})}}},n)),(0,j.jsx)(ee.Z,(0,d.Z)({danger:!0,icon:(0,j.jsx)(Y.Z,{}),onClick:function(){var e;return null===(e=t.current)||void 0===e?void 0:e.deleteSelected()}},n))]}),document.querySelector(".reader.container > header"))},le=function(e){var t=e.visible,n=e.drawRef,r=(0,u.useState)(""),a=(0,i.Z)(r,2),o=a[0],c=a[1],l=(0,u.useState)(ae.Qk[0]),d=(0,i.Z)(l,2),f=d[0],v=d[1],h=(0,u.useState)("center"),p=(0,i.Z)(h,2),m=p[0],w=p[1],g=(0,s.iX)(),x=(0,i.Z)(g,1)[0];(0,u.useEffect)((function(){var e,r=null===(e=n.current)||void 0===e?void 0:e.pointText;if(r&&t){var i,a=r.name,o=r.content,u=r.justification,s=r.fillColor;if(w(u),a)c(o),v(null!==(i=null===s||void 0===s?void 0:s.toCSS(!0))&&void 0!==i?i:ae.Qk[0]);else c(""),v(ae.Qk[0])}}),[t,n]);var C=(0,j.jsx)($.Z,{content:(0,j.jsx)(re.Q5,{color:f,setColor:v}),overlayStyle:{width:200},placement:"bottom",getPopupContainer:function(e){return e.parentElement},children:(0,j.jsx)(ee.Z,{size:"small",icon:(0,j.jsx)(H.Z,{className:"font-icon",style:{color:f}})})}),Z=(0,j.jsx)(te.ZP.Group,{size:"small",optionType:"button",value:m,buttonStyle:"solid",onChange:function(e){return w(e.target.value)},options:[{label:(0,j.jsx)(Q.Z,{}),value:"left"},{label:(0,j.jsx)(X.Z,{}),value:"center"},{label:(0,j.jsx)(G.Z,{}),value:"right"}]});return(0,j.jsxs)(_.Z,{visible:t,title:"Insert text",onCancel:function(){var e;return null===(e=n.current)||void 0===e?void 0:e.cancelText()},onOk:function(){var e,t,r=o.trim();if(!r)return null===(e=n.current)||void 0===e?void 0:e.cancelText();null===(t=n.current)||void 0===t||t.submitText(r,f,m)},bodyStyle:{paddingTop:0},destroyOnClose:!0,children:[(0,j.jsxs)("div",{className:"insert-option","data-force-light":x,children:[C,Z]}),(0,j.jsx)(ie.Z,{size:"large",rows:3,autoFocus:!0,value:o,onChange:function(e){return c(e.target.value)}})]})},de=n(763),fe=n(19348),ve=n(24124),he=function(e){var t=e.thumbnail,a=e.drawState,c=e.teamStateMap,l=e.updateState,d=e.pdfIndex,f=e.noteID,v=void 0===f?"":f,h=e.preview,p=void 0!==h&&h,m=e.onViewChange,w=e.preload,g=void 0!==w&&w,x=e.ignores,C=void 0===x?(0,ve.l4)():x,Z=e.skipInView,S=void 0!==Z&&Z,b=m&&(0,de.range)(0,1.2,.2),y=(0,fe.YD)({threshold:b,skip:S}),A=(0,i.Z)(y,3),k=A[0],E=A[1],D=A[2];(0,u.useEffect)((function(){if(m)return D&&E?void m(D.intersectionRatio):m(0)}),[E,D,m]);var R=(0,u.useState)(),T=(0,i.Z)(R,2),N=T[0],P=T[1],M=(0,u.useCallback)((0,de.once)((0,r.Z)(o().mark((function e(){var t,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d&&v){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,Promise.all([n.e(643),n.e(138)]).then(n.bind(n,21176));case 4:return t=e.sent,r=t.getNotePageImage,e.t0=P,e.next=9,r(v,d);case 9:e.t1=e.sent,(0,e.t0)(e.t1);case 11:case"end":return e.stop()}}),e)})))),[d,v]),W=E||g;(0,u.useEffect)((function(){!p&&W&&M()}),[W,p,M]);var L=(0,u.useMemo)((function(){return null===c||void 0===c?void 0:c.deleteAll(C).toList().toArray()}),[c,C]),V=Boolean(N||!d),O=W&&V,z=a.height/a.width,J=(0,s.iX)(),F=(0,i.Z)(J,1)[0];return(0,j.jsxs)("div",{ref:k,className:"page-wrapper","data-force-light":F,children:[(0,j.jsx)("svg",{viewBox:"0 0 100 ".concat(100*z)}),O&&(0,j.jsx)(me,{drawState:a,otherStates:L,updateState:l,imgSrc:N||t,preview:p})]})};he.displayName="PageWrapper";var pe=u.memo(he),me=function(e){var t=e.drawState,n=e.updateState,r=e.otherStates,a=e.preview,o=void 0!==a&&a,s=e.imgSrc,d=(0,c.gX)(),f=(0,u.useState)(""),v=(0,i.Z)(f,2),h=v[0],p=v[1],m=(0,u.useRef)(null),g=(0,l.Z)((function(e){if(n){var r=e instanceof w.Dw?e:e(t);r!==t&&n(r)}}));return o?(0,j.jsx)(T,{drawState:t,otherStates:r,imgSrc:s,readonly:!0}):(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(T,{drawState:t,otherStates:r,onChange:g,imgSrc:s,drawCtrl:d,ref:m,setActiveTool:p}),(0,j.jsx)(ce,{drawRef:m,visible:"select"===h}),(0,j.jsx)(le,{drawRef:m,visible:"text"===h})]})};me.displayName="DrawWrapper";var we=pe},11886:function(e,t,n){"use strict";n.d(t,{Eq:function(){return f},F7:function(){return g},Hq:function(){return v},gX:function(){return w},w3:function(){return x}});var r=n(1413),i=n(29439),a=n(15861),o=n(87757),u=n.n(o),c=n(61842),s=n.n(c),l=n(72791),d=n(80184),f=[10,20,30,50],v={mode:"draw",finger:!0,lineWidth:10,eraserWidth:10,color:"#000000",highlight:!1,lasso:!0,pixelEraser:!1,widthList:f};function h(){return(h=(0,a.Z)(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s().getItem("DRAW_CTRL");case 2:if(t=e.sent){e.next=7;break}return t=v,e.next=7,s().setItem("DRAW_CTRL",t);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(){return(p=(0,a.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s().setItem("DRAW_CTRL",t);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var m=l.createContext({drawCtrl:v,updateDrawCtrl:function(){}});function w(){var e=(0,l.useContext)(m).drawCtrl;return(0,l.useDebugValue)(e),e}function g(){return(0,l.useContext)(m).updateDrawCtrl}var x=function(e){var t=e.children,n=(0,l.useState)(v),a=(0,i.Z)(n,2),o=a[0],u=a[1];(0,l.useEffect)((function(){(function(){return h.apply(this,arguments)})().then(u)}),[]);return(0,d.jsx)(m.Provider,{value:{drawCtrl:o,updateDrawCtrl:function(e){u((function(t){var n=(0,r.Z)((0,r.Z)({},t),e);return function(e){p.apply(this,arguments)}(n),n}))}},children:t})}},96153:function(e,t,n){"use strict";function r(e,t){var n=document.createElement("canvas"),r=n.getContext("2d");if(!r)throw new Error("can't get virtual canvas context");return n.width=e,n.height=t,{canvas:n,context:r}}function i(e){e.width=1,e.height=1;var t=e.getContext("2d");null===t||void 0===t||t.clearRect(0,0,1,1)}n.d(t,{j:function(){return i},v:function(){return r}})},48:function(e,t,n){"use strict";n.d(t,{Q5:function(){return Z},Uk:function(){return g},Db:function(){return x}});var r=n(4942),i=n(93433),a=n(29439),o=n(72791),u=n(11886),c=n(35873),s=n(82670),l=n(69228),d=n(96272),f=n(53163),v=n(74115),h=n(22568),p=n(24124),m=n(81832),w=n(80184),g=function(e){var t=e.updateDrawCtrl,n=e.drawCtrl,r=n.highlight,i=n.color,u=(0,o.useState)(!1),c=(0,a.Z)(u,2),s=c[0],l=c[1];return(0,w.jsxs)("div",{className:"pen-panel","data-blur":s,"data-hi":r,children:[(0,w.jsxs)("div",{className:"pen-status",children:[(0,w.jsx)(x,{updateDrawCtrl:t,drawCtrl:n,setPanelBlur:l}),(0,w.jsx)(C,{checked:r,updateDrawCtrl:t})]}),(0,w.jsx)(Z,{color:i||"",setColor:function(e){return t({color:e})}})]})},x=function(e){var t,n,v=e.updateDrawCtrl,h=e.drawCtrl,g=e.setPanelBlur,x=void 0===g?function(){}:g,C=e.field,Z=void 0===C?"lineWidth":C,j=h[Z],S=null!==(t=h.widthList)&&void 0!==t?t:u.Eq,b="lineWidth"===Z&&null!==(n=h.color)&&void 0!==n?n:"#aaa",y=(0,o.useMemo)((function(){return S.indexOf(null!==j&&void 0!==j?j:-1)}),[j,S]),A=(0,o.useState)((0,p.aV)([!1,!1,!1,!1])),k=(0,a.Z)(A,2),E=k[0],D=k[1];(0,o.useEffect)((function(){E.includes(!0)?x(!0):x(!1)}),[E,x]);var R=function(e){return{"--real-size":"calc(".concat(100/s.mF,"vw * ").concat(e,")")}},T=(0,m.iX)(),N=(0,a.Z)(T,1)[0],P=[{value:-1,label:null}].concat((0,i.Z)(S.map((function(e,t){return{value:t,label:(0,w.jsx)(l.Z,{visible:E.get(t),onVisibleChange:function(e){return D((function(n){return n.set(t,e)}))},trigger:y===t?["click"]:[],placement:"bottom",destroyTooltipOnHide:!0,content:(0,w.jsx)(d.Z,{min:5,max:100,className:"ctrl-slider",defaultValue:e,onAfterChange:function(e){if(S.includes(e))return D((function(e){return e.set(t,!1)})),v((0,r.Z)({},Z,e));var n=S.slice();n[t]=e,v((0,r.Z)({widthList:n},Z,e))}}),children:(0,w.jsx)("div",{className:"circle-wrapper","data-force-light":N,style:R(e),children:(0,w.jsx)(c.W,{className:"width-circle "+Z,color:b})})})}}))));return(0,w.jsx)(f.Z,{className:"width-seg",value:y,options:P,onChange:function(e){var t;return v((0,r.Z)({},Z,null!==(t=S[+e])&&void 0!==t?t:10))}})},C=function(e){var t=e.checked,n=void 0!==t&&t,r=e.updateDrawCtrl;return(0,w.jsxs)("label",{className:"hi-wrapper",children:[(0,w.jsx)("input",{type:"checkbox",name:"highlight",checked:n,onChange:function(e){return r({highlight:e.target.checked})}}),(0,w.jsx)("div",{className:"hi-switch",children:(0,w.jsx)(h.Z,{type:"icon-Highlight"})})]})},Z=function(e){var t=e.setColor,n=e.color,r=(0,m.iX)(),i=(0,a.Z)(r,1)[0];return(0,w.jsx)("div",{className:"color-select","data-force-light":i,children:v.Qk.map((function(e){return(0,w.jsxs)("label",{children:[(0,w.jsx)("input",{checked:n===e,type:"radio",name:"color",onChange:function(n){return n.target.checked&&t(e)}}),(0,w.jsx)("div",{"data-color":e,className:"circle",style:{backgroundColor:e,borderColor:e}})]},e)}))})}},90858:function(){},64158:function(){}}]);
//# sourceMappingURL=25.60460caf.chunk.js.map