{"version":3,"file":"static/js/752.4c3622cc.chunk.js","mappings":"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","sources":["lib/draw/StateSet.ts","pages/reader/ReaderUtils.tsx","pages/reader/lib/scroll.ts","pages/reader/lib/array.ts","pages/reader/header/Left.tsx","pages/reader/header/Middle.tsx","component/UserAvatar.tsx","pages/reader/PageNav.tsx","pages/reader/header/Right.tsx","pages/reader/header/index.tsx","pages/reader/Reader.tsx","lib/network/io.ts","pages/reader/Team.tsx"],"sourcesContent":["import { DrawState, Operation, Stroke } from \"./DrawState\";\r\nimport { List, Map, Record } from \"immutable\";\r\nimport { NotePage } from \"lib/note/note\";\r\n\r\ninterface StateSetRecordType {\r\n  states: Map<string, DrawState>;\r\n  editStack: List<string>;\r\n  undoStack: List<string>;\r\n}\r\n\r\nconst defaultRecord: Readonly<StateSetRecordType> = {\r\n  states: Map(),\r\n  editStack: List(),\r\n  undoStack: List(),\r\n};\r\n\r\ntype StateSetRecord = Record<StateSetRecordType>;\r\nconst defaultFactory = Record(defaultRecord);\r\n\r\nexport type SetOperation = Operation & { pageID: string };\r\n\r\nexport class StateSet {\r\n  constructor(\r\n    private immutable: StateSetRecord,\r\n    public lastOp?: SetOperation\r\n  ) {}\r\n\r\n  static createFromPages(pageRec: globalThis.Record<string, NotePage>) {\r\n    return new StateSet(\r\n      defaultFactory().set(\r\n        \"states\",\r\n        Map(pageRec).map(({ state, ratio }) =>\r\n          DrawState.loadFromFlat(state, ratio)\r\n        )\r\n      )\r\n    );\r\n  }\r\n\r\n  getImmutable() {\r\n    return this.immutable;\r\n  }\r\n\r\n  getStates() {\r\n    return this.getImmutable().get(\"states\");\r\n  }\r\n\r\n  getOneState(pageID: string) {\r\n    return this.getStates().get(pageID);\r\n  }\r\n\r\n  getEditStack() {\r\n    return this.getImmutable().get(\"editStack\");\r\n  }\r\n\r\n  getUndoStack() {\r\n    return this.getImmutable().get(\"undoStack\");\r\n  }\r\n\r\n  setState(pageID: string, drawState: DrawState) {\r\n    const prevDS = this.getOneState(pageID);\r\n    if (!prevDS || prevDS === drawState) return this;\r\n    let currRecord = this.getImmutable()\r\n      .update(\"states\", (s) => s.set(pageID, drawState))\r\n      .update(\"editStack\", (l) => l.push(pageID))\r\n      .delete(\"undoStack\");\r\n\r\n    const { lastOp } = drawState;\r\n    const lastSetOp = lastOp && { ...lastOp, pageID };\r\n\r\n    return new StateSet(currRecord, lastSetOp);\r\n  }\r\n\r\n  // sync with mutation.\r\n  syncStrokeTime(pageID: string, stroke: Stroke) {\r\n    const prevDS = this.getOneState(pageID);\r\n    prevDS && DrawState.syncStrokeTime(prevDS, stroke);\r\n    return this;\r\n  }\r\n\r\n  addState(pageID: string, notePage: NotePage) {\r\n    const { state, ratio } = notePage;\r\n    const newDS = DrawState.loadFromFlat(state, ratio);\r\n    const currRecord = this.getImmutable().update(\"states\", (s) =>\r\n      s.set(pageID, newDS)\r\n    );\r\n    return new StateSet(currRecord);\r\n  }\r\n\r\n  deleteState(pageID: string) {\r\n    return new StateSet(\r\n      this.getImmutable().update(\"states\", (s) => s.delete(pageID))\r\n    );\r\n  }\r\n\r\n  isUndoable() {\r\n    return this.getEditStack().size > 0;\r\n  }\r\n\r\n  isRedoable() {\r\n    return this.getUndoStack().size > 0;\r\n  }\r\n\r\n  undo() {\r\n    if (!this.isUndoable()) return this;\r\n    const lastUid = this.getEditStack().last();\r\n    const prevDS = lastUid && this.getOneState(lastUid);\r\n    if (!prevDS) return this;\r\n\r\n    const newDS = DrawState.undo(prevDS);\r\n    const { lastOp } = newDS;\r\n    const lastSetOp = lastOp && { pageID: lastUid, ...lastOp };\r\n\r\n    return new StateSet(\r\n      this.getImmutable()\r\n        .update(\"editStack\", (s) => s.pop())\r\n        .update(\"undoStack\", (s) => s.push(lastUid))\r\n        .update(\"states\", (s) => s.set(lastUid, newDS)),\r\n      lastSetOp\r\n    );\r\n  }\r\n\r\n  redo() {\r\n    if (!this.isRedoable()) return this;\r\n    const lastUid = this.getUndoStack().last();\r\n    const prevDS = lastUid && this.getOneState(lastUid);\r\n    if (!prevDS) return this;\r\n\r\n    const newDS = DrawState.redo(prevDS);\r\n    const { lastOp } = newDS;\r\n    const lastSetOp = lastOp && { pageID: lastUid, ...lastOp };\r\n\r\n    return new StateSet(\r\n      this.getImmutable()\r\n        .update(\"undoStack\", (s) => s.pop())\r\n        .update(\"editStack\", (s) => s.push(lastUid))\r\n        .update(\"states\", (s) => s.set(lastUid, newDS)),\r\n      lastSetOp\r\n    );\r\n  }\r\n\r\n  getLastDS(): [string, DrawState] | undefined {\r\n    const pageID = this.lastOp?.pageID;\r\n    const ds = pageID && this.getOneState(pageID);\r\n    if (ds) return [pageID, ds];\r\n  }\r\n}\r\n","import { Button, message } from \"antd\";\r\nimport { useContext } from \"react\";\r\nimport { ReaderMethodCtx } from \"./Reader\";\r\nimport { PlusOutlined } from \"@ant-design/icons\";\r\n\r\nexport const AddPageButton = () => {\r\n  const { addFinalPage } = useContext(ReaderMethodCtx);\r\n  return (\r\n    <div className=\"add-btn-wrapper\">\r\n      <Button\r\n        type=\"dashed\"\r\n        icon={<PlusOutlined />}\r\n        block\r\n        onClick={addFinalPage}\r\n      >\r\n        New page\r\n      </Button>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport const showPageDelMsg = (onUndo: () => void) => {\r\n  message.warning({\r\n    content: (\r\n      <>\r\n        One page was deleted.\r\n        <Button\r\n          size=\"small\"\r\n          type=\"link\"\r\n          onClick={() => {\r\n            message.destroy(\"DELETE\");\r\n            onUndo();\r\n          }}\r\n        >\r\n          Undo\r\n        </Button>\r\n      </>\r\n    ),\r\n    key: \"DELETE\",\r\n    duration: 10,\r\n  });\r\n};\r\n","import { useDebugValue, useEffect, useMemo, useRef, useState } from \"react\";\r\nimport localforage from \"localforage\";\r\nimport { Map } from \"immutable\";\r\n\r\nconst scrollForage = localforage.createInstance({ name: \"scroll\" });\r\n\r\nexport function useScrollPage(noteID: string, pageOrder = [] as string[]) {\r\n  const [refMap, setRefMap] = useState(Map<string, HTMLElement>());\r\n  const scrolled = useRef(false);\r\n  const [prevPageID, setPrevPageID] = useState(\"\");\r\n  const [inviewRatios, setInviewRatios] = useState(Map<string, number>());\r\n  const currPageID = useMemo(\r\n    () => largestKey(inviewRatios, pageOrder),\r\n    [inviewRatios, pageOrder]\r\n  );\r\n  useDebugValue(currPageID);\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      const stored = await scrollForage.getItem<string>(noteID);\r\n      if (!stored) return (scrolled.current = true);\r\n      setPrevPageID(stored);\r\n    })();\r\n  }, [noteID]);\r\n\r\n  useEffect(() => {\r\n    if (scrolled.current || !refMap.has(prevPageID)) return;\r\n    requestAnimationFrame(() => {\r\n      refMap.get(prevPageID)?.scrollIntoView();\r\n      scrolled.current = true;\r\n    });\r\n  }, [prevPageID, refMap]);\r\n\r\n  useEffect(() => {\r\n    if (!scrolled.current) return;\r\n    scrollForage.setItem(noteID, currPageID);\r\n  }, [noteID, currPageID]);\r\n\r\n  const sectionRef = (pageID: string) => (el: HTMLElement | null) => {\r\n    if (!el) return;\r\n    setRefMap((prev) => prev.set(pageID, el));\r\n  };\r\n\r\n  const scrollPage = (pageID: string) => {\r\n    refMap.get(pageID)?.scrollIntoView();\r\n  };\r\n\r\n  return { scrollPage, setInviewRatios, sectionRef, currPageID };\r\n}\r\n\r\nconst largestKey = (map: Map<string, number>, order: string[]) => {\r\n  let result = \"\";\r\n  let maxRatio = 0;\r\n  for (let key of order) {\r\n    const ratio = map.get(key);\r\n    if (!ratio) continue;\r\n    if (ratio === 1) return key;\r\n    if (ratio > maxRatio) {\r\n      result = key;\r\n      maxRatio = ratio;\r\n    }\r\n  }\r\n  return result;\r\n};\r\n","export function exchange<T>(list: T[], fromIndex: number, toIndex: number) {\r\n  const result = list.slice();\r\n  const [removed] = result.splice(fromIndex, 1);\r\n  if (!removed) return list;\r\n  result.splice(toIndex, 0, removed);\r\n  return result;\r\n}\r\n\r\nexport function insertAfter<T>(list: T[], prevItem: T, newItem: T) {\r\n  const prevIndex = list.indexOf(prevItem);\r\n  const curr = list.slice();\r\n  if (prevIndex === -1) return curr;\r\n  curr.splice(prevIndex + 1, 0, newItem);\r\n  return curr;\r\n}\r\n","import { FC } from \"react\";\nimport { Button } from \"antd\";\nimport { useNavigate } from \"react-router-dom\";\nimport { HomeFilled, SaveOutlined } from \"@ant-design/icons\";\n\nexport const HeaderLeft: FC<{\n  saved: boolean;\n  instantSave: () => Promise<void> | undefined;\n}> = ({ saved, instantSave }) => {\n  const nav = useNavigate();\n  return (\n    <div className=\"left\">\n      <Button\n        type=\"text\"\n        onClick={async () => {\n          await instantSave();\n          nav(\"/\");\n        }}\n        icon={<HomeFilled style={{ opacity: 0.8 }} />}\n      />\n      <Button\n        type=\"text\"\n        className=\"save\"\n        onClick={instantSave}\n        disabled={saved}\n        icon={<SaveOutlined />}\n      />\n    </div>\n  );\n};\n","import { FC, useContext } from \"react\";\r\nimport { Button, message, Popover, ButtonProps, Segmented } from \"antd\";\r\nimport { ReaderStateCtx } from \"../Reader\";\r\nimport {\r\n  BulbFilled,\r\n  BulbOutlined,\r\n  UndoOutlined,\r\n  RedoOutlined,\r\n  GatewayOutlined,\r\n  HighlightOutlined,\r\n} from \"@ant-design/icons\";\r\nimport IconFont from \"component/IconFont\";\r\nimport { PenPanel, WidthSelect } from \"../tools/PenPanel\";\r\nimport { useForceLight } from \"lib/Dark\";\r\nimport { useDrawCtrl, useUpdateDrawCtrl } from \"lib/draw/DrawCtrl\";\r\n\r\nexport const HeaderMiddle: FC<{\r\n  handleUndo: () => void;\r\n  handleRedo: () => void;\r\n}> = ({ handleUndo, handleRedo }) => {\r\n  const { stateSet } = useContext(ReaderStateCtx);\r\n  const { mode, finger } = useDrawCtrl();\r\n  const updateDrawCtrl = useUpdateDrawCtrl();\r\n  const [forceLight, setForceLight] = useForceLight();\r\n\r\n  return (\r\n    <div className=\"middle\">\r\n      <Button\r\n        type=\"text\"\r\n        shape=\"circle\"\r\n        icon={<UndoOutlined />}\r\n        onClick={handleUndo}\r\n        disabled={!stateSet?.isUndoable()}\r\n      />\r\n      <Button\r\n        type=\"text\"\r\n        shape=\"circle\"\r\n        icon={<RedoOutlined />}\r\n        onClick={handleRedo}\r\n        disabled={!stateSet?.isRedoable()}\r\n      />\r\n      <Button\r\n        type={finger ? \"default\" : \"text\"}\r\n        shape=\"circle\"\r\n        onClick={() => {\r\n          updateDrawCtrl({ finger: !finger });\r\n          message.destroy(\"FINGER\");\r\n          message.open({\r\n            content: finger ? \"Pencil only\" : \"Draw with finger\",\r\n            key: \"FINGER\",\r\n          });\r\n        }}\r\n        icon={<IconFont type=\"icon-finger\" />}\r\n      />\r\n      <Button\r\n        className=\"force-light-btn\"\r\n        type=\"text\"\r\n        shape=\"circle\"\r\n        icon={forceLight ? <BulbFilled /> : <BulbOutlined />}\r\n        onClick={() => setForceLight((prev) => !prev)}\r\n      />\r\n      <PenButton />\r\n      <EraserButton />\r\n      <Button\r\n        type={mode === \"text\" ? \"default\" : \"text\"}\r\n        shape=\"circle\"\r\n        onClick={() => updateDrawCtrl({ mode: \"text\" })}\r\n        icon={<IconFont type=\"icon-text1\" />}\r\n      />\r\n      <SelectButton />\r\n    </div>\r\n  );\r\n};\r\n\r\nconst PenButton = () => {\r\n  const drawCtrl = useDrawCtrl();\r\n  const updateDrawCtrl = useUpdateDrawCtrl();\r\n\r\n  const btnProps: ButtonProps = {\r\n    shape: \"circle\",\r\n    icon: <HighlightOutlined />,\r\n  };\r\n  return drawCtrl.mode === \"draw\" ? (\r\n    <Popover\r\n      content={<PenPanel updateDrawCtrl={updateDrawCtrl} drawCtrl={drawCtrl} />}\r\n      trigger=\"click\"\r\n      placement=\"bottom\"\r\n      getPopupContainer={(e) => e.parentElement!}\r\n      destroyTooltipOnHide\r\n    >\r\n      <Button type=\"default\" {...btnProps} />\r\n    </Popover>\r\n  ) : (\r\n    <Button\r\n      type=\"text\"\r\n      onClick={() => updateDrawCtrl({ mode: \"draw\" })}\r\n      {...btnProps}\r\n    />\r\n  );\r\n};\r\n\r\nconst EraserButton = () => {\r\n  const drawCtrl = useDrawCtrl();\r\n  const { mode, pixelEraser } = drawCtrl;\r\n  const updateDrawCtrl = useUpdateDrawCtrl();\r\n\r\n  const btnProps: ButtonProps = {\r\n    shape: \"circle\",\r\n    icon: <IconFont type=\"icon-eraser\" />,\r\n  };\r\n\r\n  return mode === \"erase\" ? (\r\n    <Popover\r\n      content={\r\n        <div className=\"width-seg-wrapper\">\r\n          <Segmented\r\n            block\r\n            size=\"small\"\r\n            className=\"pixel-seg\"\r\n            options={[\"Pixel\", \"Object\"]}\r\n            value={pixelEraser ? \"Pixel\" : \"Object\"}\r\n            onChange={(value) => {\r\n              if (value === \"Pixel\") updateDrawCtrl({ pixelEraser: true });\r\n              else updateDrawCtrl({ pixelEraser: false });\r\n            }}\r\n          />\r\n          <WidthSelect\r\n            drawCtrl={drawCtrl}\r\n            updateDrawCtrl={updateDrawCtrl}\r\n            field=\"eraserWidth\"\r\n          />\r\n        </div>\r\n      }\r\n      trigger=\"click\"\r\n      placement=\"bottom\"\r\n      getPopupContainer={(e) => e.parentElement!}\r\n      destroyTooltipOnHide\r\n    >\r\n      <Button type=\"default\" {...btnProps} />\r\n    </Popover>\r\n  ) : (\r\n    <Button\r\n      type=\"text\"\r\n      onClick={() => updateDrawCtrl({ mode: \"erase\" })}\r\n      {...btnProps}\r\n    />\r\n  );\r\n};\r\n\r\nconst SelectButton = () => {\r\n  const { lasso, mode } = useDrawCtrl();\r\n  const updateDrawCtrl = useUpdateDrawCtrl();\r\n\r\n  const icon = lasso ? <IconFont type=\"icon-lasso1\" /> : <GatewayOutlined />;\r\n\r\n  return mode === \"select\" ? (\r\n    <Button\r\n      type=\"default\"\r\n      shape=\"circle\"\r\n      icon={icon}\r\n      onClick={() => updateDrawCtrl({ lasso: !lasso })}\r\n    />\r\n  ) : (\r\n    <Button\r\n      type=\"text\"\r\n      shape=\"circle\"\r\n      icon={icon}\r\n      onClick={() => updateDrawCtrl({ mode: \"select\" })}\r\n    />\r\n  );\r\n};\r\n","import { Avatar } from \"antd\";\r\nimport { AvatarSize } from \"antd/lib/avatar/SizeContext\";\r\nimport { FC, useMemo } from \"react\";\r\nimport { getHashedColor } from \"lib/color\";\r\nimport { UserInfo } from \"lib/user\";\r\n\r\nexport const UserAvatar: FC<{\r\n  userInfo: UserInfo;\r\n  size?: AvatarSize;\r\n  onClick?: () => void;\r\n  chosen?: boolean;\r\n  className?: string;\r\n}> = ({\r\n  userInfo,\r\n  size = \"default\",\r\n  onClick = () => {},\r\n  chosen = false,\r\n  className,\r\n}) => {\r\n  const color = useMemo(() => getHashedColor(userInfo.userID), [userInfo]);\r\n  if (!userInfo) return null;\r\n  const { userName } = userInfo;\r\n\r\n  return (\r\n    <Avatar\r\n      className={className}\r\n      data-chosen={chosen}\r\n      size={size}\r\n      style={{ backgroundColor: color }}\r\n    >\r\n      <div className=\"avatar-wrapper\" onClick={onClick}>\r\n        {userName?.slice(0, 3)}\r\n      </div>\r\n    </Avatar>\r\n  );\r\n};\r\n","import { FC, useRef, useMemo, useState, useEffect, useContext } from \"react\";\r\nimport {\r\n  MoreOutlined,\r\n  PlusOutlined,\r\n  CopyOutlined,\r\n  DeleteOutlined,\r\n  MenuFoldOutlined,\r\n  MenuUnfoldOutlined,\r\n} from \"@ant-design/icons\";\r\nimport {\r\n  Draggable,\r\n  Droppable,\r\n  DropResult,\r\n  DragDropContext,\r\n} from \"react-beautiful-dnd\";\r\nimport { ActiveKeyProvider, Setter, useActiveKey } from \"lib/hooks\";\r\nimport { ReaderMethodCtx, ReaderStateCtx } from \"./Reader\";\r\nimport PageWrapper from \"component/PageWrapper\";\r\nimport { Avatar, Button, Drawer, Menu, Popover, Tabs } from \"antd\";\r\nimport { UserAvatar } from \"component/UserAvatar\";\r\nimport { useForceLight } from \"lib/Dark\";\r\nimport { AddPageButton } from \"./ReaderUtils\";\r\nimport { exchange } from \"./lib/array\";\r\nimport IconFont from \"component/IconFont\";\r\nimport classNames from \"classnames\";\r\nimport { TeamCtx } from \"./Team\";\r\nimport \"./preview.sass\";\r\n\r\nconst PageNavContent = () => {\r\n  const { pageOrder, currPageID } = useContext(ReaderStateCtx);\r\n  const { scrollPage, saveReorder } = useContext(ReaderMethodCtx);\r\n  const [forceLight] = useForceLight();\r\n  const [activeKey] = useActiveKey();\r\n  const refRec = useRef<Record<string, HTMLElement>>({});\r\n\r\n  const onDragEnd = ({ source, destination }: DropResult) => {\r\n    if (!destination || !pageOrder) return;\r\n    const { index: fromIndex } = source;\r\n    const { index: toIndex } = destination;\r\n    const pageID = pageOrder[fromIndex];\r\n    if (fromIndex === toIndex || !pageID) return;\r\n    const newOrder = exchange(pageOrder, fromIndex, toIndex);\r\n    saveReorder(newOrder, true);\r\n    requestAnimationFrame(() => scrollPage(pageID));\r\n  };\r\n\r\n  const title = {\r\n    ALL: \"All Pages\",\r\n    MARKED: \"Bookmarks\",\r\n    WRITTEN: \"Notes\",\r\n  }[activeKey];\r\n\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  useEffect(() => refRec.current[currPageID]?.scrollIntoView(), []);\r\n\r\n  return (\r\n    <div className=\"preview-container\" data-force-light={forceLight}>\r\n      <PreviewTabs />\r\n      <h3>{title}</h3>\r\n      <DragDropContext onDragEnd={onDragEnd}>\r\n        <Droppable droppableId=\"preview-list\">\r\n          {({ droppableProps, innerRef, placeholder }) => (\r\n            <div className=\"page-list\" ref={innerRef} {...droppableProps}>\r\n              {pageOrder?.map((uid, index) => (\r\n                <PagePreview\r\n                  key={uid}\r\n                  uid={uid}\r\n                  pageIndex={index}\r\n                  refRec={refRec.current}\r\n                />\r\n              ))}\r\n              {placeholder}\r\n              {activeKey === \"ALL\" && <AddPageButton />}\r\n            </div>\r\n          )}\r\n        </Droppable>\r\n      </DragDropContext>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst PagePreview: FC<{\r\n  uid: string;\r\n  pageIndex: number;\r\n  refRec: Record<string, HTMLElement>;\r\n}> = ({ uid, pageIndex, refRec }) => {\r\n  const { stateSet, pageRec, currPageID } = useContext(ReaderStateCtx);\r\n  const { teamState, ignores } = useContext(TeamCtx);\r\n  const { scrollPage } = useContext(ReaderMethodCtx);\r\n  const [activeKey] = useActiveKey();\r\n  const [chosen, setChosen] = useState(\"\");\r\n\r\n  const page = pageRec?.get(uid);\r\n  const drawState = stateSet?.getOneState(uid);\r\n  const teamStateMap = teamState?.getOnePageStateMap(uid);\r\n\r\n  if (!page || !drawState) return null;\r\n  const { image, marked } = page;\r\n\r\n  if (\r\n    activeKey === \"WRITTEN\" &&\r\n    drawState.isEmpty() &&\r\n    (!teamStateMap || teamStateMap.every((ds) => ds.isEmpty()))\r\n  ) {\r\n    return null;\r\n  }\r\n  if (activeKey === \"MARKED\" && !marked) return null;\r\n  const curr = currPageID === uid;\r\n\r\n  return (\r\n    <Draggable\r\n      draggableId={uid}\r\n      index={pageIndex}\r\n      isDragDisabled={activeKey !== \"ALL\"}\r\n    >\r\n      {(\r\n        { innerRef, draggableProps, dragHandleProps },\r\n        { isDragging: dragged }\r\n      ) => (\r\n        <div\r\n          ref={(e) => {\r\n            innerRef(e);\r\n            if (e) refRec[uid] = e;\r\n          }}\r\n          className=\"page\"\r\n          data-curr={curr}\r\n          data-dragged={dragged}\r\n          onClick={() => scrollPage(uid)}\r\n          {...draggableProps}\r\n          {...dragHandleProps}\r\n        >\r\n          <PageWrapper\r\n            drawState={teamStateMap?.get(chosen) || drawState}\r\n            teamStateMap={chosen ? undefined : teamStateMap}\r\n            thumbnail={image}\r\n            ignores={ignores}\r\n            preview\r\n          />\r\n          <PreviewTools\r\n            uid={uid}\r\n            index={pageIndex}\r\n            chosen={chosen}\r\n            setChosen={setChosen}\r\n          />\r\n        </div>\r\n      )}\r\n    </Draggable>\r\n  );\r\n};\r\n\r\nconst PreviewTools: FC<{\r\n  uid: string;\r\n  index: number;\r\n  chosen: string;\r\n  setChosen: Setter<string>;\r\n}> = ({ uid, index, chosen, setChosen }) => {\r\n  const { switchPageMarked } = useContext(ReaderMethodCtx);\r\n  const { pageRec } = useContext(ReaderStateCtx);\r\n  const { ignores, teamState } = useContext(TeamCtx);\r\n  const userIDs = useMemo(\r\n    () =>\r\n      teamState\r\n        ?.getPageValidUsers(uid)\r\n        .filter((userID) => !ignores.has(userID)) || [],\r\n    [teamState, ignores, uid]\r\n  );\r\n  const page = pageRec?.get(uid);\r\n  if (!page) return null;\r\n  const { marked } = page;\r\n\r\n  return (\r\n    <div className=\"tools\" onClick={(e) => e.stopPropagation()}>\r\n      <div\r\n        className=\"bookmark\"\r\n        data-marked={marked}\r\n        onClick={() => switchPageMarked(uid)}\r\n      />\r\n      <div className=\"index\">{index + 1}</div>\r\n      <PreviewOption uid={uid} />\r\n      <TeamAvatars userIDs={userIDs} chosen={chosen} setChosen={setChosen} />\r\n    </div>\r\n  );\r\n};\r\n\r\nconst TeamAvatars: FC<{\r\n  userIDs: string[];\r\n  chosen: string;\r\n  setChosen: Setter<string>;\r\n}> = ({ userIDs, chosen, setChosen }) => {\r\n  const { userRec } = useContext(TeamCtx);\r\n  return (\r\n    <Avatar.Group\r\n      maxCount={2}\r\n      size=\"default\"\r\n      className={classNames(\"team-group\", { chosen })}\r\n      maxPopoverPlacement=\"bottom\"\r\n    >\r\n      {userIDs.map((userID) => {\r\n        const userInfo = userRec[userID];\r\n        if (!userInfo) return null;\r\n        return (\r\n          <UserAvatar\r\n            key={userID}\r\n            size=\"default\"\r\n            userInfo={userInfo}\r\n            className=\"preview-avatar\"\r\n            chosen={chosen === userID}\r\n            onClick={() => setChosen((prev) => (prev === userID ? \"\" : userID))}\r\n          />\r\n        );\r\n      })}\r\n    </Avatar.Group>\r\n  );\r\n};\r\n\r\nconst PreviewOption = ({ uid }: { uid: string }) => {\r\n  const { addPage, deletePage } = useContext(ReaderMethodCtx);\r\n\r\n  const menu = (\r\n    <Menu\r\n      onClick={({ key }) => {\r\n        if (key === \"ADD\") {\r\n          addPage(uid);\r\n        } else if (key === \"COPY\") {\r\n          addPage(uid, true);\r\n        } else if (key === \"DELETE\") {\r\n          deletePage(uid);\r\n        }\r\n      }}\r\n      items={[\r\n        { key: \"ADD\", icon: <PlusOutlined />, label: \"Add page\" },\r\n        { key: \"COPY\", icon: <CopyOutlined />, label: \"Duplicate\" },\r\n        {\r\n          key: \"DELETE\",\r\n          icon: <DeleteOutlined />,\r\n          label: \"Delete\",\r\n          danger: true,\r\n        },\r\n      ]}\r\n    ></Menu>\r\n  );\r\n  return (\r\n    <Popover\r\n      content={menu}\r\n      trigger=\"click\"\r\n      placement=\"left\"\r\n      destroyTooltipOnHide\r\n    >\r\n      <div className=\"option\">\r\n        <MoreOutlined />\r\n      </div>\r\n    </Popover>\r\n  );\r\n};\r\n\r\nconst PreviewTabs = () => {\r\n  const [activeKey, setActiveKey] = useActiveKey();\r\n  const { TabPane } = Tabs;\r\n  return (\r\n    <Tabs\r\n      className=\"tabs\"\r\n      activeKey={activeKey}\r\n      onChange={setActiveKey}\r\n      tabBarGutter={10}\r\n      size=\"small\"\r\n      centered\r\n    >\r\n      <TabPane tab={<IconFont type=\"icon-uf_paper\" />} key=\"ALL\" />\r\n      <TabPane tab={<IconFont type=\"icon-bookmark2\" />} key=\"MARKED\" />\r\n      <TabPane tab={<IconFont type=\"icon-write\" />} key=\"WRITTEN\" />\r\n    </Tabs>\r\n  );\r\n};\r\n\r\nexport const PageNav = () => {\r\n  const [navOn, setNavOn] = useState(false);\r\n\r\n  return (\r\n    <ActiveKeyProvider initKey=\"ALL\">\r\n      <Button\r\n        type=\"text\"\r\n        icon={navOn ? <MenuUnfoldOutlined /> : <MenuFoldOutlined />}\r\n        onClick={() => setNavOn((prev) => !prev)}\r\n      />\r\n      <Drawer\r\n        visible={navOn}\r\n        onClose={() => setNavOn(false)}\r\n        width={200}\r\n        closable={false}\r\n        zIndex={800}\r\n        className=\"preview-drawer\"\r\n        bodyStyle={{ padding: 0, overflow: \"hidden\" }}\r\n        headerStyle={{ textAlign: \"center\" }}\r\n        destroyOnClose\r\n      >\r\n        <PageNavContent />\r\n      </Drawer>\r\n    </ActiveKeyProvider>\r\n  );\r\n};\r\n","import { FC, useMemo, useState, useEffect, useContext } from \"react\";\r\nimport { Badge, Alert, Modal, Button, Divider, message, Popover } from \"antd\";\r\nimport Search from \"antd/lib/input/Search\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { PasscodeInput } from \"antd-mobile\";\r\nimport { ReaderStateCtx } from \"../Reader\";\r\nimport { TeamCtx } from \"../Team\";\r\nimport { getUserID, saveUserName } from \"lib/user\";\r\nimport { PageNav } from \"../PageNav\";\r\nimport {\r\n  EyeOutlined,\r\n  FormOutlined,\r\n  TeamOutlined,\r\n  CopyOutlined,\r\n  CheckOutlined,\r\n  ReloadOutlined,\r\n  ShareAltOutlined,\r\n  DisconnectOutlined,\r\n  EyeInvisibleOutlined,\r\n  UsergroupAddOutlined,\r\n} from \"@ant-design/icons\";\r\nimport { editNoteData } from \"lib/note/archive\";\r\nimport { UserAvatar } from \"component/UserAvatar\";\r\nimport { putNote } from \"lib/network/http\";\r\nimport copy from \"clipboard-copy\";\r\n\r\nexport const HeaderRight: FC<{\r\n  instantSave: () => Promise<void> | undefined;\r\n}> = ({ instantSave }) => {\r\n  const { teamOn } = useContext(TeamCtx);\r\n  return (\r\n    <div className=\"right\">\r\n      {teamOn ? <RoomInfo /> : <JoinRoom instantSave={instantSave} />}\r\n      <PageNav />\r\n    </div>\r\n  );\r\n};\r\n\r\nconst UserCard: FC<{ userID: string }> = ({ userID }) => {\r\n  const [renaming, setRenaming] = useState(false);\r\n  const { ignores, setIgnores, resetIO, userRec } = useContext(TeamCtx);\r\n  const userInfo = userRec[userID];\r\n  useEffect(() => setRenaming(false), [userInfo]);\r\n  if (!userInfo) return null;\r\n\r\n  const { userName, online } = userInfo;\r\n  const self = userID === getUserID();\r\n  const ignored = ignores.has(userID) && !self;\r\n\r\n  const switchIgnore = () => {\r\n    setIgnores((prev) => {\r\n      if (prev.has(userID)) return prev.delete(userID);\r\n      return prev.add(userID);\r\n    });\r\n  };\r\n\r\n  const submitRename = (value: string) => {\r\n    const name = value.trim();\r\n    if (!name || name === userName) return setRenaming(false);\r\n    saveUserName(name);\r\n    resetIO();\r\n  };\r\n\r\n  return (\r\n    <div className=\"user-item\" data-online={online}>\r\n      <UserAvatar userInfo={userInfo} size=\"small\" className=\"room-avatar\" />\r\n      {renaming || <span className=\"user-name\">{userName}</span>}\r\n      {renaming && (\r\n        <Search\r\n          autoFocus\r\n          className=\"rename-input\"\r\n          defaultValue={userName}\r\n          onSearch={submitRename}\r\n          enterButton={<Button icon={<CheckOutlined />} />}\r\n        />\r\n      )}\r\n      {self ? (\r\n        renaming || (\r\n          <Button\r\n            type=\"text\"\r\n            icon={<FormOutlined />}\r\n            onClick={() => setRenaming(true)}\r\n          />\r\n        )\r\n      ) : (\r\n        <Button\r\n          type=\"text\"\r\n          icon={ignored ? <EyeInvisibleOutlined /> : <EyeOutlined />}\r\n          onClick={switchIgnore}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nconst RoomInfo: FC = () => {\r\n  const { code, userRec, connected, loadInfo, loadState, resetIO } =\r\n    useContext(TeamCtx);\r\n  const { noteInfo } = useContext(ReaderStateCtx);\r\n  const link = window.location.href;\r\n  const share = async () => {\r\n    const selfName = userRec[getUserID()]?.userName;\r\n    try {\r\n      if (!noteInfo) return;\r\n      await copy(`${noteInfo.name} - ${selfName} - Multibility\\n${link}`);\r\n      message.destroy(\"copy\");\r\n      message.success({\r\n        content: \"Link copied!\",\r\n        icon: <CopyOutlined />,\r\n        key: \"copy\",\r\n      });\r\n    } catch (e) {\r\n      console.log(e);\r\n    }\r\n  };\r\n\r\n  const userList = useMemo(() => {\r\n    const selfID = getUserID();\r\n    const { [selfID]: selfInfo, ...otherUsers } = userRec;\r\n    const list = selfInfo ? [selfInfo] : [];\r\n    const values = Object.values(otherUsers);\r\n    list.push(\r\n      ...values.filter(({ online }) => online),\r\n      ...values.filter(({ online }) => !online)\r\n    );\r\n    return list;\r\n  }, [userRec]);\r\n\r\n  const onlineNum = useMemo(\r\n    () => userList.filter(({ online }) => online).length,\r\n    [userList]\r\n  );\r\n\r\n  const teamPop = (\r\n    <div className=\"team-popover\">\r\n      {connected || (\r\n        <Alert\r\n          className=\"disconn-alert\"\r\n          message=\"Network failed.\"\r\n          icon={<DisconnectOutlined />}\r\n          type=\"error\"\r\n          showIcon\r\n          banner\r\n        />\r\n      )}\r\n      <PasscodeInput\r\n        className=\"code-display\"\r\n        value={String(code)}\r\n        length={4}\r\n        plain\r\n      />\r\n      <Button\r\n        icon={<ShareAltOutlined />}\r\n        className=\"share-btn\"\r\n        onClick={share}\r\n        block\r\n      >\r\n        Share\r\n      </Button>\r\n      <Divider />\r\n      <div className=\"user-list\">\r\n        {userList.map((u) => (\r\n          <UserCard key={u.userID} userID={u.userID} />\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  const [reloading, setReloading] = useState(false);\r\n  const title = (\r\n    <div className=\"team-title\">\r\n      <span>Team info</span>\r\n      <Button\r\n        shape=\"circle\"\r\n        type=\"text\"\r\n        size=\"small\"\r\n        loading={reloading}\r\n        icon={<ReloadOutlined />}\r\n        onClick={async () => {\r\n          setReloading(true);\r\n          await loadInfo();\r\n          await loadState();\r\n          setReloading(false);\r\n          resetIO();\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <Popover\r\n      content={teamPop}\r\n      trigger=\"click\"\r\n      placement=\"bottomRight\"\r\n      title={title}\r\n      getPopupContainer={(e) => e.parentElement!}\r\n    >\r\n      <Button\r\n        type=\"text\"\r\n        icon={\r\n          <Badge\r\n            status={connected ? \"success\" : \"error\"}\r\n            count={connected ? onlineNum : \"!\"}\r\n            size=\"small\"\r\n          >\r\n            <TeamOutlined />\r\n          </Badge>\r\n        }\r\n      />\r\n    </Popover>\r\n  );\r\n};\r\n\r\nconst JoinRoom: FC<{\r\n  instantSave: () => Promise<void> | undefined;\r\n}> = ({ instantSave }) => {\r\n  const { noteID } = useContext(ReaderStateCtx);\r\n  const nav = useNavigate();\r\n\r\n  const createRoom = async () => {\r\n    await instantSave();\r\n    const res = await putNote(noteID);\r\n    if (!res) return message.error(\"Can't create room.\");\r\n    await editNoteData(noteID, { team: true });\r\n    nav(\"/team/\" + noteID);\r\n  };\r\n\r\n  return (\r\n    <Button\r\n      type=\"text\"\r\n      icon={<UsergroupAddOutlined />}\r\n      onClick={() => {\r\n        Modal.confirm({\r\n          title: \"Enable team editing\",\r\n          content: \"This will make your note public to anyone with the link.\",\r\n          icon: <TeamOutlined style={{ color: \"#555\" }} />,\r\n          onOk: createRoom,\r\n        });\r\n      }}\r\n    />\r\n  );\r\n};\r\n","import { FC } from \"react\";\r\nimport { HeaderLeft } from \"./Left\";\r\nimport { HeaderMiddle } from \"./Middle\";\r\nimport { HeaderRight } from \"./Right\";\r\nimport \"./header.sass\";\r\n\r\nexport const Header: FC<{\r\n  saved: boolean;\r\n  handleUndo: () => void;\r\n  handleRedo: () => void;\r\n  instantSave: () => Promise<void> | undefined;\r\n}> = ({ saved, handleUndo, handleRedo, instantSave }) => {\r\n  return (\r\n    <header>\r\n      <HeaderLeft saved={saved} instantSave={instantSave} />\r\n      <HeaderMiddle handleUndo={handleUndo} handleRedo={handleRedo} />\r\n      <HeaderRight instantSave={instantSave} />\r\n    </header>\r\n  );\r\n};\r\n","import React, {\r\n  FC,\r\n  useMemo,\r\n  useState,\r\n  useEffect,\r\n  useContext,\r\n  useCallback,\r\n} from \"react\";\r\nimport { NoteInfo, NotePage, createPage, defaultNotePage } from \"lib/note/note\";\r\nimport { DrawCtrlProvider } from \"lib/draw/DrawCtrl\";\r\nimport { NewPageInfo, ReorderInfo, SyncInfo } from \"lib/network/io\";\r\nimport { DarkModeProvider } from \"lib/Dark\";\r\nimport { useMemoizedFn as useEvent, useSafeState } from \"ahooks\";\r\nimport { SetOperation, StateSet } from \"lib/draw/StateSet\";\r\nimport { loadNote, editNoteData } from \"lib/note/archive\";\r\nimport { AddPageButton, showPageDelMsg } from \"./ReaderUtils\";\r\nimport { useParams, useNavigate } from \"react-router-dom\";\r\nimport PageWrapper from \"component/PageWrapper\";\r\nimport { DrawState } from \"lib/draw/DrawState\";\r\nimport { useScrollPage } from \"./lib/scroll\";\r\nimport { debounce, last } from \"lodash-es\";\r\nimport { insertAfter } from \"./lib/array\";\r\nimport { Setter } from \"lib/hooks\";\r\nimport { Header } from \"./header\";\r\nimport { TeamCtx } from \"./Team\";\r\nimport { Map } from \"immutable\";\r\nimport { message } from \"antd\";\r\nimport \"./reader.sass\";\r\n\r\nexport const ReaderStateCtx = React.createContext<{\r\n  noteID: string;\r\n  noteInfo?: NoteInfo;\r\n  stateSet?: StateSet;\r\n  pageRec?: Map<string, NotePage>;\r\n  pageOrder?: string[];\r\n  currPageID: string;\r\n}>({ noteID: \"\", currPageID: \"\" });\r\n\r\nexport const ReaderMethodCtx = React.createContext({\r\n  scrollPage: (pageID: string) => {},\r\n  switchPageMarked: (pageID: string) => {},\r\n  addPage: (prevPageID: string, copy?: boolean) => {},\r\n  addFinalPage: () => {},\r\n  deletePage: (pageID: string) => {},\r\n  saveReorder: async (order: string[], push: boolean) => {},\r\n});\r\n\r\nexport default function Reader() {\r\n  const noteID = useParams().noteID ?? \"\";\r\n  const nav = useNavigate();\r\n\r\n  const [pageRec, setPageRec] = useState<Map<string, NotePage>>();\r\n  const [noteInfo, setNoteInfo] = useState<NoteInfo>();\r\n  const [stateSet, setStateSet] = useState<StateSet>();\r\n  const [pageOrder, setPageOrder] = useState<string[]>();\r\n  const [saved, setSaved] = useSafeState(true);\r\n\r\n  const { io, teamOn, addTeamStatePage } = useContext(TeamCtx);\r\n  const { setInviewRatios, scrollPage, sectionRef, currPageID } = useScrollPage(\r\n    noteID,\r\n    pageOrder\r\n  );\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      const storedNote = await loadNote(noteID);\r\n      if (!storedNote) {\r\n        message.error(\"Note not found\");\r\n        return nav(\"/\");\r\n      }\r\n      const { pageRec, pdf, pageOrder, ...noteInfo } = storedNote;\r\n      setPageRec(Map(pageRec));\r\n      setPageOrder(pageOrder);\r\n      setNoteInfo(noteInfo);\r\n      setStateSet(StateSet.createFromPages(pageRec));\r\n    })();\r\n  }, [nav, noteID, teamOn]);\r\n\r\n  useEffect(() => {\r\n    if (!noteInfo) return;\r\n    document.title = noteInfo.name + \" - Multibility\";\r\n  }, [noteInfo]);\r\n\r\n  const saver = useEvent(async () => {\r\n    const pr = pageRec?.toObject();\r\n    await editNoteData(noteID, { pageRec: pr });\r\n    setSaved(true);\r\n  });\r\n\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  const debouncedSave = useCallback(debounce(saver, 2000), [saver]);\r\n  const instantSave = debouncedSave.flush;\r\n\r\n  const savePageRec = (pageID: string, cb: (prev: NotePage) => NotePage) => {\r\n    setPageRec((prev) => prev?.update(pageID, defaultNotePage, cb));\r\n    setSaved(false);\r\n    debouncedSave();\r\n  };\r\n\r\n  const saveReorder = async (pageOrder: string[], push = false) => {\r\n    setPageOrder(pageOrder);\r\n    await editNoteData(noteID, { pageOrder });\r\n    await instantSave();\r\n    push && pushReorder(pageOrder);\r\n  };\r\n\r\n  const pushReorder = (pageOrder: string[]) =>\r\n    io?.emit(\"reorder\", { pageOrder });\r\n\r\n  const handleReorder = useEvent(\r\n    ({ deleted, pageOrder, prevOrder }: ReorderInfo) => {\r\n      saveReorder(pageOrder);\r\n      if (!deleted) return;\r\n      showPageDelMsg(() => saveReorder(prevOrder, true));\r\n    }\r\n  );\r\n\r\n  const handleNewPage = useEvent(\r\n    ({ pageOrder, pageID, newPage }: NewPageInfo) => {\r\n      saveReorder(pageOrder);\r\n      savePageRec(pageID, () => newPage);\r\n      setStateSet((prev) => prev?.addState(pageID, newPage));\r\n    }\r\n  );\r\n\r\n  useEffect(() => {\r\n    io?.on(\"reorder\", handleReorder);\r\n    io?.on(\"newPage\", handleNewPage);\r\n    return () => void io?.removeAllListeners();\r\n  }, [io, handleReorder, handleNewPage]);\r\n\r\n  const pushOperation = (operation: SetOperation) => {\r\n    const handleSync = ({ pageID, stroke }: SyncInfo) =>\r\n      setStateSet((prev) => prev?.syncStrokeTime(pageID, stroke));\r\n\r\n    io?.emit(\"push\", { operation }, handleSync);\r\n  };\r\n\r\n  const pushNewPage = (\r\n    pageOrder: string[],\r\n    pageID: string,\r\n    newPage: NotePage\r\n  ) => {\r\n    const { image, marked, ...newTeamPage } = newPage;\r\n    io?.emit(\"newPage\", { pageOrder, pageID, newPage: newTeamPage });\r\n    addTeamStatePage(pageID, newPage);\r\n  };\r\n\r\n  const updatePageRec = (pageID: string, ds: DrawState) => {\r\n    const state = DrawState.flaten(ds);\r\n    savePageRec(pageID, (prev) => ({ ...prev, state }));\r\n  };\r\n\r\n  const updateStateSet = (cb: (prevSS: StateSet) => StateSet) => {\r\n    if (!stateSet) return;\r\n    const newSS = cb(stateSet);\r\n    if (newSS === stateSet) return;\r\n    setStateSet(newSS);\r\n    const lastDS = newSS.getLastDS();\r\n    const lastOp = newSS.lastOp;\r\n    if (!lastDS || !lastOp) return;\r\n    updatePageRec(...lastDS);\r\n    pushOperation(lastOp);\r\n  };\r\n\r\n  const switchPageMarked = (pageID: string) =>\r\n    savePageRec(pageID, (prev) => ({ ...prev, marked: !prev.marked }));\r\n\r\n  const addPage = (prevPageID: string, copy = false) => {\r\n    if (!pageOrder) return;\r\n    const prevPage = copy ? pageRec?.get(prevPageID) : undefined;\r\n    const [pageID, newPage] = createPage(prevPage);\r\n    const newOrder = insertAfter(pageOrder, prevPageID, pageID);\r\n    pushNewPage(newOrder, pageID, newPage);\r\n    saveReorder(newOrder);\r\n    savePageRec(pageID, () => newPage);\r\n    setStateSet((prev) => prev?.addState(pageID, newPage));\r\n  };\r\n\r\n  const addFinalPage = () => {\r\n    const lastPageID = last(pageOrder);\r\n    lastPageID && addPage(lastPageID);\r\n  };\r\n\r\n  const deletePage = (pageID: string) => {\r\n    const newOrder = pageOrder?.filter((id) => id !== pageID);\r\n    newOrder?.length && saveReorder(newOrder, true);\r\n  };\r\n\r\n  const renderResult = (\r\n    <div className=\"reader container\">\r\n      <Header\r\n        saved={saved}\r\n        instantSave={instantSave}\r\n        handleUndo={() => updateStateSet((prev) => prev.undo())}\r\n        handleRedo={() => updateStateSet((prev) => prev.redo())}\r\n      />\r\n      <main>\r\n        {pageOrder?.map((uid) => (\r\n          <section key={uid} className=\"note-page\" ref={sectionRef(uid)}>\r\n            <PageContainer\r\n              uid={uid}\r\n              updateStateSet={updateStateSet}\r\n              setInviewRatios={setInviewRatios}\r\n            />\r\n          </section>\r\n        ))}\r\n        <AddPageButton />\r\n      </main>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <DarkModeProvider>\r\n      <ReaderStateCtx.Provider\r\n        value={{\r\n          noteID,\r\n          pageRec,\r\n          noteInfo,\r\n          stateSet,\r\n          pageOrder,\r\n          currPageID,\r\n        }}\r\n      >\r\n        <ReaderMethodCtx.Provider\r\n          value={{\r\n            addPage,\r\n            scrollPage,\r\n            deletePage,\r\n            saveReorder,\r\n            addFinalPage,\r\n            switchPageMarked,\r\n          }}\r\n        >\r\n          <DrawCtrlProvider>{renderResult}</DrawCtrlProvider>\r\n        </ReaderMethodCtx.Provider>\r\n      </ReaderStateCtx.Provider>\r\n    </DarkModeProvider>\r\n  );\r\n}\r\n\r\nconst PageContainer: FC<{\r\n  uid: string;\r\n  updateStateSet: (cb: (prevSS: StateSet) => StateSet) => void;\r\n  setInviewRatios: Setter<Map<string, number>>;\r\n}> = ({ uid, updateStateSet, setInviewRatios }) => {\r\n  const { pageRec, stateSet, currPageID, pageOrder, noteID } =\r\n    useContext(ReaderStateCtx);\r\n  const { teamState, ignores } = useContext(TeamCtx);\r\n\r\n  const page = pageRec?.get(uid);\r\n  const drawState = stateSet?.getOneState(uid);\r\n  const teamStateMap = teamState?.getOnePageStateMap(uid);\r\n  const updateState = (ds: DrawState) => {\r\n    updateStateSet((prev) => prev.setState(uid, ds));\r\n  };\r\n\r\n  const onViewChange = (visible: boolean, ratio: number) => {\r\n    if (!visible) return setInviewRatios((prev) => prev.delete(uid));\r\n    setInviewRatios((prev) => prev.set(uid, ratio));\r\n  };\r\n\r\n  const preload = useMemo(() => {\r\n    if (!pageOrder) return false;\r\n    const currIndex = pageOrder.indexOf(currPageID);\r\n    const selfIndex = pageOrder.indexOf(uid);\r\n    return Math.abs(selfIndex - currIndex) <= 1;\r\n  }, [currPageID, uid, pageOrder]);\r\n\r\n  if (!page || !drawState) return null;\r\n  return (\r\n    <PageWrapper\r\n      drawState={drawState}\r\n      teamStateMap={teamStateMap}\r\n      updateState={updateState}\r\n      pdfIndex={page.pdfIndex}\r\n      noteID={noteID}\r\n      ignores={ignores}\r\n      onViewChange={onViewChange}\r\n      preload={preload}\r\n    />\r\n  );\r\n};\r\n","import { io } from \"socket.io-client\";\r\nimport { Stroke } from \"lib/draw/DrawState\";\r\nimport { NotePage } from \"lib/note/note\";\r\nimport { getUserID, getUserName } from \"lib/user\";\r\nimport { BASE_URL } from \"./http\";\r\n\r\nexport const IoFactory = (noteID: string) => () =>\r\n  io(BASE_URL, {\r\n    query: {\r\n      userID: getUserID(),\r\n      userName: getUserName(),\r\n      noteID,\r\n    },\r\n  });\r\n\r\nexport interface ReorderInfo {\r\n  pageOrder: string[];\r\n  prevOrder: string[];\r\n  deleted: boolean;\r\n}\r\n\r\nexport interface NewPageInfo {\r\n  pageOrder: string[];\r\n  pageID: string;\r\n  newPage: NotePage;\r\n}\r\n\r\nexport interface SyncInfo {\r\n  stroke: Stroke;\r\n  pageID: string;\r\n}\r\n","import React, { useState, useEffect, useCallback } from \"react\";\r\nimport {\r\n  getTeamNoteState,\r\n  loadTeamNoteInfo,\r\n  updatePages,\r\n} from \"lib/network/http\";\r\nimport { LoginOutlined, LogoutOutlined } from \"@ant-design/icons\";\r\nimport { IoFactory, NewPageInfo } from \"lib/network/io\";\r\nimport { useNavigate, useParams } from \"react-router-dom\";\r\nimport { TeamState } from \"lib/draw/TeamState\";\r\nimport { getUserID, UserInfo } from \"lib/user\";\r\nimport { NotePage } from \"lib/note/note\";\r\nimport { Socket } from \"socket.io-client\";\r\nimport { Setter } from \"lib/hooks\";\r\nimport { Loading } from \"component/Loading\";\r\nimport { message } from \"antd\";\r\nimport { Set } from \"immutable\";\r\nimport Reader from \"./Reader\";\r\n\r\nexport const TeamCtx = React.createContext({\r\n  io: undefined as Socket | undefined,\r\n  code: 0,\r\n  teamOn: false,\r\n  connected: false,\r\n  ignores: Set<string>(),\r\n  userRec: {} as Record<string, UserInfo>,\r\n  teamState: undefined as TeamState | undefined,\r\n  resetIO: () => {},\r\n  loadInfo: async () => false,\r\n  loadState: async () => false,\r\n  setIgnores: (() => {}) as Setter<Set<string>>,\r\n  addTeamStatePage: (pageID: string, newPage: NotePage) => {},\r\n});\r\n\r\nexport default function Team() {\r\n  const noteID = useParams().noteID ?? \"\";\r\n  const [teamState, setTeamState] = useState<TeamState>();\r\n  const [code, setCode] = useState(-2);\r\n  const [userRec, setUserRec] = useState<Record<string, UserInfo>>({});\r\n  const [ignores, setIgnores] = useState(Set<string>());\r\n  const [io, setIO] = useState(IoFactory(noteID));\r\n  const [loaded, setLoaded] = useState(false);\r\n  const [connected, setConnected] = useState(false);\r\n  const nav = useNavigate();\r\n\r\n  const loadInfo = useCallback(async () => {\r\n    const info = await loadTeamNoteInfo(noteID);\r\n    if (!info) {\r\n      message.error(\"Failed loading the team note info\");\r\n      return false;\r\n    }\r\n    setCode(info.code);\r\n    return true;\r\n  }, [noteID]);\r\n\r\n  const loadState = useCallback(async () => {\r\n    const teamNote = await getTeamNoteState(noteID);\r\n    if (!teamNote) {\r\n      message.error(\"Failed loading the team note state\");\r\n      return false;\r\n    }\r\n    setTeamState(TeamState.createFromTeamPages(teamNote));\r\n    return true;\r\n  }, [noteID]);\r\n\r\n  const updateSelfState = useCallback(() => {\r\n    updatePages(noteID);\r\n  }, [noteID]);\r\n\r\n  useEffect(() => {\r\n    const roomInit = async () => {\r\n      const infoLoaded = await loadInfo();\r\n      const stateLoaded = await loadState();\r\n      if (!infoLoaded || !stateLoaded) return nav(\"/\");\r\n      setLoaded(true);\r\n      updateSelfState();\r\n    };\r\n    roomInit();\r\n    return updateSelfState;\r\n  }, [loadInfo, loadState, nav, updateSelfState]);\r\n\r\n  useEffect(() => {\r\n    io.on(\"push\", ({ operation, userID }) => {\r\n      setTeamState((prev) => prev?.pushOperation(operation, userID));\r\n    });\r\n\r\n    io.on(\"join\", ({ joined, members }) => {\r\n      const { userID, userName } = joined;\r\n      setUserRec(members);\r\n      if (userID === getUserID()) return;\r\n      showJoinMsg(userID, userName);\r\n    });\r\n\r\n    io.on(\"leave\", ({ leaved, members }) => {\r\n      const { userID, userName } = leaved;\r\n      setUserRec(members);\r\n      if (userID === getUserID()) return io.emit(\"join\");\r\n      showLeaveMsg(userID, userName);\r\n    });\r\n\r\n    io.on(\"newPage\", (info: NewPageInfo) => {\r\n      const { pageID, newPage } = info;\r\n      setTeamState((prev) => prev?.addPage(pageID, newPage));\r\n    });\r\n\r\n    io.on(\"reset\", ({ userID, pageRec }) => {\r\n      if (userID === getUserID()) return;\r\n      setTeamState((prev) => prev?.resetUser(userID, pageRec));\r\n    });\r\n\r\n    io.on(\"connect_error\", console.error);\r\n    io.on(\"connect\", () => setConnected(true));\r\n    io.on(\"disconnect\", () => setConnected(false));\r\n\r\n    return () => {\r\n      io.removeAllListeners();\r\n      io.close();\r\n    };\r\n  }, [io]);\r\n\r\n  const addTeamStatePage = (pageID: string, newPage: NotePage) => {\r\n    setTeamState((prev) => prev?.addPage(pageID, newPage));\r\n  };\r\n\r\n  const resetIO = () => setIO(IoFactory(noteID));\r\n\r\n  return (\r\n    <Loading loading={!loaded}>\r\n      <TeamCtx.Provider\r\n        value={{\r\n          io,\r\n          code,\r\n          teamOn: true,\r\n          ignores,\r\n          userRec,\r\n          connected,\r\n          teamState,\r\n          resetIO,\r\n          loadInfo,\r\n          loadState,\r\n          setIgnores,\r\n          addTeamStatePage,\r\n        }}\r\n      >\r\n        <Reader />\r\n      </TeamCtx.Provider>\r\n    </Loading>\r\n  );\r\n}\r\n\r\nconst showJoinMsg = (userID: string, userName: string) => {\r\n  message.destroy(userID);\r\n  message.success({\r\n    content: `${userName} joined room`,\r\n    icon: <LoginOutlined />,\r\n    key: userID,\r\n  });\r\n};\r\n\r\nconst showLeaveMsg = (userID: string, userName: string) => {\r\n  message.destroy(userID);\r\n  message.warning({\r\n    content: `${userName} leaved room`,\r\n    icon: <LogoutOutlined />,\r\n    key: userID,\r\n  });\r\n};\r\n"],"names":["defaultRecord","states","Map","editStack","List","undoStack","defaultFactory","Record","StateSet","immutable","lastOp","this","getImmutable","get","pageID","getStates","drawState","prevDS","getOneState","currRecord","update","s","set","l","push","delete","stroke","DrawState","notePage","state","ratio","newDS","getEditStack","size","getUndoStack","isUndoable","lastUid","last","lastSetOp","pop","isRedoable","ds","pageRec","map","AddPageButton","addFinalPage","useContext","ReaderMethodCtx","className","type","icon","PlusOutlined","block","onClick","scrollForage","localforage","name","largestKey","order","result","maxRatio","key","insertAfter","list","prevItem","newItem","prevIndex","indexOf","curr","slice","splice","HeaderLeft","saved","instantSave","nav","useNavigate","HomeFilled","style","opacity","disabled","SaveOutlined","HeaderMiddle","handleUndo","handleRedo","stateSet","ReaderStateCtx","useDrawCtrl","mode","finger","updateDrawCtrl","useUpdateDrawCtrl","useForceLight","forceLight","setForceLight","shape","UndoOutlined","RedoOutlined","message","content","IconFont","BulbFilled","BulbOutlined","prev","PenButton","EraserButton","SelectButton","drawCtrl","btnProps","HighlightOutlined","PenPanel","trigger","placement","getPopupContainer","e","parentElement","destroyTooltipOnHide","pixelEraser","options","value","onChange","field","lasso","GatewayOutlined","UserAvatar","userInfo","chosen","color","useMemo","getHashedColor","userID","userName","backgroundColor","PageNavContent","pageOrder","currPageID","scrollPage","saveReorder","useActiveKey","activeKey","refRec","useRef","title","ALL","MARKED","WRITTEN","useEffect","current","scrollIntoView","PreviewTabs","onDragEnd","source","destination","fromIndex","index","toIndex","newOrder","removed","exchange","requestAnimationFrame","droppableId","droppableProps","innerRef","placeholder","ref","uid","PagePreview","pageIndex","TeamCtx","teamState","ignores","useState","setChosen","page","teamStateMap","getOnePageStateMap","image","marked","isEmpty","every","draggableId","isDragDisabled","draggableProps","dragHandleProps","dragged","isDragging","PageWrapper","undefined","thumbnail","preview","PreviewTools","switchPageMarked","userIDs","getPageValidUsers","filter","has","stopPropagation","PreviewOption","TeamAvatars","userRec","maxCount","classNames","maxPopoverPlacement","addPage","deletePage","menu","items","label","CopyOutlined","DeleteOutlined","danger","MoreOutlined","setActiveKey","TabPane","Tabs","tabBarGutter","centered","tab","PageNav","navOn","setNavOn","initKey","MenuUnfoldOutlined","MenuFoldOutlined","visible","onClose","width","closable","zIndex","bodyStyle","padding","overflow","headerStyle","textAlign","destroyOnClose","HeaderRight","teamOn","RoomInfo","JoinRoom","UserCard","renaming","setRenaming","setIgnores","resetIO","online","self","getUserID","ignored","Search","autoFocus","defaultValue","onSearch","trim","saveUserName","enterButton","CheckOutlined","FormOutlined","EyeInvisibleOutlined","EyeOutlined","add","code","connected","loadInfo","loadState","noteInfo","link","window","location","href","share","selfName","copy","console","log","userList","selfID","selfInfo","otherUsers","values","Object","onlineNum","length","teamPop","DisconnectOutlined","showIcon","banner","String","plain","ShareAltOutlined","u","reloading","setReloading","loading","ReloadOutlined","status","count","TeamOutlined","noteID","createRoom","putNote","editNoteData","team","UsergroupAddOutlined","Modal","onOk","Header","React","prevPageID","Reader","useParams","setPageRec","setNoteInfo","setStateSet","setPageOrder","useSafeState","setSaved","io","addTeamStatePage","refMap","setRefMap","scrolled","setPrevPageID","inviewRatios","setInviewRatios","useDebugValue","getItem","stored","setItem","sectionRef","el","useScrollPage","loadNote","storedNote","pdf","createFromPages","document","saver","useEvent","pr","toObject","debouncedSave","useCallback","debounce","flush","savePageRec","cb","defaultNotePage","pushReorder","emit","handleReorder","onUndo","deleted","prevOrder","duration","handleNewPage","newPage","addState","on","removeAllListeners","pushNewPage","newTeamPage","updatePageRec","updateStateSet","newSS","operation","lastDS","getLastDS","syncStrokeTime","prevPage","createPage","renderResult","undo","redo","PageContainer","Dark","Provider","id","lastPageID","DrawCtrl","preload","currIndex","selfIndex","Math","abs","updateState","setState","pdfIndex","onViewChange","IoFactory","BASE_URL","query","getUserName","Set","Team","setTeamState","setCode","setUserRec","setIO","loaded","setLoaded","setConnected","loadTeamNoteInfo","info","getTeamNoteState","teamNote","TeamState","updateSelfState","updatePages","roomInit","infoLoaded","stateLoaded","pushOperation","joined","members","showJoinMsg","leaved","showLeaveMsg","resetUser","error","close","Loading","LoginOutlined","LogoutOutlined"],"sourceRoot":""}