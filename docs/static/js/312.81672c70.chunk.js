"use strict";(self.webpackChunkmultibility=self.webpackChunkmultibility||[]).push([[312,560],{35873:function(e,t,n){n.d(t,{W:function(){return i}});var r=n(81694),a=n.n(r),u=n(80184),i=function(e){var t=e.color,n=e.className,r={backgroundColor:t};return(0,u.jsx)("div",{className:a()("color-circle",n),style:r})}},74115:function(e,t,n){n.d(t,{MW:function(){return l},O9:function(){return u},Qk:function(){return i},bM:function(){return s},mr:function(){return o}});var r=n(45917),a=n.n(r),u=["#f97316","#eab308","#84cc16","#22c55e","#10b981","#14b8a6","#06b6d4","#0ea5e9","#3b82f6","#6366f1","#8b5cf6","#a855f7","#d946ef","#ec4899","#f43f5e","#ef4444"],i=[].concat(["#000000","#9ca3af","#64748b","#78716c"],u),o=function(){var e=Math.floor(Math.random()*u.length);return u[e]},s=function(e){var t=a()(e)%u.length;return u[t]},c={"#f97316":{light:"#FFEDD5",dark:"#9A3412"},"#eab308":{light:"#FEF9C3",dark:"#854D0E"},"#84cc16":{light:"#ECFCCB",dark:"#3F6212"},"#22c55e":{light:"#DCFCE7",dark:"#166534"},"#10b981":{light:"#D1FAE5",dark:"#065F46"},"#14b8a6":{light:"#CCFBF1",dark:"#115E59"},"#06b6d4":{light:"#CFFAFE",dark:"#155E75"},"#0ea5e9":{light:"#E0F2FE",dark:"#075985"},"#3b82f6":{light:"#DBEAFE",dark:"#1E40AF"},"#6366f1":{light:"#E0E7FF",dark:"#3730A3"},"#8b5cf6":{light:"#EDE9FE",dark:"#5B21B6"},"#a855f7":{light:"#F3E8FF",dark:"#6B21A8"},"#d946ef":{light:"#FAE8FF",dark:"#86198F"},"#ec4899":{light:"#FCE7F3",dark:"#9D174D"},"#f43f5e":{light:"#FFE4E6",dark:"#9F1239"},"#ef4444":{light:"#FEE2E2",dark:"#991B1B"}},l=function(e){var t,n=null!==(t=c[e])&&void 0!==t?t:{light:"#E5E7EB",dark:"#374151"};return{"--light-color":n.light,"--dark-color":n.dark}}},79856:function(e,t,n){n.d(t,{f:function(){return f}});var r=n(29439),a=n(45987),u=n(15671),i=n(43144),o=n(57293),s=n(24124),c=["pageID"],l={pageStates:(0,s.D5)(),pageInfos:(0,s.D5)()},d=(0,s.WV)(l),f=function(){function e(t){(0,u.Z)(this,e),this.immutable=t}return(0,i.Z)(e,[{key:"getImmutable",value:function(){return this.immutable}},{key:"getPageStates",value:function(){return this.getImmutable().get("pageStates")}},{key:"getPageInfos",value:function(){return this.getImmutable().get("pageInfos")}},{key:"getOneState",value:function(e,t){var n;return null===(n=this.getPageStates().get(e))||void 0===n?void 0:n.get(t)}},{key:"getOnePageStateMap",value:function(e){return this.getPageStates().get(e)}},{key:"getPageRatio",value:function(e){var t;return null===(t=this.getPageInfos().get(e))||void 0===t?void 0:t.ratio}},{key:"includesPage",value:function(e){return this.getPageStates().has(e)}},{key:"setState",value:function(t,n,r){var a=this.getPageStates().get(t);return a?new e(this.getImmutable().update("pageStates",(function(e){return e.set(t,a.set(n,r))}))):this}},{key:"addPage",value:function(t,n){var r=n.ratio;return new e(this.getImmutable().update("pageStates",(function(e){return e.set(t,(0,s.D5)())})).update("pageInfos",(function(e){return e.set(t,{ratio:r})})))}},{key:"pushOperation",value:function(e,t){var n=e.pageID,r=(0,a.Z)(e,c),u=this.getPageRatio(n);if(!this.includesPage(n)||!u)return this;var i=this.getOneState(n,t)||o.Dw.createEmpty(u),s=o.Dw.pushOperation(i,r);return this.setState(n,t,s)}},{key:"resetUser",value:function(e,t){for(var n=this,a=0,u=Object.entries(t);a<u.length;a++){var i=(0,r.Z)(u[a],2),s=i[0],c=i[1],l=c.state,d=c.ratio;n.getOneState(s,e)&&(n=n.setState(s,e,o.Dw.loadFromFlat(l,d)))}return n}}],[{key:"createFromTeamPages",value:function(t){var n=d();return Object.entries(t).forEach((function(e){var t=(0,r.Z)(e,2),a=t[0],u=t[1],i=u.states,c=u.ratio,l=(0,s.D5)(Object.entries(i).map((function(e){var t=(0,r.Z)(e,2),n=t[0],a=t[1];return[n,o.Dw.loadFromFlat(a,c)]})));n=n.update("pageStates",(function(e){return e.set(a,l)})).update("pageInfos",(function(e){return e.set(a,{ratio:c})}))})),new e(n)}},{key:"getValidUsers",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,s.l4)();return e?Array.from(e.filter((function(e){return!e.isEmpty()})).deleteAll(t).keys()):[]}},{key:"isEmpty",value:function(e){return!e||e.every((function(e){return e.isEmpty()}))}}]),e}()},52365:function(e,t,n){n.d(t,{LH:function(){return d},kV:function(){return f},mf:function(){return i},s2:function(){return c},zI:function(){return s}});var r=n(29439),a=n(72791),u=n(80184);function i(e){var t=e.propertyName,n=e.active,u=void 0===n||n,i=(0,a.useRef)((function(){})),o=(0,a.useState)((function(){return new Promise((function(e){return i.current=e}))}));return[(0,r.Z)(o,1)[0],function(e){e.propertyName===t&&u&&i.current()}]}var o=(0,a.createContext)(["",function(){}]);function s(){var e=(0,a.useContext)(o);return(0,a.useDebugValue)(e[0]),e}var c=function(e){var t=e.children,n=e.initKey,r=(0,a.useState)(n);return(0,u.jsx)(o.Provider,{value:r,children:t})},l=(0,a.createContext)([!1,function(){}]);function d(){var e=(0,a.useContext)(l);return(0,a.useDebugValue)(e[0]),e}var f=function(e){var t=e.children,n=(0,a.useState)(!1);return(0,u.jsx)(l.Provider,{value:n,children:t})}},51570:function(e,t,n){n.d(t,{CD:function(){return P},_n:function(){return x},dn:function(){return b},f1:function(){return D},fI:function(){return h},ox:function(){return O},r8:function(){return S}});var r,a=n(45987),u=n(74165),i=n(15861),o=n(74569),s=n.n(o),c=n(35888),l=n(75783),d=n(69951),f=n(61842),p=n.n(f),v=n(83329),g=n.n(v),m=["statusCode"],x=null!==(r="https://api.slotdumpling.top/paint")?r:"";function h(e){return Z.apply(this,arguments)}function Z(){return(Z=(0,i.Z)((0,u.Z)().mark((function e(t){var n,r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s().get("code/".concat(t));case 3:if(n=e.sent,200===(r=n.data).statusCode){e.next=7;break}return e.abrupt("return",null);case 7:return e.abrupt("return",r.noteID);case 10:return e.prev=10,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 14:case"end":return e.stop()}}),e,null,[[0,10]])})))).apply(this,arguments)}function k(e){return j.apply(this,arguments)}function j(){return(j=(0,i.Z)((0,u.Z)().mark((function e(t){var n,r,i,o,c;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s().get("info/".concat(t));case 3:if(n=e.sent,r=n.data,o=(i=r).statusCode,c=(0,a.Z)(i,m),200===o){e.next=8;break}return e.abrupt("return",null);case 8:return e.abrupt("return",c);case 11:return e.prev=11,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 15:case"end":return e.stop()}}),e,null,[[0,11]])})))).apply(this,arguments)}function b(e,t){return y.apply(this,arguments)}function y(){return(y=(0,i.Z)((0,u.Z)().mark((function e(t,n){var r,a,i,o,c,d;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k(t);case 3:if(r=e.sent){e.next=6;break}return e.abrupt("return",null);case 6:return a=r.noteInfo,i=r.pageInfos,e.next=9,(0,l.Rb)(t,a,i);case 9:if(!e.sent){e.next=11;break}return e.abrupt("return",r);case 11:if(!a.withImg){e.next=21;break}return e.next=14,s()({method:"GET",url:t,responseType:"blob",onDownloadProgress:function(e){var t=e.loaded;null===n||void 0===n||n(t)}});case 14:return o=e.sent,c=o.data,d=new Blob([c],{type:"application/pdf"}),e.next=19,(0,l.Vk)(t,a,i,d);case 19:e.next=23;break;case 21:return e.next=23,(0,l.Vk)(t,a,i);case 23:return e.abrupt("return",r);case 26:return e.prev=26,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 30:case"end":return e.stop()}}),e,null,[[0,26]])})))).apply(this,arguments)}function S(e){return I.apply(this,arguments)}function I(){return(I=(0,i.Z)((0,u.Z)().mark((function e(t){var n,r,a,i,o,f,p,v,g,m,x,h;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.U9)(t);case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return",!1);case 5:return r=n.uid,a=n.name,i=n.withImg,o=n.pdf,f=n.pageOrder,p=n.pageRec,(0,c.Yl)(p),e.prev=7,e.next=10,s().put("create/".concat(t),{userID:(0,d.VN)(),pageRec:p,noteInfo:{uid:r,name:a,withImg:i,pageOrder:f}});case 10:if(v=e.sent,g=v.data,!o){e.next=21;break}return m=new FormData,e.next=16,o.arrayBuffer();case 16:return x=e.sent,h=new Blob([x]),m.append("file",h,t),e.next=21,s()({method:"POST",url:"upload",data:m,headers:{"Content-Type":"multipart/form-data"}});case 21:if(201===g.statusCode){e.next=23;break}return e.abrupt("return",!1);case 23:return e.abrupt("return",!0);case 26:return e.prev=26,e.t0=e.catch(7),console.error(e.t0),e.abrupt("return",!1);case 30:case"end":return e.stop()}}),e,null,[[7,26]])})))).apply(this,arguments)}s().defaults.baseURL=x;var w=p().createInstance({name:"updateHash"});function D(e){return C.apply(this,arguments)}function C(){return(C=(0,i.Z)((0,u.Z)().mark((function e(t){var n,r,a,i,o,f,p,v,m,x,h;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.U9)(t);case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return",null);case 5:return r=n.uid,a=n.name,i=n.withImg,o=n.pageOrder,f=n.pageRec,(0,c.Yl)(f),p={uid:r,name:a,withImg:i,pageOrder:o},v=g()(JSON.stringify([f,p])),e.next=11,w.getItem(t);case 11:if(m=e.sent,v!==m){e.next=14;break}return e.abrupt("return",!0);case 14:return e.prev=14,x={userID:(0,d.VN)(),pageRec:f,noteInfo:p},e.next=18,s().put("update/".concat(t),x);case 18:if(h=e.sent,201===h.data.statusCode){e.next=22;break}return e.abrupt("return",!1);case 22:return e.next=24,w.setItem(t,v);case 24:return e.abrupt("return",!0);case 27:return e.prev=27,e.t0=e.catch(14),console.error(e.t0),e.abrupt("return",!1);case 31:case"end":return e.stop()}}),e,null,[[14,27]])})))).apply(this,arguments)}var E=p().createInstance({name:"teamState"});function P(e,t){return N.apply(this,arguments)}function N(){return(N=(0,i.Z)((0,u.Z)().mark((function e(t,n){var r,a,i,o,c,l,f;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(t);case 2:return r=e.sent,a=r&&g()(JSON.stringify(r)),e.prev=4,e.next=7,s().get("state/".concat(t),{params:{userID:(0,d.VN)(),hash:a},onDownloadProgress:function(e){var t=e.loaded;null===n||void 0===n||n(t)}});case 7:if(i=e.sent,o=i.data,c=o.statusCode,l=o.modified,f=o.teamPages,200!==c||!l){e.next=14;break}return e.next=13,E.setItem(t,f);case 13:return e.abrupt("return",f);case 14:return e.abrupt("return",r);case 17:return e.prev=17,e.t0=e.catch(4),console.error(e.t0),e.abrupt("return",r);case 21:case"end":return e.stop()}}),e,null,[[4,17]])})))).apply(this,arguments)}function O(e){return R.apply(this,arguments)}function R(){return(R=(0,i.Z)((0,u.Z)().mark((function e(t){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.getItem(t);case 2:if(e.t1=n=e.sent,e.t0=null!==e.t1,!e.t0){e.next=6;break}e.t0=void 0!==n;case 6:if(!e.t0){e.next=10;break}e.t2=n,e.next=11;break;case 10:e.t2=void 0;case 11:return e.abrupt("return",e.t2);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},69951:function(e,t,n){n.d(t,{VN:function(){return a},lu:function(){return i},vW:function(){return u}});var r=n(49030),a=function(){var e;return function(){if(e)return e;var t=localStorage.getItem("USER_ID");return t||(t=(0,r.Z)(),localStorage.setItem("USER_ID",t)),e=t,t}}(),u=function(){var e=localStorage.getItem("USER_NAME");return e||(e=(0,r.Z)().slice(0,8),localStorage.setItem("USER_NAME",e)),e},i=function(e){return!!(e=e.trim())&&(localStorage.setItem("USER_NAME",e),!0)}},10814:function(e,t,n){n.r(t),n.d(t,{default:function(){return St}});var r=n(1413),a=n(74165),u=n(45987),i=n(15861),o=n(29439),s=n(72791),c=n(35888),l=n(70587),d=n(81832),f=n(98211),p=n(15671),v=n(43144),g=n(57293),m=n(24124),x={states:(0,m.D5)(),editStack:(0,m.aV)(),undoStack:(0,m.aV)()},h=(0,m.WV)(x),Z=function(){function e(t,n){(0,p.Z)(this,e),this.immutable=t,this.lastOp=n}return(0,v.Z)(e,[{key:"getImmutable",value:function(){return this.immutable}},{key:"getStates",value:function(){return this.getImmutable().get("states")}},{key:"getOneState",value:function(e){return this.getStates().get(e)}},{key:"getEditStack",value:function(){return this.getImmutable().get("editStack")}},{key:"getUndoStack",value:function(){return this.getImmutable().get("undoStack")}},{key:"setState",value:function(t,n){var a=this.getOneState(t);if(!a||a===n)return this;var u=this.getImmutable().update("states",(function(e){return e.set(t,n)})).update("editStack",(function(e){return e.push(t)})).delete("undoStack"),i=n.lastOp;return new e(u,i&&(0,r.Z)((0,r.Z)({},i),{},{pageID:t}))}},{key:"syncStrokeTime",value:function(e,t,n){var r=this.getOneState(e);return r&&g.Dw.syncStrokeTime(r,t,n),this}},{key:"addState",value:function(t,n){var r=n.state,a=n.ratio,u=g.Dw.loadFromFlat(r,a);return new e(this.getImmutable().update("states",(function(e){return e.set(t,u)})))}},{key:"deleteState",value:function(t){return new e(this.getImmutable().update("states",(function(e){return e.delete(t)})))}},{key:"isUndoable",value:function(){return this.getEditStack().size>0}},{key:"isRedoable",value:function(){return this.getUndoStack().size>0}},{key:"undo",value:function(){if(!this.isUndoable())return this;var t=this.getEditStack().last(),n=t&&this.getOneState(t);if(!n)return this;var a=g.Dw.undo(n),u=a.lastOp,i=u&&(0,r.Z)({pageID:t},u);return new e(this.getImmutable().update("editStack",(function(e){return e.pop()})).update("undoStack",(function(e){return e.push(t)})).update("states",(function(e){return e.set(t,a)})),i)}},{key:"redo",value:function(){if(!this.isRedoable())return this;var t=this.getUndoStack().last(),n=t&&this.getOneState(t);if(!n)return this;var a=g.Dw.redo(n),u=a.lastOp,i=u&&(0,r.Z)({pageID:t},u);return new e(this.getImmutable().update("undoStack",(function(e){return e.pop()})).update("editStack",(function(e){return e.push(t)})).update("states",(function(e){return e.set(t,a)})),i)}}],[{key:"createFromPages",value:function(t){return new e(h().set("states",(0,m.D5)(t).map((function(e){var t=e.state,n=e.ratio;return g.Dw.loadFromFlat(t,n)}))))}}]),e}(),k=n(75783),j=n(49742),b=n(57689),y=n(241),S=n(37762),I=n(93433),w=n(61842),D=n.n(w),C=n(763),E=D().createInstance({name:"scroll"}),P=(0,C.debounce)((function(e,t){E.setItem(e,t)}),2e3);var N=function(e,t){var n,r="",a=0,u=(0,S.Z)(t);try{for(u.s();!(n=u.n()).done;){var i=n.value,o=e.get(i);if(o){if(1===o)return i;o>a&&(r=i,a=o)}}}catch(s){u.e(s)}finally{u.f()}return r};function O(e,t,n){var r=e.indexOf(t),a=e.slice();return-1===r||a.splice(r+1,0,n),a}var R=n(79286),F=n(23414),T=n(82622),L=n(10711),M=n(52234),z=n(98757),V=n(2649),A=n(36090),U=n(69228),B=n(96851),H=n(26987),W=n(87309),_=n(70776),K=n(25581),X=n(52365),G=n(74115),J=n(80184),Y=function(e){var t=e.userInfo,n=e.size,r=void 0===n?"default":n,a=e.onClick,u=void 0===a?function(){}:a,i=e.chosen,o=void 0!==i&&i,c=e.className,l=(0,s.useMemo)((function(){return(0,G.bM)(t.userID)}),[t]);if(!t)return null;var d=t.userName;return(0,J.jsx)(V.C,{className:c,"data-chosen":o,size:r,style:{backgroundColor:l},children:(0,J.jsx)("div",{className:"avatar-wrapper",onClick:u,children:null===d||void 0===d?void 0:d.slice(0,3)})})},Q=n(22568),q=n(81694),$=n.n(q),ee=n(60559),te=n(13892),ne=n(79856),re=function(e){var t=e.addFinalPage;return(0,J.jsx)(W.Z,{type:"dashed",icon:(0,J.jsx)(R.Z,{}),block:!0,onClick:t,children:"New page"})},ae=n(56983),ue=n(24805),ie=["left"],oe=["ref"],se=["cardDragged"],ce=["uid","pageIndex","refRec","cardDragged"],le=["uid","index","chosen","setChosen","page","userIDs"],de=function(e){var t=(0,s.useState)(!1),n=(0,o.Z)(t,2),a=n[0],u=n[1],i=(0,X.LH)(),c=(0,o.Z)(i,1)[0],l=(0,J.jsx)(z._l,{draggableId:"OPPOSITE",index:a?1:0,isDragDisabled:!0,children:function(e){var t=e.innerRef;return(0,J.jsx)("div",{className:"opposite",ref:t})}});return(0,J.jsx)(ae.Z,{in:c,timeout:300,unmountOnExit:!0,children:(0,J.jsx)(X.s2,{initKey:"ALL",children:(0,J.jsx)(z.Z5,{onDragEnd:function(e){var t=e.destination;0===(null===t||void 0===t?void 0:t.index)&&u(!0),1===(null===t||void 0===t?void 0:t.index)&&u(!1)},children:(0,J.jsx)(z.bK,{droppableId:"preview-drop",direction:"horizontal",children:function(t,n){var u=t.droppableProps,i=t.innerRef,o=t.placeholder,s=n.isDraggingOver;return(0,J.jsxs)("aside",(0,r.Z)((0,r.Z)({className:"preview-drop","data-left":a,ref:i,"data-dragged":s},u),{},{children:[l,(0,J.jsx)(fe,(0,r.Z)({left:a},e)),o]}))}})})})})},fe=function(e){var t=e.left,n=(0,u.Z)(e,ie),a=(0,X.zI)(),i=(0,o.Z)(a,1)[0],s=(0,X.LH)(),c=(0,o.Z)(s,2)[1],l={ALL:"All Pages",MARKED:"Bookmarks",WRITTEN:"Notes"}[i],d=(0,te.QS)({onSwipedLeft:function(){t&&c(!1)},onSwipedRight:function(){t||c(!1)},swipeDuration:200}),f=d.ref,p=(0,u.Z)(d,oe);return(0,J.jsx)(z._l,{draggableId:"CARD",index:t?0:1,children:function(e,t){var a=e.innerRef,u=e.draggableProps,i=e.dragHandleProps,o=t.isDragging,s=t.isDropAnimating;return(0,J.jsxs)("div",(0,r.Z)((0,r.Z)((0,r.Z)({className:"preview-card",ref:function(e){a(e),f(e)},"data-animating":s},u),p),{},{children:[(0,J.jsx)("div",(0,r.Z)({className:"drag-handle"},i)),(0,J.jsx)("h3",{children:l}),(0,J.jsx)(he,{}),(0,J.jsx)(pe,(0,r.Z)({cardDragged:o},n)),(0,J.jsx)(Ze,(0,r.Z)({},n))]}))}})},pe=s.memo((function(e){var t=e.cardDragged,n=(0,u.Z)(e,se),a=(0,s.useRef)({}),i=(0,X.zI)(),c=(0,o.Z)(i,1)[0],l=(0,X.LH)(),d=(0,o.Z)(l,1)[0],p=n.pageOrder,v=n.currPageID,g=n.saveReorder,m=n.addFinalPage,x=(0,f.Z)((function(){var e;null===(e=a.current[v])||void 0===e||e.scrollIntoView()}));return(0,s.useLayoutEffect)((function(){d&&x()}),[d,c,x]),(0,J.jsx)(z.Z5,{onDragEnd:function(e){var t=e.source,n=e.destination;if(n&&p){var r=t.index,a=n.index,u=p[r];if(r!==a&&u){var i=function(e,t,n){var r=e.slice(),a=r.splice(t,1),u=(0,o.Z)(a,1)[0];return u?(r.splice(n,0,u),r):e}(p,r,a);g(i,!0)}}},children:(0,J.jsx)(z.bK,{droppableId:"preview-list",isDropDisabled:t,children:function(e){var u=e.droppableProps,i=e.innerRef,o=e.placeholder;return(0,J.jsxs)("div",(0,r.Z)((0,r.Z)({className:"page-list",ref:i},u),{},{children:[p.map((function(e,u){return(0,J.jsx)(ve,(0,r.Z)({uid:e,pageIndex:u,refRec:a.current,cardDragged:t},n),e)})),o,"ALL"===c&&(0,J.jsx)(re,{addFinalPage:m})]}))}})})}));pe.displayName="PageList";var ve=function(e){var t=e.uid,n=e.pageIndex,a=e.refRec,i=e.cardDragged,c=(0,u.Z)(e,ce),l=c.stateSet,d=c.pageRec,f=c.currPageID,p=c.scrollPage,v=(0,s.useContext)(ee.TeamCtx),g=v.teamState,m=v.ignores,x=(0,X.zI)(),h=(0,o.Z)(x,1)[0],Z=(0,s.useState)(""),k=(0,o.Z)(Z,2),j=k[0],b=k[1],S=d.get(t),I=l.getOneState(t),w=null===g||void 0===g?void 0:g.getOnePageStateMap(t),D=(0,s.useRef)(!1);D.current="MARKED"===h&&((null===S||void 0===S?void 0:S.marked)||D.current);var C=(0,s.useMemo)((function(){return ne.f.getValidUsers(w,m)}),[w,m]);if(!S||!I)return null;if("WRITTEN"===h&&I.isEmpty()&&ne.f.isEmpty(w))return null;if("MARKED"===h&&!D.current)return null;var E=f===t;return(0,J.jsx)(z._l,{draggableId:t,index:n,isDragDisabled:"ALL"!==h||i,children:function(e,u){var o=e.innerRef,s=e.draggableProps,l=e.dragHandleProps,d=u.isDragging,f=u.isDropAnimating;return(0,J.jsxs)("div",(0,r.Z)((0,r.Z)((0,r.Z)({ref:function(e){o(e),e&&(a[t]=e)},className:"page","data-curr":E,"data-dragged":d,"data-animating":f,onClick:function(){return p(t)}},s),l),{},{children:[(0,J.jsx)(y.default,{drawState:(null===w||void 0===w?void 0:w.get(j))||I,teamStateMap:j?void 0:w,thumbnail:S.image,ignores:m,preview:!0,skipInView:d||i}),(0,J.jsx)(ge,(0,r.Z)({uid:t,index:n,chosen:j,setChosen:b,page:S,userIDs:C},c))]}))}})},ge=s.memo((function(e){var t=e.uid,n=e.index,a=e.chosen,i=e.setChosen,o=e.page,s=e.userIDs,c=(0,u.Z)(e,le),l=c.switchPageMarked;return(0,J.jsxs)("div",{className:"tools",onClick:function(e){return e.stopPropagation()},children:[(0,J.jsx)("div",{className:"bookmark","data-marked":o.marked,onClick:function(){return l(t)}}),(0,J.jsx)("div",{className:"index",children:n+1}),(0,J.jsx)(xe,(0,r.Z)({uid:t},c)),(0,J.jsx)(me,{userIDs:s,chosen:a,setChosen:i})]})}));ge.displayName="PreviewTools";var me=function(e){var t=e.userIDs,n=e.chosen,r=e.setChosen,a=(0,s.useContext)(ee.TeamCtx).userRec;return(0,J.jsx)(V.C.Group,{maxCount:2,size:"default",className:$()("team-group",{chosen:n}),maxPopoverPlacement:"bottom",children:t.map((function(e){var t=a[e];return t?(0,J.jsx)(Y,{size:"default",userInfo:t,className:"preview-avatar",chosen:n===e,onClick:function(){return r((function(t){return t===e?"":e}))}},e):null}))})},xe=function(e){var t=e.uid,n=e.addPage,r=e.deletePage,a=(0,J.jsx)(A.Z,{items:[{key:"ADD",icon:(0,J.jsx)(R.Z,{}),label:"Add page",onClick:function(){return n(t)}},{key:"COPY",icon:(0,J.jsx)(F.Z,{}),label:"Duplicate",onClick:function(){return n(t,!0)}},{key:"DELETE",icon:(0,J.jsx)(T.Z,{}),label:"Delete",danger:!0,onClick:function(){return r(t)}}]});return(0,J.jsx)(U.Z,{content:a,trigger:"click",placement:"left",destroyTooltipOnHide:!0,getPopupContainer:function(e){var t,n;return null===(t=e.parentElement)||void 0===t||null===(n=t.parentElement)||void 0===n?void 0:n.parentElement},children:(0,J.jsx)("div",{className:"option",children:(0,J.jsx)(L.Z,{})})})},he=s.memo((function(){var e=(0,X.zI)(),t=(0,o.Z)(e,2),n=t[0],r=t[1];return(0,J.jsx)(B.Z,{className:"tabs",activeKey:n,onChange:r,tabBarGutter:0,size:"small",centered:!0,items:[{key:"ALL",label:(0,J.jsx)(Q.Z,{type:"icon-uf_paper"})},{key:"MARKED",label:(0,J.jsx)(Q.Z,{type:"icon-bookmark2"})},{key:"WRITTEN",label:(0,J.jsx)(Q.Z,{type:"icon-write"})}]})}));he.displayName="PreviewTabs";var Ze=function(e){var t=e.currPageID,n=e.pageOrder,r=e.scrollPage,a=e.size,u=e.setSize,i=(0,s.useMemo)((function(){var e;return(null!==(e=n.indexOf(t))&&void 0!==e?e:0)+1}),[t,n]),o=n&&(0,J.jsx)(H.Z,{pageSize:1,total:n.length,simple:!0,current:i,onChange:function(e){var t=n[e-1];t&&r(t)}});return(0,J.jsxs)("footer",{children:[(0,J.jsx)(U.Z,{content:o,trigger:"click",getPopupContainer:function(e){return e.parentElement},destroyTooltipOnHide:!0,children:(0,J.jsxs)(W.Z,{type:"text",size:"small",children:[i," / ",n.length]})}),(0,J.jsx)(ke,{}),(0,J.jsx)(_.Z,{className:"size-select",popupClassName:"size-drop",size:"small",bordered:!1,showArrow:!1,dropdownMatchSelectWidth:80,options:[40,60,80,100].map((function(e){return{value:e,label:e+"%"}})),value:a,onChange:u,placement:"topRight",getPopupContainer:function(e){return e.parentElement}})]})},ke=function(){var e=(0,l.gX)().finger,t=(0,l.F7)(),n=(0,d.iX)(),r=(0,o.Z)(n,2),a=r[0],u=r[1],i=(0,ue.useMediaQuery)({query:"(prefers-color-scheme: light)"}),s=(0,J.jsxs)(J.Fragment,{children:[(0,J.jsxs)("div",{className:"footer-option",children:[(0,J.jsx)("span",{children:"Pencil only"}),(0,J.jsx)(K.Z,{size:"small",checked:!e,onChange:function(e){return t({finger:!e})}})]}),(0,J.jsxs)("div",{className:"footer-option",children:[(0,J.jsx)("span",{children:"Light mode"}),(0,J.jsx)(K.Z,{size:"small",checked:a||i,disabled:i,onChange:u})]})]});return(0,J.jsx)(U.Z,{getPopupContainer:function(e){return e.parentElement},trigger:"click",content:s,placement:"topRight",children:(0,J.jsx)(W.Z,{className:"option-btn",size:"small",type:"text",shape:"circle",icon:(0,J.jsx)(M.Z,{style:{opacity:.5}})})})},je=n(52242),be=n(65323),ye=function(e){var t=e.saved,n=e.instantSave,r=(0,b.s0)();return(0,J.jsxs)("div",{className:"left",children:[(0,J.jsx)(W.Z,{type:"text",onClick:(0,i.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n();case 2:r("/");case 3:case"end":return e.stop()}}),e)}))),icon:(0,J.jsx)(je.Z,{style:{opacity:.8}})}),(0,J.jsx)(W.Z,{type:"text",className:"save",onClick:n,disabled:t,icon:(0,J.jsx)(be.Z,{})})]})},Se=n(53163),Ie=n(35945),we=n(78030),De=n(50446),Ce=n(76849),Ee=n(62),Pe=n(28624),Ne=n(14965),Oe=n(2721),Re={type:"text",shape:"circle"},Fe=function(e){var t=e.handleUndo,n=e.handleRedo,a=e.undoable,u=e.redoable,i=(0,l.gX)().mode,o=(0,l.F7)();return(0,J.jsxs)("div",{className:"middle",children:[(0,J.jsx)(W.Z,(0,r.Z)((0,r.Z)({},Re),{},{icon:(0,J.jsx)(we.Z,{}),onClick:t,disabled:!a})),(0,J.jsx)(W.Z,(0,r.Z)((0,r.Z)({className:"redo-btn"},Re),{},{icon:(0,J.jsx)(De.Z,{}),onClick:n,disabled:!u})),(0,J.jsx)(Te,{}),(0,J.jsx)(Le,{}),(0,J.jsx)(W.Z,{shape:"circle",type:"text"===i?"link":"text",onClick:function(){return o({mode:"text"})},icon:(0,J.jsx)(Q.Z,{type:"icon-text1"})}),(0,J.jsx)(Me,{})]})},Te=function(){var e=(0,l.gX)(),t=e.mode,n=e.color,a=(0,l.F7)();return"draw"===t?(0,J.jsx)(U.Z,{content:(0,J.jsx)(Oe.Uk,{updateDrawCtrl:a,drawCtrl:e}),trigger:"click",placement:"bottom",getPopupContainer:function(e){return e.parentElement},destroyTooltipOnHide:!0,children:(0,J.jsx)(W.Z,{type:"link",icon:(0,J.jsx)(Ce.Z,{twoToneColor:n,className:"pen-icon"})})}):(0,J.jsx)(W.Z,(0,r.Z)((0,r.Z)({},Re),{},{onClick:function(){return a({mode:"draw"})},icon:(0,J.jsx)(Ee.Z,{})}))},Le=function(){var e=(0,l.gX)(),t=e.mode,n=e.pixelEraser,a=e.globalEraser,u=(0,l.F7)(),i=(0,J.jsx)(Se.Z,{block:!0,size:"small",className:"pixel-seg",options:["Pixel","Object"],value:n?"Pixel":"Object",onChange:function(e){u("Pixel"===e?{pixelEraser:!0}:{pixelEraser:!1})}}),o=(0,J.jsx)("div",{className:"global-switch","data-pixel-on":n,children:n||(0,J.jsxs)(J.Fragment,{children:[(0,J.jsxs)("span",{children:["Global",(0,J.jsx)(Ie.Z,{className:"hint",title:"Turn on to erase others' strokes.",children:(0,J.jsx)(Pe.Z,{})})]}),(0,J.jsx)(K.Z,{size:"small",checked:a,onChange:function(e){return u({globalEraser:e})}})]})});return"erase"===t?(0,J.jsx)(U.Z,{content:(0,J.jsxs)("div",{className:"erase-panel",children:[i,(0,J.jsx)(Oe.Db,{drawCtrl:e,updateDrawCtrl:u,field:"eraserWidth"}),o]}),trigger:"click",placement:"bottom",getPopupContainer:function(e){return e.parentElement},destroyTooltipOnHide:!0,children:(0,J.jsx)(W.Z,{type:"link",icon:(0,J.jsx)(Q.Z,{type:"icon-eraser"})})}):(0,J.jsx)(W.Z,(0,r.Z)((0,r.Z)({},Re),{},{onClick:function(){return u({mode:"erase"})},icon:(0,J.jsx)(Q.Z,{type:"icon-eraser"})}))},Me=function(){var e=(0,l.gX)(),t=e.lasso,n=e.mode,a=(0,l.F7)(),u=t?(0,J.jsx)(Q.Z,{type:"icon-lasso1"}):(0,J.jsx)(Ne.Z,{});return"select"===n?(0,J.jsx)(W.Z,{type:"link",icon:u,onClick:function(){return a({lasso:!t})}}):(0,J.jsx)(W.Z,(0,r.Z)((0,r.Z)({},Re),{},{icon:u,onClick:function(){return a({mode:"select"})}}))},ze=n(49142),Ve=n(33441),Ae=n(91333),Ue=n(75594),Be=n(50419),He=n(50759),We=n(95055),_e=n(78502),Ke=n(69951),Xe=n(67575),Ge=n(30501),Je=n(98272),Ye=n(24215),Qe=n(37557),qe=n(78823),$e=n(17973),et=n(19951),tt=n(56200),nt=n(23605),rt=n(18301),at=n(51570),ut=n(1829),it=n.n(ut),ot=function(e){var t=e.instantSave,n=(0,s.useContext)(ee.TeamCtx).teamOn;return(0,J.jsxs)("div",{className:"right",children:[n?(0,J.jsx)(dt,{}):(0,J.jsx)(ft,{instantSave:t}),(0,J.jsx)(st,{})]})},st=function(){var e=(0,X.LH)(),t=(0,o.Z)(e,2),n=t[0],r=t[1];return(0,J.jsx)(W.Z,{type:n?"link":"text",icon:(0,J.jsx)(Q.Z,{type:"icon-cards"}),onClick:function(){return r((function(e){return!e}))}})},ct=function(e){var t=e.userInfo,n=(0,s.useState)(!1),r=(0,o.Z)(n,2),a=r[0],u=r[1],i=(0,s.useContext)(ee.TeamCtx),c=i.ignores,l=i.setIgnores,d=i.resetIO;if((0,s.useEffect)((function(){return u(!1)}),[t]),!t)return null;var f=t.userName,p=t.online,v=t.userID,g=v===(0,Ke.VN)(),m=c.has(v)&&!g;return(0,J.jsxs)("div",{className:"user-item","data-online":p,children:[(0,J.jsx)(Y,{userInfo:t,size:"small",className:"room-avatar"}),a||(0,J.jsx)("span",{className:"user-name",children:f}),a&&(0,J.jsx)(We.Z,{autoFocus:!0,className:"rename-input",defaultValue:f,onSearch:function(e){var t=e.trim();if(!t||t===f)return u(!1);(0,Ke.lu)(t),d()},enterButton:(0,J.jsx)(W.Z,{icon:(0,J.jsx)(Xe.Z,{})})}),g?a||(0,J.jsx)(W.Z,{type:"text",icon:(0,J.jsx)(Ge.Z,{}),onClick:function(){return u(!0)}}):(0,J.jsx)(W.Z,{type:"text",icon:m?(0,J.jsx)(Je.Z,{}):(0,J.jsx)(Ye.Z,{}),onClick:function(){l((function(e){return e.has(v)?e.delete(v):e.add(v)}))}})]})},lt=function(){var e=(0,s.useState)(!1),t=(0,o.Z)(e,2),n=t[0],r=t[1],u=window.location.href,c=function(){var e=(0,i.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,it()("".concat(document.title,"\n").concat(u));case 3:r(!0),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),console.log(e.t0);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(){return e.apply(this,arguments)}}();return(0,J.jsx)(W.Z,{icon:n?(0,J.jsx)(Qe.Z,{}):(0,J.jsx)(qe.Z,{}),type:n?"primary":"default",className:"share-btn",onClick:c,block:!0,children:n?"Copied":"Copy link"})},dt=function(){var e=(0,s.useContext)(ee.TeamCtx),t=e.code,n=e.userRec,r=e.connected,c=e.loadInfo,l=e.loadState,d=e.resetIO,f=(0,s.useMemo)((function(){var e=(0,Ke.VN)(),t=n[e],r=(0,u.Z)(n,[e].map(ze.Z));if(!t)return[];var a=Object.values(r);return[t].concat((0,I.Z)((0,C.sortBy)(a,"online").reverse()))}),[n]),p=(0,s.useMemo)((function(){return f.filter((function(e){return e.online})).length}),[f]),v=(0,J.jsxs)("div",{className:"team-popover",children:[r||(0,J.jsx)(Ve.Z,{className:"disconn-alert",message:"Network failed.",icon:(0,J.jsx)($e.Z,{}),type:"error",showIcon:!0,banner:!0}),(0,J.jsxs)("div",{className:"team-info-title",children:[(0,J.jsx)(et.Z,{}),(0,J.jsx)("span",{children:"Share"})]}),(0,J.jsx)(_e.GD,{className:"code-display",value:String(t),length:4,plain:!0}),(0,J.jsx)(lt,{}),(0,J.jsx)(Ae.Z,{}),(0,J.jsxs)("div",{className:"team-info-title",children:[(0,J.jsx)(tt.Z,{}),(0,J.jsx)("span",{children:"Members"})]}),(0,J.jsx)("div",{className:"user-list",children:f.map((function(e){return(0,J.jsx)(ct,{userInfo:e},e.userID)}))})]}),g=(0,s.useState)(!1),m=(0,o.Z)(g,2),x=m[0],h=m[1],Z=(0,J.jsxs)("div",{className:"team-title",children:[(0,J.jsx)("span",{children:"Team info"}),(0,J.jsx)(W.Z,{shape:"circle",type:"text",size:"small",loading:x,icon:(0,J.jsx)(nt.Z,{}),onClick:(0,i.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h(!0),e.next=3,c();case 3:return e.next=5,l();case 5:h(!1),d();case 7:case"end":return e.stop()}}),e)})))})]});return(0,J.jsx)(U.Z,{content:v,trigger:"click",placement:"bottomRight",title:Z,getPopupContainer:function(e){return e.parentElement},destroyTooltipOnHide:!0,children:(0,J.jsx)(W.Z,{type:"text",icon:(0,J.jsx)(Ue.Z,{status:r?"success":"error",count:r?p:"!",size:"small",children:(0,J.jsx)(tt.Z,{})})})})},ft=function(e){var t,n=e.instantSave,r=null!==(t=(0,b.UO)().noteID)&&void 0!==t?t:"",u=(0,b.s0)(),o=function(){var e=(0,i.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n();case 2:return e.next=4,(0,at.r8)(r);case 4:if(e.sent){e.next=7;break}return e.abrupt("return",Be.ZP.error("Can't create room."));case 7:return e.next=9,(0,k.SP)(r,{team:!0});case 9:u("/team/"+r);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,J.jsx)(W.Z,{type:"text",icon:(0,J.jsx)(rt.Z,{}),onClick:function(){He.Z.confirm({title:"Enable team editing",content:"This will make your note public to anyone with the link.",icon:(0,J.jsx)(tt.Z,{style:{color:"#555"}}),onOk:o})}})},pt=["saved","instantSave"],vt=function(e){var t=e.saved,n=e.instantSave,a=(0,u.Z)(e,pt);return(0,J.jsxs)("header",{children:[(0,J.jsx)(ye,{saved:t,instantSave:n}),(0,J.jsx)(Fe,(0,r.Z)({},a)),(0,J.jsx)(ot,{instantSave:n})]})},gt=n(92560),mt=n(97892),xt=n.n(mt),ht=n(6593),Zt=n.n(ht);xt().extend(Zt());var kt=function(e){var t=e.noteInfo,n=e.renameNote,r=(0,s.useState)(!1),a=(0,o.Z)(r,2),u=a[0],i=a[1],c=(0,s.useState)(t.name),l=(0,o.Z)(c,2),d=l[0],f=l[1],p=(0,s.useState)(!1),v=(0,o.Z)(p,2),g=v[0],m=v[1],x=t.lastTime,h=t.createTime,Z=(0,s.useMemo)((function(){return xt()(x).calendar()}),[x]),k=(0,s.useMemo)((function(){return xt()(h).calendar()}),[h]);return(0,J.jsx)("nav",{children:(0,J.jsxs)("div",{className:"info",children:[u?(0,J.jsx)(gt.Z,{className:"title",size:"large",bordered:!1,value:d,onChange:function(e){return f(e.target.value)},autoFocus:!0,onBlur:function(){n(d),i(!1)}}):(0,J.jsx)("p",{className:"title",onClick:function(){return i(!0)},children:d}),(0,J.jsxs)("span",{className:"time",onClick:function(){return m((function(e){return!e}))},children:[g?k:Z,(0,J.jsx)("span",{className:"label",children:g?"Created":"Last Edited"})]})]})})},jt=["pageRec","pdf","pageOrder"],bt=["image","marked"],yt=["pageRec","pdf","pageOrder"];function St(){return(0,J.jsx)(X.kV,{children:(0,J.jsx)(d.Wk,{children:(0,J.jsx)(l.w3,{children:(0,J.jsx)(It,{})})})})}var It=function(){var e,t=null!==(e=(0,b.UO)().noteID)&&void 0!==e?e:"",n=(0,b.s0)(),d=(0,s.useState)(),p=(0,o.Z)(d,2),v=p[0],x=p[1],h=(0,s.useState)(),y=(0,o.Z)(h,2),S=y[0],w=y[1],D=(0,s.useState)(),R=(0,o.Z)(D,2),F=R[0],T=R[1],L=(0,s.useState)(),M=(0,o.Z)(L,2),z=M[0],V=M[1],A=(0,s.useState)(!0),U=(0,o.Z)(A,2),B=U[0],H=U[1],W=(0,s.useContext)(ee.TeamCtx),_=W.io,K=W.addTeamStatePage,X=W.checkOpID;(0,s.useEffect)((function(){(0,i.Z)((0,a.Z)().mark((function e(){var r,i,o,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,k.U9)(t);case 2:if(r=e.sent){e.next=6;break}return Be.ZP.error("Note not found"),e.abrupt("return",n("/"));case 6:i=r.pageRec,r.pdf,o=r.pageOrder,s=(0,u.Z)(r,jt),x((0,m.D5)(i)),V(o),w(s),T(Z.createFromPages(i));case 11:case"end":return e.stop()}}),e)})))()}),[n,t]),(0,s.useEffect)((function(){S&&(document.title=S.name+" - Multibility")}),[S]),(0,s.useEffect)((function(){return document.body.classList.add("reader"),function(){return document.body.classList.remove("reader")}}),[]);var G=(0,f.Z)((0,i.Z)((0,a.Z)().mark((function e(){var n,u,i,o,s=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=s.length>0&&void 0!==s[0]&&s[0],i=v,u&&(null===F||void 0===F||F.getStates().forEach((function(e,t){var n;i=null===(n=i)||void 0===n?void 0:n.update(t,c.BJ,(function(t){return(0,r.Z)((0,r.Z)({},t),{},{state:g.Dw.flaten(e)})}))})),x(i)),o=null===(n=i)||void 0===n?void 0:n.toObject(),e.next=6,(0,k.SP)(t,{pageRec:o});case 6:H(!0);case 7:case"end":return e.stop()}}),e)})))),Y=(0,s.useCallback)((0,C.debounce)(G,5e3),[G]),Q=Y.flush,q=function(e,t){x((function(n){return null===n||void 0===n?void 0:n.update(e,c.BJ,t)})),H(!1),Y()},$=function(){var e=(0,i.Z)((0,a.Z)().mark((function e(n){var r,u=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>1&&void 0!==u[1]&&u[1],V(n),e.next=4,(0,k.SP)(t,{pageOrder:n});case 4:return e.next=6,Q();case 6:r&&te(n);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),te=function(e){return null===_||void 0===_?void 0:_.emit("reorder",{pageOrder:e})},ne=(0,f.Z)((function(e){var t=e.deleted,n=e.pageOrder,r=e.prevOrder;$(n),t&&(0,j.Ow)((function(){return $(r,!0)}))})),ae=(0,f.Z)((function(e){var t=e.pageOrder,n=e.pageID,r=e.newPage;$(t),q(n,(function(){return r})),T((function(e){return null===e||void 0===e?void 0:e.addState(n,r)}))}));(0,s.useEffect)((function(){return null===_||void 0===_||_.on("reorder",ne),null===_||void 0===_||_.on("newPage",ae),function(){null===_||void 0===_||_.removeAllListeners()}}),[_,ne,ae]);var ue=function(e){null===_||void 0===_||_.emit("push",{operation:e},(function(t){var n=t.timestamp,r=t.prevID,a=t.currID;!function(t){if("add"===e.type){var n=e.pageID,r=e.stroke.uid;T((function(e){return null===e||void 0===e?void 0:e.syncStrokeTime(n,r,t)}))}}(n),X(r,a)}))},ie=function(e,t,n){n.image,n.marked;var r=(0,u.Z)(n,bt);null===_||void 0===_||_.emit("newPage",{pageOrder:e,pageID:t,newPage:r}),K(t,n)},oe=function(e){if(F){var t=e(F);if(t!==F){T(t),H(!1),Y(!0);var n=t.lastOp;n&&ue(n)}}},se=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(z){var n=t?null===v||void 0===v?void 0:v.get(e):void 0,r=(0,c.D4)(n),a=(0,o.Z)(r,2),u=a[0],i=a[1],s=O(z,e,u);ie(s,u,i),$(s),q(u,(function(){return i})),T((function(e){return null===e||void 0===e?void 0:e.addState(u,i)}))}},ce=function(){var e=(0,C.last)(z);e&&se(e)},le=(0,s.useState)(100),fe=(0,o.Z)(le,2),pe=fe[0],ve=fe[1],ge=100===pe,me=(100-pe)/2+"%",xe={paddingLeft:me,paddingRight:me},he=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=(0,s.useState)((0,m.D5)()),u=(0,o.Z)(r,2),c=u[0],l=u[1],d=(0,s.useRef)(!1),p=(0,s.useState)(""),v=(0,o.Z)(p,2),g=v[0],x=v[1];(0,s.useEffect)((function(){(0,i.Z)((0,a.Z)().mark((function t(){var n;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,E.getItem(e);case 2:if(n=t.sent){t.next=5;break}return t.abrupt("return",d.current=!0);case 5:x(n);case 6:case"end":return t.stop()}}),t)})))()}),[e]),(0,s.useLayoutEffect)((function(){var e=c.get(g);!d.current&&e&&(e.scrollIntoView(),d.current=!0)}),[g,c]);var h=(0,s.useState)((0,m.D5)()),Z=(0,o.Z)(h,2),k=Z[0],j=Z[1],b=(0,s.useDeferredValue)(k),y=(0,s.useDeferredValue)(t),S=(0,s.useMemo)((function(){return N(b,y)}),[b,y]);(0,s.useEffect)((function(){d.current&&P(e,S)}),[e,S]);var w=(0,f.Z)((function(){var e,t,n=c.get(S),r=null===n||void 0===n||null===(e=n.parentElement)||void 0===e||null===(t=e.parentElement)||void 0===t?void 0:t.firstElementChild;return r?-n.getBoundingClientRect().top+r.getBoundingClientRect().height:0})),D=(0,s.useMemo)(w,[t,w].concat((0,I.Z)(n))),C=(0,f.Z)((function(){var e=c.get(S);e&&(e.scrollIntoView(),window.scrollBy(0,D))}));(0,s.useLayoutEffect)(C,[t,C].concat((0,I.Z)(n)));var O=(0,f.Z)((function(e){return function(t){t&&l((function(n){return n.set(e,t)}))}})),R=(0,s.useRef)(0),F=(0,s.useState)(!1),T=(0,o.Z)(F,2),L=T[0],M=T[1],z=function(e){var t=c.get(e);t&&(document.addEventListener("scroll",(function e(){window.clearTimeout(R.current),R.current=window.setTimeout((function(){M(!1),document.removeEventListener("scroll",e)}),50)})),t.scrollIntoView({behavior:"smooth"}),M(!0))};return(0,s.useDebugValue)(S),{scrollPage:z,setInviewRatios:j,sectionRef:O,currPageID:S,scrolling:L}}(t,z,[pe]),Ze=he.setInviewRatios,ke=he.scrollPage,je=he.sectionRef,be=he.currPageID,ye=he.scrolling,Se=(0,l.gX)().finger;(0,s.useEffect)((function(){if(window.BroadcastChannel){var e=new BroadcastChannel("open note");return e.postMessage(t),e.onmessage=function(e){e.data===t&&(Y.cancel(),(0,j.sk)((function(){return n("/")})))},function(){return e.close()}}}),[n,t,Y]);var Ie=function(){var e=(0,i.Z)((0,a.Z)().mark((function e(n){var r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n!==(null===S||void 0===S?void 0:S.name)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,(0,k.SP)(t,{name:n});case 4:return e.next=6,(0,k.U9)(t);case 6:if(r=e.sent){e.next=9;break}return e.abrupt("return");case 9:r.pageRec,r.pdf,r.pageOrder,i=(0,u.Z)(r,yt),w(i);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();if(!F||!z||!v||!S)return null;var we={noteID:t,pageRec:v,pageOrder:z,stateSet:F,currPageID:be,size:pe},De={scrollPage:ke,switchPageMarked:function(e){return q(e,(function(e){return(0,r.Z)((0,r.Z)({},e),{},{marked:!e.marked})}))},addFinalPage:ce,addPage:se,deletePage:function(e){var t=null===z||void 0===z?void 0:z.filter((function(t){return t!==e}));(null===t||void 0===t?void 0:t.length)&&$(t,!0)},saveReorder:$,setSize:ve};return(0,J.jsxs)("div",{className:"reader container",children:[(0,J.jsx)(vt,{saved:B,instantSave:Q,handleUndo:function(){return oe((function(e){return e.undo()}))},handleRedo:function(){return oe((function(e){return e.redo()}))},undoable:F.isUndoable(),redoable:F.isRedoable()}),(0,J.jsx)(kt,{noteInfo:S,renameNote:Ie}),(0,J.jsxs)("main",{"data-finger":Se,"data-full":ge,style:xe,children:[z.map((function(e){return(0,J.jsx)("section",{className:"note-page",ref:je(e),children:(0,J.jsx)(wt,(0,r.Z)({uid:e,updateStateSet:oe,setInviewRatios:Ze,scrolling:ye},we))},e)})),(0,J.jsx)("footer",{children:(0,J.jsx)(re,{addFinalPage:ce})})]}),(0,J.jsx)(de,(0,r.Z)((0,r.Z)({},we),De))]})},wt=function(e){var t=e.uid,n=e.updateStateSet,r=e.setInviewRatios,a=e.scrolling,u=e.pageRec,i=e.stateSet,o=e.currPageID,c=e.pageOrder,l=e.noteID,d=(0,s.useContext)(ee.TeamCtx),p=d.teamState,v=d.ignores,g=u.get(t),m=i.getOneState(t),x=null===p||void 0===p?void 0:p.getOnePageStateMap(t),h=(0,f.Z)((function(e){n((function(n){return n.setState(t,e)}))})),Z=(0,f.Z)((function(e){if(!e)return r((function(e){return e.delete(t)}));r((function(n){return n.set(t,e)}))})),k=(0,s.useMemo)((function(){if(!c)return!1;var e=c.indexOf(o),n=c.indexOf(t);return Math.abs(n-e)<=1}),[o,t,c]);return g&&m?(0,J.jsx)(y.default,{drawState:m,teamStateMap:x,updateState:h,pdfIndex:g.pdfIndex,noteID:l,ignores:v,onViewChange:Z,preload:k,skipInView:a}):null}},60559:function(e,t,n){n.r(t),n.d(t,{TeamCtx:function(){return b},default:function(){return y}});var r=n(29439),a=n(74165),u=n(15861),i=n(72791),o=n(98211),s=n(51570),c=n(44428),l=n(69951),d=n(57689),f=n(49742),p=n(79856),v=n(99361),g=n(50419),m=n(24124),x=n(10814),h=n(763),Z=n(1438),k=n.n(Z),j=n(80184),b=i.createContext({io:void 0,code:0,teamOn:!1,connected:!1,ignores:(0,m.l4)(),userRec:{},teamState:void 0,resetIO:function(){},loadInfo:function(){var e=(0,u.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!1);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),loadState:function(){},setIgnores:function(){},addTeamStatePage:function(e,t){},checkOpID:function(e,t){}});function y(){var e,t=null!==(e=(0,d.UO)().noteID)&&void 0!==e?e:"",n=(0,i.useState)(),Z=(0,r.Z)(n,2),y=Z[0],S=Z[1],I=(0,i.useState)(-2),w=(0,r.Z)(I,2),D=w[0],C=w[1],E=(0,i.useState)({}),P=(0,r.Z)(E,2),N=P[0],O=P[1],R=(0,i.useState)((0,m.l4)()),F=(0,r.Z)(R,2),T=F[0],L=F[1],M=(0,i.useState)(),z=(0,r.Z)(M,2),V=z[0],A=z[1],U=(0,i.useState)(!1),B=(0,r.Z)(U,2),H=B[0],W=B[1],_=(0,i.useState)(!1),K=(0,r.Z)(_,2),X=K[0],G=K[1],J=(0,d.s0)(),Y=(0,i.useState)(""),Q=(0,r.Z)(Y,2),q=Q[0],$=Q[1],ee=(0,o.Z)((0,u.Z)((0,a.Z)().mark((function e(){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return $("Loading note info..."),e.next=3,(0,s.dn)(t,(function(e){$("Downloading PDF: "+k()(e))}));case 3:if(n=e.sent){e.next=7;break}return g.ZP.error("Failed loading the team note info"),e.abrupt("return",!1);case 7:return C(n.code),e.abrupt("return",!0);case 9:case"end":return e.stop()}}),e)})))),te=(0,i.useCallback)((0,h.throttle)(function(){var e=(0,u.Z)((0,a.Z)().mark((function e(n){var r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return $("Loading team note..."),e.next=3,(0,s.CD)(t,(function(e){e<1024||($("Loading team note: "+k()(e)),null===n||void 0===n||n(e))}));case 3:if(r=e.sent){e.next=7;break}return g.ZP.error("Failed loading the team note state"),e.abrupt("return",!1);case 7:return S(p.f.createFromTeamPages(r)),e.abrupt("return",!0);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),1e4),[t]),ne=function(){var e,t="SYNC",n=g.ZP.loading({content:"Syncing...",key:t});null===(e=te((function(e){var n="Syncing: "+k()(e);g.ZP.loading({content:n,key:t,duration:0})})))||void 0===e||e.then(n)},re=(0,o.Z)((function(){return A(function(e){return(0,c.io)(s._n,{query:{userID:(0,l.VN)(),userName:(0,l.vW)(),noteID:e}})}(t))})),ae=(0,o.Z)((function(){(0,s.f1)(t)})),ue=(0,i.useRef)(""),ie=(0,o.Z)((function(e,t){var n=e&&ue.current&&e!==ue.current;ue.current=t,n&&ne()})),oe=(0,o.Z)((function(e){var t=ue.current&&ue.current!==e;ue.current=e,t&&ne()}));(0,i.useEffect)((function(){var e=function(){var e=(0,u.Z)((0,a.Z)().mark((function e(){var t,n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ee();case 2:return t=e.sent,e.next=5,te();case 5:if(n=e.sent,t&&n){e.next=8;break}return e.abrupt("return",J("/"));case 8:W(!0),re(),ae();case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return e(),ae}),[ee,te,J,re,ae]),(0,i.useEffect)((function(){if(V)return V.on("push",(function(e){var t=e.operation,n=e.userID,r=e.prevID,a=e.currID;S((function(e){return null===e||void 0===e?void 0:e.pushOperation(t,n)})),ie(r,a)})),V.on("join",(function(e){var t=e.joined,n=e.members,r=t.userID,a=t.userName;O(n),r!==(0,l.VN)()&&(0,f.gd)(r,a)})),V.on("leave",(function(e){var t=e.leaved,n=e.members,r=t.userID,a=t.userName;if(O(n),r===(0,l.VN)())return V.emit("join");(0,f.mz)(r,a)})),V.on("newPage",(function(e){var t=e.pageID,n=e.newPage;S((function(e){return null===e||void 0===e?void 0:e.addPage(t,n)}))})),V.on("reset",(function(e){var t=e.userID,n=e.pageRec;t!==(0,l.VN)()&&S((function(e){return null===e||void 0===e?void 0:e.resetUser(t,n)}))})),V.on("connect_error",console.error),V.on("disconnect",(function(){return G(!1)})),V.on("connect",(function(){return G(!0)})),V.on("connected",(function(e){var t=e.currID;return oe(t)})),function(){V.removeAllListeners(),V.close()}}),[V,ie,oe]);return(0,j.jsx)(v.g,{loading:!H,text:q,children:(0,j.jsx)(b.Provider,{value:{io:V,code:D,teamOn:!0,ignores:T,userRec:N,connected:X,teamState:y,resetIO:re,loadInfo:ee,loadState:te,setIgnores:L,addTeamStatePage:function(e,t){S((function(n){return null===n||void 0===n?void 0:n.addPage(e,t)}))},checkOpID:ie},children:(0,j.jsx)(x.default,{})})})}},49742:function(e,t,n){n.d(t,{Ow:function(){return l},gd:function(){return d},mz:function(){return f},sk:function(){return p}});var r=n(50419),a=n(87309),u=n(50759),i=n(56058),o=n(87962),s=n(52242),c=n(80184),l=function(e){r.ZP.warning({content:(0,c.jsxs)(c.Fragment,{children:["One page was deleted.",(0,c.jsx)(a.Z,{size:"small",type:"link",onClick:function(){r.ZP.destroy("DELETE"),e()},children:"Undo"})]}),key:"DELETE",duration:10})},d=function(e,t){r.ZP.success({content:"".concat(t," joined the room"),icon:(0,c.jsx)(i.Z,{}),key:e})},f=function(e,t){r.ZP.warning({content:"".concat(t," left the room"),icon:(0,c.jsx)(o.Z,{}),key:e})},p=function(e){u.Z.error({title:"This note is opened in another tab.",okText:"Back",okButtonProps:{icon:(0,c.jsx)(s.Z,{})},onOk:e})}}}]);
//# sourceMappingURL=312.81672c70.chunk.js.map